import{s as $t,t as ut,T as ws,u as Co,E as yh,c as Ne,U as ul,v as ro,w as un,S as _s,x as ss,e as rt,d as Kt,V as z,h as ft,y as ns,a as Ae,P as Ih,C as Ht,z as Rs,H as on,J as Ch,W as po,b as ei,K as Vt,O as an,N as bo,Q as Jn,r as pi,X as ys,Y as ln,Z as mo,_ as bh,$ as Th,a0 as Fs,a1 as go,a2 as hi,a3 as Ni,i as Pa,a4 as $n,a5 as Gd,a6 as To,a7 as dl,a8 as fl,a9 as pl,aa as ml,ab as gl,ac as xo,ad as El,ae as vl,af as wl,ag as yl,ah as Il,ai as Cl,aj as bl,ak as xh,B as Rt,al as Ah,am as _h,an as er,ao as Hd,ap as jd,aq as zi,ar as Wd,as as Zd,f as Kd,at as Rh,G as Eo,au as Nt,av as Ct,L as rs,aw as Ao,ax as Xd,ay as si,az as Qd,aA as Bi,aB as Ar,aC as qd,aD as xn,j as Jd,aE as $d,aF as ef,aG as tf,aH as sf,aI as nf,aJ as rf,I as Tl,aK as xl,aL as Al,aM as oo,aN as _l,aO as of,aP as An,aQ as Ui,aR as af,aS as lf,aT as cf,aU as hf,aV as uf,aW as pc,aX as df,aY as ff,aZ as pf,a_ as Fh,a$ as mf,b0 as mc,b1 as gf,b2 as Ef,b3 as vf,b4 as wf,b5 as yf,b6 as If,b7 as Cf,b8 as Da,b9 as tn,ba as bf,bb as Tf}from"./web-ifc-api-ub-SNF9_.js";var xf=Object.defineProperty,Af=(l,e,t)=>e in l?xf(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,S=(l,e,t)=>(Af(l,typeof e!="symbol"?e+"":e,t),t),_f=Object.defineProperty,Rf=(l,e,t)=>e in l?_f(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t,R=(l,e,t)=>(Rf(l,typeof e!="symbol"?e+"":e,t),t);const Sh=0,Ff=1,Sf=2,gc=2,ca=1.25,Ec=1,ao=6*4+4+4,_o=65535,Of=Math.pow(2,-24),ha=Symbol("SKIP_GENERATION");function Pf(l){return l.index?l.index.count:l.attributes.position.count}function dn(l){return Pf(l)/3}function Df(l,e=ArrayBuffer){return l>65535?new Uint32Array(new e(4*l)):new Uint16Array(new e(2*l))}function Mf(l,e){if(!l.index){const t=l.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s=Df(t,i);l.setIndex(new Kt(s,1));for(let n=0;n<t;n++)s[n]=n}}function Oh(l){const e=dn(l),t=l.drawRange,i=t.start/3,s=(t.start+t.count)/3,n=Math.max(0,i),r=Math.min(e,s)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function Ph(l){if(!l.groups||!l.groups.length)return Oh(l);const e=[],t=new Set,i=l.drawRange,s=i.start/3,n=(i.start+i.count)/3;for(const o of l.groups){const a=o.start/3,c=(o.start+o.count)/3;t.add(Math.max(s,a)),t.add(Math.min(n,c))}const r=Array.from(t.values()).sort((o,a)=>o-a);for(let o=0;o<r.length-1;o++){const a=r[o],c=r[o+1];e.push({offset:Math.floor(a),count:Math.floor(c-a)})}return e}function Lf(l){if(l.groups.length===0)return!1;const e=dn(l),t=Ph(l).sort((n,r)=>n.offset-r.offset),i=t[t.length-1];i.count=Math.min(e-i.offset,i.count);let s=0;return t.forEach(({count:n})=>s+=n),e!==s}function gt(l,e,t){return t.min.x=e[l],t.min.y=e[l+1],t.min.z=e[l+2],t.max.x=e[l+3],t.max.y=e[l+4],t.max.z=e[l+5],t}function Nf(l){l[0]=l[1]=l[2]=1/0,l[3]=l[4]=l[5]=-1/0}function vc(l){let e=-1,t=-1/0;for(let i=0;i<3;i++){const s=l[i+3]-l[i];s>t&&(t=s,e=i)}return e}function wc(l,e){e.set(l)}function yc(l,e,t){let i,s;for(let n=0;n<3;n++){const r=n+3;i=l[n],s=e[n],t[n]=i<s?i:s,i=l[r],s=e[r],t[r]=i>s?i:s}}function _r(l,e,t){for(let i=0;i<3;i++){const s=e[l+2*i],n=e[l+2*i+1],r=s-n,o=s+n;r<t[i]&&(t[i]=r),o>t[i+3]&&(t[i+3]=o)}}function _n(l){const e=l[3]-l[0],t=l[4]-l[1],i=l[5]-l[2];return 2*(e*t+t*i+i*e)}function ua(l,e,t,i,s=null){let n=1/0,r=1/0,o=1/0,a=-1/0,c=-1/0,u=-1/0,d=1/0,f=1/0,m=1/0,E=-1/0,g=-1/0,w=-1/0;const y=s!==null;for(let I=e*6,_=(e+t)*6;I<_;I+=6){const C=l[I+0],F=l[I+1],M=C-F,D=C+F;M<n&&(n=M),D>a&&(a=D),y&&C<d&&(d=C),y&&C>E&&(E=C);const B=l[I+2],N=l[I+3],G=B-N,Q=B+N;G<r&&(r=G),Q>c&&(c=Q),y&&B<f&&(f=B),y&&B>g&&(g=B);const O=l[I+4],V=l[I+5],T=O-V,J=O+V;T<o&&(o=T),J>u&&(u=J),y&&O<m&&(m=O),y&&O>w&&(w=O)}i[0]=n,i[1]=r,i[2]=o,i[3]=a,i[4]=c,i[5]=u,y&&(s[0]=d,s[1]=f,s[2]=m,s[3]=E,s[4]=g,s[5]=w)}function Uf(l,e,t,i){let s=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,c=-1/0;for(let u=e*6,d=(e+t)*6;u<d;u+=6){const f=l[u+0];f<s&&(s=f),f>o&&(o=f);const m=l[u+2];m<n&&(n=m),m>a&&(a=m);const E=l[u+4];E<r&&(r=E),E>c&&(c=E)}i[0]=s,i[1]=n,i[2]=r,i[3]=o,i[4]=a,i[5]=c}function Bf(l,e){Nf(e);const t=l.attributes.position,i=l.index?l.index.array:null,s=dn(l),n=new Float32Array(s*6),r=t.normalized,o=t.array,a=t.offset||0;let c=3;t.isInterleavedBufferAttribute&&(c=t.data.stride);const u=["getX","getY","getZ"];for(let d=0;d<s;d++){const f=d*3,m=d*6;let E=f+0,g=f+1,w=f+2;i&&(E=i[E],g=i[g],w=i[w]),r||(E=E*c+a,g=g*c+a,w=w*c+a);for(let y=0;y<3;y++){let I,_,C;r?(I=t[u[y]](E),_=t[u[y]](g),C=t[u[y]](w)):(I=o[E+y],_=o[g+y],C=o[w+y]);let F=I;_<F&&(F=_),C<F&&(F=C);let M=I;_>M&&(M=_),C>M&&(M=C);const D=(M-F)/2,B=y*2;n[m+B+0]=F+D,n[m+B+1]=D+(Math.abs(F)+D)*Of,F<e[y]&&(e[y]=F),M>e[y+3]&&(e[y+3]=M)}}return n}const Di=32,kf=(l,e)=>l.candidate-e.candidate,Xi=new Array(Di).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Rr=new Float32Array(6);function zf(l,e,t,i,s,n){let r=-1,o=0;if(n===Sh)r=vc(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===Ff)r=vc(l),r!==-1&&(o=Vf(t,i,s,r));else if(n===Sf){const a=_n(l);let c=ca*s;const u=i*6,d=(i+s)*6;for(let f=0;f<3;f++){const m=e[f],E=(e[f+3]-m)/Di;if(s<Di/4){const g=[...Xi];g.length=s;let w=0;for(let I=u;I<d;I+=6,w++){const _=g[w];_.candidate=t[I+2*f],_.count=0;const{bounds:C,leftCacheBounds:F,rightCacheBounds:M}=_;for(let D=0;D<3;D++)M[D]=1/0,M[D+3]=-1/0,F[D]=1/0,F[D+3]=-1/0,C[D]=1/0,C[D+3]=-1/0;_r(I,t,C)}g.sort(kf);let y=s;for(let I=0;I<y;I++){const _=g[I];for(;I+1<y&&g[I+1].candidate===_.candidate;)g.splice(I+1,1),y--}for(let I=u;I<d;I+=6){const _=t[I+2*f];for(let C=0;C<y;C++){const F=g[C];_>=F.candidate?_r(I,t,F.rightCacheBounds):(_r(I,t,F.leftCacheBounds),F.count++)}}for(let I=0;I<y;I++){const _=g[I],C=_.count,F=s-_.count,M=_.leftCacheBounds,D=_.rightCacheBounds;let B=0;C!==0&&(B=_n(M)/a);let N=0;F!==0&&(N=_n(D)/a);const G=Ec+ca*(B*C+N*F);G<c&&(r=f,c=G,o=_.candidate)}}else{for(let y=0;y<Di;y++){const I=Xi[y];I.count=0,I.candidate=m+E+y*E;const _=I.bounds;for(let C=0;C<3;C++)_[C]=1/0,_[C+3]=-1/0}for(let y=u;y<d;y+=6){let I=~~((t[y+2*f]-m)/E);I>=Di&&(I=Di-1);const _=Xi[I];_.count++,_r(y,t,_.bounds)}const g=Xi[Di-1];wc(g.bounds,g.rightCacheBounds);for(let y=Di-2;y>=0;y--){const I=Xi[y],_=Xi[y+1];yc(I.bounds,_.rightCacheBounds,I.rightCacheBounds)}let w=0;for(let y=0;y<Di-1;y++){const I=Xi[y],_=I.count,C=I.bounds,F=Xi[y+1].rightCacheBounds;_!==0&&(w===0?wc(C,Rr):yc(C,Rr,Rr)),w+=_;let M=0,D=0;w!==0&&(M=_n(Rr)/a);const B=s-w;B!==0&&(D=_n(F)/a);const N=Ec+ca*(M*w+D*B);N<c&&(r=f,c=N,o=I.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function Vf(l,e,t,i){let s=0;for(let n=e,r=e+t;n<r;n++)s+=l[n*6+i*2];return s/t}class Fr{constructor(){}}function Yf(l,e,t,i,s,n){let r=i,o=i+s-1;const a=n.pos,c=n.axis*2;for(;;){for(;r<=o&&t[r*6+c]<a;)r++;for(;r<=o&&t[o*6+c]>=a;)o--;if(r<o){for(let u=0;u<3;u++){let d=e[r*3+u];e[r*3+u]=e[o*3+u],e[o*3+u]=d}for(let u=0;u<6;u++){let d=t[r*6+u];t[r*6+u]=t[o*6+u],t[o*6+u]=d}r++,o--}else return r}}function Gf(l,e,t,i,s,n){let r=i,o=i+s-1;const a=n.pos,c=n.axis*2;for(;;){for(;r<=o&&t[r*6+c]<a;)r++;for(;r<=o&&t[o*6+c]>=a;)o--;if(r<o){let u=l[r];l[r]=l[o],l[o]=u;for(let d=0;d<6;d++){let f=t[r*6+d];t[r*6+d]=t[o*6+d],t[o*6+d]=f}r++,o--}else return r}}function Hf(l,e){const t=(l.index?l.index.count:l.attributes.position.count)/3,i=t>2**16,s=i?4:2,n=e?new SharedArrayBuffer(t*s):new ArrayBuffer(t*s),r=i?new Uint32Array(n):new Uint16Array(n);for(let o=0,a=r.length;o<a;o++)r[o]=o;return r}function jf(l,e){const t=l.geometry,i=t.index?t.index.array:null,s=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,a=e.onProgress,c=dn(t),u=l._indirectBuffer;let d=!1;const f=new Float32Array(6),m=new Float32Array(6),E=Bf(t,f),g=e.indirect?Gf:Yf,w=[],y=e.indirect?Oh(t):Ph(t);if(y.length===1){const C=y[0],F=new Fr;F.boundingData=f,Uf(E,C.offset,C.count,m),_(F,C.offset,C.count,m),w.push(F)}else for(let C of y){const F=new Fr;F.boundingData=new Float32Array(6),ua(E,C.offset,C.count,F.boundingData,m),_(F,C.offset,C.count,m),w.push(F)}return w;function I(C){a&&a(C/c)}function _(C,F,M,D=null,B=0){if(!d&&B>=s&&(d=!0,n&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),M<=r||B>=s)return I(F+M),C.offset=F,C.count=M,C;const N=zf(C.boundingData,D,E,F,M,o);if(N.axis===-1)return I(F+M),C.offset=F,C.count=M,C;const G=g(u,i,E,F,M,N);if(G===F||G===F+M)I(F+M),C.offset=F,C.count=M;else{C.splitAxis=N.axis;const Q=new Fr,O=F,V=G-F;C.left=Q,Q.boundingData=new Float32Array(6),ua(E,O,V,Q.boundingData,m),_(Q,O,V,m,B+1);const T=new Fr,J=G,de=M-V;C.right=T,T.boundingData=new Float32Array(6),ua(E,J,de,T.boundingData,m),_(T,J,de,m,B+1)}return C}}function Wf(l,e){const t=l.geometry;e.indirect&&(l._indirectBuffer=Hf(t,e.useSharedArrayBuffer),Lf(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),l._indirectBuffer||Mf(t,e);const i=jf(l,e);let s,n,r;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let d=0;d<i.length;d++){const f=i[d];let m=c(f);const E=new a(ao*m);s=new Float32Array(E),n=new Uint32Array(E),r=new Uint16Array(E),u(0,f),o.push(E)}l._roots=o;return;function c(d){return d.count?1:1+c(d.left)+c(d.right)}function u(d,f){const m=d/4,E=d/2,g=!!f.count,w=f.boundingData;for(let y=0;y<6;y++)s[m+y]=w[y];if(g){const y=f.offset,I=f.count;return n[m+6]=y,r[E+14]=I,r[E+15]=_o,d+ao}else{const y=f.left,I=f.right,_=f.splitAxis;let C;if(C=u(d+ao,y),C/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[m+6]=C/4,C=u(C,I),n[m+7]=_,C}}}class Vi{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,s=-1/0;for(let n=0,r=e.length;n<r;n++){const o=e[n][t];i=o<i?o:i,s=o>s?o:s}this.min=i,this.max=s}setFromPoints(e,t){let i=1/0,s=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=e.dot(o);i=a<i?a:i,s=a>s?a:s}this.min=i,this.max=s}isSeparated(e){return this.min>e.max||e.min>this.max}}Vi.prototype.setFromBox=function(){const l=new z;return function(e,t){const i=t.min,s=t.max;let n=1/0,r=-1/0;for(let o=0;o<=1;o++)for(let a=0;a<=1;a++)for(let c=0;c<=1;c++){l.x=i.x*o+s.x*(1-o),l.y=i.y*a+s.y*(1-a),l.z=i.z*c+s.z*(1-c);const u=e.dot(l);n=Math.min(u,n),r=Math.max(u,r)}this.min=n,this.max=r}}();const Zf=function(){const l=new z,e=new z,t=new z;return function(i,s,n){const r=i.start,o=l,a=s.start,c=e;t.subVectors(r,a),l.subVectors(i.end,i.start),e.subVectors(s.end,s.start);const u=t.dot(c),d=c.dot(o),f=c.dot(c),m=t.dot(o),E=o.dot(o)*f-d*d;let g,w;E!==0?g=(u*d-m*f)/E:g=0,w=(u+g*d)/f,n.x=g,n.y=w}}(),Rl=function(){const l=new ft,e=new z,t=new z;return function(i,s,n,r){Zf(i,s,l);let o=l.x,a=l.y;if(o>=0&&o<=1&&a>=0&&a<=1){i.at(o,n),s.at(a,r);return}else if(o>=0&&o<=1){a<0?s.at(0,r):s.at(1,r),i.closestPointToPoint(r,!0,n);return}else if(a>=0&&a<=1){o<0?i.at(0,n):i.at(1,n),s.closestPointToPoint(n,!0,r);return}else{let c;o<0?c=i.start:c=i.end;let u;a<0?u=s.start:u=s.end;const d=e,f=t;if(i.closestPointToPoint(u,!0,e),s.closestPointToPoint(c,!0,t),d.distanceToSquared(u)<=f.distanceToSquared(c)){n.copy(d),r.copy(u);return}else{n.copy(c),r.copy(f);return}}}}(),Kf=function(){const l=new z,e=new z,t=new ns,i=new $t;return function(s,n){const{radius:r,center:o}=s,{a,b:c,c:u}=n;if(i.start=a,i.end=c,i.closestPointToPoint(o,!0,l).distanceTo(o)<=r||(i.start=a,i.end=u,i.closestPointToPoint(o,!0,l).distanceTo(o)<=r)||(i.start=c,i.end=u,i.closestPointToPoint(o,!0,l).distanceTo(o)<=r))return!0;const d=n.getPlane(t);if(Math.abs(d.distanceToPoint(o))<=r){const f=d.projectPoint(o,e);if(n.containsPoint(f))return!0}return!1}}(),Xf=1e-15;function da(l){return Math.abs(l)<Xf}class mi extends ws{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new z),this.satBounds=new Array(4).fill().map(()=>new Vi),this.points=[this.a,this.b,this.c],this.sphere=new _s,this.plane=new ns,this.needsUpdate=!0}intersectsSphere(e){return Kf(e,this)}update(){const e=this.a,t=this.b,i=this.c,s=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,s);const c=n[1],u=r[1];c.subVectors(e,t),u.setFromPoints(c,s);const d=n[2],f=r[2];d.subVectors(t,i),f.setFromPoints(d,s);const m=n[3],E=r[3];m.subVectors(i,e),E.setFromPoints(m,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}mi.prototype.closestPointToSegment=function(){const l=new z,e=new z,t=new $t;return function(i,s=null,n=null){const{start:r,end:o}=i,a=this.points;let c,u=1/0;for(let d=0;d<3;d++){const f=(d+1)%3;t.start.copy(a[d]),t.end.copy(a[f]),Rl(t,i,l,e),c=l.distanceToSquared(e),c<u&&(u=c,s&&s.copy(l),n&&n.copy(e))}return this.closestPointToPoint(r,l),c=r.distanceToSquared(l),c<u&&(u=c,s&&s.copy(l),n&&n.copy(r)),this.closestPointToPoint(o,l),c=o.distanceToSquared(l),c<u&&(u=c,s&&s.copy(l),n&&n.copy(o)),Math.sqrt(u)}}();mi.prototype.intersectsTriangle=function(){const l=new mi,e=new Array(3),t=new Array(3),i=new Vi,s=new Vi,n=new z,r=new z,o=new z,a=new z,c=new z,u=new $t,d=new $t,f=new $t,m=new z;function E(g,w,y){const I=g.points;let _=0,C=-1;for(let F=0;F<3;F++){const{start:M,end:D}=u;M.copy(I[F]),D.copy(I[(F+1)%3]),u.delta(r);const B=da(w.distanceToPoint(M));if(da(w.normal.dot(r))&&B){y.copy(u),_=2;break}const N=w.intersectLine(u,m);if(!N&&B&&m.copy(M),(N||B)&&!da(m.distanceTo(D))){if(_<=1)(_===1?y.start:y.end).copy(m),B&&(C=_);else if(_>=2){(C===1?y.start:y.end).copy(m),_=2;break}if(_++,_===2&&C===-1)break}}return _}return function(g,w=null,y=!1){this.needsUpdate&&this.update(),g.isExtendedTriangle?g.needsUpdate&&g.update():(l.copy(g),l.update(),g=l);const I=this.plane,_=g.plane;if(Math.abs(I.normal.dot(_.normal))>1-1e-10){const C=this.satBounds,F=this.satAxes;t[0]=g.a,t[1]=g.b,t[2]=g.c;for(let B=0;B<4;B++){const N=C[B],G=F[B];if(i.setFromPoints(G,t),N.isSeparated(i))return!1}const M=g.satBounds,D=g.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let B=0;B<4;B++){const N=M[B],G=D[B];if(i.setFromPoints(G,e),N.isSeparated(i))return!1}for(let B=0;B<4;B++){const N=F[B];for(let G=0;G<4;G++){const Q=D[G];if(n.crossVectors(N,Q),i.setFromPoints(n,e),s.setFromPoints(n,t),i.isSeparated(s))return!1}}return w&&(y||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),w.start.set(0,0,0),w.end.set(0,0,0)),!0}else{const C=E(this,_,d);if(C===1&&g.containsPoint(d.end))return w&&(w.start.copy(d.end),w.end.copy(d.end)),!0;if(C!==2)return!1;const F=E(g,I,f);if(F===1&&this.containsPoint(f.end))return w&&(w.start.copy(f.end),w.end.copy(f.end)),!0;if(F!==2)return!1;if(d.delta(o),f.delta(a),o.dot(a)<0){let O=f.start;f.start=f.end,f.end=O}const M=d.start.dot(o),D=d.end.dot(o),B=f.start.dot(o),N=f.end.dot(o),G=D<B,Q=M<N;return M!==N&&B!==D&&G===Q?!1:(w&&(c.subVectors(d.start,f.start),c.dot(o)>0?w.start.copy(d.start):w.start.copy(f.start),c.subVectors(d.end,f.end),c.dot(o)<0?w.end.copy(d.end):w.end.copy(f.end)),!0)}}}();mi.prototype.distanceToPoint=function(){const l=new z;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();mi.prototype.distanceToTriangle=function(){const l=new z,e=new z,t=["a","b","c"],i=new $t,s=new $t;return function(n,r=null,o=null){const a=r||o?i:null;if(this.intersectsTriangle(n,a))return(r||o)&&(r&&a.getCenter(r),o&&a.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let d;const f=t[u],m=n[f];this.closestPointToPoint(m,l),d=m.distanceToSquared(l),d<c&&(c=d,r&&r.copy(l),o&&o.copy(m));const E=this[f];n.closestPointToPoint(E,l),d=E.distanceToSquared(l),d<c&&(c=d,r&&r.copy(E),o&&o.copy(l))}for(let u=0;u<3;u++){const d=t[u],f=t[(u+1)%3];i.set(this[d],this[f]);for(let m=0;m<3;m++){const E=t[m],g=t[(m+1)%3];s.set(n[E],n[g]),Rl(i,s,l,e);const w=l.distanceToSquared(e);w<c&&(c=w,r&&r.copy(l),o&&o.copy(e))}}return Math.sqrt(c)}}();class jt{constructor(e,t,i){this.isOrientedBox=!0,this.min=new z,this.max=new z,this.matrix=new Ne,this.invMatrix=new Ne,this.points=new Array(8).fill().map(()=>new z),this.satAxes=new Array(3).fill().map(()=>new z),this.satBounds=new Array(3).fill().map(()=>new Vi),this.alignedSatBounds=new Array(3).fill().map(()=>new Vi),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}jt.prototype.update=function(){return function(){const l=this.matrix,e=this.min,t=this.max,i=this.points;for(let a=0;a<=1;a++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){const d=1*a|2*c|4*u,f=i[d];f.x=a?t.x:e.x,f.y=c?t.y:e.y,f.z=u?t.z:e.z,f.applyMatrix4(l)}const s=this.satBounds,n=this.satAxes,r=i[0];for(let a=0;a<3;a++){const c=n[a],u=s[a],d=1<<a,f=i[d];c.subVectors(r,f),u.setFromPoints(c,i)}const o=this.alignedSatBounds;o[0].setFromPointsField(i,"x"),o[1].setFromPointsField(i,"y"),o[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();jt.prototype.intersectsBox=function(){const l=new Vi;return function(e){this.needsUpdate&&this.update();const t=e.min,i=e.max,s=this.satBounds,n=this.satAxes,r=this.alignedSatBounds;if(l.min=t.x,l.max=i.x,r[0].isSeparated(l)||(l.min=t.y,l.max=i.y,r[1].isSeparated(l))||(l.min=t.z,l.max=i.z,r[2].isSeparated(l)))return!1;for(let o=0;o<3;o++){const a=n[o],c=s[o];if(l.setFromBox(a,e),c.isSeparated(l))return!1}return!0}}();jt.prototype.intersectsTriangle=function(){const l=new mi,e=new Array(3),t=new Vi,i=new Vi,s=new z;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(l.copy(n),l.update(),n=l);const r=this.satBounds,o=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let d=0;d<3;d++){const f=r[d],m=o[d];if(t.setFromPoints(m,e),f.isSeparated(t))return!1}const a=n.satBounds,c=n.satAxes,u=this.points;for(let d=0;d<3;d++){const f=a[d],m=c[d];if(t.setFromPoints(m,u),f.isSeparated(t))return!1}for(let d=0;d<3;d++){const f=o[d];for(let m=0;m<4;m++){const E=c[m];if(s.crossVectors(f,E),t.setFromPoints(s,e),i.setFromPoints(s,u),t.isSeparated(i))return!1}}return!0}}();jt.prototype.closestPointToPoint=function(){return function(l,e){return this.needsUpdate&&this.update(),e.copy(l).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();jt.prototype.distanceToPoint=function(){const l=new z;return function(e){return this.closestPointToPoint(e,l),e.distanceTo(l)}}();jt.prototype.distanceToBox=function(){const l=["x","y","z"],e=new Array(12).fill().map(()=>new $t),t=new Array(12).fill().map(()=>new $t),i=new z,s=new z;return function(n,r=0,o=null,a=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(o||a)&&(n.getCenter(s),this.closestPointToPoint(s,i),n.closestPointToPoint(i,s),o&&o.copy(i),a&&a.copy(s)),0;const c=r*r,u=n.min,d=n.max,f=this.points;let m=1/0;for(let g=0;g<8;g++){const w=f[g];s.copy(w).clamp(u,d);const y=w.distanceToSquared(s);if(y<m&&(m=y,o&&o.copy(w),a&&a.copy(s),y<c))return Math.sqrt(y)}let E=0;for(let g=0;g<3;g++)for(let w=0;w<=1;w++)for(let y=0;y<=1;y++){const I=(g+1)%3,_=(g+2)%3,C=w<<I|y<<_,F=1<<g|w<<I|y<<_,M=f[C],D=f[F];e[E].set(M,D);const B=l[g],N=l[I],G=l[_],Q=t[E],O=Q.start,V=Q.end;O[B]=u[B],O[N]=w?u[N]:d[N],O[G]=y?u[G]:d[N],V[B]=d[B],V[N]=w?u[N]:d[N],V[G]=y?u[G]:d[N],E++}for(let g=0;g<=1;g++)for(let w=0;w<=1;w++)for(let y=0;y<=1;y++){s.x=g?d.x:u.x,s.y=w?d.y:u.y,s.z=y?d.z:u.z,this.closestPointToPoint(s,i);const I=s.distanceToSquared(i);if(I<m&&(m=I,o&&o.copy(i),a&&a.copy(s),I<c))return Math.sqrt(I)}for(let g=0;g<12;g++){const w=e[g];for(let y=0;y<12;y++){const I=t[y];Rl(w,I,i,s);const _=i.distanceToSquared(s);if(_<m&&(m=_,o&&o.copy(i),a&&a.copy(s),_<c))return Math.sqrt(_)}}return Math.sqrt(m)}}();class Fl{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class Qf extends Fl{constructor(){super(()=>new mi)}}const ni=new Qf;function qt(l,e){return e[l+15]===65535}function Jt(l,e){return e[l+6]}function ri(l,e){return e[l+14]}function oi(l){return l+8}function ai(l,e){return e[l+6]}function Dh(l,e){return e[l+7]}class qf{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const dt=new qf;let es,sn;const Bs=[],Sr=new Fl(()=>new ut);function Jf(l,e,t,i,s,n){es=Sr.getPrimitive(),sn=Sr.getPrimitive(),Bs.push(es,sn),dt.setBuffer(l._roots[e]);const r=Ma(0,l.geometry,t,i,s,n);dt.clearBuffer(),Sr.releasePrimitive(es),Sr.releasePrimitive(sn),Bs.pop(),Bs.pop();const o=Bs.length;return o>0&&(sn=Bs[o-1],es=Bs[o-2]),r}function Ma(l,e,t,i,s=null,n=0,r=0){const{float32Array:o,uint16Array:a,uint32Array:c}=dt;let u=l*2;if(qt(u,a)){const d=Jt(l,c),f=ri(u,a);return gt(l,o,es),i(d,f,!1,r,n+l,es)}else{let d=function(Q){const{uint16Array:O,uint32Array:V}=dt;let T=Q*2;for(;!qt(T,O);)Q=oi(Q),T=Q*2;return Jt(Q,V)},f=function(Q){const{uint16Array:O,uint32Array:V}=dt;let T=Q*2;for(;!qt(T,O);)Q=ai(Q,V),T=Q*2;return Jt(Q,V)+ri(T,O)};const m=oi(l),E=ai(l,c);let g=m,w=E,y,I,_,C;if(s&&(_=es,C=sn,gt(g,o,_),gt(w,o,C),y=s(_),I=s(C),I<y)){g=E,w=m;const Q=y;y=I,I=Q,_=C}_||(_=es,gt(g,o,_));const F=qt(g*2,a),M=t(_,F,y,r+1,n+g);let D;if(M===gc){const Q=d(g),O=f(g)-Q;D=i(Q,O,!0,r+1,n+g,_)}else D=M&&Ma(g,e,t,i,s,n,r+1);if(D)return!0;C=sn,gt(w,o,C);const B=qt(w*2,a),N=t(C,B,I,r+1,n+w);let G;if(N===gc){const Q=d(w),O=f(w)-Q;G=i(Q,O,!0,r+1,n+w,C)}else G=N&&Ma(w,e,t,i,s,n,r+1);return!!G}}const Rn=new z,fa=new z;function $f(l,e,t={},i=0,s=1/0){const n=i*i,r=s*s;let o=1/0,a=null;if(l.shapecast({boundsTraverseOrder:u=>(Rn.copy(e).clamp(u.min,u.max),Rn.distanceToSquared(e)),intersectsBounds:(u,d,f)=>f<o&&f<r,intersectsTriangle:(u,d)=>{u.closestPointToPoint(e,Rn);const f=e.distanceToSquared(Rn);return f<o&&(fa.copy(Rn),o=f,a=d),f<n}}),o===1/0)return null;const c=Math.sqrt(o);return t.point?t.point.copy(fa):t.point=fa.clone(),t.distance=c,t.faceIndex=a,t}const ks=new z,zs=new z,Vs=new z,Or=new ft,Pr=new ft,Dr=new ft,Ic=new z,Cc=new z,bc=new z,Mr=new z;function ep(l,e,t,i,s,n){let r;return n===Tf?r=l.intersectTriangle(i,t,e,!0,s):r=l.intersectTriangle(e,t,i,n!==Jn,s),r===null?null:{distance:l.origin.distanceTo(s),point:s.clone()}}function tp(l,e,t,i,s,n,r,o,a){ks.fromBufferAttribute(e,n),zs.fromBufferAttribute(e,r),Vs.fromBufferAttribute(e,o);const c=ep(l,ks,zs,Vs,Mr,a);if(c){i&&(Or.fromBufferAttribute(i,n),Pr.fromBufferAttribute(i,r),Dr.fromBufferAttribute(i,o),c.uv=ws.getInterpolation(Mr,ks,zs,Vs,Or,Pr,Dr,new ft)),s&&(Or.fromBufferAttribute(s,n),Pr.fromBufferAttribute(s,r),Dr.fromBufferAttribute(s,o),c.uv1=ws.getInterpolation(Mr,ks,zs,Vs,Or,Pr,Dr,new ft)),t&&(Ic.fromBufferAttribute(t,n),Cc.fromBufferAttribute(t,r),bc.fromBufferAttribute(t,o),c.normal=ws.getInterpolation(Mr,ks,zs,Vs,Ic,Cc,bc,new z),c.normal.dot(l.direction)>0&&c.normal.multiplyScalar(-1));const u={a:n,b:r,c:o,normal:new z,materialIndex:0};ws.getNormal(ks,zs,Vs,u.normal),c.face=u,c.faceIndex=n}return c}function Ro(l,e,t,i,s){const n=i*3;let r=n+0,o=n+1,a=n+2;const c=l.index;l.index&&(r=c.getX(r),o=c.getX(o),a=c.getX(a));const{position:u,normal:d,uv:f,uv1:m}=l.attributes,E=tp(t,u,d,f,m,r,o,a,e);return E?(E.faceIndex=i,s&&s.push(E),E):null}function bt(l,e,t,i){const s=l.a,n=l.b,r=l.c;let o=e,a=e+1,c=e+2;t&&(o=t.getX(o),a=t.getX(a),c=t.getX(c)),s.x=i.getX(o),s.y=i.getY(o),s.z=i.getZ(o),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(c),r.y=i.getY(c),r.z=i.getZ(c)}function ip(l,e,t,i,s,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=i,c=i+s;a<c;a++)Ro(r,e,t,a,n)}function sp(l,e,t,i,s){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let c=i,u=i+s;c<u;c++){let d;d=Ro(n,e,t,c),d&&d.distance<o&&(a=d,o=d.distance)}return a}function np(l,e,t,i,s,n,r){const{geometry:o}=t,{index:a}=o,c=o.attributes.position;for(let u=l,d=e+l;u<d;u++){let f;if(f=u,bt(r,f*3,a,c),r.needsUpdate=!0,i(r,f,s,n))return!0}return!1}function rp(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,i=t.index?t.index.array:null,s=t.attributes.position;let n,r,o,a,c=0;const u=l._roots;for(let f=0,m=u.length;f<m;f++)n=u[f],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),d(0,c),c+=n.byteLength;function d(f,m,E=!1){const g=f*2;if(o[g+15]===_o){const w=r[f+6],y=o[g+14];let I=1/0,_=1/0,C=1/0,F=-1/0,M=-1/0,D=-1/0;for(let B=3*w,N=3*(w+y);B<N;B++){let G=i[B];const Q=s.getX(G),O=s.getY(G),V=s.getZ(G);Q<I&&(I=Q),Q>F&&(F=Q),O<_&&(_=O),O>M&&(M=O),V<C&&(C=V),V>D&&(D=V)}return a[f+0]!==I||a[f+1]!==_||a[f+2]!==C||a[f+3]!==F||a[f+4]!==M||a[f+5]!==D?(a[f+0]=I,a[f+1]=_,a[f+2]=C,a[f+3]=F,a[f+4]=M,a[f+5]=D,!0):!1}else{const w=f+8,y=r[f+6],I=w+m,_=y+m;let C=E,F=!1,M=!1;e?C||(F=e.has(I),M=e.has(_),C=!F&&!M):(F=!0,M=!0);const D=C||F,B=C||M;let N=!1;D&&(N=d(w,m,C));let G=!1;B&&(G=d(y,m,C));const Q=N||G;if(Q)for(let O=0;O<3;O++){const V=w+O,T=y+O,J=a[V],de=a[V+3],ie=a[T],ve=a[T+3];a[f+O]=J<ie?J:ie,a[f+O+3]=de>ve?de:ve}return Q}}}const Tc=new ut;function ts(l,e,t,i){return gt(l,e,Tc),t.intersectBox(Tc,i)}function op(l,e,t,i,s,n){const{geometry:r,_indirectBuffer:o}=l;for(let a=i,c=i+s;a<c;a++){let u=o?o[a]:a;Ro(r,e,t,u,n)}}function ap(l,e,t,i,s){const{geometry:n,_indirectBuffer:r}=l;let o=1/0,a=null;for(let c=i,u=i+s;c<u;c++){let d;d=Ro(n,e,t,r?r[c]:c),d&&d.distance<o&&(a=d,o=d.distance)}return a}function lp(l,e,t,i,s,n,r){const{geometry:o}=t,{index:a}=o,c=o.attributes.position;for(let u=l,d=e+l;u<d;u++){let f;if(f=t.resolveTriangleIndex(u),bt(r,f*3,a,c),r.needsUpdate=!0,i(r,f,s,n))return!0}return!1}const xc=new z;function cp(l,e,t,i,s){dt.setBuffer(l._roots[e]),La(0,l,t,i,s),dt.clearBuffer()}function La(l,e,t,i,s){const{float32Array:n,uint16Array:r,uint32Array:o}=dt,a=l*2;if(qt(a,r)){const c=Jt(l,o),u=ri(a,r);ip(e,t,i,c,u,s)}else{const c=oi(l);ts(c,n,i,xc)&&La(c,e,t,i,s);const u=ai(l,o);ts(u,n,i,xc)&&La(u,e,t,i,s)}}const Ac=new z,hp=["x","y","z"];function up(l,e,t,i){dt.setBuffer(l._roots[e]);const s=Na(0,l,t,i);return dt.clearBuffer(),s}function Na(l,e,t,i){const{float32Array:s,uint16Array:n,uint32Array:r}=dt;let o=l*2;if(qt(o,n)){const a=Jt(l,r),c=ri(o,n);return sp(e,t,i,a,c)}else{const a=Dh(l,r),c=hp[a],u=i.direction[c]>=0;let d,f;u?(d=oi(l),f=ai(l,r)):(d=ai(l,r),f=oi(l));const m=ts(d,s,i,Ac)?Na(d,e,t,i):null;if(m){const g=m.point[c];if(u?g<=s[f+a]:g>=s[f+a+3])return m}const E=ts(f,s,i,Ac)?Na(f,e,t,i):null;return m&&E?m.distance<=E.distance?m:E:m||E||null}}const Lr=new ut,Ys=new mi,Gs=new mi,Fn=new Ne,_c=new jt,Nr=new jt;function dp(l,e,t,i){dt.setBuffer(l._roots[e]);const s=Ua(0,l,t,i);return dt.clearBuffer(),s}function Ua(l,e,t,i,s=null){const{float32Array:n,uint16Array:r,uint32Array:o}=dt;let a=l*2;if(s===null&&(t.boundingBox||t.computeBoundingBox(),_c.set(t.boundingBox.min,t.boundingBox.max,i),s=_c),qt(a,r)){const c=e.geometry,u=c.index,d=c.attributes.position,f=t.index,m=t.attributes.position,E=Jt(l,o),g=ri(a,r);if(Fn.copy(i).invert(),t.boundsTree)return gt(l,n,Nr),Nr.matrix.copy(Fn),Nr.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:w=>Nr.intersectsBox(w),intersectsTriangle:w=>{w.a.applyMatrix4(i),w.b.applyMatrix4(i),w.c.applyMatrix4(i),w.needsUpdate=!0;for(let y=E*3,I=(g+E)*3;y<I;y+=3)if(bt(Gs,y,u,d),Gs.needsUpdate=!0,w.intersectsTriangle(Gs))return!0;return!1}});for(let w=E*3,y=(g+E)*3;w<y;w+=3){bt(Ys,w,u,d),Ys.a.applyMatrix4(Fn),Ys.b.applyMatrix4(Fn),Ys.c.applyMatrix4(Fn),Ys.needsUpdate=!0;for(let I=0,_=f.count;I<_;I+=3)if(bt(Gs,I,f,m),Gs.needsUpdate=!0,Ys.intersectsTriangle(Gs))return!0}}else{const c=l+8,u=o[l+6];return gt(c,n,Lr),!!(s.intersectsBox(Lr)&&Ua(c,e,t,i,s)||(gt(u,n,Lr),s.intersectsBox(Lr)&&Ua(u,e,t,i,s)))}}const Ur=new Ne,pa=new jt,Sn=new jt,fp=new z,pp=new z,mp=new z,gp=new z;function Ep(l,e,t,i={},s={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),pa.set(e.boundingBox.min,e.boundingBox.max,t),pa.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,c=o.index,u=e.attributes.position,d=e.index,f=ni.getPrimitive(),m=ni.getPrimitive();let E=fp,g=pp,w=null,y=null;s&&(w=mp,y=gp);let I=1/0,_=null,C=null;return Ur.copy(t).invert(),Sn.matrix.copy(Ur),l.shapecast({boundsTraverseOrder:F=>pa.distanceToBox(F),intersectsBounds:(F,M,D)=>D<I&&D<r?(M&&(Sn.min.copy(F.min),Sn.max.copy(F.max),Sn.needsUpdate=!0),!0):!1,intersectsRange:(F,M)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:D=>Sn.distanceToBox(D),intersectsBounds:(D,B,N)=>N<I&&N<r,intersectsRange:(D,B)=>{for(let N=D,G=D+B;N<G;N++){bt(m,3*N,d,u),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let Q=F,O=F+M;Q<O;Q++){bt(f,3*Q,c,a),f.needsUpdate=!0;const V=f.distanceToTriangle(m,E,w);if(V<I&&(g.copy(E),y&&y.copy(w),I=V,_=Q,C=N),V<n)return!0}}}});{const D=dn(e);for(let B=0,N=D;B<N;B++){bt(m,3*B,d,u),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let G=F,Q=F+M;G<Q;G++){bt(f,3*G,c,a),f.needsUpdate=!0;const O=f.distanceToTriangle(m,E,w);if(O<I&&(g.copy(E),y&&y.copy(w),I=O,_=G,C=B),O<n)return!0}}}}}),ni.releasePrimitive(f),ni.releasePrimitive(m),I===1/0?null:(i.point?i.point.copy(g):i.point=g.clone(),i.distance=I,i.faceIndex=_,s&&(s.point?s.point.copy(y):s.point=y.clone(),s.point.applyMatrix4(Ur),g.applyMatrix4(Ur),s.distance=g.sub(s.point).length(),s.faceIndex=C),i)}function vp(l,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=l.geometry,i=t.index?t.index.array:null,s=t.attributes.position;let n,r,o,a,c=0;const u=l._roots;for(let f=0,m=u.length;f<m;f++)n=u[f],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),d(0,c),c+=n.byteLength;function d(f,m,E=!1){const g=f*2;if(o[g+15]===_o){const w=r[f+6],y=o[g+14];let I=1/0,_=1/0,C=1/0,F=-1/0,M=-1/0,D=-1/0;for(let B=w,N=w+y;B<N;B++){const G=3*l.resolveTriangleIndex(B);for(let Q=0;Q<3;Q++){let O=G+Q;O=i?i[O]:O;const V=s.getX(O),T=s.getY(O),J=s.getZ(O);V<I&&(I=V),V>F&&(F=V),T<_&&(_=T),T>M&&(M=T),J<C&&(C=J),J>D&&(D=J)}}return a[f+0]!==I||a[f+1]!==_||a[f+2]!==C||a[f+3]!==F||a[f+4]!==M||a[f+5]!==D?(a[f+0]=I,a[f+1]=_,a[f+2]=C,a[f+3]=F,a[f+4]=M,a[f+5]=D,!0):!1}else{const w=f+8,y=r[f+6],I=w+m,_=y+m;let C=E,F=!1,M=!1;e?C||(F=e.has(I),M=e.has(_),C=!F&&!M):(F=!0,M=!0);const D=C||F,B=C||M;let N=!1;D&&(N=d(w,m,C));let G=!1;B&&(G=d(y,m,C));const Q=N||G;if(Q)for(let O=0;O<3;O++){const V=w+O,T=y+O,J=a[V],de=a[V+3],ie=a[T],ve=a[T+3];a[f+O]=J<ie?J:ie,a[f+O+3]=de>ve?de:ve}return Q}}}const Rc=new z;function wp(l,e,t,i,s){dt.setBuffer(l._roots[e]),Ba(0,l,t,i,s),dt.clearBuffer()}function Ba(l,e,t,i,s){const{float32Array:n,uint16Array:r,uint32Array:o}=dt,a=l*2;if(qt(a,r)){const c=Jt(l,o),u=ri(a,r);op(e,t,i,c,u,s)}else{const c=oi(l);ts(c,n,i,Rc)&&Ba(c,e,t,i,s);const u=ai(l,o);ts(u,n,i,Rc)&&Ba(u,e,t,i,s)}}const Fc=new z,yp=["x","y","z"];function Ip(l,e,t,i){dt.setBuffer(l._roots[e]);const s=ka(0,l,t,i);return dt.clearBuffer(),s}function ka(l,e,t,i){const{float32Array:s,uint16Array:n,uint32Array:r}=dt;let o=l*2;if(qt(o,n)){const a=Jt(l,r),c=ri(o,n);return ap(e,t,i,a,c)}else{const a=Dh(l,r),c=yp[a],u=i.direction[c]>=0;let d,f;u?(d=oi(l),f=ai(l,r)):(d=ai(l,r),f=oi(l));const m=ts(d,s,i,Fc)?ka(d,e,t,i):null;if(m){const g=m.point[c];if(u?g<=s[f+a]:g>=s[f+a+3])return m}const E=ts(f,s,i,Fc)?ka(f,e,t,i):null;return m&&E?m.distance<=E.distance?m:E:m||E||null}}const Br=new ut,Hs=new mi,js=new mi,On=new Ne,Sc=new jt,kr=new jt;function Cp(l,e,t,i){dt.setBuffer(l._roots[e]);const s=za(0,l,t,i);return dt.clearBuffer(),s}function za(l,e,t,i,s=null){const{float32Array:n,uint16Array:r,uint32Array:o}=dt;let a=l*2;if(s===null&&(t.boundingBox||t.computeBoundingBox(),Sc.set(t.boundingBox.min,t.boundingBox.max,i),s=Sc),qt(a,r)){const c=e.geometry,u=c.index,d=c.attributes.position,f=t.index,m=t.attributes.position,E=Jt(l,o),g=ri(a,r);if(On.copy(i).invert(),t.boundsTree)return gt(l,n,kr),kr.matrix.copy(On),kr.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:w=>kr.intersectsBox(w),intersectsTriangle:w=>{w.a.applyMatrix4(i),w.b.applyMatrix4(i),w.c.applyMatrix4(i),w.needsUpdate=!0;for(let y=E,I=g+E;y<I;y++)if(bt(js,3*e.resolveTriangleIndex(y),u,d),js.needsUpdate=!0,w.intersectsTriangle(js))return!0;return!1}});for(let w=E,y=g+E;w<y;w++){const I=e.resolveTriangleIndex(w);bt(Hs,3*I,u,d),Hs.a.applyMatrix4(On),Hs.b.applyMatrix4(On),Hs.c.applyMatrix4(On),Hs.needsUpdate=!0;for(let _=0,C=f.count;_<C;_+=3)if(bt(js,_,f,m),js.needsUpdate=!0,Hs.intersectsTriangle(js))return!0}}else{const c=l+8,u=o[l+6];return gt(c,n,Br),!!(s.intersectsBox(Br)&&za(c,e,t,i,s)||(gt(u,n,Br),s.intersectsBox(Br)&&za(u,e,t,i,s)))}}const zr=new Ne,ma=new jt,Pn=new jt,bp=new z,Tp=new z,xp=new z,Ap=new z;function _p(l,e,t,i={},s={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),ma.set(e.boundingBox.min,e.boundingBox.max,t),ma.needsUpdate=!0;const o=l.geometry,a=o.attributes.position,c=o.index,u=e.attributes.position,d=e.index,f=ni.getPrimitive(),m=ni.getPrimitive();let E=bp,g=Tp,w=null,y=null;s&&(w=xp,y=Ap);let I=1/0,_=null,C=null;return zr.copy(t).invert(),Pn.matrix.copy(zr),l.shapecast({boundsTraverseOrder:F=>ma.distanceToBox(F),intersectsBounds:(F,M,D)=>D<I&&D<r?(M&&(Pn.min.copy(F.min),Pn.max.copy(F.max),Pn.needsUpdate=!0),!0):!1,intersectsRange:(F,M)=>{if(e.boundsTree){const D=e.boundsTree;return D.shapecast({boundsTraverseOrder:B=>Pn.distanceToBox(B),intersectsBounds:(B,N,G)=>G<I&&G<r,intersectsRange:(B,N)=>{for(let G=B,Q=B+N;G<Q;G++){const O=D.resolveTriangleIndex(G);bt(m,3*O,d,u),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let V=F,T=F+M;V<T;V++){const J=l.resolveTriangleIndex(V);bt(f,3*J,c,a),f.needsUpdate=!0;const de=f.distanceToTriangle(m,E,w);if(de<I&&(g.copy(E),y&&y.copy(w),I=de,_=V,C=G),de<n)return!0}}}})}else{const D=dn(e);for(let B=0,N=D;B<N;B++){bt(m,3*B,d,u),m.a.applyMatrix4(t),m.b.applyMatrix4(t),m.c.applyMatrix4(t),m.needsUpdate=!0;for(let G=F,Q=F+M;G<Q;G++){const O=l.resolveTriangleIndex(G);bt(f,3*O,c,a),f.needsUpdate=!0;const V=f.distanceToTriangle(m,E,w);if(V<I&&(g.copy(E),y&&y.copy(w),I=V,_=G,C=B),V<n)return!0}}}}}),ni.releasePrimitive(f),ni.releasePrimitive(m),I===1/0?null:(i.point?i.point.copy(g):i.point=g.clone(),i.distance=I,i.faceIndex=_,s&&(s.point?s.point.copy(y):s.point=y.clone(),s.point.applyMatrix4(zr),g.applyMatrix4(zr),s.distance=g.sub(s.point).length(),s.faceIndex=C),i)}function Rp(){return typeof SharedArrayBuffer<"u"}const jn=new dt.constructor,vo=new dt.constructor,$i=new Fl(()=>new ut),Ws=new ut,Zs=new ut,ga=new ut,Ea=new ut;let va=!1;function Fp(l,e,t,i){if(va)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");va=!0;const s=l._roots,n=e._roots;let r,o=0,a=0;const c=new Ne().copy(t).invert();for(let u=0,d=s.length;u<d;u++){jn.setBuffer(s[u]),a=0;const f=$i.getPrimitive();gt(0,jn.float32Array,f),f.applyMatrix4(c);for(let m=0,E=n.length;m<E&&(vo.setBuffer(n[u]),r=ui(0,0,t,c,i,o,a,0,0,f),vo.clearBuffer(),a+=n[m].length,!r);m++);if($i.releasePrimitive(f),jn.clearBuffer(),o+=s[u].length,r)break}return va=!1,r}function ui(l,e,t,i,s,n=0,r=0,o=0,a=0,c=null,u=!1){let d,f;u?(d=vo,f=jn):(d=jn,f=vo);const m=d.float32Array,E=d.uint32Array,g=d.uint16Array,w=f.float32Array,y=f.uint32Array,I=f.uint16Array,_=l*2,C=e*2,F=qt(_,g),M=qt(C,I);let D=!1;if(M&&F)u?D=s(Jt(e,y),ri(e*2,I),Jt(l,E),ri(l*2,g),a,r+e,o,n+l):D=s(Jt(l,E),ri(l*2,g),Jt(e,y),ri(e*2,I),o,n+l,a,r+e);else if(M){const B=$i.getPrimitive();gt(e,w,B),B.applyMatrix4(t);const N=oi(l),G=ai(l,E);gt(N,m,Ws),gt(G,m,Zs);const Q=B.intersectsBox(Ws),O=B.intersectsBox(Zs);D=Q&&ui(e,N,i,t,s,r,n,a,o+1,B,!u)||O&&ui(e,G,i,t,s,r,n,a,o+1,B,!u),$i.releasePrimitive(B)}else{const B=oi(e),N=ai(e,y);gt(B,w,ga),gt(N,w,Ea);const G=c.intersectsBox(ga),Q=c.intersectsBox(Ea);if(G&&Q)D=ui(l,B,t,i,s,n,r,o,a+1,c,u)||ui(l,N,t,i,s,n,r,o,a+1,c,u);else if(G)if(F)D=ui(l,B,t,i,s,n,r,o,a+1,c,u);else{const O=$i.getPrimitive();O.copy(ga).applyMatrix4(t);const V=oi(l),T=ai(l,E);gt(V,m,Ws),gt(T,m,Zs);const J=O.intersectsBox(Ws),de=O.intersectsBox(Zs);D=J&&ui(B,V,i,t,s,r,n,a,o+1,O,!u)||de&&ui(B,T,i,t,s,r,n,a,o+1,O,!u),$i.releasePrimitive(O)}else if(Q)if(F)D=ui(l,N,t,i,s,n,r,o,a+1,c,u);else{const O=$i.getPrimitive();O.copy(Ea).applyMatrix4(t);const V=oi(l),T=ai(l,E);gt(V,m,Ws),gt(T,m,Zs);const J=O.intersectsBox(Ws),de=O.intersectsBox(Zs);D=J&&ui(N,V,i,t,s,r,n,a,o+1,O,!u)||de&&ui(N,T,i,t,s,r,n,a,o+1,O,!u),$i.releasePrimitive(O)}}return D}const Vr=new jt,Oc=new ut;class Sl{static serialize(e,t={}){t={cloneBuffers:!0,...t};const i=e.geometry,s=e._roots,n=e._indirectBuffer,r=i.getIndex();let o;return t.cloneBuffers?o={roots:s.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:s,index:r.array,indirectBuffer:n},o}static deserialize(e,t,i={}){i={setIndex:!0,indirect:!!e.indirectBuffer,...i};const{index:s,roots:n,indirectBuffer:r}=e,o=new Sl(t,{...i,[ha]:!0});if(o._roots=n,o._indirectBuffer=r||null,i.setIndex){const a=t.getIndex();if(a===null){const c=new Kt(e.index,1,!1);t.setIndex(c)}else a.array!==s&&(a.array.set(s),a.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:Sh,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[ha]:!1},t),t.useSharedArrayBuffer&&!Rp())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[ha]||(Wf(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new ut)));const{_indirectBuffer:i}=this;this.resolveTriangleIndex=t.indirect?s=>i[s]:s=>s}refit(e=null){return(this.indirect?vp:rp)(this,e)}traverse(e,t=0){const i=this._roots[t],s=new Uint32Array(i),n=new Uint16Array(i);r(0);function r(o,a=0){const c=o*2,u=n[c+15]===_o;if(u){const d=s[o+6],f=n[c+14];e(a,u,new Float32Array(i,o*4,6),d,f)}else{const d=o+ao/4,f=s[o+6],m=s[o+7];e(a,u,new Float32Array(i,o*4,6),m)||(r(d,a+1),r(f,a+1))}}}raycast(e,t=mc){const i=this._roots,s=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),a=s.groups,c=r?t.side:t,u=this.indirect?wp:cp;for(let d=0,f=i.length;d<f;d++){const m=o?t[a[d].materialIndex].side:c,E=n.length;if(u(this,d,m,e,n),o){const g=a[d].materialIndex;for(let w=E,y=n.length;w<y;w++)n[w].face.materialIndex=g}}return n}raycastFirst(e,t=mc){const i=this._roots,s=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const a=s.groups,c=n?t.side:t,u=this.indirect?Ip:up;for(let d=0,f=i.length;d<f;d++){const m=r?t[a[d].materialIndex].side:c,E=u(this,d,m,e);E!=null&&(o==null||E.distance<o.distance)&&(o=E,r&&(E.face.materialIndex=a[d].materialIndex))}return o}intersectsGeometry(e,t){let i=!1;const s=this._roots,n=this.indirect?Cp:dp;for(let r=0,o=s.length;r<o&&(i=n(this,r,e,t),!i);r++);return i}shapecast(e){const t=ni.getPrimitive(),i=this.indirect?lp:np;let{boundsTraverseOrder:s,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const d=r;r=(f,m,E,g,w)=>d(f,m,E,g,w)?!0:i(f,m,this,o,E,g,t)}else r||(o?r=(d,f,m,E)=>i(d,f,this,o,m,E,t):r=(d,f,m)=>m);let a=!1,c=0;const u=this._roots;for(let d=0,f=u.length;d<f;d++){const m=u[d];if(a=Jf(this,d,n,r,s,c),a)break;c+=m.byteLength}return ni.releasePrimitive(t),a}bvhcast(e,t,i){let{intersectsRanges:s,intersectsTriangles:n}=i;const r=ni.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,c=this.indirect?E=>{const g=this.resolveTriangleIndex(E);bt(r,g*3,o,a)}:E=>{bt(r,E*3,o,a)},u=ni.getPrimitive(),d=e.geometry.index,f=e.geometry.attributes.position,m=e.indirect?E=>{const g=e.resolveTriangleIndex(E);bt(u,g*3,d,f)}:E=>{bt(u,E*3,d,f)};if(n){const E=(g,w,y,I,_,C,F,M)=>{for(let D=y,B=y+I;D<B;D++){m(D),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let N=g,G=g+w;N<G;N++)if(c(N),r.needsUpdate=!0,n(r,u,N,D,_,C,F,M))return!0}return!1};if(s){const g=s;s=function(w,y,I,_,C,F,M,D){return g(w,y,I,_,C,F,M,D)?!0:E(w,y,I,_,C,F,M,D)}}else s=E}return Fp(this,e,t,s)}intersectsBox(e,t){return Vr.set(e.min,e.max,t),Vr.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Vr.intersectsBox(i),intersectsTriangle:i=>Vr.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},s={},n=0,r=1/0){return(this.indirect?_p:Ep)(this,e,t,i,s,n,r)}closestPointToPoint(e,t={},i=0,s=1/0){return $f(this,e,t,i,s)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{gt(0,new Float32Array(t),Oc),e.union(Oc)}),e}}function Pc(l,e,t){return l===null||(l.point.applyMatrix4(e.matrixWorld),l.distance=l.point.distanceTo(t.ray.origin),l.object=e,l.distance<t.near||l.distance>t.far)?null:l}const wa=new gf,Dc=new Ne,Sp=Ae.prototype.raycast;function Op(l,e){if(this.geometry.boundsTree){if(this.material===void 0)return;Dc.copy(this.matrixWorld).invert(),wa.copy(l.ray).applyMatrix4(Dc);const t=this.geometry.boundsTree;if(l.firstHitOnly===!0){const i=Pc(t.raycastFirst(wa,this.material),this,l);i&&e.push(i)}else{const i=t.raycast(wa,this.material);for(let s=0,n=i.length;s<n;s++){const r=Pc(i[s],this,l);r&&e.push(r)}}}else Sp.call(this,l,e)}function Pp(l){return this.boundsTree=new Sl(this,l),this.boundsTree}function Dp(){this.boundsTree=null}class le{constructor(){R(this,"trigger",e=>{const t=this.handlers.slice(0);for(const i of t)i(e)}),R(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class Wn{constructor(){R(this,"trigger",async e=>{const t=this.handlers.slice(0);for(const i of t)await i(e)}),R(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class Ol{constructor(e){R(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),R(this,"isResizeable",()=>"resize"in this&&"getSize"in this),R(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),R(this,"isHideable",()=>"visible"in this),R(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=e}}class Ke extends Ol{}class Mh extends Ol{constructor(e){super(e),R(this,"worlds",new Map),R(this,"onWorldChanged",new le),R(this,"currentWorld",null),this.onWorldChanged.add(({world:t,action:i})=>{i==="removed"&&this.worlds.delete(t.uuid)})}}class Mp extends Mh{constructor(){super(...arguments),R(this,"hasCameraControls",()=>"controls"in this)}}class Lp extends Mh{constructor(){super(...arguments),R(this,"onAfterUpdate",new le),R(this,"onBeforeUpdate",new le),R(this,"onDisposed",new le),R(this,"onResize",new le),R(this,"onClippingPlanesUpdated",new le),R(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,i){t.isLocal=i;const s=this.clippingPlanes.indexOf(t);e&&s===-1?this.clippingPlanes.push(t):!e&&s>-1&&this.clippingPlanes.splice(s,1),this.three.clippingPlanes=this.clippingPlanes.filter(n=>!n.isLocal)}}const Lh=class Va extends Ke{constructor(e){super(e),R(this,"_disposedComponents",new Set),R(this,"enabled",!0),e.add(Va.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,i=!0){e.removeFromParent();const s=e;s.dispose&&s.dispose(),this.disposeGeometryAndMaterials(e,t),i&&s.children&&s.children.length&&this.disposeChildren(s),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){const i=e;i.geometry&&this.disposeGeometry(i.geometry),t&&i.material&&Va.disposeMaterial(i),i.material=[],i.geometry=null}disposeChildren(e){for(const t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(const t of e.material)t.dispose();else e.material.dispose()}};R(Lh,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let Ri=Lh;class rn extends Set{constructor(e){super(e),R(this,"onItemAdded",new le),R(this,"onItemDeleted",new le),R(this,"onCleared",new le),R(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...e){for(const t of e)this.has(t)||!this.guard(t)||(super.add(t),this.onItemAdded||(this.onItemAdded=new le),this.onItemAdded.trigger(t));return this}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class Yi extends Map{constructor(e){super(e),R(this,"onItemSet",new le),R(this,"onItemUpdated",new le),R(this,"onItemDeleted",new le),R(this,"onCleared",new le),R(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(e,t){const i=this.has(e);if(!(this.guard??(()=>!0))(e,t))return this;const s=super.set(e,t);return i?(this.onItemUpdated||(this.onItemUpdated=new le),this.onItemUpdated.trigger({key:e,value:t})):(this.onItemSet||(this.onItemSet=new le),this.onItemSet.trigger({key:e,value:t})),s}delete(e){const t=super.delete(e);return t&&this.onItemDeleted.trigger(e),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}const lo=0,Np=1,Up=new z,Mc=new $t,ya=new ns,Lc=new z,Yr=new ws;class Bp{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Nc,this.unassigned=new Nc,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.vertices.push(new kp(e[t]));this.compute()}return this}setFromObject(e){const t=[];return e.updateMatrixWorld(!0),e.traverse(function(i){const s=i.geometry;if(s!==void 0){const n=s.attributes.position;if(n!==void 0)for(let r=0,o=n.count;r<o;r++){const a=new z;a.fromBufferAttribute(n,r).applyMatrix4(i.matrixWorld),t.push(a)}}}),this.setFromPoints(t)}containsPoint(e){const t=this.faces;for(let i=0,s=t.length;i<s;i++)if(t[i].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){const i=this.faces;let s=-1/0,n=1/0;for(let r=0,o=i.length;r<o;r++){const a=i[r],c=a.distanceToPoint(e.origin),u=a.normal.dot(e.direction);if(c>0&&u>=0)return null;const d=u!==0?-c/u:0;if(!(d<=0)&&(u>0?n=Math.min(d,n):s=Math.max(d,s),s>n))return null}return s!==-1/0?e.at(s,t):e.at(n,t),t}intersectsRay(e){return this.intersectRay(e,Up)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){const t=e.outside;let i=e.outside;for(;i.next!==null&&i.next.face===e;)i=i.next;return this.assigned.removeSubList(t,i),t.prev=i.next=null,e.outside=null,t}}deleteFaceVertices(e,t){const i=this.removeAllVerticesFromFace(e);if(i!==void 0)if(t===void 0)this.unassigned.appendChain(i);else{let s=i;do{const n=s.next;t.distanceToPoint(s.point)>this.tolerance?this.addVertexToFace(s,t):this.unassigned.append(s),s=n}while(s!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{const i=t.next;let s=this.tolerance,n=null;for(let r=0;r<e.length;r++){const o=e[r];if(o.mark===lo){const a=o.distanceToPoint(t.point);if(a>s&&(s=a,n=o),s>1e3*this.tolerance)break}}n!==null&&this.addVertexToFace(t,n),t=i}while(t!==null)}return this}computeExtremes(){const e=new z,t=new z,i=[],s=[];for(let n=0;n<3;n++)i[n]=s[n]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let n=0,r=this.vertices.length;n<r;n++){const o=this.vertices[n],a=o.point;for(let c=0;c<3;c++)a.getComponent(c)<e.getComponent(c)&&(e.setComponent(c,a.getComponent(c)),i[c]=o);for(let c=0;c<3;c++)a.getComponent(c)>t.getComponent(c)&&(t.setComponent(c,a.getComponent(c)),s[c]=o)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:i,max:s}}computeInitialHull(){const e=this.vertices,t=this.computeExtremes(),i=t.min,s=t.max;let n=0,r=0;for(let f=0;f<3;f++){const m=s[f].point.getComponent(f)-i[f].point.getComponent(f);m>n&&(n=m,r=f)}const o=i[r],a=s[r];let c,u;n=0,Mc.set(o.point,a.point);for(let f=0,m=this.vertices.length;f<m;f++){const E=e[f];if(E!==o&&E!==a){Mc.closestPointToPoint(E.point,!0,Lc);const g=Lc.distanceToSquared(E.point);g>n&&(n=g,c=E)}}n=-1,ya.setFromCoplanarPoints(o.point,a.point,c.point);for(let f=0,m=this.vertices.length;f<m;f++){const E=e[f];if(E!==o&&E!==a&&E!==c){const g=Math.abs(ya.distanceToPoint(E.point));g>n&&(n=g,u=E)}}const d=[];if(ya.distanceToPoint(u.point)<0){d.push(fi.create(o,a,c),fi.create(u,a,o),fi.create(u,c,a),fi.create(u,o,c));for(let f=0;f<3;f++){const m=(f+1)%3;d[f+1].getEdge(2).setTwin(d[0].getEdge(m)),d[f+1].getEdge(1).setTwin(d[m+1].getEdge(0))}}else{d.push(fi.create(o,c,a),fi.create(u,o,a),fi.create(u,a,c),fi.create(u,c,o));for(let f=0;f<3;f++){const m=(f+1)%3;d[f+1].getEdge(2).setTwin(d[0].getEdge((3-f)%3)),d[f+1].getEdge(0).setTwin(d[m+1].getEdge(1))}}for(let f=0;f<4;f++)this.faces.push(d[f]);for(let f=0,m=e.length;f<m;f++){const E=e[f];if(E!==o&&E!==a&&E!==c&&E!==u){n=this.tolerance;let g=null;for(let w=0;w<4;w++){const y=this.faces[w].distanceToPoint(E.point);y>n&&(n=y,g=this.faces[w])}g!==null&&this.addVertexToFace(E,g)}}return this}reindexFaces(){const e=[];for(let t=0;t<this.faces.length;t++){const i=this.faces[t];i.mark===lo&&e.push(i)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0;const i=this.assigned.first().face;let s=i.outside;do{const n=i.distanceToPoint(s.point);n>t&&(t=n,e=s),s=s.next}while(s!==null&&s.face===i);return e}}computeHorizon(e,t,i,s){this.deleteFaceVertices(i),i.mark=Np;let n;t===null?n=t=i.getEdge(0):n=t.next;do{const r=n.twin,o=r.face;o.mark===lo&&(o.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,r,o,s):s.push(n)),n=n.next}while(n!==t);return this}addAdjoiningFace(e,t){const i=fi.create(e,t.tail(),t.head());return this.faces.push(i),i.getEdge(-1).setTwin(t.twin),i.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let i=null,s=null;for(let n=0;n<t.length;n++){const r=t[n],o=this.addAdjoiningFace(e,r);i===null?i=o:o.next.setTwin(s),this.newFaces.push(o.face),s=o}return i.next.setTwin(s),this}addVertexToHull(e){const t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}}class fi{constructor(){this.normal=new z,this.midpoint=new z,this.area=0,this.constant=0,this.outside=null,this.mark=lo,this.edge=null}static create(e,t,i){const s=new fi,n=new Ia(e,s),r=new Ia(t,s),o=new Ia(i,s);return n.next=o.prev=r,r.next=n.prev=o,o.next=r.prev=n,s.edge=n,s.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){const e=this.edge.tail(),t=this.edge.head(),i=this.edge.next.head();return Yr.set(e.point,t.point,i.point),Yr.getNormal(this.normal),Yr.getMidpoint(this.midpoint),this.area=Yr.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}}class Ia{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){const e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}}class kp{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}}class Nc{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}}const Ya=[2,2,1],Ga=[1,0,0];function Ai(l,e){return l*3+e}function zp(l){const e=l.elements;let t=0;for(let i=0;i<9;i++)t+=e[i]*e[i];return Math.sqrt(t)}function Vp(l){const e=l.elements;let t=0;for(let i=0;i<3;i++){const s=e[Ai(Ya[i],Ga[i])];t+=2*s*s}return Math.sqrt(t)}function Yp(l,e){let t=0,i=1;const s=l.elements;for(let c=0;c<3;c++){const u=Math.abs(s[Ai(Ya[c],Ga[c])]);u>t&&(t=u,i=c)}let n=1,r=0;const o=Ga[i],a=Ya[i];if(Math.abs(s[Ai(a,o)])>Number.EPSILON){const c=s[Ai(a,a)],u=s[Ai(o,o)],d=s[Ai(a,o)],f=(c-u)/2/d;let m;f<0?m=-1/(-f+Math.sqrt(1+f*f)):m=1/(f+Math.sqrt(1+f*f)),n=1/Math.sqrt(1+m*m),r=m*n}return e.identity(),e.elements[Ai(o,o)]=n,e.elements[Ai(a,a)]=n,e.elements[Ai(a,o)]=r,e.elements[Ai(o,a)]=-r,e}function Gp(l,e){let t=0,i=0;const s=10;e.unitary.identity(),e.diagonal.copy(l);const n=e.unitary,r=e.diagonal,o=new ys,a=new ys,c=Number.EPSILON*zp(r);for(;i<s&&Vp(r)>c;)Yp(r,o),a.copy(o).transpose(),r.multiply(o),r.premultiply(a),n.multiply(o),++t>2&&(i++,t=0);return e}function Hp(l){const e=[];for(let Be=0;Be<l.length-2;Be+=3){const ye=l[Be],Ye=l[Be+1],Je=l[Be+2];e.push(new z(ye,Ye,Je))}const t=new Bp;t.setFromPoints(e);const i={unitary:new ys,diagonal:new ys},s=t.faces,n=[],r=[];for(let Be=0,ye=s.length;Be<ye;Be++){const Ye=s[Be];let Je=Ye.edge;n.length=0;do n.push(Je),Je=Je.next;while(Je!==Ye.edge);const He=n.length-2;for(let vt=1,x=He;vt<=x;vt++){const fe=n[0].vertex,he=n[vt+0].vertex,k=n[vt+1].vertex;r.push(fe.point.x,fe.point.y,fe.point.z),r.push(he.point.x,he.point.y,he.point.z),r.push(k.point.x,k.point.y,k.point.z)}}const o=new z,a=new z,c=new z,u=new z,d=new z,f=new z,m=new z,E=new z;let g=0,w=0,y=0,I=0,_=0,C=0,F=0;for(let Be=0,ye=r.length;Be<ye;Be+=9){o.fromArray(r,Be),a.fromArray(r,Be+3),c.fromArray(r,Be+6),m.set(0,0,0),m.add(o).add(a).add(c).divideScalar(3),u.subVectors(a,o),d.subVectors(c,o);const Ye=f.crossVectors(u,d).length()/2;E.add(f.copy(m).multiplyScalar(Ye)),g+=Ye,w+=(9*m.x*m.x+o.x*o.x+a.x*a.x+c.x*c.x)*(Ye/12),y+=(9*m.x*m.y+o.x*o.y+a.x*a.y+c.x*c.y)*(Ye/12),I+=(9*m.x*m.z+o.x*o.z+a.x*a.z+c.x*c.z)*(Ye/12),_+=(9*m.y*m.y+o.y*o.y+a.y*a.y+c.y*c.y)*(Ye/12),C+=(9*m.y*m.z+o.y*o.z+a.y*a.z+c.y*c.z)*(Ye/12),F+=(9*m.z*m.z+o.z*o.z+a.z*a.z+c.z*c.z)*(Ye/12)}E.divideScalar(g),w/=g,y/=g,I/=g,_/=g,C/=g,F/=g,w-=E.x*E.x,y-=E.x*E.y,I-=E.x*E.z,_-=E.y*E.y,C-=E.y*E.z,F-=E.z*E.z;const M=new ys;M.elements[0]=w,M.elements[1]=y,M.elements[2]=I,M.elements[3]=y,M.elements[4]=_,M.elements[5]=C,M.elements[6]=I,M.elements[7]=C,M.elements[8]=F,Gp(M,i);const D=i.unitary,B=new z,N=new z,G=new z;D.extractBasis(B,N,G);let Q=-1/0,O=-1/0,V=-1/0,T=1/0,J=1/0,de=1/0;for(let Be=0,ye=e.length;Be<ye;Be++){const Ye=e[Be];Q=Math.max(B.dot(Ye),Q),O=Math.max(N.dot(Ye),O),V=Math.max(G.dot(Ye),V),T=Math.min(B.dot(Ye),T),J=Math.min(N.dot(Ye),J),de=Math.min(G.dot(Ye),de)}B.multiplyScalar(.5*(T+Q)),N.multiplyScalar(.5*(J+O)),G.multiplyScalar(.5*(de+V));const ie=new z,ve=new z,ue=new ys;ie.add(B).add(N).add(G),ve.x=Q-T,ve.y=O-J,ve.z=V-de,ve.multiplyScalar(.5),ue.copy(D);const{x:De,y:oe,z:re}=ve,Me=new Ne;Me.makeScale(De*2,oe*2,re*2);const Oe=new Ne;Oe.makeTranslation(-De,-oe,-re);const xe=new Ne;xe.makeTranslation(ie.x,ie.y,ie.z);const it=new Ne;it.setFromMatrix3(ue);const at=new Ne;return at.multiply(xe),at.multiply(it),at.multiply(Oe),at.multiply(Me),{center:ie,halfSizes:ve,rotation:ue,transformation:at}}function jp(l,e,t){const i=[l[0]-e[0],l[1]-e[1],l[2]-e[2]];return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]>0}class Uc{static isTransparent(e){return e.transparent&&e.opacity<1}}const Ha=class _t{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return`${_t._lut[e&255]+_t._lut[e>>8&255]+_t._lut[e>>16&255]+_t._lut[e>>24&255]}-${_t._lut[t&255]}${_t._lut[t>>8&255]}-${_t._lut[t>>16&15|64]}${_t._lut[t>>24&255]}-${_t._lut[i&63|128]}${_t._lut[i>>8&255]}-${_t._lut[i>>16&255]}${_t._lut[i>>24&255]}${_t._lut[s&255]}${_t._lut[s>>8&255]}${_t._lut[s>>16&255]}${_t._lut[s>>24&255]}`.toLowerCase()}static validate(e){if(!_t._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};R(Ha,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),R(Ha,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let xs=Ha;class Wp extends Ke{constructor(e,t){super(e),R(this,"onDisposed",new le),R(this,"onVertexFound",new le),R(this,"onVertexLost",new le),R(this,"onEnabled",new le),R(this,"components"),R(this,"workingPlane",null),R(this,"_pickedPoint",null),R(this,"_config"),R(this,"_enabled",!1),this.components=e,this.config={snapDistance:.25,showOnlyVertex:!1,...t},this.enabled=!1}set enabled(e){this._enabled=e,e||(this._pickedPoint=null),this.onEnabled.trigger(e)}get enabled(){return this._enabled}set config(e){this._config={...this._config,...e}}get config(){return this._config}dispose(){this.onVertexFound.reset(),this.onVertexLost.reset(),this.components=null,this.onDisposed.trigger(),this.onDisposed.reset()}get(e){if(!this.enabled)return this._pickedPoint;const t=this.components.get(li).get(e).castRay();if(!t)return this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint;const i=this.getClosestVertex(t);return i?!this.workingPlane||Math.abs(this.workingPlane.distanceToPoint(i))<.001?((this._pickedPoint===null||!this._pickedPoint.equals(i))&&(this._pickedPoint=i.clone(),this.onVertexFound.trigger(this._pickedPoint)),this._pickedPoint):(this._pickedPoint=null,this._pickedPoint):(this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint)}getClosestVertex(e){let t=new z,i=!1,s=Number.MAX_SAFE_INTEGER;const n=this.getVertices(e);if(n===null)return null;for(const r of n){if(!r)continue;const o=e.point.distanceTo(r);o>s||o>this._config.snapDistance||(i=!0,t=r,s=e.point.distanceTo(r))}return i?t:this.config.showOnlyVertex?null:e.point}getVertices(e){const t=e.object;if(!e.face||!t)return null;const i=t.geometry,s=new Ne,{instanceId:n}=e,r=n!==void 0,o=t instanceof pi;return o&&r&&t.getMatrixAt(n,s),[this.getVertex(e.face.a,i),this.getVertex(e.face.b,i),this.getVertex(e.face.c,i)].map(a=>(a&&(o&&r&&a.applyMatrix4(s),a.applyMatrix4(t.matrixWorld)),a))}getVertex(e,t){if(e===void 0)return null;const i=t.attributes.position;return new z(i.getX(e),i.getY(e),i.getZ(e))}}const Nh=class Uh{constructor(){R(this,"onDisposed",new le),R(this,"list",new Map),R(this,"enabled",!1),R(this,"_clock"),R(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,i]of this.list)i.enabled&&i.isUpdateable()&&i.update(e);requestAnimationFrame(this.update)}),this._clock=new Ch,Uh.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");xs.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const i=new e(this);return this.list.has(t)||this.add(t,i),i}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){rt.prototype.computeBoundsTree=Pp,rt.prototype.disposeBoundsTree=Dp,Ae.prototype.raycast=Op}};R(Nh,"release","2.2.11");let Zp=Nh;class Kp extends Ol{constructor(){super(...arguments),R(this,"meshes",new Set),R(this,"onAfterUpdate",new le),R(this,"onBeforeUpdate",new le),R(this,"onDisposed",new le),R(this,"isDisposing",!1),R(this,"enabled",!0),R(this,"uuid",xs.create()),R(this,"name"),R(this,"_scene"),R(this,"_camera"),R(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){const t=this.components.get(Ri);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const i of this.meshes)t.destroy(i);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(Yh).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}class Xp extends Lp{constructor(e,t,i){super(e),R(this,"enabled",!0),R(this,"container"),R(this,"needsUpdate"),R(this,"three"),R(this,"_canvas"),R(this,"_parameters"),R(this,"_resizeObserver",null),R(this,"onContainerUpdated",new le),R(this,"_resizing",!1),R(this,"resize",r=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();const o=r?r.x:this.container.clientWidth,a=r?r.y:this.container.clientHeight;this.three.setSize(o,a),this.onResize.trigger(new ft(o,a)),this._resizing=!1}),R(this,"resizeEvent",()=>{this.resize()}),R(this,"onContextLost",r=>{r.preventDefault(),this.enabled=!1}),R(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new po({canvas:this._canvas,antialias:!0,alpha:!0,...this._parameters}),this.enabled=!0}),this.container=t,this._parameters=i,this.three=new po({antialias:!0,alpha:!0,...i}),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;const s=this.three.getContext(),{canvas:n}=s;n.addEventListener("webglcontextlost",this.onContextLost,!1),n.addEventListener("webglcontextrestored",this.onContextBack,!1),this.needsUpdate=!0}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new ft(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){const t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const ze={LEFT:1,RIGHT:2,MIDDLE:4},pe=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Ks={NONE:0,IN:1,OUT:-1};function ps(l){return l.isPerspectiveCamera}function qi(l){return l.isOrthographicCamera}const Xs=Math.PI*2,Bc=Math.PI/2,Bh=1e-5,Dn=Math.PI/180;function di(l,e,t){return Math.max(e,Math.min(t,l))}function lt(l,e=Bh){return Math.abs(l)<e}function nt(l,e,t=Bh){return lt(l-e,t)}function kc(l,e){return Math.round(l/e)*e}function Mn(l){return isFinite(l)?l:l<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Ln(l){return Math.abs(l)<Number.MAX_VALUE?l:l*(1/0)}function Gr(l,e,t,i,s=1/0,n){i=Math.max(1e-4,i);const r=2/i,o=r*n,a=1/(1+o+.48*o*o+.235*o*o*o);let c=l-e;const u=e,d=s*i;c=di(c,-d,d),e=l-c;const f=(t.value+r*c)*n;t.value=(t.value-r*f)*a;let m=e+(c+f)*a;return u-l>0==m>u&&(m=u,t.value=(m-u)/n),m}function zc(l,e,t,i,s=1/0,n,r){i=Math.max(1e-4,i);const o=2/i,a=o*n,c=1/(1+a+.48*a*a+.235*a*a*a);let u=e.x,d=e.y,f=e.z,m=l.x-u,E=l.y-d,g=l.z-f;const w=u,y=d,I=f,_=s*i,C=_*_,F=m*m+E*E+g*g;if(F>C){const J=Math.sqrt(F);m=m/J*_,E=E/J*_,g=g/J*_}u=l.x-m,d=l.y-E,f=l.z-g;const M=(t.x+o*m)*n,D=(t.y+o*E)*n,B=(t.z+o*g)*n;t.x=(t.x-o*M)*c,t.y=(t.y-o*D)*c,t.z=(t.z-o*B)*c,r.x=u+(m+M)*c,r.y=d+(E+D)*c,r.z=f+(g+B)*c;const N=w-l.x,G=y-l.y,Q=I-l.z,O=r.x-w,V=r.y-y,T=r.z-I;return N*O+G*V+Q*T>0&&(r.x=w,r.y=y,r.z=I,t.x=(r.x-w)/n,t.y=(r.y-y)/n,t.z=(r.z-I)/n),r}function Ca(l,e){e.set(0,0),l.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=l.length,e.y/=l.length}function ba(l,e){return qi(l)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Qp{constructor(){this._listeners={}}addEventListener(e,t){const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const t=this._listeners[e.type];if(t!==void 0){e.target=this;const i=t.slice(0);for(let s=0,n=i.length;s<n;s++)i[s].call(this,e)}}}const qp="2.7.3",Hr=1/8,kh=typeof window<"u",Jp=kh&&/Mac/.test(navigator.platform),$p=!(kh&&"PointerEvent"in window);let ke,Vc,jr,Ta,Wt,je,tt,Qs,Nn,Ii,Ci,ms,Yc,Gc,ii,Un,qs,Hc,xa,jc,Aa,_a,Wr;class Ut extends Qp{static install(e){ke=e.THREE,Vc=Object.freeze(new ke.Vector3(0,0,0)),jr=Object.freeze(new ke.Vector3(0,1,0)),Ta=Object.freeze(new ke.Vector3(0,0,1)),Wt=new ke.Vector2,je=new ke.Vector3,tt=new ke.Vector3,Qs=new ke.Vector3,Nn=new ke.Vector3,Ii=new ke.Vector3,Ci=new ke.Vector3,ms=new ke.Vector3,Yc=new ke.Vector3,Gc=new ke.Vector3,ii=new ke.Spherical,Un=new ke.Spherical,qs=new ke.Box3,Hc=new ke.Box3,xa=new ke.Sphere,jc=new ke.Quaternion,Aa=new ke.Quaternion,_a=new ke.Matrix4,Wr=new ke.Raycaster}static get ACTION(){return pe}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=pe.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Ks.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new ke.Vector3,this._focalOffsetVelocity=new ke.Vector3,this._zoomVelocity={value:0},this._truckInternal=(C,F,M)=>{let D,B;if(ps(this._camera)){const N=je.copy(this._camera.position).sub(this._target),G=this._camera.getEffectiveFOV()*Dn,Q=N.length()*Math.tan(G*.5);D=this.truckSpeed*C*Q/this._elementRect.height,B=this.truckSpeed*F*Q/this._elementRect.height}else if(qi(this._camera)){const N=this._camera;D=C*(N.right-N.left)/N.zoom/this._elementRect.width,B=F*(N.top-N.bottom)/N.zoom/this._elementRect.height}else return;this.verticalDragToForward?(M?this.setFocalOffset(this._focalOffsetEnd.x+D,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(D,0,!0),this.forward(-B,!0)):M?this.setFocalOffset(this._focalOffsetEnd.x+D,this._focalOffsetEnd.y+B,this._focalOffsetEnd.z,!0):this.truck(D,B,!0)},this._rotateInternal=(C,F)=>{const M=Xs*this.azimuthRotateSpeed*C/this._elementRect.height,D=Xs*this.polarRotateSpeed*F/this._elementRect.height;this.rotate(M,D,!0)},this._dollyInternal=(C,F,M)=>{const D=Math.pow(.95,-C*this.dollySpeed),B=this._sphericalEnd.radius,N=this._sphericalEnd.radius*D,G=di(N,this.minDistance,this.maxDistance),Q=G-N;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(N,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(Q,!0),this._dollyToNoClamp(G,!0)):this._dollyToNoClamp(G,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?N:G)-B,this._dollyControlCoord.set(F,M)),this._lastDollyDirection=Math.sign(-C)},this._zoomInternal=(C,F,M)=>{const D=Math.pow(.95,C*this.dollySpeed),B=this._zoom,N=this._zoom*D;this.zoomTo(N,!0),this.dollyToCursor&&(this._changedZoom+=N-B,this._dollyControlCoord.set(F,M))},typeof ke>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new ke.Quaternion().setFromUnitVectors(this._camera.up,jr),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=pe.NONE,this._target=new ke.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new ke.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new ke.Spherical().setFromVector3(je.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new ke.Vector3,new ke.Vector3,new ke.Vector3,new ke.Vector3],this._updateNearPlaneCorners(),this._boundary=new ke.Box3(new ke.Vector3(-1/0,-1/0,-1/0),new ke.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new ke.Vector2,this.mouseButtons={left:pe.ROTATE,middle:pe.DOLLY,right:pe.TRUCK,wheel:ps(this._camera)?pe.DOLLY:qi(this._camera)?pe.ZOOM:pe.NONE},this.touches={one:pe.TOUCH_ROTATE,two:ps(this._camera)?pe.TOUCH_DOLLY_TRUCK:qi(this._camera)?pe.TOUCH_ZOOM_TRUCK:pe.NONE,three:pe.TOUCH_TRUCK};const i=new ke.Vector2,s=new ke.Vector2,n=new ke.Vector2,r=C=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const D=this._domElement.getBoundingClientRect(),B=C.clientX/D.width,N=C.clientY/D.height;if(B<this._interactiveArea.left||B>this._interactiveArea.right||N<this._interactiveArea.top||N>this._interactiveArea.bottom)return}const F=C.pointerType!=="mouse"?null:(C.buttons&ze.LEFT)===ze.LEFT?ze.LEFT:(C.buttons&ze.MIDDLE)===ze.MIDDLE?ze.MIDDLE:(C.buttons&ze.RIGHT)===ze.RIGHT?ze.RIGHT:null;if(F!==null){const D=this._findPointerByMouseButton(F);D&&this._disposePointer(D)}if((C.buttons&ze.LEFT)===ze.LEFT&&this._lockedPointer)return;const M={pointerId:C.pointerId,clientX:C.clientX,clientY:C.clientY,deltaX:0,deltaY:0,mouseButton:F};this._activePointers.push(M),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),this._isDragging=!0,g(C)},o=C=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const D=this._domElement.getBoundingClientRect(),B=C.clientX/D.width,N=C.clientY/D.height;if(B<this._interactiveArea.left||B>this._interactiveArea.right||N<this._interactiveArea.top||N>this._interactiveArea.bottom)return}const F=(C.buttons&ze.LEFT)===ze.LEFT?ze.LEFT:(C.buttons&ze.MIDDLE)===ze.MIDDLE?ze.MIDDLE:(C.buttons&ze.RIGHT)===ze.RIGHT?ze.RIGHT:null;if(F!==null){const D=this._findPointerByMouseButton(F);D&&this._disposePointer(D)}const M={pointerId:1,clientX:C.clientX,clientY:C.clientY,deltaX:0,deltaY:0,mouseButton:(C.buttons&ze.LEFT)===ze.LEFT?ze.LEFT:(C.buttons&ze.MIDDLE)===ze.LEFT?ze.MIDDLE:(C.buttons&ze.RIGHT)===ze.LEFT?ze.RIGHT:null};this._activePointers.push(M),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("mouseup",d),this._domElement.ownerDocument.addEventListener("mousemove",c),this._domElement.ownerDocument.addEventListener("mouseup",d),this._isDragging=!0,g(C)},a=C=>{C.cancelable&&C.preventDefault();const F=C.pointerId,M=this._lockedPointer||this._findPointerById(F);if(M){if(M.clientX=C.clientX,M.clientY=C.clientY,M.deltaX=C.movementX,M.deltaY=C.movementY,this._state=0,C.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(C.buttons&ze.LEFT)===ze.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(C.buttons&ze.MIDDLE)===ze.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(C.buttons&ze.RIGHT)===ze.RIGHT&&(this._state=this._state|this.mouseButtons.right);w()}},c=C=>{const F=this._lockedPointer||this._findPointerById(1);F&&(F.clientX=C.clientX,F.clientY=C.clientY,F.deltaX=C.movementX,F.deltaY=C.movementY,this._state=0,(this._lockedPointer||(C.buttons&ze.LEFT)===ze.LEFT)&&(this._state=this._state|this.mouseButtons.left),(C.buttons&ze.MIDDLE)===ze.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(C.buttons&ze.RIGHT)===ze.RIGHT&&(this._state=this._state|this.mouseButtons.right),w())},u=C=>{const F=this._findPointerById(C.pointerId);if(!(F&&F===this._lockedPointer)){if(F&&this._disposePointer(F),C.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=pe.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=pe.NONE;y()}},d=()=>{const C=this._findPointerById(1);C&&C===this._lockedPointer||(C&&this._disposePointer(C),this._state=pe.NONE,y())};let f=-1;const m=C=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===pe.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const N=this._domElement.getBoundingClientRect(),G=C.clientX/N.width,Q=C.clientY/N.height;if(G<this._interactiveArea.left||G>this._interactiveArea.right||Q<this._interactiveArea.top||Q>this._interactiveArea.bottom)return}if(C.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===pe.ROTATE||this.mouseButtons.wheel===pe.TRUCK){const N=performance.now();f-N<1e3&&this._getClientRect(this._elementRect),f=N}const F=Jp?-1:-3,M=C.deltaMode===1?C.deltaY/F:C.deltaY/(F*10),D=this.dollyToCursor?(C.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,B=this.dollyToCursor?(C.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case pe.ROTATE:{this._rotateInternal(C.deltaX,C.deltaY),this._isUserControllingRotate=!0;break}case pe.TRUCK:{this._truckInternal(C.deltaX,C.deltaY,!1),this._isUserControllingTruck=!0;break}case pe.OFFSET:{this._truckInternal(C.deltaX,C.deltaY,!0),this._isUserControllingOffset=!0;break}case pe.DOLLY:{this._dollyInternal(-M,D,B),this._isUserControllingDolly=!0;break}case pe.ZOOM:{this._zoomInternal(-M,D,B),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},E=C=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===Ut.ACTION.NONE){const F=C instanceof PointerEvent?C.pointerId:0,M=this._findPointerById(F);M&&this._disposePointer(M),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("mouseup",d);return}C.preventDefault()}},g=C=>{if(this._enabled){if(Ca(this._activePointers,Wt),this._getClientRect(this._elementRect),i.copy(Wt),s.copy(Wt),this._activePointers.length>=2){const F=Wt.x-this._activePointers[1].clientX,M=Wt.y-this._activePointers[1].clientY,D=Math.sqrt(F*F+M*M);n.set(0,D);const B=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,N=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;s.set(B,N)}if(this._state=0,!C)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in C&&C.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(C.buttons&ze.LEFT)===ze.LEFT&&(this._state=this._state|this.mouseButtons.left),(C.buttons&ze.MIDDLE)===ze.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(C.buttons&ze.RIGHT)===ze.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&pe.ROTATE)===pe.ROTATE||(this._state&pe.TOUCH_ROTATE)===pe.TOUCH_ROTATE||(this._state&pe.TOUCH_DOLLY_ROTATE)===pe.TOUCH_DOLLY_ROTATE||(this._state&pe.TOUCH_ZOOM_ROTATE)===pe.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&pe.TRUCK)===pe.TRUCK||(this._state&pe.TOUCH_TRUCK)===pe.TOUCH_TRUCK||(this._state&pe.TOUCH_DOLLY_TRUCK)===pe.TOUCH_DOLLY_TRUCK||(this._state&pe.TOUCH_ZOOM_TRUCK)===pe.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&pe.DOLLY)===pe.DOLLY||(this._state&pe.TOUCH_DOLLY)===pe.TOUCH_DOLLY||(this._state&pe.TOUCH_DOLLY_TRUCK)===pe.TOUCH_DOLLY_TRUCK||(this._state&pe.TOUCH_DOLLY_OFFSET)===pe.TOUCH_DOLLY_OFFSET||(this._state&pe.TOUCH_DOLLY_ROTATE)===pe.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&pe.ZOOM)===pe.ZOOM||(this._state&pe.TOUCH_ZOOM)===pe.TOUCH_ZOOM||(this._state&pe.TOUCH_ZOOM_TRUCK)===pe.TOUCH_ZOOM_TRUCK||(this._state&pe.TOUCH_ZOOM_OFFSET)===pe.TOUCH_ZOOM_OFFSET||(this._state&pe.TOUCH_ZOOM_ROTATE)===pe.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&pe.OFFSET)===pe.OFFSET||(this._state&pe.TOUCH_OFFSET)===pe.TOUCH_OFFSET||(this._state&pe.TOUCH_DOLLY_OFFSET)===pe.TOUCH_DOLLY_OFFSET||(this._state&pe.TOUCH_ZOOM_OFFSET)===pe.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},w=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Ca(this._activePointers,Wt);const C=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,F=C?-C.deltaX:s.x-Wt.x,M=C?-C.deltaY:s.y-Wt.y;if(s.copy(Wt),((this._state&pe.ROTATE)===pe.ROTATE||(this._state&pe.TOUCH_ROTATE)===pe.TOUCH_ROTATE||(this._state&pe.TOUCH_DOLLY_ROTATE)===pe.TOUCH_DOLLY_ROTATE||(this._state&pe.TOUCH_ZOOM_ROTATE)===pe.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(F,M),this._isUserControllingRotate=!0),(this._state&pe.DOLLY)===pe.DOLLY||(this._state&pe.ZOOM)===pe.ZOOM){const D=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,B=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,N=this.dollyDragInverted?-1:1;(this._state&pe.DOLLY)===pe.DOLLY?(this._dollyInternal(N*M*Hr,D,B),this._isUserControllingDolly=!0):(this._zoomInternal(N*M*Hr,D,B),this._isUserControllingZoom=!0)}if((this._state&pe.TOUCH_DOLLY)===pe.TOUCH_DOLLY||(this._state&pe.TOUCH_ZOOM)===pe.TOUCH_ZOOM||(this._state&pe.TOUCH_DOLLY_TRUCK)===pe.TOUCH_DOLLY_TRUCK||(this._state&pe.TOUCH_ZOOM_TRUCK)===pe.TOUCH_ZOOM_TRUCK||(this._state&pe.TOUCH_DOLLY_OFFSET)===pe.TOUCH_DOLLY_OFFSET||(this._state&pe.TOUCH_ZOOM_OFFSET)===pe.TOUCH_ZOOM_OFFSET||(this._state&pe.TOUCH_DOLLY_ROTATE)===pe.TOUCH_DOLLY_ROTATE||(this._state&pe.TOUCH_ZOOM_ROTATE)===pe.TOUCH_ZOOM_ROTATE){const D=Wt.x-this._activePointers[1].clientX,B=Wt.y-this._activePointers[1].clientY,N=Math.sqrt(D*D+B*B),G=n.y-N;n.set(0,N);const Q=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,O=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&pe.TOUCH_DOLLY)===pe.TOUCH_DOLLY||(this._state&pe.TOUCH_DOLLY_ROTATE)===pe.TOUCH_DOLLY_ROTATE||(this._state&pe.TOUCH_DOLLY_TRUCK)===pe.TOUCH_DOLLY_TRUCK||(this._state&pe.TOUCH_DOLLY_OFFSET)===pe.TOUCH_DOLLY_OFFSET?(this._dollyInternal(G*Hr,Q,O),this._isUserControllingDolly=!0):(this._zoomInternal(G*Hr,Q,O),this._isUserControllingZoom=!0)}((this._state&pe.TRUCK)===pe.TRUCK||(this._state&pe.TOUCH_TRUCK)===pe.TOUCH_TRUCK||(this._state&pe.TOUCH_DOLLY_TRUCK)===pe.TOUCH_DOLLY_TRUCK||(this._state&pe.TOUCH_ZOOM_TRUCK)===pe.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(F,M,!1),this._isUserControllingTruck=!0),((this._state&pe.OFFSET)===pe.OFFSET||(this._state&pe.TOUCH_OFFSET)===pe.TOUCH_OFFSET||(this._state&pe.TOUCH_DOLLY_OFFSET)===pe.TOUCH_DOLLY_OFFSET||(this._state&pe.TOUCH_ZOOM_OFFSET)===pe.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(F,M,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},y=()=>{Ca(this._activePointers,Wt),s.copy(Wt),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",d),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",I),this._domElement.ownerDocument.addEventListener("pointerlockerror",_),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),g())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",I),this._domElement.ownerDocument.removeEventListener("pointerlockerror",_))};const I=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},_=()=>{this.unlockPointer()};this._addAllEventListeners=C=>{this._domElement=C,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),$p&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",u),this._domElement.addEventListener("wheel",m,{passive:!1}),this._domElement.addEventListener("contextmenu",E)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",u),this._domElement.removeEventListener("wheel",m,{passive:!1}),this._domElement.removeEventListener("contextmenu",E),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("mouseup",d),this._domElement.ownerDocument.removeEventListener("pointerlockchange",I),this._domElement.ownerDocument.removeEventListener("pointerlockerror",_))},this.cancel=()=>{this._state!==pe.NONE&&(this._state=pe.NONE,this._activePointers.length=0,y())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=di(e.width,0,1),this._interactiveArea.height=di(e.height,0,1),this._interactiveArea.x=di(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=di(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,i=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,i)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,i=!1){this._isUserControllingRotate=!1;const s=di(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=di(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=s,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!i||nt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&nt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Ks.NONE,this._changedDolly=0,this._dollyToNoClamp(di(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const n=this._collisionTest(),r=nt(n,this._spherical.radius);if(!(i>e)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,n)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const s=!t||nt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(s)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(Nn).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const i=!t||nt(this._target.x,this._targetEnd.x,this.restThreshold)&&nt(this._target.y,this._targetEnd.y,this.restThreshold)&&nt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=di(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const i=!t||nt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(e,t,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,i)}truck(e,t,i=!1){this._camera.updateMatrix(),Ii.setFromMatrixColumn(this._camera.matrix,0),Ci.setFromMatrixColumn(this._camera.matrix,1),Ii.multiplyScalar(e),Ci.multiplyScalar(-t);const s=je.copy(Ii).add(Ci),n=tt.copy(this._targetEnd).add(s);return this.moveTo(n.x,n.y,n.z,i)}forward(e,t=!1){je.setFromMatrixColumn(this._camera.matrix,0),je.crossVectors(this._camera.up,je),je.multiplyScalar(e);const i=tt.copy(this._targetEnd).add(je);return this.moveTo(i.x,i.y,i.z,t)}elevate(e,t=!1){return je.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+je.x,this._targetEnd.y+je.y,this._targetEnd.z+je.z,t)}moveTo(e,t,i,s=!1){this._isUserControllingTruck=!1;const n=je.set(e,t,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,s||this._target.copy(this._targetEnd);const r=!s||nt(this._target.x,this._targetEnd.x,this.restThreshold)&&nt(this._target.y,this._targetEnd.y,this.restThreshold)&&nt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,i,s=!1){const n=je.set(e,t,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(n.x,n.y,n.z,s)}fitToBox(e,t,{cover:i=!1,paddingLeft:s=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const a=[],c=e.isBox3?qs.copy(e):qs.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const u=kc(this._sphericalEnd.theta,Bc),d=kc(this._sphericalEnd.phi,Bc);a.push(this.rotateTo(u,d,t));const f=je.setFromSpherical(this._sphericalEnd).normalize(),m=jc.setFromUnitVectors(f,Ta),E=nt(Math.abs(f.y),1);E&&m.multiply(Aa.setFromAxisAngle(jr,u)),m.multiply(this._yAxisUpSpaceInverse);const g=Hc.makeEmpty();tt.copy(c.min).applyQuaternion(m),g.expandByPoint(tt),tt.copy(c.min).setX(c.max.x).applyQuaternion(m),g.expandByPoint(tt),tt.copy(c.min).setY(c.max.y).applyQuaternion(m),g.expandByPoint(tt),tt.copy(c.max).setZ(c.min.z).applyQuaternion(m),g.expandByPoint(tt),tt.copy(c.min).setZ(c.max.z).applyQuaternion(m),g.expandByPoint(tt),tt.copy(c.max).setY(c.min.y).applyQuaternion(m),g.expandByPoint(tt),tt.copy(c.max).setX(c.min.x).applyQuaternion(m),g.expandByPoint(tt),tt.copy(c.max).applyQuaternion(m),g.expandByPoint(tt),g.min.x-=s,g.min.y-=r,g.max.x+=n,g.max.y+=o,m.setFromUnitVectors(Ta,f),E&&m.premultiply(Aa.invert()),m.premultiply(this._yAxisUpSpace);const w=g.getSize(je),y=g.getCenter(tt).applyQuaternion(m);if(ps(this._camera)){const I=this.getDistanceToFitBox(w.x,w.y,w.z,i);a.push(this.moveTo(y.x,y.y,y.z,t)),a.push(this.dollyTo(I,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(qi(this._camera)){const I=this._camera,_=I.right-I.left,C=I.top-I.bottom,F=i?Math.max(_/w.x,C/w.y):Math.min(_/w.x,C/w.y);a.push(this.moveTo(y.x,y.y,y.z,t)),a.push(this.zoomTo(F,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const i=[],s=e instanceof ke.Sphere?xa.copy(e):Ut.createBoundingSphere(e,xa);if(i.push(this.moveTo(s.center.x,s.center.y,s.center.z,t)),ps(this._camera)){const n=this.getDistanceToFitSphere(s.radius);i.push(this.dollyTo(n,t))}else if(qi(this._camera)){const n=this._camera.right-this._camera.left,r=this._camera.top-this._camera.bottom,o=2*s.radius,a=Math.min(n/o,r/o);i.push(this.zoomTo(a,t))}return i.push(this.setFocalOffset(0,0,0,t)),Promise.all(i)}setLookAt(e,t,i,s,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ks.NONE,this._changedDolly=0;const a=tt.set(s,n,r),c=je.set(e,t,i);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(c.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const u=!o||nt(this._target.x,this._targetEnd.x,this.restThreshold)&&nt(this._target.y,this._targetEnd.y,this.restThreshold)&&nt(this._target.z,this._targetEnd.z,this.restThreshold)&&nt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&nt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&nt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(e,t,i,s,n,r,o,a,c,u,d,f,m,E=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ks.NONE,this._changedDolly=0;const g=je.set(s,n,r),w=tt.set(e,t,i);ii.setFromVector3(w.sub(g).applyQuaternion(this._yAxisUpSpace));const y=Qs.set(u,d,f),I=tt.set(o,a,c);Un.setFromVector3(I.sub(y).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(g.lerp(y,m));const _=Un.theta-ii.theta,C=Un.phi-ii.phi,F=Un.radius-ii.radius;this._sphericalEnd.set(ii.radius+F*m,ii.phi+C*m,ii.theta+_*m),this.normalizeRotations(),this._needsUpdate=!0,E||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const M=!E||nt(this._target.x,this._targetEnd.x,this.restThreshold)&&nt(this._target.y,this._targetEnd.y,this.restThreshold)&&nt(this._target.z,this._targetEnd.z,this.restThreshold)&&nt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&nt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&nt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(M)}setPosition(e,t,i,s=!1){return this.setLookAt(e,t,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,s)}setTarget(e,t,i,s=!1){const n=this.getPosition(je),r=this.setLookAt(n.x,n.y,n.z,e,t,i,s);return this._sphericalEnd.phi=di(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,i,s=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,i),this._needsUpdate=!0,s||this._focalOffset.copy(this._focalOffsetEnd);const n=!s||nt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&nt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&nt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,i){this._camera.updateMatrixWorld(),Ii.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Ci.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ms.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const s=je.set(e,t,i),n=s.distanceTo(this._camera.position),r=s.sub(this._camera.position);Ii.multiplyScalar(r.x),Ci.multiplyScalar(r.y),ms.multiplyScalar(r.z),je.copy(Ii).add(Ci).add(ms),je.z=je.z+n,this.dollyTo(n,!1),this.setFocalOffset(-je.x,je.y,-je.z,!1),this.moveTo(e,t,i,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,i,s){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new ke.Vector4,typeof e=="number"?this._viewport.set(e,t,i,s):this._viewport.copy(e)}getDistanceToFitBox(e,t,i,s=!1){if(ba(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,r=this._camera.getEffectiveFOV()*Dn,o=this._camera.aspect;return((s?n>o:n<o)?t:e/o)*.5/Math.tan(r*.5)+i*.5}getDistanceToFitSphere(e){if(ba(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*Dn,i=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,s=1<this._camera.aspect?t:i;return e/Math.sin(s*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new ke.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new ke.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof ke.Spherical?e:new ke.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new ke.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Xs,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Xs),this._spherical.theta+=Xs*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Xs)}reset(e=!1){if(!nt(this._camera.up.x,this._cameraUp0.x)||!nt(this._camera.up.y,this._cameraUp0.y)||!nt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const i=this.getPosition(je);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,jr),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=je.subVectors(this._target,this._camera.position).normalize(),t=tt.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const i=this.getPosition(je);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,s=this._sphericalEnd.radius-this._spherical.radius,n=Yc.subVectors(this._targetEnd,this._target),r=Gc.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(lt(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const u=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Gr(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,u,1/0,e),this._needsUpdate=!0}if(lt(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const u=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Gr(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,u,1/0,e),this._needsUpdate=!0}if(lt(s))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const u=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Gr(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,u,this.maxSpeed,e),this._needsUpdate=!0}if(lt(n.x)&&lt(n.y)&&lt(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const u=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;zc(this._target,this._targetEnd,this._targetVelocity,u,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(lt(r.x)&&lt(r.y)&&lt(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const u=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;zc(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,u,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(lt(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const u=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Gr(this._zoom,this._zoomEnd,this._zoomVelocity,u,1/0,e)}if(this.dollyToCursor){if(ps(this._camera)&&this._changedDolly!==0){const u=this._spherical.radius-this._lastDistance,d=this._camera,f=this._getCameraDirection(Nn),m=je.copy(f).cross(d.up).normalize();m.lengthSq()===0&&(m.x=1);const E=tt.crossVectors(m,f),g=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*Dn*.5),w=(this._sphericalEnd.radius-u-this._sphericalEnd.radius)/this._sphericalEnd.radius,y=Qs.copy(this._targetEnd).add(m.multiplyScalar(this._dollyControlCoord.x*g*d.aspect)).add(E.multiplyScalar(this._dollyControlCoord.y*g)),I=je.copy(this._targetEnd).lerp(y,w),_=this._lastDollyDirection===Ks.IN&&this._spherical.radius<=this.minDistance,C=this._lastDollyDirection===Ks.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(_||C)){this._sphericalEnd.radius-=u,this._spherical.radius-=u;const M=tt.copy(f).multiplyScalar(-u);I.add(M)}this._boundary.clampPoint(I,I);const F=tt.subVectors(I,this._targetEnd);this._targetEnd.copy(I),this._target.add(F),this._changedDolly-=u,lt(this._changedDolly)&&(this._changedDolly=0)}else if(qi(this._camera)&&this._changedZoom!==0){const u=this._zoom-this._lastZoom,d=this._camera,f=je.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),m=tt.set(0,0,-1).applyQuaternion(d.quaternion),E=Qs.copy(f).add(m.multiplyScalar(-f.dot(d.up))),g=-(this._zoom-u-this._zoom)/this._zoom,w=this._getCameraDirection(Nn),y=this._targetEnd.dot(w),I=je.copy(this._targetEnd).lerp(E,g),_=I.dot(w),C=w.multiplyScalar(_-y);I.sub(C),this._boundary.clampPoint(I,I);const F=tt.subVectors(I,this._targetEnd);this._targetEnd.copy(I),this._target.add(F),this._changedZoom-=u,lt(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!lt(this._focalOffset.x)||!lt(this._focalOffset.y)||!lt(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),Ii.setFromMatrixColumn(this._camera.matrix,0),Ci.setFromMatrixColumn(this._camera.matrix,1),ms.setFromMatrixColumn(this._camera.matrix,2),Ii.multiplyScalar(this._focalOffset.x),Ci.multiplyScalar(-this._focalOffset.y),ms.multiplyScalar(this._focalOffset.z),je.copy(Ii).add(Ci).add(ms),this._camera.position.add(je)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),je.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),lt(t,this.restThreshold)&&lt(i,this.restThreshold)&&lt(s,this.restThreshold)&&lt(n.x,this.restThreshold)&&lt(n.y,this.restThreshold)&&lt(n.z,this.restThreshold)&&lt(r.x,this.restThreshold)&&lt(r.y,this.restThreshold)&&lt(r.z,this.restThreshold)&&lt(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Mn(this.maxDistance),minZoom:this.minZoom,maxZoom:Mn(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Mn(this.maxPolarAngle),minAzimuthAngle:Mn(this.minAzimuthAngle),maxAzimuthAngle:Mn(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:je.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const i=JSON.parse(e);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Ln(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Ln(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Ln(i.maxPolarAngle),this.minAzimuthAngle=Ln(i.minAzimuthAngle),this.maxAzimuthAngle=Ln(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],t),ii.setFromVector3(je.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(ii.theta,ii.phi,t),this.dollyTo(ii.radius,t),this.zoomTo(i.zoom,t),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",qp),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,i){const s=t.lengthSq();if(s===0)return e;const n=tt.copy(t).add(e),r=this._boundary.clampPoint(n,Qs).sub(n),o=r.lengthSq();if(o===0)return e.add(t);if(o===s)return e;if(i===0)return e.add(t).add(r);{const a=1+i*o/t.dot(r);return e.add(tt.copy(t).multiplyScalar(a)).add(r.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(ps(this._camera)){const e=this._camera,t=e.near,i=e.getEffectiveFOV()*Dn,s=Math.tan(i*.5)*t,n=s*e.aspect;this._nearPlaneCorners[0].set(-n,-s,0),this._nearPlaneCorners[1].set(n,-s,0),this._nearPlaneCorners[2].set(n,s,0),this._nearPlaneCorners[3].set(-n,s,0)}else if(qi(this._camera)){const e=this._camera,t=1/e.zoom,i=e.left*t,s=e.right*t,n=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(i,n,0),this._nearPlaneCorners[1].set(s,n,0),this._nearPlaneCorners[2].set(s,r,0),this._nearPlaneCorners[3].set(i,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||ba(this._camera,"_collisionTest"))return e;const t=this._getTargetDirection(Nn);_a.lookAt(Vc,t,this._camera.up);for(let i=0;i<4;i++){const s=tt.copy(this._nearPlaneCorners[i]);s.applyMatrix4(_a);const n=Qs.addVectors(this._target,s);Wr.set(n,t),Wr.far=this._spherical.radius+1;const r=Wr.intersectObjects(this.colliderMeshes);r.length!==0&&r[0].distance<e&&(e=r[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const i=()=>{this.removeEventListener("rest",i),t()};this.addEventListener("rest",i)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new ke.Sphere){const i=t,s=i.center;qs.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&qs.expandByObject(r)}),qs.getCenter(s);let n=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r,a=o.geometry.clone();a.applyMatrix4(o.matrixWorld);const c=a.attributes.position;for(let u=0,d=c.count;u<d;u++)je.fromBufferAttribute(c,u),n=Math.max(n,s.distanceToSquared(je))}),i.radius=Math.sqrt(n),i}}class Kn extends Mp{constructor(e){super(e),R(this,"onBeforeUpdate",new le),R(this,"onAfterUpdate",new le),R(this,"onAspectUpdated",new le),R(this,"onDisposed",new le),R(this,"three"),R(this,"_allControls",new Map),R(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof ss){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const i=this.currentWorld.renderer.getSize();this.three.aspect=i.width/i.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:t,world:i})=>{if(t==="added"){const s=this.newCameraControls();this._allControls.set(i.uuid,s)}if(t==="removed"){const s=this._allControls.get(i.uuid);s&&(s.dispose(),this._allControls.delete(i.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[e,t]of this._allControls)t.dispose()}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}setupCamera(){const e=window.innerWidth/window.innerHeight,t=new Ih(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new z(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");Ut.install({THREE:Kn.getSubsetOfThree()});const{domElement:e}=this.currentWorld.renderer.three,t=new Ut(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Xd,Vector2:ft,Vector3:z,Vector4:un,Quaternion:si,Matrix4:Ne,Spherical:Qd,Box3:ut,Sphere:_s,Raycaster:Co,MathUtils:er}}}const zh=class Vh extends Ke{constructor(e){super(e),R(this,"onAfterUpdate",new le),R(this,"onBeforeUpdate",new le),R(this,"onDisposed",new le),R(this,"list",new Yi),R(this,"enabled",!0),e.add(Vh.uuid,this)}create(){const e=new Kp(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(e.uuid),e.dispose()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(const[t,i]of this.list)i.update(e)}};R(zh,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let Yh=zh;function em(l,e,t,i){return new Promise((s,n)=>{function r(){const o=l.clientWaitSync(e,t,0);if(o===l.WAIT_FAILED){n();return}if(o===l.TIMEOUT_EXPIRED){setTimeout(r,i);return}s()}r()})}async function tm(l,e,t,i,s,n,r){const o=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0);l.flush(),await em(l,o,0,10),l.deleteSync(o),l.bindBuffer(e,t),l.getBufferSubData(e,i,s,n,r),l.bindBuffer(e,null)}async function im(l,e,t,i,s,n,r,o){const a=l.createBuffer();return l.bindBuffer(l.PIXEL_PACK_BUFFER,a),l.bufferData(l.PIXEL_PACK_BUFFER,o.byteLength,l.STREAM_READ),l.readPixels(e,t,i,s,n,r,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await tm(l,l.PIXEL_PACK_BUFFER,a,0,o),l.deleteBuffer(a),o}class Gh{constructor(e,t,i){if(R(this,"onDisposed",new le),R(this,"onViewUpdated",new Wn),R(this,"enabled",!0),R(this,"needsUpdate",!1),R(this,"renderDebugFrame",!1),R(this,"components"),R(this,"world"),R(this,"renderer"),R(this,"autoUpdate",!0),R(this,"updateInterval",1e3),R(this,"worker"),R(this,"scene",new Rs),R(this,"_width",512),R(this,"_height",512),R(this,"_availableColor",1),R(this,"renderTarget"),R(this,"bufferSize"),R(this,"_buffer"),R(this,"_isWorkerBusy",!1),R(this,"updateVisibility",async r=>{if(!this.enabled||!this.needsUpdate&&!r||this._isWorkerBusy)return;this._isWorkerBusy=!0;const o=this.world.camera.three;o.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,o);const a=this.renderer.getContext();try{await im(a,0,0,this._width,this._height,a.RGBA,a.UNSIGNED_BYTE,this._buffer)}catch{this.needsUpdate=!1,this._isWorkerBusy=!1,this.renderer.setRenderTarget(null);return}this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,o),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1}),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.applySettings(i),this.world=t,this.renderer=new po,this.renderTarget=new zi(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=t.renderer.clippingPlanes;const s=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,n=new Blob([s],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n))}dispose(){this.enabled=!1;for(const e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let e=BigInt(this._availableColor.toString());const t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);const[i,s,n]=t,r=`${i}-${s}-${n}`;return{r:i,g:s,b:n,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(e){e&&(e.updateInterval!==void 0&&(this.updateInterval=e.updateInterval),e.height!==void 0&&(this._height=e.height),e.width!==void 0&&(this._width=e.width),e.autoUpdate!==void 0&&(this.autoUpdate=e.autoUpdate))}}class sm extends Gh{constructor(e,t,i){super(e,t,i),R(this,"onViewUpdated",new le),R(this,"threshold",100),R(this,"colorMeshes",new Map),R(this,"isProcessing",!1),R(this,"_interval",null),R(this,"_colorCodeMeshMap",new Map),R(this,"_meshIDColorCodeMap",new Map),R(this,"_currentVisibleMeshes",new Set),R(this,"_recentlyHiddenMeshes",new Set),R(this,"_intervalID",null),R(this,"_transparentMat",new ei({transparent:!0,opacity:0})),R(this,"handleWorkerMessage",async s=>{if(this.isProcessing)return;const n=s.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[r,o]of n){if(o<this.threshold)continue;const a=this._colorCodeMeshMap.get(r);a&&(this._currentVisibleMeshes.add(a),this._recentlyHiddenMeshes.delete(a))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1}),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._interval=window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval)),this.onViewUpdated.add(({seen:s,unseen:n})=>{for(const r of s)r.visible=!0;for(const r of n)r.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._interval!==null&&(window.clearInterval(this._interval),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const e=this.components.get(Ri);for(const t in this.colorMeshes){const i=this.colorMeshes.get(t);i&&e.destroy(i,!0)}this.colorMeshes.clear()}add(e){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=e instanceof pi,{geometry:i,material:s}=e,{colorMaterial:n,code:r}=this.getAvailableMaterial();let o;if(Array.isArray(s)){let u=!0;const d=[];for(const f of s)Uc.isTransparent(f)?d.push(this._transparentMat):(u=!1,d.push(n));if(u){n.dispose(),this.isProcessing=!1;return}o=d}else if(Uc.isTransparent(s)){n.dispose(),this.isProcessing=!1;return}else o=n;this._colorCodeMeshMap.set(r,e),this._meshIDColorCodeMap.set(e.uuid,r);const a=t?e.count:1,c=new pi(i,o,a);t?c.instanceMatrix=e.instanceMatrix:c.setMatrixAt(0,new Ne),e.visible=!1,e.updateWorldMatrix(!0,!1),c.applyMatrix4(e.matrixWorld),c.updateMatrix(),this.scene.add(c),this.colorMeshes.set(e.uuid,c),this.increaseColor(),this.isProcessing=!1}remove(e){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const t=this.components.get(Ri);this._currentVisibleMeshes.delete(e),this._recentlyHiddenMeshes.delete(e);const i=this.colorMeshes.get(e.uuid),s=this._meshIDColorCodeMap.get(e.uuid);if(!i||!s){this.isProcessing=!1;return}this._colorCodeMeshMap.delete(s),this._meshIDColorCodeMap.delete(e.uuid),this.colorMeshes.delete(e.uuid),i.geometry=void 0,i.material=[],t.destroy(i,!0),this._recentlyHiddenMeshes.delete(e),this._currentVisibleMeshes.delete(e),this.isProcessing=!1}updateInstanced(e){for(const t of e){const i=this.colorMeshes.get(t.uuid);i&&(i.count=t.count)}}getAvailableMaterial(){const{r:e,g:t,b:i,code:s}=this.getAvailableColor(),n=Bi.enabled;Bi.enabled=!1;const r=new Ht(`rgb(${e}, ${t}, ${i})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const o=this.world.renderer.clippingPlanes,a=new ei({color:r,clippingPlanes:o,side:Jn});return Bi.enabled=n,{colorMaterial:a,code:s}}}const Hh=class ja extends Ke{constructor(e){super(e),R(this,"onDisposed",new le),R(this,"_enabled",!0),R(this,"list",new Map),e.add(ja.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const[t,i]of this.list)i.enabled=e}create(e,t){if(this.list.has(e.uuid))return this.list.get(e.uuid);const i=new sm(this.components,e,t);return this.list.set(e.uuid,i),i}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(ja.uuid),this.onDisposed.reset();for(const[e,t]of this.list)t.dispose();this.list.clear()}updateInstanced(e){for(const[,t]of this.list)t.updateInstanced(e)}};R(Hh,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let nm=Hh;class rm{constructor(e){R(this,"_event"),R(this,"_position",new ft),R(this,"onDisposed",new le),R(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((t.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(t.clientX-e.left)/(e.right-e.left)*2-1}setupEvents(e){e?this.dom.addEventListener("pointermove",this.updateMouseInfo):this.dom.removeEventListener("pointermove",this.updateMouseInfo)}}class om{constructor(e,t){R(this,"enabled",!0),R(this,"components"),R(this,"onDisposed",new le),R(this,"mouse"),R(this,"three",new Co),R(this,"world");const i=t.renderer;if(!i)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new rm(i.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,i=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(i)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),i=this.filterClippingPlanes(t);return i.length>0?i[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const i=t.clippingPlanes;return e.length<=0||!i||(i==null?void 0:i.length)<=0?e:e.filter(s=>i.every(n=>n.distanceToPoint(s.point)>0))}}const jh=class Wh extends Ke{constructor(e){super(e),R(this,"enabled",!0),R(this,"list",new Map),R(this,"onDisposed",new le),e.add(Wh.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);const t=new om(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};R(jh,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let li=jh;class am{constructor(e,t,i){R(this,"onDisposed",new le),R(this,"world"),R(this,"components"),R(this,"three"),R(this,"_fade",3),R(this,"updateZoom",()=>{this.world.camera instanceof Kn&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;const{color:s,size1:n,size2:r,distance:o}=i;this.components=e;const a=new bo(2,2,1,1),c=new Nt({side:Jn,uniforms:{uSize1:{value:n},uSize2:{value:r},uColor:{value:s},uDistance:{value:o},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new Ae(a,c),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}dispose(){this.setupEvents(!1),this.components.get(Ri).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof Kn))return;const t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}}const lm=class Zh extends Ke{constructor(e){super(e),R(this,"list",new Map),R(this,"config",{color:new Ht(12303291),size1:1,size2:10,distance:500}),R(this,"onDisposed",new le),R(this,"enabled",!0),e.add(Zh.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");const t=new am(this.components,e,this.config);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){const t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};R(lm,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");const gs=new Co,Lt=new z,Qi=new z,mt=new si,Wc={X:new z(1,0,0),Y:new z(0,1,0),Z:new z(0,0,1)},Ra={type:"change"},Zc={type:"mouseDown"},Kc={type:"mouseUp",mode:null},Xc={type:"objectChange"};class cm extends an{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const i=new mm;this._gizmo=i,this.add(i);const s=new gm;this._plane=s,this.add(s);const n=this;function r(I,_){let C=_;Object.defineProperty(n,I,{get:function(){return C!==void 0?C:_},set:function(F){C!==F&&(C=F,s[I]=F,i[I]=F,n.dispatchEvent({type:I+"-changed",value:F}),n.dispatchEvent(Ra))}}),n[I]=_,s[I]=_,i[I]=_}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new z,a=new z,c=new si,u=new si,d=new z,f=new si,m=new z,E=new z,g=new z,w=0,y=new z;r("worldPosition",o),r("worldPositionStart",a),r("worldQuaternion",c),r("worldQuaternionStart",u),r("cameraPosition",d),r("cameraQuaternion",f),r("pointStart",m),r("pointEnd",E),r("rotationAxis",g),r("rotationAngle",w),r("eye",y),this._offset=new z,this._startNorm=new z,this._endNorm=new z,this._cameraScale=new z,this._parentPosition=new z,this._parentQuaternion=new si,this._parentQuaternionInv=new si,this._parentScale=new z,this._worldScaleStart=new z,this._worldQuaternionInv=new si,this._worldScale=new z,this._positionStart=new z,this._quaternionStart=new si,this._scaleStart=new z,this._getPointer=hm.bind(this),this._onPointerDown=dm.bind(this),this._onPointerHover=um.bind(this),this._onPointerMove=fm.bind(this),this._onPointerUp=pm.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;gs.setFromCamera(e,this.camera);const t=Fa(this._gizmo.picker[this.mode],gs);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){gs.setFromCamera(e,this.camera);const t=Fa(this._plane,gs,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,Zc.mode=this.mode,this.dispatchEvent(Zc)}}pointerMove(e){const t=this.axis,i=this.mode,s=this.object;let n=this.space;if(i==="scale"?n="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(n="world"),s===void 0||t===null||this.dragging===!1||e.button!==-1)return;gs.setFromCamera(e,this.camera);const r=Fa(this._plane,gs,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(s.position.applyQuaternion(mt.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),n==="world"&&(s.parent&&s.position.add(Lt.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Lt.setFromMatrixPosition(s.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),Qi.set(o,o,o)}else Lt.copy(this.pointStart),Qi.copy(this.pointEnd),Lt.applyQuaternion(this._worldQuaternionInv),Qi.applyQuaternion(this._worldQuaternionInv),Qi.divide(Lt),t.search("X")===-1&&(Qi.x=1),t.search("Y")===-1&&(Qi.y=1),t.search("Z")===-1&&(Qi.z=1);s.scale.copy(this._scaleStart).multiply(Qi),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Lt.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Lt.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Wc[t]),Lt.copy(Wc[t]),n==="local"&&Lt.applyQuaternion(this.worldQuaternion),Lt.cross(this.eye),Lt.length()===0?a=!0:this.rotationAngle=this._offset.dot(Lt.normalize())*o),(t==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(mt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(mt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Ra),this.dispatchEvent(Xc)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Kc.mode=this.mode,this.dispatchEvent(Kc)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Ra),this.dispatchEvent(Xc),this.pointStart.copy(this.pointEnd))}getRaycaster(){return gs}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function hm(l){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:l.button};{const e=this.domElement.getBoundingClientRect();return{x:(l.clientX-e.left)/e.width*2-1,y:-(l.clientY-e.top)/e.height*2+1,button:l.button}}}function um(l){if(this.enabled)switch(l.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(l));break}}function dm(l){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(l.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(l)),this.pointerDown(this._getPointer(l)))}function fm(l){this.enabled&&this.pointerMove(this._getPointer(l))}function pm(l){this.enabled&&(this.domElement.releasePointerCapture(l.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(l)))}function Fa(l,e,t){const i=e.intersectObject(l,!0);for(let s=0;s<i.length;s++)if(i[s].object.visible||t)return i[s];return!1}const Zr=new yh,ot=new z(0,1,0),Qc=new z(0,0,0),qc=new Ne,Kr=new si,co=new si,bi=new z,Jc=new Ne,Gn=new z(1,0,0),vs=new z(0,1,0),Hn=new z(0,0,1),Xr=new z,Bn=new z,kn=new z;class mm extends an{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new ei({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new rs({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;const s=t.clone();s.opacity=.5;const n=e.clone();n.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const a=e.clone();a.color.setHex(16711680),a.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const u=e.clone();u.color.setHex(255),u.opacity=.5;const d=e.clone();d.opacity=.25;const f=e.clone();f.color.setHex(16776960),f.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const E=new Vt(0,.04,.1,12);E.translate(0,.05,0);const g=new Rt(.08,.08,.08);g.translate(0,.04,0);const w=new rt;w.setAttribute("position",new on([0,0,0,1,0,0],3));const y=new Vt(.0075,.0075,.5,3);y.translate(0,.25,0);function I(T,J){const de=new xn(T,.0075,3,64,J*Math.PI*2);return de.rotateY(Math.PI/2),de.rotateX(Math.PI/2),de}function _(){const T=new rt;return T.setAttribute("position",new on([0,0,0,1,1,1],3)),T}const C={X:[[new Ae(E,n),[.5,0,0],[0,0,-Math.PI/2]],[new Ae(E,n),[-.5,0,0],[0,0,Math.PI/2]],[new Ae(y,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Ae(E,r),[0,.5,0]],[new Ae(E,r),[0,-.5,0],[Math.PI,0,0]],[new Ae(y,r)]],Z:[[new Ae(E,o),[0,0,.5],[Math.PI/2,0,0]],[new Ae(E,o),[0,0,-.5],[-Math.PI/2,0,0]],[new Ae(y,o),null,[Math.PI/2,0,0]]],XYZ:[[new Ae(new Ar(.1,0),d.clone()),[0,0,0]]],XY:[[new Ae(new Rt(.15,.15,.01),u.clone()),[.15,.15,0]]],YZ:[[new Ae(new Rt(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ae(new Rt(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},F={X:[[new Ae(new Vt(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Ae(new Vt(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Ae(new Vt(.2,0,.6,4),i),[0,.3,0]],[new Ae(new Vt(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Ae(new Vt(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Ae(new Vt(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Ae(new Ar(.2,0),i)]],XY:[[new Ae(new Rt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Ae(new Rt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ae(new Rt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},M={START:[[new Ae(new Ar(.01,2),s),null,null,null,"helper"]],END:[[new Ae(new Ar(.01,2),s),null,null,null,"helper"]],DELTA:[[new Ct(_(),s),null,null,null,"helper"]],X:[[new Ct(w,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ct(w,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ct(w,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},D={XYZE:[[new Ae(I(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new Ae(I(.5,.5),n)]],Y:[[new Ae(I(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new Ae(I(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new Ae(I(.75,1),f),null,[0,Math.PI/2,0]]]},B={AXIS:[[new Ct(w,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},N={XYZE:[[new Ae(new qd(.25,10,8),i)]],X:[[new Ae(new xn(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Ae(new xn(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Ae(new xn(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Ae(new xn(.75,.1,2,24),i)]]},G={X:[[new Ae(g,n),[.5,0,0],[0,0,-Math.PI/2]],[new Ae(y,n),[0,0,0],[0,0,-Math.PI/2]],[new Ae(g,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Ae(g,r),[0,.5,0]],[new Ae(y,r)],[new Ae(g,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Ae(g,o),[0,0,.5],[Math.PI/2,0,0]],[new Ae(y,o),[0,0,0],[Math.PI/2,0,0]],[new Ae(g,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Ae(new Rt(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new Ae(new Rt(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ae(new Rt(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Ae(new Rt(.1,.1,.1),d.clone())]]},Q={X:[[new Ae(new Vt(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new Ae(new Vt(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Ae(new Vt(.2,0,.6,4),i),[0,.3,0]],[new Ae(new Vt(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Ae(new Vt(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new Ae(new Vt(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Ae(new Rt(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new Ae(new Rt(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Ae(new Rt(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Ae(new Rt(.2,.2,.2),i),[0,0,0]]]},O={X:[[new Ct(w,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ct(w,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ct(w,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function V(T){const J=new an;for(const de in T)for(let ie=T[de].length;ie--;){const ve=T[de][ie][0].clone(),ue=T[de][ie][1],De=T[de][ie][2],oe=T[de][ie][3],re=T[de][ie][4];ve.name=de,ve.tag=re,ue&&ve.position.set(ue[0],ue[1],ue[2]),De&&ve.rotation.set(De[0],De[1],De[2]),oe&&ve.scale.set(oe[0],oe[1],oe[2]),ve.updateMatrix();const Me=ve.geometry.clone();Me.applyMatrix4(ve.matrix),ve.geometry=Me,ve.renderOrder=1/0,ve.position.set(0,0,0),ve.rotation.set(0,0,0),ve.scale.set(1,1,1),J.add(ve)}return J}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=V(C)),this.add(this.gizmo.rotate=V(D)),this.add(this.gizmo.scale=V(G)),this.add(this.picker.translate=V(F)),this.add(this.picker.rotate=V(N)),this.add(this.picker.scale=V(Q)),this.add(this.helper.translate=V(M)),this.add(this.helper.rotate=V(B)),this.add(this.helper.scale=V(O)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:co;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let s=0;s<i.length;s++){const n=i[s];n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(r*this.size/4),n.tag==="helper"){n.visible=!1,n.name==="AXIS"?(n.visible=!!this.axis,this.axis==="X"&&(mt.setFromEuler(Zr.set(0,0,0)),n.quaternion.copy(t).multiply(mt),Math.abs(ot.copy(Gn).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(mt.setFromEuler(Zr.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(mt),Math.abs(ot.copy(vs).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(mt.setFromEuler(Zr.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(mt),Math.abs(ot.copy(Hn).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(mt.setFromEuler(Zr.set(0,Math.PI/2,0)),ot.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(qc.lookAt(Qc,ot,vs)),n.quaternion.multiply(mt),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),Lt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Lt.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(Lt),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}n.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(n.name==="X"&&Math.abs(ot.copy(Gn).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Y"&&Math.abs(ot.copy(vs).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="Z"&&Math.abs(ot.copy(Hn).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XY"&&Math.abs(ot.copy(Hn).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="YZ"&&Math.abs(ot.copy(Gn).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),n.name==="XZ"&&Math.abs(ot.copy(vs).applyQuaternion(t).dot(this.eye))<.2&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)):this.mode==="rotate"&&(Kr.copy(t),ot.copy(this.eye).applyQuaternion(mt.copy(t).invert()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(qc.lookAt(this.eye,Qc,vs)),n.name==="X"&&(mt.setFromAxisAngle(Gn,Math.atan2(-ot.y,ot.z)),mt.multiplyQuaternions(Kr,mt),n.quaternion.copy(mt)),n.name==="Y"&&(mt.setFromAxisAngle(vs,Math.atan2(ot.x,ot.z)),mt.multiplyQuaternions(Kr,mt),n.quaternion.copy(mt)),n.name==="Z"&&(mt.setFromAxisAngle(Hn,Math.atan2(ot.y,ot.x)),mt.multiplyQuaternions(Kr,mt),n.quaternion.copy(mt))),n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX),n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY),n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ),n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some(function(o){return n.name===o}))&&(n.material.color.setHex(16776960),n.material.opacity=1)}super.updateMatrixWorld(e)}}class gm extends Ae{constructor(){super(new bo(1e5,1e5,2,2),new ei({visible:!1,wireframe:!0,side:Jn,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Xr.copy(Gn).applyQuaternion(t==="local"?this.worldQuaternion:co),Bn.copy(vs).applyQuaternion(t==="local"?this.worldQuaternion:co),kn.copy(Hn).applyQuaternion(t==="local"?this.worldQuaternion:co),ot.copy(Bn),this.mode){case"translate":case"scale":switch(this.axis){case"X":ot.copy(this.eye).cross(Xr),bi.copy(Xr).cross(ot);break;case"Y":ot.copy(this.eye).cross(Bn),bi.copy(Bn).cross(ot);break;case"Z":ot.copy(this.eye).cross(kn),bi.copy(kn).cross(ot);break;case"XY":bi.copy(kn);break;case"YZ":bi.copy(Xr);break;case"XZ":ot.copy(kn),bi.copy(Bn);break;case"XYZ":case"E":bi.set(0,0,0);break}break;case"rotate":default:bi.set(0,0,0)}bi.length()===0?this.quaternion.copy(this.cameraQuaternion):(Jc.lookAt(Lt.set(0,0,0),bi,ot),this.quaternion.setFromRotationMatrix(Jc)),super.updateMatrixWorld(e)}}class Fo{constructor(e,t,i,s,n,r=5,o=!0){if(R(this,"onDraggingStarted",new le),R(this,"onDraggingEnded",new le),R(this,"onDisposed",new le),R(this,"normal"),R(this,"origin"),R(this,"three",new ns),R(this,"components"),R(this,"world"),R(this,"type","default"),R(this,"_helper"),R(this,"_visible",!0),R(this,"_enabled",!0),R(this,"_controlsActive",!1),R(this,"_arrowBoundBox",new Ae),R(this,"_planeMesh"),R(this,"_controls"),R(this,"_hiddenMaterial",new ei({visible:!1})),R(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),R(this,"changeDrag",a=>{this._visible=!a.value,this.preventCameraMovement(),this.notifyDraggingChanged(a)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=s,this.origin=i,t.renderer.setPlane(!0,this.three),this._planeMesh=Fo.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(s,i),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new z(1,0,0),t=new z;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,i=new cm(e,t);return this.initializeControls(i),this.world.scene.three.add(i),i}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new Vt(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new an;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const i=new bo(1),s=new Ae(i,t);return s.scale.set(e,e,e),s}}const Kh=class Wa extends Ke{constructor(e){super(e),R(this,"onBeforeDrag",new le),R(this,"onAfterDrag",new le),R(this,"onBeforeCreate",new le),R(this,"onBeforeCancel",new le),R(this,"onAfterCancel",new le),R(this,"onBeforeDelete",new le),R(this,"onAfterCreate",new le),R(this,"onAfterDelete",new le),R(this,"onDisposed",new le),R(this,"orthogonalY",!1),R(this,"toleranceOrthogonalY",.7),R(this,"Type",Fo),R(this,"list",[]),R(this,"_material",new ei({color:12255487,side:Jn,transparent:!0,opacity:.2})),R(this,"_size",5),R(this,"_enabled",!1),R(this,"_visible",!0),R(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),R(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(Wa.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(const t of this.list)t.enabled=e;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get material(){return this._material}set material(e){this._material=e;for(const t of this.list)t.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(const t of this.list)t.size=e}dispose(){this._enabled=!1;for(const e of this.list)e.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(Wa.uuid),this.onDisposed.reset()}create(e){const t=this.components.get(li).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,i){const s=this.newPlane(e,i,t);return this.updateMaterialsAndPlanes(),s}delete(e,t){t||(t=this.pickPlane(e)),t&&this.deletePlane(t)}deleteAll(e){const t=[...this.list];for(const i of t)if(!e||e.has(i.type)){this.delete(i.world,i);const s=this.list.indexOf(i);s!==-1&&this.list.splice(s,1)}}deletePlane(e){const t=this.list.indexOf(e);if(t!==-1){if(this.list.splice(t,1),!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)}}pickPlane(e){const t=this.components.get(li).get(e),i=this.getAllPlaneMeshes(),s=t.castRay(i);if(s){const n=s.object;return this.list.find(r=>r.meshes.includes(n))}}getAllPlaneMeshes(){const e=[];for(const t of this.list)e.push(...t.meshes);return e}createPlaneFromIntersection(e,t){var i;if(!e.renderer)throw new Error("The given world must have a renderer!");const s=t.point.distanceTo(new z(0,0,0)),n=(i=t.face)==null?void 0:i.normal;if(!s||!n)return null;const r=this.getWorldNormal(t,n),o=this.newPlane(e,t.point,r.negate());return o.visible=this._visible,o.size=this._size,e.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes(),o}getWorldNormal(e,t){const i=e.object;let s=e.object.matrixWorld.clone();if(i instanceof pi&&e.instanceId!==void 0){const o=new Ne;i.getMatrixAt(e.instanceId,o),s=o.multiply(s)}const n=new ys().getNormalMatrix(s),r=t.clone().applyMatrix3(n).normalize();return this.normalizePlaneDirectionY(r),r}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,i){const s=new this.Type(this.components,e,t,i,this._material);return s.onDraggingStarted.add(this._onStartDragging),s.onDraggingEnded.add(this._onEndDragging),this.list.push(s),this.onAfterCreate.trigger(s),s}updateMaterialsAndPlanes(){const e=this.components.get(Yh);for(const[t,i]of e.list){if(!i.renderer)continue;i.renderer.updateClippingPlanes();const{clippingPlanes:s}=i.renderer;for(const n of i.meshes)if(n.material)if(Array.isArray(n.material))for(const r of n.material)r.clippingPlanes=s;else n.material.clippingPlanes=s}}};R(Kh,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let cn=Kh;class Em{constructor(e){R(this,"enabled",!1),R(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new z;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=Ut.ACTION.DOLLY,e.touches.two=Ut.ACTION.TOUCH_ZOOM_TRUCK}}class vm{constructor(e){R(this,"enabled",!0),R(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new z;e.getPosition(t);const i=t.length();e.distance=i,e.truckSpeed=2;const{rotation:s}=this.camera.three,n=new z(0,0,-1).applyEuler(s),r=t.addScaledVector(n,i);e.moveTo(r.x,r.y,r.z)}}class wm{constructor(e){R(this,"enabled",!1),R(this,"id","Plan"),R(this,"mouseAction1"),R(this,"mouseAction2"),R(this,"mouseInitialized",!1),R(this,"defaultAzimuthSpeed"),R(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=Ut.ACTION.TRUCK,t.touches.one=Ut.ACTION.TOUCH_TRUCK,t.touches.two=Ut.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=Ut.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}}class ym{constructor(e){R(this,"onChanged",new le),R(this,"current","Perspective"),R(this,"camera"),R(this,"matchOrthoDistanceEnabled",!1),R(this,"_component"),R(this,"_previousDistance",-1),this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const e=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(e)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:i}=e;this.setupOrthoCamera(i,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new z;this._component.threePersp.getWorldDirection(t);const i=new z;this._component.controls.getTarget(i);const s=i.clone().sub(this._component.threePersp.position).dot(t),n=e.renderer.getSize(),r=n.x/n.y,o=this._component.threePersp,a=s*2*Math.atan(o.fov*(Math.PI/180)/2);return{width:a*r,height:a}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=Ut.ACTION.ZOOM,this._component.controls.mouseButtons.middle=Ut.ACTION.ZOOM;const i=this._component.threePersp,s=this._component.threeOrtho;s.zoom=1,s.left=t/-2,s.right=t/2,s.top=e/2,s.bottom=e/-2,s.updateProjectionMatrix(),s.position.copy(i.position),s.quaternion.copy(i.quaternion),this._component.controls.camera=s}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=Ut.ACTION.DOLLY,this._component.controls.mouseButtons.middle=Ut.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=Ut.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}}class Im extends Kn{constructor(e){super(e),R(this,"projection"),R(this,"threeOrtho"),R(this,"threePersp"),R(this,"_userInputButtons",{}),R(this,"_frustumSize",50),R(this,"_navigationModes",new Map),R(this,"_mode",null),R(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new ym(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.onWorldChanged.add(({action:t})=>{t==="added"&&(this._navigationModes.clear(),this._navigationModes.set("Orbit",new vm(this)),this._navigationModes.set("FirstPerson",new Em(this)),this._navigationModes.set("Plan",new wm(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone()))})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}async fit(e,t=1.5){if(!this.enabled)return;const i=Number.MAX_VALUE,s=Number.MIN_VALUE,n=new z(i,i,i),r=new z(s,s,s);for(const f of e){const m=new ut().setFromObject(f);m.min.x<n.x&&(n.x=m.min.x),m.min.y<n.y&&(n.y=m.min.y),m.min.z<n.z&&(n.z=m.min.z),m.max.x>r.x&&(r.x=m.max.x),m.max.y>r.y&&(r.y=m.max.y),m.max.z>r.z&&(r.z=m.max.z)}const o=new ut(n,r),a=new z;o.getSize(a);const c=new z;o.getCenter(c);const u=Math.max(a.x,a.y,a.z)*t,d=new _s(c,u);await this.controls.fitToSphere(d,!0)}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const e=window.innerWidth/window.innerHeight;return new ss(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const e=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,i=this.threeOrtho.right,s=e.y/this.previousSize.y,n=e.x/this.previousSize.x,r=t*s,o=i*n;this.threeOrtho.left=-o,this.threeOrtho.right=o,this.threeOrtho.top=r,this.threeOrtho.bottom=-r,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(e)}}const $c=new Map([[To,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[dl,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[fl,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[pl,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[$n,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[ml,{forRelated:"IsTypedBy",forRelating:"Types"}],[gl,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[xo,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[El,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[vl,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[wl,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[yl,{forRelated:"HasContext",forRelating:"Declares"}],[Il,{forRelated:"HasAssignments",forRelating:"Controls"}],[Cl,{forRelated:"Nests",forRelating:"IsNestedBy"}],[bl,{forRelated:"HasAssociations",forRelating:"DocumentRefForObjects"}]]),Xh={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class Cs{static async getUnits(e){var t,i,s;const{IFCUNITASSIGNMENT:n}=hi,r=await e.getAllPropertiesOfType(n);if(!r)return 1;const o=Object.keys(r),a=r[parseInt(o[0],10)];for(const c of a.Units){if(c.value===void 0||c.value===null)continue;const u=await e.getProperties(c.value);if(!u||!u.UnitType||!u.UnitType.value||u.UnitType.value!=="LENGTHUNIT")continue;let d=1,f=1;return u.Name.value==="METRE"&&(f=1),u.Name.value==="FOOT"&&(f=.3048),((t=u.Prefix)==null?void 0:t.value)==="MILLI"?d=.001:((i=u.Prefix)==null?void 0:i.value)==="CENTI"?d=.01:((s=u.Prefix)==null?void 0:s.value)==="DECI"&&(d=.1),f*d}return 1}static async findItemByGuid(e,t){var i;const s=e.getAllPropertiesIDs();for(const n of s){const r=await e.getProperties(n);if(r&&((i=r.GlobalId)==null?void 0:i.value)===t)return r}return null}static async getRelationMap(e,t,i){var s;const n=i??(async()=>{}),r={},o=e.getAllPropertiesIDs();for(const a of o){const c=await e.getProperties(a);if(!c)continue;const u=c.type===t,d=Object.keys(c).find(w=>w.startsWith("Relating")),f=Object.keys(c).find(w=>w.startsWith("Related"));if(!(u&&d&&f))continue;const m=await e.getProperties((s=c[d])==null?void 0:s.value),E=c[f];if(!m||!E||!(E&&Array.isArray(E)))continue;const g=E.map(w=>w.value);await n(m.expressID,g),r[m.expressID]=g}return r}static async getQsetQuantities(e,t,i){const s=i??(()=>{}),n=await e.getProperties(t);return!n||n.type!==Jd?null:(n.Quantities??[{}]).map(r=>(r.value&&s(r.value),r.value)).filter(r=>r!==null)}static async getPsetProps(e,t,i){const s=i??(()=>{}),n=await e.getProperties(t);return!n||n.type!==Pa?null:(n.HasProperties??[{}]).map(r=>(r.value&&s(r.value),r.value)).filter(r=>r!==null)}static async getPsetRel(e,t){var i;if(!await e.getProperties(t))return null;const s=await e.getAllPropertiesOfType($n);if(!s)return null;const n=Object.values(s);let r=null;for(const o of n)((i=o.RelatingPropertyDefinition)==null?void 0:i.value)===t&&(r=o.expressID);return r}static async getQsetRel(e,t){return Cs.getPsetRel(e,t)}static async getEntityName(e,t){var i;const s=await e.getProperties(t);if(!s)return{key:null,name:null};const n=Object.keys(s).find(o=>o.endsWith("Name"))??null,r=n?(i=s[n])==null?void 0:i.value:null;return{key:n,name:r}}static async getQuantityValue(e,t){const i=await e.getProperties(t);if(!i)return{key:null,value:null};const s=Object.keys(i).find(r=>r.endsWith("Value"))??null;let n;return s===null||i[s]===void 0||i[s]===null?n=null:n=i[s].value,{key:s,value:n}}static isRel(e){return Xh[e].startsWith("IFCREL")}static async attributeExists(e,t,i){const s=await e.getProperties(t);return s?Object.keys(s).includes(i):!1}static async groupEntitiesByType(e,t){var i;const s=new Map;for(const n of t){const r=await e.getProperties(n);if(!r)continue;const o=r.type;s.get(o)||s.set(o,new Set),(i=s.get(o))==null||i.add(n)}return s}}class Cm{constructor(){R(this,"factor",1),R(this,"complement",1)}apply(e){const t=this.getScaleMatrix().multiply(e);e.copy(t)}setUp(e){var t,i,s;this.factor=1;const n=this.getLengthUnits(e);if(!n)return;const r=n==null,o=n.Name===void 0||n.Name===null;r||o||(n.Name.value==="FOOT"&&(this.factor=.3048),((t=n.Prefix)==null?void 0:t.value)==="MILLI"?this.complement=.001:((i=n.Prefix)==null?void 0:i.value)==="CENTI"?this.complement=.01:((s=n.Prefix)==null?void 0:s.value)==="DECI"&&(this.complement=.01))}getLengthUnits(e){try{const t=e.GetLineIDsWithType(0,Ef).get(0),i=e.GetLine(0,t);for(const s of i.Units){if(!s||s.value===null||s.value===void 0)continue;const n=e.GetLine(0,s.value);if(n.UnitType&&n.UnitType.value==="LENGTHUNIT")return n}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const e=this.factor;return new Ne().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}}class Qh{constructor(){R(this,"itemsByFloor",{}),R(this,"_units",new Cm)}setUp(e){this._units.setUp(e),this.cleanUp();try{const t=e.GetLineIDsWithType(0,xo),i=new Set,s=e.GetLineIDsWithType(0,Fs);for(let c=0;c<s.size();c++)i.add(s.get(c));const n=e.GetLineIDsWithType(0,To),r=n.size();for(let c=0;c<r;c++){const u=n.get(c),d=e.GetLine(0,u);if(!d||!d.RelatingObject||!d.RelatedObjects)continue;const f=d.RelatingObject.value,m=d.RelatedObjects;for(const E of m){const g=E.value;i.has(g)&&(this.itemsByFloor[g]=f)}}const o={},a=t.size();for(let c=0;c<a;c++){const u=t.get(c),d=e.GetLine(0,u);if(!d||!d.RelatingStructure||!d.RelatedElements)continue;const f=d.RelatingStructure.value,m=d.RelatedElements;if(i.has(f))for(const E of m){o[f]||(o[f]=[]);const g=E.value;o[f].push(g)}else for(const E of m){const g=E.value;this.itemsByFloor[g]=f}}for(const c in o){const u=this.itemsByFloor[c];if(u!==void 0){const d=o[c];for(const f of d)this.itemsByFloor[f]=u}}for(let c=0;c<r;c++){const u=n.get(c),d=e.GetLine(0,u);if(!d||!d.RelatingObject||!d.RelatedObjects)continue;const f=d.RelatingObject.value,m=d.RelatedObjects;for(const E of m){const g=E.value,w=this.itemsByFloor[f];w!==void 0&&(this.itemsByFloor[g]=w)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class Pl{constructor(){R(this,"includeProperties",!0),R(this,"optionalCategories",[Fs]),R(this,"coordinate",!0),R(this,"wasm",{path:"",absolute:!1,logLevel:$d.LOG_LEVEL_OFF}),R(this,"excludedCategories",new Set),R(this,"includedCategories",new Set),R(this,"saveLocations",!1),R(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),R(this,"autoSetWasm",!0),R(this,"customLocateFileHandler",null)}}class qh{constructor(){R(this,"defLineMat",new rs({color:16777215}))}read(e){const t=e.GetAllAlignments(0),i=e.GetAllCrossSections2D(0),s=e.GetAllCrossSections3D(0),n={IfcAlignment:t,IfcCrossSection2D:i,IfcCrossSection3D:s};return this.get(n)}get(e){if(e.IfcAlignment){const t=new Map;for(const i of e.IfcAlignment){const s=new ef;s.absolute=this.getCurves(i.curve3D,s),s.horizontal=this.getCurves(i.horizontal,s),s.vertical=this.getCurves(i.vertical,s),t.set(t.size,s)}return{alignments:t,coordinationMatrix:new Ne}}}getCurves(e,t){const i=[];let s=0;for(const n of e){const r={};if(n.data)for(const f of n.data){const[m,E]=f.split(": "),g=parseFloat(E);r[m]=g||E}const{points:o}=n,a=new Float32Array(o.length*3);for(let f=0;f<o.length;f++){const{x:m,y:E,z:g}=o[f];a[f*3]=m,a[f*3+1]=E,a[f*3+2]=g||0}const c=new Kt(a,3),u=new tf;u.setAttribute("position",c);const d=new sf(s,r,t,u,this.defLineMat);i.push(d.curve),s++}return i}}class Jh{getNameInfo(e){var t;const i={},{arguments:s}=e.GetHeaderLine(0,nf)||{};if(!s)return i;const[n,r,o,a,c,u,d]=s;if(n!=null&&n.value&&(i.name=n.value),r!=null&&r.value&&(i.creationDate=new Date(r.value)),o){i.author={};const[f,m]=o;f!=null&&f.value&&(i.author.name=f.value),m!=null&&m.value&&(i.author.email=m.value)}return(t=a[0])!=null&&t.value&&(i.organization=a[0].value),c!=null&&c.value&&(i.preprocessorVersion=c==null?void 0:c.value),u!=null&&u.value&&(i.originatingSystem=u==null?void 0:u.value),d!=null&&d.value&&(i.authorization=d==null?void 0:d.value),i}getDescriptionInfo(e){var t;const i={},{arguments:s}=e.GetHeaderLine(0,rf)||{};if(!s)return i;const[n,r]=s;if((t=n[0])!=null&&t.value){const o=n[0].value.match(/\[([^\]]+)\]/);o&&o[1]&&(i.viewDefinition=o[1])}return r!=null&&r.value&&(i.implementationLevel=r.value),i}}class $h{static get(e,t){const i=[Tl,xl,Al,Ao,Fs,vf,wf,yf,If],s=e.data;for(const n of i){const r=t.GetLineIDsWithType(0,n),o=r.size();for(let a=0;a<o;a++){const c=r.get(a);s.has(c)||s.set(c,[[],[0,n]])}}}}const eu=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),tu=class iu extends Ke{constructor(e){super(e),R(this,"enabled",!0),e.add(iu.uuid,this)}async export(e,t,i=!1,s=!0){const n={},r=new Set(e.GetIfcEntityList(t)),o=new Set([Tl,xl,Al,Ao,Fs]);for(const a of o)r.add(a);for(const a of r){if(eu.has(a))continue;const c=o.has(a)&&s,u=e.GetLineIDsWithType(t,a);for(const d of u){const f=e.GetLine(0,d,c,i);n[f.expressID]=f}}return n}};R(tu,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let bm=tu;const su=class Za extends Ke{constructor(e){super(e),R(this,"onDisposed",new le),R(this,"onIfcStartedLoading",new le),R(this,"onSetup",new le),R(this,"settings",new Pl),R(this,"webIfc",new ln),R(this,"enabled",!0),R(this,"_material",new mo),R(this,"_spatialTree",new Qh),R(this,"_metaData",new Jh),R(this,"_fragmentInstances",new Map),R(this,"_civil",new qh),R(this,"_visitedFragments",new Map),R(this,"_materialT",new mo({transparent:!0,opacity:.5})),this.components.add(Za.uuid,this),this.settings.excludedCategories.add(bh)}dispose(){this.webIfc=null,this.onDisposed.trigger(Za.uuid),this.onDisposed.reset()}async setup(e){this.settings={...this.settings,...e},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(e,t=!0,i=""){const s=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(e);const n=await this.getAllGeometries();n.name=i;const r=await this.components.get(bm).export(this.webIfc,0);n.setLocalProperties(r);const o=this.components.get(Ze);o.groups.set(n.uuid,n);for(const a of n.items)o.list.set(a.id,a),a.mesh.uuid=a.id,a.group=n;o.onFragmentsLoaded.trigger(n),t&&o.coordinate([n]);for(const[a]of n.data){const c=r[a];if(!c||!c.GlobalId)continue;const u=c.GlobalId.value||c.GlobalId;n.globalToExpressIDs.set(u,a)}return $h.get(n,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-s} ms!`),n}async readIfcFile(e){const{path:t,absolute:i,logLevel:s}=this.settings.wasm;return this.webIfc.SetWasmPath(t,i),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(e,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new ln,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const e=this.webIfc.GetIfcEntityList(0),t=new Th;t.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const i=[];for(const n of e){if(!this.webIfc.IsIfcElement(n)&&n!==Fs)continue;const r=this.settings.includedCategories;if(r.size>0&&!r.has(n)||this.settings.excludedCategories.has(n))continue;const o=this.webIfc.GetLineIDsWithType(0,n),a=o.size();for(let c=0;c<a;c++){const u=o.get(c);i.push(u);const d=this._spatialTree.itemsByFloor[u]||0;t.data.set(u,[[],[d,n]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,i,n=>{this.getMesh(n,t)});for(const n of this._visitedFragments){const{index:r,fragment:o}=n[1];t.keyFragments.set(r,o.id)}for(const n of t.items){const r=this._fragmentInstances.get(n.id);if(!r)throw new Error("Fragment not found!");const o=[];for(const[a,c]of r)o.push(c);n.add(o)}const s=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(s),t.civilData=this._civil.read(this.webIfc),t}getMesh(e,t){const i=e.geometries.size(),s=e.expressID;for(let n=0;n<i;n++){const r=e.geometries.get(n),{x:o,y:a,z:c,w:u}=r.color,d=u!==1,{geometryExpressID:f}=r,m=`${f}-${d}`;if(!this._visitedFragments.has(m)){const C=this.getGeometry(this.webIfc,f),F=d?this._materialT:this._material,M=new go(C,F,1);t.add(M.mesh),t.items.push(M);const D=this._visitedFragments.size;this._visitedFragments.set(m,{index:D,fragment:M})}const E=new Ht().setRGB(o,a,c,"srgb"),g=new Ne;g.fromArray(r.flatTransformation);const w=this._visitedFragments.get(m);if(w===void 0)throw new Error("Error getting geometry data for streaming!");const y=t.data.get(s);if(!y)throw new Error("Data not found!");y[0].push(w.index);const{fragment:I}=w;this._fragmentInstances.has(I.id)||this._fragmentInstances.set(I.id,new Map);const _=this._fragmentInstances.get(I.id);if(!_)throw new Error("Instances not found!");if(_.has(s)){const C=_.get(s);if(!C)throw new Error("Instance not found!");C.transforms.push(g),C.colors&&C.colors.push(E)}else _.set(s,{id:s,transforms:[g],colors:[E]})}}getGeometry(e,t){const i=e.GetGeometry(0,t),s=e.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),n=e.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let d=0;d<n.length;d+=6)r[d/2]=n[d],r[d/2+1]=n[d+1],r[d/2+2]=n[d+2],o[d/2]=n[d+3],o[d/2+1]=n[d+4],o[d/2+2]=n[d+5];const a=new rt,c=new Kt(r,3),u=new Kt(o,3);return a.setAttribute("position",c),a.setAttribute("normal",u),a.setIndex(Array.from(s)),i.delete(),a}async autoSetWasm(){const e=await fetch(`https://unpkg.com/@thatopen/components@${Zp.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const t=await e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const i=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}}};R(su,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let Tm=su;const xm={IfcRelAssignsToControl:{related:5,relating:7},IfcRelAssignsToGroup:{related:5,relating:7},IfcRelAssignsToProduct:{related:5,relating:7},IfcRelAssociatesClassification:{related:5,relating:6},IfcRelAssociatesMaterial:{related:5,relating:6},IfcRelAssociatesDocument:{related:5,relating:6},IfcRelContainedInSpatialStructure:{related:5,relating:6},IfcRelFlowControlElements:{related:5,relating:6},IfcRelConnectsElements:{related:7,relating:6},IfcRelDeclares:{related:6,relating:5},IfcRelAggregates:{related:6,relating:5},IfcRelNests:{related:6,relating:5},IfcRelDefinesByProperties:{related:5,relating:6},IfcRelDefinesByType:{related:5,relating:6},IfcRelDefinesByTemplate:{related:5,relating:6}},Am={[Il]:"IfcRelAssignsToControl",[pl]:"IfcRelAssignsToGroup",[wl]:"IfcRelAssignsToProduct",[fl]:"IfcRelAssociatesClassification",[dl]:"IfcRelAssociatesMaterial",[bl]:"IfcRelAssociatesDocument",[xo]:"IfcRelContainedInSpatialStructure",[vl]:"IfcRelConnectsElements",[El]:"IfcRelFlowControlElements",[yl]:"IfcRelDeclares",[To]:"IfcRelAggregates",[Cl]:"IfcRelNests",[$n]:"IfcRelDefinesByProperties",[ml]:"IfcRelDefinesByType",[gl]:"IfcRelDefinesByTemplate"},nu=class $s extends Ke{constructor(e){super(e),R(this,"onDisposed",new le),R(this,"onRequestFile",new le),R(this,"ifcToExport",null),R(this,"onElementToPset",new le),R(this,"onPropToPset",new le),R(this,"onPsetRemoved",new le),R(this,"onDataChanged",new le),R(this,"wasm",{path:"/",absolute:!1}),R(this,"enabled",!0),R(this,"attributeListeners",{}),R(this,"selectedModel"),R(this,"changeMap",{}),this.components.add($s.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger($s.uuid),this.onDisposed.reset()}static getIFCSchema(e){const t=e.ifcMetadata.schema;if(!t)throw new Error("IFC Schema not found");return t.startsWith("IFC2X3")?"IFC2X3":t.startsWith("IFC4")&&t.replace("IFC4","")===""?"IFC4":t.startsWith("IFC4X3")?"IFC4X3":t}async setData(e,...t){for(const i of t){const{expressID:s}=i;(!s||s===-1)&&(i.expressID=this.getNewExpressID(e)),await e.setProperties(i.expressID,i),this.registerChange(e,i.expressID)}}async newPset(e,t,i){const s=$s.getIFCSchema(e),{ownerHistoryHandle:n}=await this.getOwnerHistory(e),r=this.newGUID(e),o=new hi[s].IfcLabel(t),a=i?new hi[s].IfcText(i):null,c=new hi[s].IfcPropertySet(r,n,o,a,[]);c.expressID=this.getNewExpressID(e);const u=this.newGUID(e),d=new hi[s].IfcRelDefinesByProperties(u,n,null,null,[],new Ni(c.expressID));return d.expressID=this.getNewExpressID(e),await this.setData(e,c,d),{pset:c,rel:d}}async removePset(e,...t){for(const i of t){const s=await e.getProperties(i);if((s==null?void 0:s.type)!==Pa)continue;const n=await Cs.getPsetRel(e,i);if(n&&(await e.setProperties(n,null),this.registerChange(e,n)),s){for(const r of s.HasProperties)await e.setProperties(r.value,null);await e.setProperties(i,null),this.onPsetRemoved.trigger({model:e,psetID:i}),this.registerChange(e,i)}}}newSingleStringProperty(e,t,i,s){return this.newSingleProperty(e,t,i,s)}newSingleNumericProperty(e,t,i,s){return this.newSingleProperty(e,t,i,s)}newSingleBooleanProperty(e,t,i,s){return this.newSingleProperty(e,t,i,s)}async removePsetProp(e,t,i){const s=await e.getProperties(t),n=await e.getProperties(i);!s||!n||s.type===Pa&&n&&(s.HasProperties=s.HasProperties.filter(r=>r.value!==i),await e.setProperties(i,null),this.registerChange(e,t,i))}addElementToPset(e,t,...i){this.components.get(hn).addEntitiesRelation(e,t,{type:$n,inv:"IsDefinedBy"},...i)}async addPropToPset(e,t,...i){const s=await e.getProperties(t);if(s){for(const n of i){if(s.HasProperties.includes(n))continue;const r=new Ni(n);s.HasProperties.push(r),this.onPropToPset.trigger({model:e,psetID:t,propID:n})}this.registerChange(e,t)}}async createIfcRel(e,t,i,s){const n=Am[t];if(!n)throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const r=e.ifcMetadata.schema,o=xm[n],a=hi[r][n];if(!(o&&a))throw new Error(`IfcPropertiesManager: ${n} is unsoported.`);const c=[new hi[r].IfcGloballyUniqueId(xs.create())],{related:u,relating:d}=o,f=[...new Set(s)].map(g=>new Ni(g)),m=(g,w)=>{for(let y=g;y<w-1;y++)c.push(null)};u<d?(m(1,u),c.push(f),m(u,d),c.push(new Ni(i))):(m(1,d),m(d,u),c.push(new Ni(i)),c.push(f));const E=new a(...c);return await this.setData(e,E),E}async saveToIfc(e,t){const i=this.components.get(Tm),s=i.webIfc,n=await i.readIfcFile(t);await this.components.get(hn).applyRelationChanges();const r=this.changeMap[e.uuid]??[];for(const a of r){const c=await e.getProperties(a);c?s.WriteLine(n,c):s.DeleteLine(n,a)}const o=s.SaveModel(n);return i.webIfc.CloseModel(n),i.cleanUp(),o}async getEntityRef(e,t){const i=await e.getAllPropertiesOfType(t);if(!i)return null;const s=[];for(const n in i){const r=new Ni(Number(n));s.push(r)}return s}async setAttributeListener(e,t,i){this.attributeListeners[e.uuid]||(this.attributeListeners[e.uuid]={});const s=this.attributeListeners[e.uuid][t]?this.attributeListeners[e.uuid][t][i]:null;if(s)return s;const n=await e.getProperties(t);if(!n)throw new Error(`Entity with expressID ${t} doesn't exists.`);const r=n[i];if(Array.isArray(r)||!r)throw new Error(`Attribute ${i} is array or null, and it can't have a listener.`);const o=r.value;if(o===void 0||o==null)throw new Error(`Attribute ${i} has a badly defined handle.`);const a=new le;return Object.defineProperty(n[i],"value",{get(){return this._value},async set(c){this._value=c,a.trigger(c)}}),n[i].value=o,this.attributeListeners[e.uuid][t]||(this.attributeListeners[e.uuid][t]={}),this.attributeListeners[e.uuid][t][i]=a,a}getNewExpressID(e){return e.ifcMetadata.maxExpressID++,e.ifcMetadata.maxExpressID}newGUID(e){const t=$s.getIFCSchema(e);return new hi[t].IfcGloballyUniqueId(xs.create())}async getOwnerHistory(e){const t=await e.getAllPropertiesOfType(Gd);if(!t)throw new Error("No OwnerHistory was found.");const i=Object.keys(t).map(r=>parseInt(r,10)),s=t[i[0]],n=new Ni(s.expressID);return{ownerHistory:s,ownerHistoryHandle:n}}registerChange(e,...t){this.changeMap[e.uuid]||(this.changeMap[e.uuid]=new Set);for(const i of t)this.changeMap[e.uuid].add(i),this.onDataChanged.trigger({model:e,expressID:i})}async newSingleProperty(e,t,i,s){const n=$s.getIFCSchema(e),r=new hi[n].IfcIdentifier(i),o=new hi[n][t](s),a=new hi[n].IfcPropertySingleValue(r,null,o,null);return a.expressID=this.getNewExpressID(e),await this.setData(e,a),a}};R(nu,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");let _m=nu;const ru=class Ka extends Ke{constructor(e){super(e),R(this,"onDisposed",new le),R(this,"onRelationsIndexed",new le),R(this,"relationMaps",{}),R(this,"enabled",!0),R(this,"_relToAttributesMap",$c),R(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests","DocumentRefForObjects"]),R(this,"_ifcRels",[To,dl,fl,pl,$n,ml,gl,xo,El,vl,wl,yl,Il,Cl,bl]),R(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]}),R(this,"_changeMap",{}),R(this,"onEntitiesRelated",new le),this.components.add(Ka.uuid,this),e.get(Ze).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(e,t,i,s){const n=Object.keys(t).find(u=>u.startsWith("Relating")),r=Object.keys(t).find(u=>u.startsWith("Related"));if(!(n&&r))return;const o=t[n].value,a=t[r].map(u=>u.value),c=this.getAttributeIndex(s);if(c!==null){let u=e.get(o);u||(u=new Map,e.set(o,u));let d=u.get(c);d||(d=[],u.set(c,d)),d.push(...a)}for(const u of a){const d=this.getAttributeIndex(i);if(d===null)continue;let f=e.get(u);f||(f=new Map,e.set(u,f));let m=f.get(d);m||(m=[],f.set(d,m)),m.push(o)}}getAttributeIndex(e){const t=this._inverseAttributes.indexOf(e);return t===-1?null:t}setRelationMap(e,t){this.relationMaps[e.uuid]=t,this.onRelationsIndexed.trigger({modelID:e.uuid,relationsMap:t})}async process(e){if(!e.hasProperties)throw new Error("FragmentsGroup properties not found");let t=this.relationMaps[e.uuid];if(t)return t;t=new Map;for(const i of this._ifcRels){const s=await e.getAllPropertiesOfType(i);if(!s)continue;const n=this._relToAttributesMap.get(i);if(!n)continue;const{forRelated:r,forRelating:o}=n;for(const a in s){const c=s[a];this.indexRelations(t,c,r,o)}}return this.setRelationMap(e,t),t}async processFromWebIfc(e,t){const i=new Map;for(const s of this._ifcRels){const n=this._relToAttributesMap.get(s);if(!n)continue;const{forRelated:r,forRelating:o}=n,a=e.GetLineIDsWithType(t,s);for(let c=0;c<a.size();c++){const u=await e.properties.getItemProperties(t,a.get(c));this.indexRelations(i,u,r,o)}}return this.onRelationsIndexed.trigger({modelID:t.toString(),relationsMap:i}),i}getEntityRelations(e,t,i){const s=this.relationMaps[e.uuid];if(!s)throw new Error(`IfcRelationsIndexer: model ${e.uuid} has no relations indexed.`);const n=s.get(t),r=this.getAttributeIndex(i);return n===void 0||r===null?null:n.get(r)||null}serializeRelations(e){const t={};for(const[i,s]of e.entries()){t[i]||(t[i]={});for(const[n,r]of s.entries())t[i][n]=r}return JSON.stringify(t)}serializeModelRelations(e){const t=this.relationMaps[e.uuid];return t?this.serializeRelations(t):null}serializeAllRelations(){const e={};for(const t in this.relationMaps){const i=this.relationMaps[t],s={};for(const[n,r]of i.entries()){s[n]||(s[n]={});for(const[o,a]of r.entries())s[n][o]=a}e[t]=s}return JSON.stringify(e)}getRelationsMapFromJSON(e){const t=JSON.parse(e),i=new Map;for(const s in t){const n=t[s],r=new Map;for(const o in n)r.set(Number(o),n[o]);i.set(Number(s),r)}return i}dispose(){this.relationMaps={},this.components.get(Ze).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(Ka.uuid),this.onDisposed.reset()}getEntitiesWithRelation(e,t,i){const s=this.relationMaps[e.uuid];if(!s)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");const n=new Set;for(const[r,o]of s){const a=this.getAttributeIndex(t);if(a===null)throw new Error("IfcRelationsIndexer: invalid inverse attribute name");const c=o.get(a);c&&c.includes(i)&&n.add(r)}return n}addEntityRelations(e,t,i,...s){const n=this.getEntityRelations(e,t,i);if(n)n.push(...s);else{const r=this.getAttributeIndex(i);if(!r)throw new Error(`IfcRelationsIndexer: ${i} is not a valid relation name.`);const o=this.relationMaps[e.uuid].get(t);o==null||o.set(r,s)}}async applyRelationChanges(){const e=this.components.get(Ze),t=this.components.get(_m);for(const i in this._changeMap){const s=e.groups.get(i);if(!s)continue;const n=this._changeMap[i];for(const[r,o]of n)for(const[a,c]of o){const{related:u,relID:d}=c;if(d){const f=await s.getProperties(d);if(!f)continue;const m=Object.keys(f),E=m.find(w=>w.startsWith("Related")),g=m.find(w=>w.startsWith("Relating"));if(!(E&&g))continue;f[E]=[...u].map(w=>new Ni(w)),f[g]=new Ni(a),await t.setData(s,f)}else{const f=await t.createIfcRel(s,r,a,[...u]);if(!f)continue;c.relID=f.expressID}}}}addEntitiesRelation(e,t,i,...s){const{type:n,inv:r}=i,o=this.relationMaps[e.uuid];if(!o||!this._ifcRels.includes(n))return;const a=$c.get(n);if(!a)return;const{forRelated:c,forRelating:u}=a;if(!(c===r||u===r))return;let d=this._changeMap[e.uuid];d||(d=new Yi,this._changeMap[e.uuid]=d);const f=u===r?[t]:s,m=c===r?[t]:s;let E=d.get(n);E||(E=new Yi,E.onItemSet.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:f,relatedIDs:m})),E.onItemUpdated.add(()=>this.onEntitiesRelated.trigger({invAttribute:r,relType:n,relatingIDs:f,relatedIDs:m})),d.set(n,E));for(const g of f){let w=E.get(g);w||(w={related:new rn},E.set(g,w)),w.related.add(...m)}for(const g of f){let w=o.get(g);w||(w=new Map,o.set(g,w));const y=this.getAttributeIndex(u);if(y!==null){let I=w.get(y);I||(I=[],w.set(y,I)),I.push(...m)}}for(const g of m){let w=o.get(g);w||(w=new Map,o.set(g,w));const y=this.getAttributeIndex(c);if(y===null)continue;let I=w.get(y);I||(I=[],w.set(y,I)),I.push(...f)}}getEntityChildren(e,t,i=new Set){if(i.add(t),this.relationMaps[e.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");const s=this.getEntityRelations(e,t,"IsDecomposedBy");if(s)for(const r of s)this.getEntityChildren(e,r,i);const n=this.getEntityRelations(e,t,"ContainsElements");if(n)for(const r of n)this.getEntityChildren(e,r,i);return i}};R(ru,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let hn=ru;const ou=class au extends Ke{constructor(e){super(e),R(this,"onDisposed",new le),R(this,"onFragmentsLoaded",new le),R(this,"onFragmentsDisposed",new le),R(this,"list",new Yi),R(this,"groups",new Yi),R(this,"baseCoordinationModel",""),R(this,"baseCoordinationMatrix",new Ne),R(this,"enabled",!0),R(this,"_loader",new xh),this.components.add(au.uuid,this)}get meshes(){const e=[];for(const[t,i]of this.list)e.push(i.mesh);return e}dispose(){for(const[e,t]of this.groups)t.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(e){const{uuid:t}=e,i=[];for(const s of e.items)i.push(s.id),this.list.delete(s.id);e.dispose(!0),this.groups.delete(e.uuid),this.groups.size===0&&(this.baseCoordinationModel="",this.baseCoordinationMatrix=new Ne),this.onFragmentsDisposed.trigger({groupID:t,fragmentIDs:i})}load(e,t){const i={coordinate:!0,...t},{coordinate:s,name:n,properties:r,relationsMap:o}=i,a=this._loader.import(e);t&&(a.isStreamed=t.isStreamed||!1),n&&(a.name=n);for(const c of a.items)c.group=a,this.list.set(c.id,c);return s&&this.coordinate([a]),this.groups.set(a.uuid,a),r&&a.setLocalProperties(r),o&&this.components.get(hn).setRelationMap(a,o),this.onFragmentsLoaded.trigger(a),a}export(e){return this._loader.export(e)}getModelIdMap(e){const t={};for(const i in e){const s=this.list.get(i);if(!(s&&s.group))continue;const n=s.group;n.uuid in t||(t[n.uuid]=new Set);const r=e[i];for(const o of r)t[n.uuid].add(o)}return t}modelIdToFragmentIdMap(e){let t={};for(const i in e){const s=this.groups.get(i);if(!s)continue;const n=e[i],r=s.getFragmentMap(n);t={...t,...r}}return t}guidToFragmentIdMap(e){const t={};for(const[i,s]of this.groups){i in t||(t[i]=new Set);for(const n of e){const r=s.globalToExpressIDs.get(n);r&&t[i].add(r)}}return this.modelIdToFragmentIdMap(t)}fragmentIdMapToGuids(e){const t=[],i=this.getModelIdMap(e);for(const s in i){const n=this.groups.get(s);if(!n)continue;const r=i[s];for(const o of r)for(const[a,c]of n.globalToExpressIDs.entries())if(c===o){t.push(a);break}}return t}coordinate(e=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const t=e.pop();if(!t)return;this.baseCoordinationModel=t.uuid,this.baseCoordinationMatrix=t.coordinationMatrix.clone()}if(e.length)for(const t of e)t.coordinationMatrix.equals(this.baseCoordinationMatrix)||(t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrix(),this.applyBaseCoordinateSystem(t,t.coordinationMatrix))}applyBaseCoordinateSystem(e,t){t&&e.applyMatrix4(t.clone().invert()),e.applyMatrix4(this.baseCoordinationMatrix)}clone(e,t){const i=e.cloneGroup(t);this.groups.set(i.uuid,i);for(const s of i.items)this.list.set(s.id,s);return i}};R(ou,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let Ze=ou;var Qr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rm(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function qr(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var lu={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(l,e){(function(t){l.exports=t()})(function(){return function t(i,s,n){function r(c,u){if(!s[c]){if(!i[c]){var d=typeof qr=="function"&&qr;if(!u&&d)return d(c,!0);if(o)return o(c,!0);var f=new Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f}var m=s[c]={exports:{}};i[c][0].call(m.exports,function(E){var g=i[c][1][E];return r(g||E)},m,m.exports,t,i,s,n)}return s[c].exports}for(var o=typeof qr=="function"&&qr,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,i,s){var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(a){for(var c,u,d,f,m,E,g,w=[],y=0,I=a.length,_=I,C=n.getTypeOf(a)!=="string";y<a.length;)_=I-y,d=C?(c=a[y++],u=y<I?a[y++]:0,y<I?a[y++]:0):(c=a.charCodeAt(y++),u=y<I?a.charCodeAt(y++):0,y<I?a.charCodeAt(y++):0),f=c>>2,m=(3&c)<<4|u>>4,E=1<_?(15&u)<<2|d>>6:64,g=2<_?63&d:64,w.push(o.charAt(f)+o.charAt(m)+o.charAt(E)+o.charAt(g));return w.join("")},s.decode=function(a){var c,u,d,f,m,E,g=0,w=0,y="data:";if(a.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var I,_=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&_--,a.charAt(a.length-2)===o.charAt(64)&&_--,_%1!=0)throw new Error("Invalid base64 input, bad content length.");for(I=r.uint8array?new Uint8Array(0|_):new Array(0|_);g<a.length;)c=o.indexOf(a.charAt(g++))<<2|(f=o.indexOf(a.charAt(g++)))>>4,u=(15&f)<<4|(m=o.indexOf(a.charAt(g++)))>>2,d=(3&m)<<6|(E=o.indexOf(a.charAt(g++))),I[w++]=c,m!==64&&(I[w++]=u),E!==64&&(I[w++]=d);return I}},{"./support":30,"./utils":32}],2:[function(t,i,s){var n=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function c(u,d,f,m,E){this.compressedSize=u,this.uncompressedSize=d,this.crc32=f,this.compression=m,this.compressedContent=E}c.prototype={getContentWorker:function(){var u=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),d=this;return u.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(u,d,f){return u.pipe(new o).pipe(new a("uncompressedSize")).pipe(d.compressWorker(f)).pipe(new a("compressedSize")).withStreamInfo("compression",d)},i.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,s){var n=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,s){var n=t("./utils"),r=function(){for(var o,a=[],c=0;c<256;c++){o=c;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;a[c]=o}return a}();i.exports=function(o,a){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?function(c,u,d,f){var m=r,E=f+d;c^=-1;for(var g=f;g<E;g++)c=c>>>8^m[255&(c^u[g])];return-1^c}(0|a,o,o.length,0):function(c,u,d,f){var m=r,E=f+d;c^=-1;for(var g=f;g<E;g++)c=c>>>8^m[255&(c^u.charCodeAt(g))];return-1^c}(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(t,i,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,i,s){var n=null;n=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:n}},{lie:37}],7:[function(t,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),c=n?"uint8array":"array";function u(d,f){a.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=f,this.meta={}}s.magic="\b\0",o.inherits(u,a),u.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,d.data),!1)},u.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(f){d.push({data:f,meta:d.meta})}},s.compressWorker=function(d){return new u("Deflate",d)},s.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,s){function n(m,E){var g,w="";for(g=0;g<E;g++)w+=String.fromCharCode(255&m),m>>>=8;return w}function r(m,E,g,w,y,I){var _,C,F=m.file,M=m.compression,D=I!==c.utf8encode,B=o.transformTo("string",I(F.name)),N=o.transformTo("string",c.utf8encode(F.name)),G=F.comment,Q=o.transformTo("string",I(G)),O=o.transformTo("string",c.utf8encode(G)),V=N.length!==F.name.length,T=O.length!==G.length,J="",de="",ie="",ve=F.dir,ue=F.date,De={crc32:0,compressedSize:0,uncompressedSize:0};E&&!g||(De.crc32=m.crc32,De.compressedSize=m.compressedSize,De.uncompressedSize=m.uncompressedSize);var oe=0;E&&(oe|=8),D||!V&&!T||(oe|=2048);var re=0,Me=0;ve&&(re|=16),y==="UNIX"?(Me=798,re|=function(xe,it){var at=xe;return xe||(at=it?16893:33204),(65535&at)<<16}(F.unixPermissions,ve)):(Me=20,re|=function(xe){return 63&(xe||0)}(F.dosPermissions)),_=ue.getUTCHours(),_<<=6,_|=ue.getUTCMinutes(),_<<=5,_|=ue.getUTCSeconds()/2,C=ue.getUTCFullYear()-1980,C<<=4,C|=ue.getUTCMonth()+1,C<<=5,C|=ue.getUTCDate(),V&&(de=n(1,1)+n(u(B),4)+N,J+="up"+n(de.length,2)+de),T&&(ie=n(1,1)+n(u(Q),4)+O,J+="uc"+n(ie.length,2)+ie);var Oe="";return Oe+=`
\0`,Oe+=n(oe,2),Oe+=M.magic,Oe+=n(_,2),Oe+=n(C,2),Oe+=n(De.crc32,4),Oe+=n(De.compressedSize,4),Oe+=n(De.uncompressedSize,4),Oe+=n(B.length,2),Oe+=n(J.length,2),{fileRecord:d.LOCAL_FILE_HEADER+Oe+B+J,dirRecord:d.CENTRAL_FILE_HEADER+n(Me,2)+Oe+n(Q.length,2)+"\0\0\0\0"+n(re,4)+n(w,4)+B+J+Q}}var o=t("../utils"),a=t("../stream/GenericWorker"),c=t("../utf8"),u=t("../crc32"),d=t("../signature");function f(m,E,g,w){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=E,this.zipPlatform=g,this.encodeFileName=w,this.streamFiles=m,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(f,a),f.prototype.push=function(m){var E=m.meta.percent||0,g=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(m):(this.bytesWritten+=m.data.length,a.prototype.push.call(this,{data:m.data,meta:{currentFile:this.currentFile,percent:g?(E+100*(g-w-1))/g:100}}))},f.prototype.openedSource=function(m){this.currentSourceOffset=this.bytesWritten,this.currentFile=m.file.name;var E=this.streamFiles&&!m.file.dir;if(E){var g=r(m,E,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(m){this.accumulate=!1;var E=this.streamFiles&&!m.file.dir,g=r(m,E,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),E)this.push({data:function(w){return d.DATA_DESCRIPTOR+n(w.crc32,4)+n(w.compressedSize,4)+n(w.uncompressedSize,4)}(m),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var m=this.bytesWritten,E=0;E<this.dirRecords.length;E++)this.push({data:this.dirRecords[E],meta:{percent:100}});var g=this.bytesWritten-m,w=function(y,I,_,C,F){var M=o.transformTo("string",F(C));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(y,2)+n(y,2)+n(I,4)+n(_,4)+n(M.length,2)+M}(this.dirRecords.length,g,m,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(m){this._sources.push(m);var E=this;return m.on("data",function(g){E.processChunk(g)}),m.on("end",function(){E.closedSource(E.previous.streamInfo),E._sources.length?E.prepareNextSource():E.end()}),m.on("error",function(g){E.error(g)}),this},f.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(m){var E=this._sources;if(!a.prototype.error.call(this,m))return!1;for(var g=0;g<E.length;g++)try{E[g].error(m)}catch{}return!0},f.prototype.lock=function(){a.prototype.lock.call(this);for(var m=this._sources,E=0;E<m.length;E++)m[E].lock()},i.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,s){var n=t("../compressions"),r=t("./ZipFileWorker");s.generateWorker=function(o,a,c){var u=new r(a.streamFiles,c,a.platform,a.encodeFileName),d=0;try{o.forEach(function(f,m){d++;var E=function(I,_){var C=I||_,F=n[C];if(!F)throw new Error(C+" is not a valid compression method !");return F}(m.options.compression,a.compression),g=m.options.compressionOptions||a.compressionOptions||{},w=m.dir,y=m.date;m._compressWorker(E,g).withStreamInfo("file",{name:f,dir:w,date:y,comment:m.comment||"",unixPermissions:m.unixPermissions,dosPermissions:m.dosPermissions}).pipe(u)}),u.entriesCount=d}catch(f){u.error(f)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,s){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=t("./external"),i.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,s){var n=t("./utils"),r=t("./external"),o=t("./utf8"),a=t("./zipEntries"),c=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function d(f){return new r.Promise(function(m,E){var g=f.decompressed.getContentWorker().pipe(new c);g.on("error",function(w){E(w)}).on("end",function(){g.streamInfo.crc32!==f.decompressed.crc32?E(new Error("Corrupted zip : CRC32 mismatch")):m()}).resume()})}i.exports=function(f,m){var E=this;return m=n.extend(m||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),u.isNode&&u.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",f,!0,m.optimizedBinaryString,m.base64).then(function(g){var w=new a(m);return w.load(g),w}).then(function(g){var w=[r.Promise.resolve(g)],y=g.files;if(m.checkCRC32)for(var I=0;I<y.length;I++)w.push(d(y[I]));return r.Promise.all(w)}).then(function(g){for(var w=g.shift(),y=w.files,I=0;I<y.length;I++){var _=y[I],C=_.fileNameStr,F=n.resolve(_.fileNameStr);E.file(F,_.decompressed,{binary:!0,optimizedBinaryString:!0,date:_.date,dir:_.dir,comment:_.fileCommentStr.length?_.fileCommentStr:null,unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions,createFolders:m.createFolders}),_.dir||(E.file(F).unsafeOriginalName=C)}return w.zipComment.length&&(E.comment=w.zipComment),E})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,s){var n=t("../utils"),r=t("../stream/GenericWorker");function o(a,c){r.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(c)}n.inherits(o,r),o.prototype._bindStream=function(a){var c=this;(this._stream=a).pause(),a.on("data",function(u){c.push({data:u,meta:{percent:0}})}).on("error",function(u){c.isPaused?this.generatedError=u:c.error(u)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,s){var n=t("readable-stream").Readable;function r(o,a,c){n.call(this,a),this._helper=o;var u=this;o.on("data",function(d,f){u.push(d)||u._helper.pause(),c&&c(f)}).on("error",function(d){u.emit("error",d)}).on("end",function(){u.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},i.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,i,s){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,i,s){function n(F,M,D){var B,N=o.getTypeOf(M),G=o.extend(D||{},u);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(F=y(F)),G.createFolders&&(B=w(F))&&I.call(this,B,!0);var Q=N==="string"&&G.binary===!1&&G.base64===!1;D&&D.binary!==void 0||(G.binary=!Q),(M instanceof d&&M.uncompressedSize===0||G.dir||!M||M.length===0)&&(G.base64=!1,G.binary=!0,M="",G.compression="STORE",N="string");var O=null;O=M instanceof d||M instanceof a?M:E.isNode&&E.isStream(M)?new g(F,M):o.prepareContent(F,M,G.binary,G.optimizedBinaryString,G.base64);var V=new f(F,O,G);this.files[F]=V}var r=t("./utf8"),o=t("./utils"),a=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),u=t("./defaults"),d=t("./compressedObject"),f=t("./zipObject"),m=t("./generate"),E=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),w=function(F){F.slice(-1)==="/"&&(F=F.substring(0,F.length-1));var M=F.lastIndexOf("/");return 0<M?F.substring(0,M):""},y=function(F){return F.slice(-1)!=="/"&&(F+="/"),F},I=function(F,M){return M=M!==void 0?M:u.createFolders,F=y(F),this.files[F]||n.call(this,F,null,{dir:!0,createFolders:M}),this.files[F]};function _(F){return Object.prototype.toString.call(F)==="[object RegExp]"}var C={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(F){var M,D,B;for(M in this.files)B=this.files[M],(D=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&F(D,B)},filter:function(F){var M=[];return this.forEach(function(D,B){F(D,B)&&M.push(B)}),M},file:function(F,M,D){if(arguments.length!==1)return F=this.root+F,n.call(this,F,M,D),this;if(_(F)){var B=F;return this.filter(function(G,Q){return!Q.dir&&B.test(G)})}var N=this.files[this.root+F];return N&&!N.dir?N:null},folder:function(F){if(!F)return this;if(_(F))return this.filter(function(N,G){return G.dir&&F.test(N)});var M=this.root+F,D=I.call(this,M),B=this.clone();return B.root=D.name,B},remove:function(F){F=this.root+F;var M=this.files[F];if(M||(F.slice(-1)!=="/"&&(F+="/"),M=this.files[F]),M&&!M.dir)delete this.files[F];else for(var D=this.filter(function(N,G){return G.name.slice(0,F.length)===F}),B=0;B<D.length;B++)delete this.files[D[B].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(F){var M,D={};try{if((D=o.extend(F||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=D.type.toLowerCase(),D.compression=D.compression.toUpperCase(),D.type==="binarystring"&&(D.type="string"),!D.type)throw new Error("No output type specified.");o.checkSupport(D.type),D.platform!=="darwin"&&D.platform!=="freebsd"&&D.platform!=="linux"&&D.platform!=="sunos"||(D.platform="UNIX"),D.platform==="win32"&&(D.platform="DOS");var B=D.comment||this.comment||"";M=m.generateWorker(this,D,B)}catch(N){(M=new a("error")).error(N)}return new c(M,D.type||"string",D.mimeType)},generateAsync:function(F,M){return this.generateInternalStream(F).accumulate(M)},generateNodeStream:function(F,M){return(F=F||{}).type||(F.type="nodebuffer"),this.generateInternalStream(F).toNodejsStream(M)}};i.exports=C},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,s){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,s){var n=t("./DataReader");function r(o){n.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),d=o.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===a&&this.data[f+1]===c&&this.data[f+2]===u&&this.data[f+3]===d)return f-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),c=o.charCodeAt(1),u=o.charCodeAt(2),d=o.charCodeAt(3),f=this.readData(4);return a===f[0]&&c===f[1]&&u===f[2]&&d===f[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},i.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,i,s){var n=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,c=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)c=(c<<8)+this.byteAt(a);return this.index+=o,c},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},i.exports=r},{"../utils":32}],19:[function(t,i,s){var n=t("./Uint8ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},i.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,s){var n=t("./DataReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},i.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,i,s){var n=t("./ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},i.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,s){var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),c=t("./NodeBufferReader"),u=t("./Uint8ArrayReader");i.exports=function(d){var f=n.getTypeOf(d);return n.checkSupport(f),f!=="string"||r.uint8array?f==="nodebuffer"?new c(d):r.uint8array?new u(n.transformTo("uint8array",d)):new o(n.transformTo("array",d)):new a(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,s){var n=t("./GenericWorker"),r=t("../utils");function o(a){n.call(this,"ConvertWorker to "+a),this.destType=a}r.inherits(o,n),o.prototype.processChunk=function(a){this.push({data:r.transformTo(this.destType,a.data),meta:a.meta})},i.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,s){var n=t("./GenericWorker"),r=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(a){this.streamInfo.crc32=r(a.data,this.streamInfo.crc32||0),this.push(a)},i.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,s){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}n.inherits(o,r),o.prototype.processChunk=function(a){if(a){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+a.data.length}r.prototype.processChunk.call(this,a)},i.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,s){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(u){c.dataIsReady=!0,c.data=u,c.max=u&&u.length||0,c.type=n.getTypeOf(u),c.isPaused||c._tickAndRepeat()},function(u){c.error(u)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,c);break;case"uint8array":a=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":a=this.data.slice(this.index,c)}return this.index=c,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,s){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var a=0;a<this._listeners[r].length;a++)this._listeners[r][a].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(a){o.processChunk(a)}),r.on("end",function(){o.end()}),r.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},i.exports=n},{}],29:[function(t,i,s){var n=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),a=t("../base64"),c=t("../support"),u=t("../external"),d=null;if(c.nodestream)try{d=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(E,g){return new u.Promise(function(w,y){var I=[],_=E._internalType,C=E._outputType,F=E._mimeType;E.on("data",function(M,D){I.push(M),g&&g(D)}).on("error",function(M){I=[],y(M)}).on("end",function(){try{var M=function(D,B,N){switch(D){case"blob":return n.newBlob(n.transformTo("arraybuffer",B),N);case"base64":return a.encode(B);default:return n.transformTo(D,B)}}(C,function(D,B){var N,G=0,Q=null,O=0;for(N=0;N<B.length;N++)O+=B[N].length;switch(D){case"string":return B.join("");case"array":return Array.prototype.concat.apply([],B);case"uint8array":for(Q=new Uint8Array(O),N=0;N<B.length;N++)Q.set(B[N],G),G+=B[N].length;return Q;case"nodebuffer":return Buffer.concat(B);default:throw new Error("concat : unsupported type '"+D+"'")}}(_,I),F);w(M)}catch(D){y(D)}I=[]}).resume()})}function m(E,g,w){var y=g;switch(g){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=g,this._mimeType=w,n.checkSupport(y),this._worker=E.pipe(new r(y)),E.lock()}catch(I){this._worker=new o("error"),this._worker.error(I)}}m.prototype={accumulate:function(E){return f(this,E)},on:function(E,g){var w=this;return E==="data"?this._worker.on(E,function(y){g.call(w,y.data,y.meta)}):this._worker.on(E,function(){n.delay(g,arguments,w)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(E){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},E)}},i.exports=m},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var n=new ArrayBuffer(0);try{s.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),s.blob=r.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!t("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,s){for(var n=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),a=t("./stream/GenericWorker"),c=new Array(256),u=0;u<256;u++)c[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;c[254]=c[254]=1;function d(){a.call(this,"utf-8 decode"),this.leftOver=null}function f(){a.call(this,"utf-8 encode")}s.utf8encode=function(m){return r.nodebuffer?o.newBufferFrom(m,"utf-8"):function(E){var g,w,y,I,_,C=E.length,F=0;for(I=0;I<C;I++)(64512&(w=E.charCodeAt(I)))==55296&&I+1<C&&(64512&(y=E.charCodeAt(I+1)))==56320&&(w=65536+(w-55296<<10)+(y-56320),I++),F+=w<128?1:w<2048?2:w<65536?3:4;for(g=r.uint8array?new Uint8Array(F):new Array(F),I=_=0;_<F;I++)(64512&(w=E.charCodeAt(I)))==55296&&I+1<C&&(64512&(y=E.charCodeAt(I+1)))==56320&&(w=65536+(w-55296<<10)+(y-56320),I++),w<128?g[_++]=w:(w<2048?g[_++]=192|w>>>6:(w<65536?g[_++]=224|w>>>12:(g[_++]=240|w>>>18,g[_++]=128|w>>>12&63),g[_++]=128|w>>>6&63),g[_++]=128|63&w);return g}(m)},s.utf8decode=function(m){return r.nodebuffer?n.transformTo("nodebuffer",m).toString("utf-8"):function(E){var g,w,y,I,_=E.length,C=new Array(2*_);for(g=w=0;g<_;)if((y=E[g++])<128)C[w++]=y;else if(4<(I=c[y]))C[w++]=65533,g+=I-1;else{for(y&=I===2?31:I===3?15:7;1<I&&g<_;)y=y<<6|63&E[g++],I--;1<I?C[w++]=65533:y<65536?C[w++]=y:(y-=65536,C[w++]=55296|y>>10&1023,C[w++]=56320|1023&y)}return C.length!==w&&(C.subarray?C=C.subarray(0,w):C.length=w),n.applyFromCharCode(C)}(m=n.transformTo(r.uint8array?"uint8array":"array",m))},n.inherits(d,a),d.prototype.processChunk=function(m){var E=n.transformTo(r.uint8array?"uint8array":"array",m.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var g=E;(E=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),E.set(g,this.leftOver.length)}else E=this.leftOver.concat(E);this.leftOver=null}var w=function(I,_){var C;for((_=_||I.length)>I.length&&(_=I.length),C=_-1;0<=C&&(192&I[C])==128;)C--;return C<0||C===0?_:C+c[I[C]]>_?C:_}(E),y=E;w!==E.length&&(r.uint8array?(y=E.subarray(0,w),this.leftOver=E.subarray(w,E.length)):(y=E.slice(0,w),this.leftOver=E.slice(w,E.length))),this.push({data:s.utf8decode(y),meta:m.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=d,n.inherits(f,a),f.prototype.processChunk=function(m){this.push({data:s.utf8encode(m.data),meta:m.meta})},s.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,s){var n=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),a=t("./external");function c(g){return g}function u(g,w){for(var y=0;y<g.length;++y)w[y]=255&g.charCodeAt(y);return w}t("setimmediate"),s.newBlob=function(g,w){s.checkSupport("blob");try{return new Blob([g],{type:w})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(g),y.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(g,w,y){var I=[],_=0,C=g.length;if(C<=y)return String.fromCharCode.apply(null,g);for(;_<C;)w==="array"||w==="nodebuffer"?I.push(String.fromCharCode.apply(null,g.slice(_,Math.min(_+y,C)))):I.push(String.fromCharCode.apply(null,g.subarray(_,Math.min(_+y,C)))),_+=y;return I.join("")},stringifyByChar:function(g){for(var w="",y=0;y<g.length;y++)w+=String.fromCharCode(g[y]);return w},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function f(g){var w=65536,y=s.getTypeOf(g),I=!0;if(y==="uint8array"?I=d.applyCanBeUsed.uint8array:y==="nodebuffer"&&(I=d.applyCanBeUsed.nodebuffer),I)for(;1<w;)try{return d.stringifyByChunk(g,y,w)}catch{w=Math.floor(w/2)}return d.stringifyByChar(g)}function m(g,w){for(var y=0;y<g.length;y++)w[y]=g[y];return w}s.applyFromCharCode=f;var E={};E.string={string:c,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return E.string.uint8array(g).buffer},uint8array:function(g){return u(g,new Uint8Array(g.length))},nodebuffer:function(g){return u(g,o.allocBuffer(g.length))}},E.array={string:f,array:c,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},E.arraybuffer={string:function(g){return f(new Uint8Array(g))},array:function(g){return m(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:c,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},E.uint8array={string:f,array:function(g){return m(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:c,nodebuffer:function(g){return o.newBufferFrom(g)}},E.nodebuffer={string:f,array:function(g){return m(g,new Array(g.length))},arraybuffer:function(g){return E.nodebuffer.uint8array(g).buffer},uint8array:function(g){return m(g,new Uint8Array(g.length))},nodebuffer:c},s.transformTo=function(g,w){if(w=w||"",!g)return w;s.checkSupport(g);var y=s.getTypeOf(w);return E[y][g](w)},s.resolve=function(g){for(var w=g.split("/"),y=[],I=0;I<w.length;I++){var _=w[I];_==="."||_===""&&I!==0&&I!==w.length-1||(_===".."?y.pop():y.push(_))}return y.join("/")},s.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(g)?"nodebuffer":n.uint8array&&g instanceof Uint8Array?"uint8array":n.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(g){if(!n[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(g){var w,y,I="";for(y=0;y<(g||"").length;y++)I+="\\x"+((w=g.charCodeAt(y))<16?"0":"")+w.toString(16).toUpperCase();return I},s.delay=function(g,w,y){setImmediate(function(){g.apply(y||null,w||[])})},s.inherits=function(g,w){function y(){}y.prototype=w.prototype,g.prototype=new y},s.extend=function(){var g,w,y={};for(g=0;g<arguments.length;g++)for(w in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],w)&&y[w]===void 0&&(y[w]=arguments[g][w]);return y},s.prepareContent=function(g,w,y,I,_){return a.Promise.resolve(w).then(function(C){return n.blob&&(C instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(C))!==-1)&&typeof FileReader<"u"?new a.Promise(function(F,M){var D=new FileReader;D.onload=function(B){F(B.target.result)},D.onerror=function(B){M(B.target.error)},D.readAsArrayBuffer(C)}):C}).then(function(C){var F=s.getTypeOf(C);return F?(F==="arraybuffer"?C=s.transformTo("uint8array",C):F==="string"&&(_?C=r.decode(C):y&&I!==!0&&(C=function(M){return u(M,n.uint8array?new Uint8Array(M.length):new Array(M.length))}(C))),C):a.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,s){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),a=t("./zipEntry"),c=t("./support");function u(d){this.files=[],this.loadOptions=d}u.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(d)+")")}},isSignature:function(d,f){var m=this.reader.index;this.reader.setIndex(d);var E=this.reader.readString(4)===f;return this.reader.setIndex(m),E},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),f=c.uint8array?"uint8array":"array",m=r.transformTo(f,d);this.zipComment=this.loadOptions.decodeFileName(m)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,f,m,E=this.zip64EndOfCentralSize-44;0<E;)d=this.reader.readInt(2),f=this.reader.readInt(4),m=this.reader.readData(f),this.zip64ExtensibleData[d]={id:d,length:f,value:m}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,f;for(d=0;d<this.files.length;d++)f=this.files[d],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(d=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var f=d;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var m=this.centralDirOffset+this.centralDirSize;this.zip64&&(m+=20,m+=12+this.zip64EndOfCentralSize);var E=f-m;if(0<E)this.isSignature(f,o.CENTRAL_FILE_HEADER)||(this.reader.zero=E);else if(E<0)throw new Error("Corrupted zip: missing "+Math.abs(E)+" bytes.")},prepareReader:function(d){this.reader=n(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,s){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),c=t("./utf8"),u=t("./compressions"),d=t("./support");function f(m,E){this.options=m,this.loadOptions=E}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(m){var E,g;if(m.skip(22),this.fileNameLength=m.readInt(2),g=m.readInt(2),this.fileName=m.readData(this.fileNameLength),m.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((E=function(w){for(var y in u)if(Object.prototype.hasOwnProperty.call(u,y)&&u[y].magic===w)return u[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,E,m.readData(this.compressedSize))},readCentralPart:function(m){this.versionMadeBy=m.readInt(2),m.skip(2),this.bitFlag=m.readInt(2),this.compressionMethod=m.readString(2),this.date=m.readDate(),this.crc32=m.readInt(4),this.compressedSize=m.readInt(4),this.uncompressedSize=m.readInt(4);var E=m.readInt(2);if(this.extraFieldsLength=m.readInt(2),this.fileCommentLength=m.readInt(2),this.diskNumberStart=m.readInt(2),this.internalFileAttributes=m.readInt(2),this.externalFileAttributes=m.readInt(4),this.localHeaderOffset=m.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");m.skip(E),this.readExtraFields(m),this.parseZIP64ExtraField(m),this.fileComment=m.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var m=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),m==0&&(this.dosPermissions=63&this.externalFileAttributes),m==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var m=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=m.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=m.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=m.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=m.readInt(4))}},readExtraFields:function(m){var E,g,w,y=m.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});m.index+4<y;)E=m.readInt(2),g=m.readInt(2),w=m.readData(g),this.extraFields[E]={id:E,length:g,value:w};m.setIndex(y)},handleUTF8:function(){var m=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var E=this.findExtraFieldUnicodePath();if(E!==null)this.fileNameStr=E;else{var g=r.transformTo(m,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var y=r.transformTo(m,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var m=this.extraFields[28789];if(m){var E=n(m.value);return E.readInt(1)!==1||a(this.fileName)!==E.readInt(4)?null:c.utf8decode(E.readData(m.length-5))}return null},findExtraFieldUnicodeComment:function(){var m=this.extraFields[25461];if(m){var E=n(m.value);return E.readInt(1)!==1||a(this.fileComment)!==E.readInt(4)?null:c.utf8decode(E.readData(m.length-5))}return null}},i.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,s){function n(E,g,w){this.name=E,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=g,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),a=t("./utf8"),c=t("./compressedObject"),u=t("./stream/GenericWorker");n.prototype={internalStream:function(E){var g=null,w="string";try{if(!E)throw new Error("No output type specified.");var y=(w=E.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),g=this._decompressWorker();var I=!this._dataBinary;I&&!y&&(g=g.pipe(new a.Utf8EncodeWorker)),!I&&y&&(g=g.pipe(new a.Utf8DecodeWorker))}catch(_){(g=new u("error")).error(_)}return new r(g,w,"")},async:function(E,g){return this.internalStream(E).accumulate(g)},nodeStream:function(E,g){return this.internalStream(E||"nodebuffer").toNodejsStream(g)},_compressWorker:function(E,g){if(this._data instanceof c&&this._data.compression.magic===E.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new a.Utf8EncodeWorker)),c.createWorkerFrom(w,E,g)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new o(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},m=0;m<d.length;m++)n.prototype[d[m]]=f;i.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,s){(function(n){var r,o,a=n.MutationObserver||n.WebKitMutationObserver;if(a){var c=0,u=new a(E),d=n.document.createTextNode("");u.observe(d,{characterData:!0}),r=function(){d.data=c=++c%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var g=n.document.createElement("script");g.onreadystatechange=function(){E(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},n.document.documentElement.appendChild(g)}:function(){setTimeout(E,0)};else{var f=new n.MessageChannel;f.port1.onmessage=E,r=function(){f.port2.postMessage(0)}}var m=[];function E(){var g,w;o=!0;for(var y=m.length;y;){for(w=m,m=[],g=-1;++g<y;)w[g]();y=m.length}o=!1}i.exports=function(g){m.push(g)!==1||o||r()}}).call(this,typeof Qr<"u"?Qr:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,s){var n=t("immediate");function r(){}var o={},a=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function d(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,y!==r&&g(this,y)}function f(y,I,_){this.promise=y,typeof I=="function"&&(this.onFulfilled=I,this.callFulfilled=this.otherCallFulfilled),typeof _=="function"&&(this.onRejected=_,this.callRejected=this.otherCallRejected)}function m(y,I,_){n(function(){var C;try{C=I(_)}catch(F){return o.reject(y,F)}C===y?o.reject(y,new TypeError("Cannot resolve promise with itself")):o.resolve(y,C)})}function E(y){var I=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof I=="function")return function(){I.apply(y,arguments)}}function g(y,I){var _=!1;function C(D){_||(_=!0,o.reject(y,D))}function F(D){_||(_=!0,o.resolve(y,D))}var M=w(function(){I(F,C)});M.status==="error"&&C(M.value)}function w(y,I){var _={};try{_.value=y(I),_.status="success"}catch(C){_.status="error",_.value=C}return _}(i.exports=d).prototype.finally=function(y){if(typeof y!="function")return this;var I=this.constructor;return this.then(function(_){return I.resolve(y()).then(function(){return _})},function(_){return I.resolve(y()).then(function(){throw _})})},d.prototype.catch=function(y){return this.then(null,y)},d.prototype.then=function(y,I){if(typeof y!="function"&&this.state===c||typeof I!="function"&&this.state===a)return this;var _=new this.constructor(r);return this.state!==u?m(_,this.state===c?y:I,this.outcome):this.queue.push(new f(_,y,I)),_},f.prototype.callFulfilled=function(y){o.resolve(this.promise,y)},f.prototype.otherCallFulfilled=function(y){m(this.promise,this.onFulfilled,y)},f.prototype.callRejected=function(y){o.reject(this.promise,y)},f.prototype.otherCallRejected=function(y){m(this.promise,this.onRejected,y)},o.resolve=function(y,I){var _=w(E,I);if(_.status==="error")return o.reject(y,_.value);var C=_.value;if(C)g(y,C);else{y.state=c,y.outcome=I;for(var F=-1,M=y.queue.length;++F<M;)y.queue[F].callFulfilled(I)}return y},o.reject=function(y,I){y.state=a,y.outcome=I;for(var _=-1,C=y.queue.length;++_<C;)y.queue[_].callRejected(I);return y},d.resolve=function(y){return y instanceof this?y:o.resolve(new this(r),y)},d.reject=function(y){var I=new this(r);return o.reject(I,y)},d.all=function(y){var I=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=y.length,C=!1;if(!_)return this.resolve([]);for(var F=new Array(_),M=0,D=-1,B=new this(r);++D<_;)N(y[D],D);return B;function N(G,Q){I.resolve(G).then(function(O){F[Q]=O,++M!==_||C||(C=!0,o.resolve(B,F))},function(O){C||(C=!0,o.reject(B,O))})}},d.race=function(y){var I=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var _=y.length,C=!1;if(!_)return this.resolve([]);for(var F=-1,M=new this(r);++F<_;)D=y[F],I.resolve(D).then(function(B){C||(C=!0,o.resolve(M,B))},function(B){C||(C=!0,o.reject(M,B))});var D;return M}},{immediate:36}],38:[function(t,i,s){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,s){var n=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),c=t("./zlib/zstream"),u=Object.prototype.toString,d=0,f=-1,m=0,E=8;function g(y){if(!(this instanceof g))return new g(y);this.options=r.assign({level:f,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:m,to:""},y||{});var I=this.options;I.raw&&0<I.windowBits?I.windowBits=-I.windowBits:I.gzip&&0<I.windowBits&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var _=n.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(_!==d)throw new Error(a[_]);if(I.header&&n.deflateSetHeader(this.strm,I.header),I.dictionary){var C;if(C=typeof I.dictionary=="string"?o.string2buf(I.dictionary):u.call(I.dictionary)==="[object ArrayBuffer]"?new Uint8Array(I.dictionary):I.dictionary,(_=n.deflateSetDictionary(this.strm,C))!==d)throw new Error(a[_]);this._dict_set=!0}}function w(y,I){var _=new g(I);if(_.push(y,!0),_.err)throw _.msg||a[_.err];return _.result}g.prototype.push=function(y,I){var _,C,F=this.strm,M=this.options.chunkSize;if(this.ended)return!1;C=I===~~I?I:I===!0?4:0,typeof y=="string"?F.input=o.string2buf(y):u.call(y)==="[object ArrayBuffer]"?F.input=new Uint8Array(y):F.input=y,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new r.Buf8(M),F.next_out=0,F.avail_out=M),(_=n.deflate(F,C))!==1&&_!==d)return this.onEnd(_),!(this.ended=!0);F.avail_out!==0&&(F.avail_in!==0||C!==4&&C!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(F.output,F.next_out))):this.onData(r.shrinkBuf(F.output,F.next_out)))}while((0<F.avail_in||F.avail_out===0)&&_!==1);return C===4?(_=n.deflateEnd(this.strm),this.onEnd(_),this.ended=!0,_===d):C!==2||(this.onEnd(d),!(F.avail_out=0))},g.prototype.onData=function(y){this.chunks.push(y)},g.prototype.onEnd=function(y){y===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},s.Deflate=g,s.deflate=w,s.deflateRaw=function(y,I){return(I=I||{}).raw=!0,w(y,I)},s.gzip=function(y,I){return(I=I||{}).gzip=!0,w(y,I)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,s){var n=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),c=t("./zlib/messages"),u=t("./zlib/zstream"),d=t("./zlib/gzheader"),f=Object.prototype.toString;function m(g){if(!(this instanceof m))return new m(g);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},g||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||g&&g.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var y=n.inflateInit2(this.strm,w.windowBits);if(y!==a.Z_OK)throw new Error(c[y]);this.header=new d,n.inflateGetHeader(this.strm,this.header)}function E(g,w){var y=new m(w);if(y.push(g,!0),y.err)throw y.msg||c[y.err];return y.result}m.prototype.push=function(g,w){var y,I,_,C,F,M,D=this.strm,B=this.options.chunkSize,N=this.options.dictionary,G=!1;if(this.ended)return!1;I=w===~~w?w:w===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof g=="string"?D.input=o.binstring2buf(g):f.call(g)==="[object ArrayBuffer]"?D.input=new Uint8Array(g):D.input=g,D.next_in=0,D.avail_in=D.input.length;do{if(D.avail_out===0&&(D.output=new r.Buf8(B),D.next_out=0,D.avail_out=B),(y=n.inflate(D,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&N&&(M=typeof N=="string"?o.string2buf(N):f.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,y=n.inflateSetDictionary(this.strm,M)),y===a.Z_BUF_ERROR&&G===!0&&(y=a.Z_OK,G=!1),y!==a.Z_STREAM_END&&y!==a.Z_OK)return this.onEnd(y),!(this.ended=!0);D.next_out&&(D.avail_out!==0&&y!==a.Z_STREAM_END&&(D.avail_in!==0||I!==a.Z_FINISH&&I!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(_=o.utf8border(D.output,D.next_out),C=D.next_out-_,F=o.buf2string(D.output,_),D.next_out=C,D.avail_out=B-C,C&&r.arraySet(D.output,D.output,_,C,0),this.onData(F)):this.onData(r.shrinkBuf(D.output,D.next_out)))),D.avail_in===0&&D.avail_out===0&&(G=!0)}while((0<D.avail_in||D.avail_out===0)&&y!==a.Z_STREAM_END);return y===a.Z_STREAM_END&&(I=a.Z_FINISH),I===a.Z_FINISH?(y=n.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===a.Z_OK):I!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(D.avail_out=0))},m.prototype.onData=function(g){this.chunks.push(g)},m.prototype.onEnd=function(g){g===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},s.Inflate=m,s.inflate=E,s.inflateRaw=function(g,w){return(w=w||{}).raw=!0,E(g,w)},s.ungzip=E},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,s){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(a){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var u=c.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var d in u)u.hasOwnProperty(d)&&(a[d]=u[d])}}return a},s.shrinkBuf=function(a,c){return a.length===c?a:a.subarray?a.subarray(0,c):(a.length=c,a)};var r={arraySet:function(a,c,u,d,f){if(c.subarray&&a.subarray)a.set(c.subarray(u,u+d),f);else for(var m=0;m<d;m++)a[f+m]=c[u+m]},flattenChunks:function(a){var c,u,d,f,m,E;for(c=d=0,u=a.length;c<u;c++)d+=a[c].length;for(E=new Uint8Array(d),c=f=0,u=a.length;c<u;c++)m=a[c],E.set(m,f),f+=m.length;return E}},o={arraySet:function(a,c,u,d,f){for(var m=0;m<d;m++)a[f+m]=c[u+m]},flattenChunks:function(a){return[].concat.apply([],a)}};s.setTyped=function(a){a?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,r)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,o))},s.setTyped(n)},{}],42:[function(t,i,s){var n=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new n.Buf8(256),c=0;c<256;c++)a[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function u(d,f){if(f<65537&&(d.subarray&&o||!d.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(d,f));for(var m="",E=0;E<f;E++)m+=String.fromCharCode(d[E]);return m}a[254]=a[254]=1,s.string2buf=function(d){var f,m,E,g,w,y=d.length,I=0;for(g=0;g<y;g++)(64512&(m=d.charCodeAt(g)))==55296&&g+1<y&&(64512&(E=d.charCodeAt(g+1)))==56320&&(m=65536+(m-55296<<10)+(E-56320),g++),I+=m<128?1:m<2048?2:m<65536?3:4;for(f=new n.Buf8(I),g=w=0;w<I;g++)(64512&(m=d.charCodeAt(g)))==55296&&g+1<y&&(64512&(E=d.charCodeAt(g+1)))==56320&&(m=65536+(m-55296<<10)+(E-56320),g++),m<128?f[w++]=m:(m<2048?f[w++]=192|m>>>6:(m<65536?f[w++]=224|m>>>12:(f[w++]=240|m>>>18,f[w++]=128|m>>>12&63),f[w++]=128|m>>>6&63),f[w++]=128|63&m);return f},s.buf2binstring=function(d){return u(d,d.length)},s.binstring2buf=function(d){for(var f=new n.Buf8(d.length),m=0,E=f.length;m<E;m++)f[m]=d.charCodeAt(m);return f},s.buf2string=function(d,f){var m,E,g,w,y=f||d.length,I=new Array(2*y);for(m=E=0;m<y;)if((g=d[m++])<128)I[E++]=g;else if(4<(w=a[g]))I[E++]=65533,m+=w-1;else{for(g&=w===2?31:w===3?15:7;1<w&&m<y;)g=g<<6|63&d[m++],w--;1<w?I[E++]=65533:g<65536?I[E++]=g:(g-=65536,I[E++]=55296|g>>10&1023,I[E++]=56320|1023&g)}return u(I,E)},s.utf8border=function(d,f){var m;for((f=f||d.length)>d.length&&(f=d.length),m=f-1;0<=m&&(192&d[m])==128;)m--;return m<0||m===0?f:m+a[d[m]]>f?m:f}},{"./common":41}],43:[function(t,i,s){i.exports=function(n,r,o,a){for(var c=65535&n|0,u=n>>>16&65535|0,d=0;o!==0;){for(o-=d=2e3<o?2e3:o;u=u+(c=c+r[a++]|0)|0,--d;);c%=65521,u%=65521}return c|u<<16|0}},{}],44:[function(t,i,s){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,s){var n=function(){for(var r,o=[],a=0;a<256;a++){r=a;for(var c=0;c<8;c++)r=1&r?3988292384^r>>>1:r>>>1;o[a]=r}return o}();i.exports=function(r,o,a,c){var u=n,d=c+a;r^=-1;for(var f=c;f<d;f++)r=r>>>8^u[255&(r^o[f])];return-1^r}},{}],46:[function(t,i,s){var n,r=t("../utils/common"),o=t("./trees"),a=t("./adler32"),c=t("./crc32"),u=t("./messages"),d=0,f=4,m=0,E=-2,g=-1,w=4,y=2,I=8,_=9,C=286,F=30,M=19,D=2*C+1,B=15,N=3,G=258,Q=G+N+1,O=42,V=113,T=1,J=2,de=3,ie=4;function ve(x,fe){return x.msg=u[fe],fe}function ue(x){return(x<<1)-(4<x?9:0)}function De(x){for(var fe=x.length;0<=--fe;)x[fe]=0}function oe(x){var fe=x.state,he=fe.pending;he>x.avail_out&&(he=x.avail_out),he!==0&&(r.arraySet(x.output,fe.pending_buf,fe.pending_out,he,x.next_out),x.next_out+=he,fe.pending_out+=he,x.total_out+=he,x.avail_out-=he,fe.pending-=he,fe.pending===0&&(fe.pending_out=0))}function re(x,fe){o._tr_flush_block(x,0<=x.block_start?x.block_start:-1,x.strstart-x.block_start,fe),x.block_start=x.strstart,oe(x.strm)}function Me(x,fe){x.pending_buf[x.pending++]=fe}function Oe(x,fe){x.pending_buf[x.pending++]=fe>>>8&255,x.pending_buf[x.pending++]=255&fe}function xe(x,fe){var he,k,U=x.max_chain_length,q=x.strstart,Ee=x.prev_length,ge=x.nice_match,se=x.strstart>x.w_size-Q?x.strstart-(x.w_size-Q):0,Ie=x.window,Pe=x.w_mask,Te=x.prev,Ue=x.strstart+G,st=Ie[q+Ee-1],We=Ie[q+Ee];x.prev_length>=x.good_match&&(U>>=2),ge>x.lookahead&&(ge=x.lookahead);do if(Ie[(he=fe)+Ee]===We&&Ie[he+Ee-1]===st&&Ie[he]===Ie[q]&&Ie[++he]===Ie[q+1]){q+=2,he++;do;while(Ie[++q]===Ie[++he]&&Ie[++q]===Ie[++he]&&Ie[++q]===Ie[++he]&&Ie[++q]===Ie[++he]&&Ie[++q]===Ie[++he]&&Ie[++q]===Ie[++he]&&Ie[++q]===Ie[++he]&&Ie[++q]===Ie[++he]&&q<Ue);if(k=G-(Ue-q),q=Ue-G,Ee<k){if(x.match_start=fe,ge<=(Ee=k))break;st=Ie[q+Ee-1],We=Ie[q+Ee]}}while((fe=Te[fe&Pe])>se&&--U!=0);return Ee<=x.lookahead?Ee:x.lookahead}function it(x){var fe,he,k,U,q,Ee,ge,se,Ie,Pe,Te=x.w_size;do{if(U=x.window_size-x.lookahead-x.strstart,x.strstart>=Te+(Te-Q)){for(r.arraySet(x.window,x.window,Te,Te,0),x.match_start-=Te,x.strstart-=Te,x.block_start-=Te,fe=he=x.hash_size;k=x.head[--fe],x.head[fe]=Te<=k?k-Te:0,--he;);for(fe=he=Te;k=x.prev[--fe],x.prev[fe]=Te<=k?k-Te:0,--he;);U+=Te}if(x.strm.avail_in===0)break;if(Ee=x.strm,ge=x.window,se=x.strstart+x.lookahead,Ie=U,Pe=void 0,Pe=Ee.avail_in,Ie<Pe&&(Pe=Ie),he=Pe===0?0:(Ee.avail_in-=Pe,r.arraySet(ge,Ee.input,Ee.next_in,Pe,se),Ee.state.wrap===1?Ee.adler=a(Ee.adler,ge,Pe,se):Ee.state.wrap===2&&(Ee.adler=c(Ee.adler,ge,Pe,se)),Ee.next_in+=Pe,Ee.total_in+=Pe,Pe),x.lookahead+=he,x.lookahead+x.insert>=N)for(q=x.strstart-x.insert,x.ins_h=x.window[q],x.ins_h=(x.ins_h<<x.hash_shift^x.window[q+1])&x.hash_mask;x.insert&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[q+N-1])&x.hash_mask,x.prev[q&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=q,q++,x.insert--,!(x.lookahead+x.insert<N)););}while(x.lookahead<Q&&x.strm.avail_in!==0)}function at(x,fe){for(var he,k;;){if(x.lookahead<Q){if(it(x),x.lookahead<Q&&fe===d)return T;if(x.lookahead===0)break}if(he=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,he=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),he!==0&&x.strstart-he<=x.w_size-Q&&(x.match_length=xe(x,he)),x.match_length>=N)if(k=o._tr_tally(x,x.strstart-x.match_start,x.match_length-N),x.lookahead-=x.match_length,x.match_length<=x.max_lazy_match&&x.lookahead>=N){for(x.match_length--;x.strstart++,x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,he=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart,--x.match_length!=0;);x.strstart++}else x.strstart+=x.match_length,x.match_length=0,x.ins_h=x.window[x.strstart],x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+1])&x.hash_mask;else k=o._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++;if(k&&(re(x,!1),x.strm.avail_out===0))return T}return x.insert=x.strstart<N-1?x.strstart:N-1,fe===f?(re(x,!0),x.strm.avail_out===0?de:ie):x.last_lit&&(re(x,!1),x.strm.avail_out===0)?T:J}function Be(x,fe){for(var he,k,U;;){if(x.lookahead<Q){if(it(x),x.lookahead<Q&&fe===d)return T;if(x.lookahead===0)break}if(he=0,x.lookahead>=N&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,he=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),x.prev_length=x.match_length,x.prev_match=x.match_start,x.match_length=N-1,he!==0&&x.prev_length<x.max_lazy_match&&x.strstart-he<=x.w_size-Q&&(x.match_length=xe(x,he),x.match_length<=5&&(x.strategy===1||x.match_length===N&&4096<x.strstart-x.match_start)&&(x.match_length=N-1)),x.prev_length>=N&&x.match_length<=x.prev_length){for(U=x.strstart+x.lookahead-N,k=o._tr_tally(x,x.strstart-1-x.prev_match,x.prev_length-N),x.lookahead-=x.prev_length-1,x.prev_length-=2;++x.strstart<=U&&(x.ins_h=(x.ins_h<<x.hash_shift^x.window[x.strstart+N-1])&x.hash_mask,he=x.prev[x.strstart&x.w_mask]=x.head[x.ins_h],x.head[x.ins_h]=x.strstart),--x.prev_length!=0;);if(x.match_available=0,x.match_length=N-1,x.strstart++,k&&(re(x,!1),x.strm.avail_out===0))return T}else if(x.match_available){if((k=o._tr_tally(x,0,x.window[x.strstart-1]))&&re(x,!1),x.strstart++,x.lookahead--,x.strm.avail_out===0)return T}else x.match_available=1,x.strstart++,x.lookahead--}return x.match_available&&(k=o._tr_tally(x,0,x.window[x.strstart-1]),x.match_available=0),x.insert=x.strstart<N-1?x.strstart:N-1,fe===f?(re(x,!0),x.strm.avail_out===0?de:ie):x.last_lit&&(re(x,!1),x.strm.avail_out===0)?T:J}function ye(x,fe,he,k,U){this.good_length=x,this.max_lazy=fe,this.nice_length=he,this.max_chain=k,this.func=U}function Ye(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*D),this.dyn_dtree=new r.Buf16(2*(2*F+1)),this.bl_tree=new r.Buf16(2*(2*M+1)),De(this.dyn_ltree),De(this.dyn_dtree),De(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(B+1),this.heap=new r.Buf16(2*C+1),De(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*C+1),De(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Je(x){var fe;return x&&x.state?(x.total_in=x.total_out=0,x.data_type=y,(fe=x.state).pending=0,fe.pending_out=0,fe.wrap<0&&(fe.wrap=-fe.wrap),fe.status=fe.wrap?O:V,x.adler=fe.wrap===2?0:1,fe.last_flush=d,o._tr_init(fe),m):ve(x,E)}function He(x){var fe=Je(x);return fe===m&&function(he){he.window_size=2*he.w_size,De(he.head),he.max_lazy_match=n[he.level].max_lazy,he.good_match=n[he.level].good_length,he.nice_match=n[he.level].nice_length,he.max_chain_length=n[he.level].max_chain,he.strstart=0,he.block_start=0,he.lookahead=0,he.insert=0,he.match_length=he.prev_length=N-1,he.match_available=0,he.ins_h=0}(x.state),fe}function vt(x,fe,he,k,U,q){if(!x)return E;var Ee=1;if(fe===g&&(fe=6),k<0?(Ee=0,k=-k):15<k&&(Ee=2,k-=16),U<1||_<U||he!==I||k<8||15<k||fe<0||9<fe||q<0||w<q)return ve(x,E);k===8&&(k=9);var ge=new Ye;return(x.state=ge).strm=x,ge.wrap=Ee,ge.gzhead=null,ge.w_bits=k,ge.w_size=1<<ge.w_bits,ge.w_mask=ge.w_size-1,ge.hash_bits=U+7,ge.hash_size=1<<ge.hash_bits,ge.hash_mask=ge.hash_size-1,ge.hash_shift=~~((ge.hash_bits+N-1)/N),ge.window=new r.Buf8(2*ge.w_size),ge.head=new r.Buf16(ge.hash_size),ge.prev=new r.Buf16(ge.w_size),ge.lit_bufsize=1<<U+6,ge.pending_buf_size=4*ge.lit_bufsize,ge.pending_buf=new r.Buf8(ge.pending_buf_size),ge.d_buf=1*ge.lit_bufsize,ge.l_buf=3*ge.lit_bufsize,ge.level=fe,ge.strategy=q,ge.method=he,He(x)}n=[new ye(0,0,0,0,function(x,fe){var he=65535;for(he>x.pending_buf_size-5&&(he=x.pending_buf_size-5);;){if(x.lookahead<=1){if(it(x),x.lookahead===0&&fe===d)return T;if(x.lookahead===0)break}x.strstart+=x.lookahead,x.lookahead=0;var k=x.block_start+he;if((x.strstart===0||x.strstart>=k)&&(x.lookahead=x.strstart-k,x.strstart=k,re(x,!1),x.strm.avail_out===0)||x.strstart-x.block_start>=x.w_size-Q&&(re(x,!1),x.strm.avail_out===0))return T}return x.insert=0,fe===f?(re(x,!0),x.strm.avail_out===0?de:ie):(x.strstart>x.block_start&&(re(x,!1),x.strm.avail_out),T)}),new ye(4,4,8,4,at),new ye(4,5,16,8,at),new ye(4,6,32,32,at),new ye(4,4,16,16,Be),new ye(8,16,32,32,Be),new ye(8,16,128,128,Be),new ye(8,32,128,256,Be),new ye(32,128,258,1024,Be),new ye(32,258,258,4096,Be)],s.deflateInit=function(x,fe){return vt(x,fe,I,15,8,0)},s.deflateInit2=vt,s.deflateReset=He,s.deflateResetKeep=Je,s.deflateSetHeader=function(x,fe){return x&&x.state?x.state.wrap!==2?E:(x.state.gzhead=fe,m):E},s.deflate=function(x,fe){var he,k,U,q;if(!x||!x.state||5<fe||fe<0)return x?ve(x,E):E;if(k=x.state,!x.output||!x.input&&x.avail_in!==0||k.status===666&&fe!==f)return ve(x,x.avail_out===0?-5:E);if(k.strm=x,he=k.last_flush,k.last_flush=fe,k.status===O)if(k.wrap===2)x.adler=0,Me(k,31),Me(k,139),Me(k,8),k.gzhead?(Me(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),Me(k,255&k.gzhead.time),Me(k,k.gzhead.time>>8&255),Me(k,k.gzhead.time>>16&255),Me(k,k.gzhead.time>>24&255),Me(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),Me(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(Me(k,255&k.gzhead.extra.length),Me(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(x.adler=c(x.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(Me(k,0),Me(k,0),Me(k,0),Me(k,0),Me(k,0),Me(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),Me(k,3),k.status=V);else{var Ee=I+(k.w_bits-8<<4)<<8;Ee|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(Ee|=32),Ee+=31-Ee%31,k.status=V,Oe(k,Ee),k.strstart!==0&&(Oe(k,x.adler>>>16),Oe(k,65535&x.adler)),x.adler=1}if(k.status===69)if(k.gzhead.extra){for(U=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>U&&(x.adler=c(x.adler,k.pending_buf,k.pending-U,U)),oe(x),U=k.pending,k.pending!==k.pending_buf_size));)Me(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>U&&(x.adler=c(x.adler,k.pending_buf,k.pending-U,U)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){U=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>U&&(x.adler=c(x.adler,k.pending_buf,k.pending-U,U)),oe(x),U=k.pending,k.pending===k.pending_buf_size)){q=1;break}q=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,Me(k,q)}while(q!==0);k.gzhead.hcrc&&k.pending>U&&(x.adler=c(x.adler,k.pending_buf,k.pending-U,U)),q===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){U=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>U&&(x.adler=c(x.adler,k.pending_buf,k.pending-U,U)),oe(x),U=k.pending,k.pending===k.pending_buf_size)){q=1;break}q=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,Me(k,q)}while(q!==0);k.gzhead.hcrc&&k.pending>U&&(x.adler=c(x.adler,k.pending_buf,k.pending-U,U)),q===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&oe(x),k.pending+2<=k.pending_buf_size&&(Me(k,255&x.adler),Me(k,x.adler>>8&255),x.adler=0,k.status=V)):k.status=V),k.pending!==0){if(oe(x),x.avail_out===0)return k.last_flush=-1,m}else if(x.avail_in===0&&ue(fe)<=ue(he)&&fe!==f)return ve(x,-5);if(k.status===666&&x.avail_in!==0)return ve(x,-5);if(x.avail_in!==0||k.lookahead!==0||fe!==d&&k.status!==666){var ge=k.strategy===2?function(se,Ie){for(var Pe;;){if(se.lookahead===0&&(it(se),se.lookahead===0)){if(Ie===d)return T;break}if(se.match_length=0,Pe=o._tr_tally(se,0,se.window[se.strstart]),se.lookahead--,se.strstart++,Pe&&(re(se,!1),se.strm.avail_out===0))return T}return se.insert=0,Ie===f?(re(se,!0),se.strm.avail_out===0?de:ie):se.last_lit&&(re(se,!1),se.strm.avail_out===0)?T:J}(k,fe):k.strategy===3?function(se,Ie){for(var Pe,Te,Ue,st,We=se.window;;){if(se.lookahead<=G){if(it(se),se.lookahead<=G&&Ie===d)return T;if(se.lookahead===0)break}if(se.match_length=0,se.lookahead>=N&&0<se.strstart&&(Te=We[Ue=se.strstart-1])===We[++Ue]&&Te===We[++Ue]&&Te===We[++Ue]){st=se.strstart+G;do;while(Te===We[++Ue]&&Te===We[++Ue]&&Te===We[++Ue]&&Te===We[++Ue]&&Te===We[++Ue]&&Te===We[++Ue]&&Te===We[++Ue]&&Te===We[++Ue]&&Ue<st);se.match_length=G-(st-Ue),se.match_length>se.lookahead&&(se.match_length=se.lookahead)}if(se.match_length>=N?(Pe=o._tr_tally(se,1,se.match_length-N),se.lookahead-=se.match_length,se.strstart+=se.match_length,se.match_length=0):(Pe=o._tr_tally(se,0,se.window[se.strstart]),se.lookahead--,se.strstart++),Pe&&(re(se,!1),se.strm.avail_out===0))return T}return se.insert=0,Ie===f?(re(se,!0),se.strm.avail_out===0?de:ie):se.last_lit&&(re(se,!1),se.strm.avail_out===0)?T:J}(k,fe):n[k.level].func(k,fe);if(ge!==de&&ge!==ie||(k.status=666),ge===T||ge===de)return x.avail_out===0&&(k.last_flush=-1),m;if(ge===J&&(fe===1?o._tr_align(k):fe!==5&&(o._tr_stored_block(k,0,0,!1),fe===3&&(De(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),oe(x),x.avail_out===0))return k.last_flush=-1,m}return fe!==f?m:k.wrap<=0?1:(k.wrap===2?(Me(k,255&x.adler),Me(k,x.adler>>8&255),Me(k,x.adler>>16&255),Me(k,x.adler>>24&255),Me(k,255&x.total_in),Me(k,x.total_in>>8&255),Me(k,x.total_in>>16&255),Me(k,x.total_in>>24&255)):(Oe(k,x.adler>>>16),Oe(k,65535&x.adler)),oe(x),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?m:1)},s.deflateEnd=function(x){var fe;return x&&x.state?(fe=x.state.status)!==O&&fe!==69&&fe!==73&&fe!==91&&fe!==103&&fe!==V&&fe!==666?ve(x,E):(x.state=null,fe===V?ve(x,-3):m):E},s.deflateSetDictionary=function(x,fe){var he,k,U,q,Ee,ge,se,Ie,Pe=fe.length;if(!x||!x.state||(q=(he=x.state).wrap)===2||q===1&&he.status!==O||he.lookahead)return E;for(q===1&&(x.adler=a(x.adler,fe,Pe,0)),he.wrap=0,Pe>=he.w_size&&(q===0&&(De(he.head),he.strstart=0,he.block_start=0,he.insert=0),Ie=new r.Buf8(he.w_size),r.arraySet(Ie,fe,Pe-he.w_size,he.w_size,0),fe=Ie,Pe=he.w_size),Ee=x.avail_in,ge=x.next_in,se=x.input,x.avail_in=Pe,x.next_in=0,x.input=fe,it(he);he.lookahead>=N;){for(k=he.strstart,U=he.lookahead-(N-1);he.ins_h=(he.ins_h<<he.hash_shift^he.window[k+N-1])&he.hash_mask,he.prev[k&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=k,k++,--U;);he.strstart=k,he.lookahead=N-1,it(he)}return he.strstart+=he.lookahead,he.block_start=he.strstart,he.insert=he.lookahead,he.lookahead=0,he.match_length=he.prev_length=N-1,he.match_available=0,x.next_in=ge,x.input=se,x.avail_in=Ee,he.wrap=q,m},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,s){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,s){i.exports=function(n,r){var o,a,c,u,d,f,m,E,g,w,y,I,_,C,F,M,D,B,N,G,Q,O,V,T,J;o=n.state,a=n.next_in,T=n.input,c=a+(n.avail_in-5),u=n.next_out,J=n.output,d=u-(r-n.avail_out),f=u+(n.avail_out-257),m=o.dmax,E=o.wsize,g=o.whave,w=o.wnext,y=o.window,I=o.hold,_=o.bits,C=o.lencode,F=o.distcode,M=(1<<o.lenbits)-1,D=(1<<o.distbits)-1;e:do{_<15&&(I+=T[a++]<<_,_+=8,I+=T[a++]<<_,_+=8),B=C[I&M];t:for(;;){if(I>>>=N=B>>>24,_-=N,(N=B>>>16&255)===0)J[u++]=65535&B;else{if(!(16&N)){if(!(64&N)){B=C[(65535&B)+(I&(1<<N)-1)];continue t}if(32&N){o.mode=12;break e}n.msg="invalid literal/length code",o.mode=30;break e}G=65535&B,(N&=15)&&(_<N&&(I+=T[a++]<<_,_+=8),G+=I&(1<<N)-1,I>>>=N,_-=N),_<15&&(I+=T[a++]<<_,_+=8,I+=T[a++]<<_,_+=8),B=F[I&D];i:for(;;){if(I>>>=N=B>>>24,_-=N,!(16&(N=B>>>16&255))){if(!(64&N)){B=F[(65535&B)+(I&(1<<N)-1)];continue i}n.msg="invalid distance code",o.mode=30;break e}if(Q=65535&B,_<(N&=15)&&(I+=T[a++]<<_,(_+=8)<N&&(I+=T[a++]<<_,_+=8)),m<(Q+=I&(1<<N)-1)){n.msg="invalid distance too far back",o.mode=30;break e}if(I>>>=N,_-=N,(N=u-d)<Q){if(g<(N=Q-N)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break e}if(V=y,(O=0)===w){if(O+=E-N,N<G){for(G-=N;J[u++]=y[O++],--N;);O=u-Q,V=J}}else if(w<N){if(O+=E+w-N,(N-=w)<G){for(G-=N;J[u++]=y[O++],--N;);if(O=0,w<G){for(G-=N=w;J[u++]=y[O++],--N;);O=u-Q,V=J}}}else if(O+=w-N,N<G){for(G-=N;J[u++]=y[O++],--N;);O=u-Q,V=J}for(;2<G;)J[u++]=V[O++],J[u++]=V[O++],J[u++]=V[O++],G-=3;G&&(J[u++]=V[O++],1<G&&(J[u++]=V[O++]))}else{for(O=u-Q;J[u++]=J[O++],J[u++]=J[O++],J[u++]=J[O++],2<(G-=3););G&&(J[u++]=J[O++],1<G&&(J[u++]=J[O++]))}break}}break}}while(a<c&&u<f);a-=G=_>>3,I&=(1<<(_-=G<<3))-1,n.next_in=a,n.next_out=u,n.avail_in=a<c?c-a+5:5-(a-c),n.avail_out=u<f?f-u+257:257-(u-f),o.hold=I,o.bits=_}},{}],49:[function(t,i,s){var n=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),a=t("./inffast"),c=t("./inftrees"),u=1,d=2,f=0,m=-2,E=1,g=852,w=592;function y(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function I(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function _(O){var V;return O&&O.state?(V=O.state,O.total_in=O.total_out=V.total=0,O.msg="",V.wrap&&(O.adler=1&V.wrap),V.mode=E,V.last=0,V.havedict=0,V.dmax=32768,V.head=null,V.hold=0,V.bits=0,V.lencode=V.lendyn=new n.Buf32(g),V.distcode=V.distdyn=new n.Buf32(w),V.sane=1,V.back=-1,f):m}function C(O){var V;return O&&O.state?((V=O.state).wsize=0,V.whave=0,V.wnext=0,_(O)):m}function F(O,V){var T,J;return O&&O.state?(J=O.state,V<0?(T=0,V=-V):(T=1+(V>>4),V<48&&(V&=15)),V&&(V<8||15<V)?m:(J.window!==null&&J.wbits!==V&&(J.window=null),J.wrap=T,J.wbits=V,C(O))):m}function M(O,V){var T,J;return O?(J=new I,(O.state=J).window=null,(T=F(O,V))!==f&&(O.state=null),T):m}var D,B,N=!0;function G(O){if(N){var V;for(D=new n.Buf32(512),B=new n.Buf32(32),V=0;V<144;)O.lens[V++]=8;for(;V<256;)O.lens[V++]=9;for(;V<280;)O.lens[V++]=7;for(;V<288;)O.lens[V++]=8;for(c(u,O.lens,0,288,D,0,O.work,{bits:9}),V=0;V<32;)O.lens[V++]=5;c(d,O.lens,0,32,B,0,O.work,{bits:5}),N=!1}O.lencode=D,O.lenbits=9,O.distcode=B,O.distbits=5}function Q(O,V,T,J){var de,ie=O.state;return ie.window===null&&(ie.wsize=1<<ie.wbits,ie.wnext=0,ie.whave=0,ie.window=new n.Buf8(ie.wsize)),J>=ie.wsize?(n.arraySet(ie.window,V,T-ie.wsize,ie.wsize,0),ie.wnext=0,ie.whave=ie.wsize):(J<(de=ie.wsize-ie.wnext)&&(de=J),n.arraySet(ie.window,V,T-J,de,ie.wnext),(J-=de)?(n.arraySet(ie.window,V,T-J,J,0),ie.wnext=J,ie.whave=ie.wsize):(ie.wnext+=de,ie.wnext===ie.wsize&&(ie.wnext=0),ie.whave<ie.wsize&&(ie.whave+=de))),0}s.inflateReset=C,s.inflateReset2=F,s.inflateResetKeep=_,s.inflateInit=function(O){return M(O,15)},s.inflateInit2=M,s.inflate=function(O,V){var T,J,de,ie,ve,ue,De,oe,re,Me,Oe,xe,it,at,Be,ye,Ye,Je,He,vt,x,fe,he,k,U=0,q=new n.Buf8(4),Ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return m;(T=O.state).mode===12&&(T.mode=13),ve=O.next_out,de=O.output,De=O.avail_out,ie=O.next_in,J=O.input,ue=O.avail_in,oe=T.hold,re=T.bits,Me=ue,Oe=De,fe=f;e:for(;;)switch(T.mode){case E:if(T.wrap===0){T.mode=13;break}for(;re<16;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(2&T.wrap&&oe===35615){q[T.check=0]=255&oe,q[1]=oe>>>8&255,T.check=o(T.check,q,2,0),re=oe=0,T.mode=2;break}if(T.flags=0,T.head&&(T.head.done=!1),!(1&T.wrap)||(((255&oe)<<8)+(oe>>8))%31){O.msg="incorrect header check",T.mode=30;break}if((15&oe)!=8){O.msg="unknown compression method",T.mode=30;break}if(re-=4,x=8+(15&(oe>>>=4)),T.wbits===0)T.wbits=x;else if(x>T.wbits){O.msg="invalid window size",T.mode=30;break}T.dmax=1<<x,O.adler=T.check=1,T.mode=512&oe?10:12,re=oe=0;break;case 2:for(;re<16;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(T.flags=oe,(255&T.flags)!=8){O.msg="unknown compression method",T.mode=30;break}if(57344&T.flags){O.msg="unknown header flags set",T.mode=30;break}T.head&&(T.head.text=oe>>8&1),512&T.flags&&(q[0]=255&oe,q[1]=oe>>>8&255,T.check=o(T.check,q,2,0)),re=oe=0,T.mode=3;case 3:for(;re<32;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}T.head&&(T.head.time=oe),512&T.flags&&(q[0]=255&oe,q[1]=oe>>>8&255,q[2]=oe>>>16&255,q[3]=oe>>>24&255,T.check=o(T.check,q,4,0)),re=oe=0,T.mode=4;case 4:for(;re<16;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}T.head&&(T.head.xflags=255&oe,T.head.os=oe>>8),512&T.flags&&(q[0]=255&oe,q[1]=oe>>>8&255,T.check=o(T.check,q,2,0)),re=oe=0,T.mode=5;case 5:if(1024&T.flags){for(;re<16;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}T.length=oe,T.head&&(T.head.extra_len=oe),512&T.flags&&(q[0]=255&oe,q[1]=oe>>>8&255,T.check=o(T.check,q,2,0)),re=oe=0}else T.head&&(T.head.extra=null);T.mode=6;case 6:if(1024&T.flags&&(ue<(xe=T.length)&&(xe=ue),xe&&(T.head&&(x=T.head.extra_len-T.length,T.head.extra||(T.head.extra=new Array(T.head.extra_len)),n.arraySet(T.head.extra,J,ie,xe,x)),512&T.flags&&(T.check=o(T.check,J,xe,ie)),ue-=xe,ie+=xe,T.length-=xe),T.length))break e;T.length=0,T.mode=7;case 7:if(2048&T.flags){if(ue===0)break e;for(xe=0;x=J[ie+xe++],T.head&&x&&T.length<65536&&(T.head.name+=String.fromCharCode(x)),x&&xe<ue;);if(512&T.flags&&(T.check=o(T.check,J,xe,ie)),ue-=xe,ie+=xe,x)break e}else T.head&&(T.head.name=null);T.length=0,T.mode=8;case 8:if(4096&T.flags){if(ue===0)break e;for(xe=0;x=J[ie+xe++],T.head&&x&&T.length<65536&&(T.head.comment+=String.fromCharCode(x)),x&&xe<ue;);if(512&T.flags&&(T.check=o(T.check,J,xe,ie)),ue-=xe,ie+=xe,x)break e}else T.head&&(T.head.comment=null);T.mode=9;case 9:if(512&T.flags){for(;re<16;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(oe!==(65535&T.check)){O.msg="header crc mismatch",T.mode=30;break}re=oe=0}T.head&&(T.head.hcrc=T.flags>>9&1,T.head.done=!0),O.adler=T.check=0,T.mode=12;break;case 10:for(;re<32;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}O.adler=T.check=y(oe),re=oe=0,T.mode=11;case 11:if(T.havedict===0)return O.next_out=ve,O.avail_out=De,O.next_in=ie,O.avail_in=ue,T.hold=oe,T.bits=re,2;O.adler=T.check=1,T.mode=12;case 12:if(V===5||V===6)break e;case 13:if(T.last){oe>>>=7&re,re-=7&re,T.mode=27;break}for(;re<3;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}switch(T.last=1&oe,re-=1,3&(oe>>>=1)){case 0:T.mode=14;break;case 1:if(G(T),T.mode=20,V!==6)break;oe>>>=2,re-=2;break e;case 2:T.mode=17;break;case 3:O.msg="invalid block type",T.mode=30}oe>>>=2,re-=2;break;case 14:for(oe>>>=7&re,re-=7&re;re<32;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if((65535&oe)!=(oe>>>16^65535)){O.msg="invalid stored block lengths",T.mode=30;break}if(T.length=65535&oe,re=oe=0,T.mode=15,V===6)break e;case 15:T.mode=16;case 16:if(xe=T.length){if(ue<xe&&(xe=ue),De<xe&&(xe=De),xe===0)break e;n.arraySet(de,J,ie,xe,ve),ue-=xe,ie+=xe,De-=xe,ve+=xe,T.length-=xe;break}T.mode=12;break;case 17:for(;re<14;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(T.nlen=257+(31&oe),oe>>>=5,re-=5,T.ndist=1+(31&oe),oe>>>=5,re-=5,T.ncode=4+(15&oe),oe>>>=4,re-=4,286<T.nlen||30<T.ndist){O.msg="too many length or distance symbols",T.mode=30;break}T.have=0,T.mode=18;case 18:for(;T.have<T.ncode;){for(;re<3;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}T.lens[Ee[T.have++]]=7&oe,oe>>>=3,re-=3}for(;T.have<19;)T.lens[Ee[T.have++]]=0;if(T.lencode=T.lendyn,T.lenbits=7,he={bits:T.lenbits},fe=c(0,T.lens,0,19,T.lencode,0,T.work,he),T.lenbits=he.bits,fe){O.msg="invalid code lengths set",T.mode=30;break}T.have=0,T.mode=19;case 19:for(;T.have<T.nlen+T.ndist;){for(;ye=(U=T.lencode[oe&(1<<T.lenbits)-1])>>>16&255,Ye=65535&U,!((Be=U>>>24)<=re);){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(Ye<16)oe>>>=Be,re-=Be,T.lens[T.have++]=Ye;else{if(Ye===16){for(k=Be+2;re<k;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(oe>>>=Be,re-=Be,T.have===0){O.msg="invalid bit length repeat",T.mode=30;break}x=T.lens[T.have-1],xe=3+(3&oe),oe>>>=2,re-=2}else if(Ye===17){for(k=Be+3;re<k;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}re-=Be,x=0,xe=3+(7&(oe>>>=Be)),oe>>>=3,re-=3}else{for(k=Be+7;re<k;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}re-=Be,x=0,xe=11+(127&(oe>>>=Be)),oe>>>=7,re-=7}if(T.have+xe>T.nlen+T.ndist){O.msg="invalid bit length repeat",T.mode=30;break}for(;xe--;)T.lens[T.have++]=x}}if(T.mode===30)break;if(T.lens[256]===0){O.msg="invalid code -- missing end-of-block",T.mode=30;break}if(T.lenbits=9,he={bits:T.lenbits},fe=c(u,T.lens,0,T.nlen,T.lencode,0,T.work,he),T.lenbits=he.bits,fe){O.msg="invalid literal/lengths set",T.mode=30;break}if(T.distbits=6,T.distcode=T.distdyn,he={bits:T.distbits},fe=c(d,T.lens,T.nlen,T.ndist,T.distcode,0,T.work,he),T.distbits=he.bits,fe){O.msg="invalid distances set",T.mode=30;break}if(T.mode=20,V===6)break e;case 20:T.mode=21;case 21:if(6<=ue&&258<=De){O.next_out=ve,O.avail_out=De,O.next_in=ie,O.avail_in=ue,T.hold=oe,T.bits=re,a(O,Oe),ve=O.next_out,de=O.output,De=O.avail_out,ie=O.next_in,J=O.input,ue=O.avail_in,oe=T.hold,re=T.bits,T.mode===12&&(T.back=-1);break}for(T.back=0;ye=(U=T.lencode[oe&(1<<T.lenbits)-1])>>>16&255,Ye=65535&U,!((Be=U>>>24)<=re);){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(ye&&!(240&ye)){for(Je=Be,He=ye,vt=Ye;ye=(U=T.lencode[vt+((oe&(1<<Je+He)-1)>>Je)])>>>16&255,Ye=65535&U,!(Je+(Be=U>>>24)<=re);){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}oe>>>=Je,re-=Je,T.back+=Je}if(oe>>>=Be,re-=Be,T.back+=Be,T.length=Ye,ye===0){T.mode=26;break}if(32&ye){T.back=-1,T.mode=12;break}if(64&ye){O.msg="invalid literal/length code",T.mode=30;break}T.extra=15&ye,T.mode=22;case 22:if(T.extra){for(k=T.extra;re<k;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}T.length+=oe&(1<<T.extra)-1,oe>>>=T.extra,re-=T.extra,T.back+=T.extra}T.was=T.length,T.mode=23;case 23:for(;ye=(U=T.distcode[oe&(1<<T.distbits)-1])>>>16&255,Ye=65535&U,!((Be=U>>>24)<=re);){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(!(240&ye)){for(Je=Be,He=ye,vt=Ye;ye=(U=T.distcode[vt+((oe&(1<<Je+He)-1)>>Je)])>>>16&255,Ye=65535&U,!(Je+(Be=U>>>24)<=re);){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}oe>>>=Je,re-=Je,T.back+=Je}if(oe>>>=Be,re-=Be,T.back+=Be,64&ye){O.msg="invalid distance code",T.mode=30;break}T.offset=Ye,T.extra=15&ye,T.mode=24;case 24:if(T.extra){for(k=T.extra;re<k;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}T.offset+=oe&(1<<T.extra)-1,oe>>>=T.extra,re-=T.extra,T.back+=T.extra}if(T.offset>T.dmax){O.msg="invalid distance too far back",T.mode=30;break}T.mode=25;case 25:if(De===0)break e;if(xe=Oe-De,T.offset>xe){if((xe=T.offset-xe)>T.whave&&T.sane){O.msg="invalid distance too far back",T.mode=30;break}it=xe>T.wnext?(xe-=T.wnext,T.wsize-xe):T.wnext-xe,xe>T.length&&(xe=T.length),at=T.window}else at=de,it=ve-T.offset,xe=T.length;for(De<xe&&(xe=De),De-=xe,T.length-=xe;de[ve++]=at[it++],--xe;);T.length===0&&(T.mode=21);break;case 26:if(De===0)break e;de[ve++]=T.length,De--,T.mode=21;break;case 27:if(T.wrap){for(;re<32;){if(ue===0)break e;ue--,oe|=J[ie++]<<re,re+=8}if(Oe-=De,O.total_out+=Oe,T.total+=Oe,Oe&&(O.adler=T.check=T.flags?o(T.check,de,Oe,ve-Oe):r(T.check,de,Oe,ve-Oe)),Oe=De,(T.flags?oe:y(oe))!==T.check){O.msg="incorrect data check",T.mode=30;break}re=oe=0}T.mode=28;case 28:if(T.wrap&&T.flags){for(;re<32;){if(ue===0)break e;ue--,oe+=J[ie++]<<re,re+=8}if(oe!==(4294967295&T.total)){O.msg="incorrect length check",T.mode=30;break}re=oe=0}T.mode=29;case 29:fe=1;break e;case 30:fe=-3;break e;case 31:return-4;case 32:default:return m}return O.next_out=ve,O.avail_out=De,O.next_in=ie,O.avail_in=ue,T.hold=oe,T.bits=re,(T.wsize||Oe!==O.avail_out&&T.mode<30&&(T.mode<27||V!==4))&&Q(O,O.output,O.next_out,Oe-O.avail_out)?(T.mode=31,-4):(Me-=O.avail_in,Oe-=O.avail_out,O.total_in+=Me,O.total_out+=Oe,T.total+=Oe,T.wrap&&Oe&&(O.adler=T.check=T.flags?o(T.check,de,Oe,O.next_out-Oe):r(T.check,de,Oe,O.next_out-Oe)),O.data_type=T.bits+(T.last?64:0)+(T.mode===12?128:0)+(T.mode===20||T.mode===15?256:0),(Me==0&&Oe===0||V===4)&&fe===f&&(fe=-5),fe)},s.inflateEnd=function(O){if(!O||!O.state)return m;var V=O.state;return V.window&&(V.window=null),O.state=null,f},s.inflateGetHeader=function(O,V){var T;return O&&O.state&&2&(T=O.state).wrap?((T.head=V).done=!1,f):m},s.inflateSetDictionary=function(O,V){var T,J=V.length;return O&&O.state?(T=O.state).wrap!==0&&T.mode!==11?m:T.mode===11&&r(1,V,J,0)!==T.check?-3:Q(O,V,J,J)?(T.mode=31,-4):(T.havedict=1,f):m},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,s){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(u,d,f,m,E,g,w,y){var I,_,C,F,M,D,B,N,G,Q=y.bits,O=0,V=0,T=0,J=0,de=0,ie=0,ve=0,ue=0,De=0,oe=0,re=null,Me=0,Oe=new n.Buf16(16),xe=new n.Buf16(16),it=null,at=0;for(O=0;O<=15;O++)Oe[O]=0;for(V=0;V<m;V++)Oe[d[f+V]]++;for(de=Q,J=15;1<=J&&Oe[J]===0;J--);if(J<de&&(de=J),J===0)return E[g++]=20971520,E[g++]=20971520,y.bits=1,0;for(T=1;T<J&&Oe[T]===0;T++);for(de<T&&(de=T),O=ue=1;O<=15;O++)if(ue<<=1,(ue-=Oe[O])<0)return-1;if(0<ue&&(u===0||J!==1))return-1;for(xe[1]=0,O=1;O<15;O++)xe[O+1]=xe[O]+Oe[O];for(V=0;V<m;V++)d[f+V]!==0&&(w[xe[d[f+V]]++]=V);if(D=u===0?(re=it=w,19):u===1?(re=r,Me-=257,it=o,at-=257,256):(re=a,it=c,-1),O=T,M=g,ve=V=oe=0,C=-1,F=(De=1<<(ie=de))-1,u===1&&852<De||u===2&&592<De)return 1;for(;;){for(B=O-ve,G=w[V]<D?(N=0,w[V]):w[V]>D?(N=it[at+w[V]],re[Me+w[V]]):(N=96,0),I=1<<O-ve,T=_=1<<ie;E[M+(oe>>ve)+(_-=I)]=B<<24|N<<16|G|0,_!==0;);for(I=1<<O-1;oe&I;)I>>=1;if(I!==0?(oe&=I-1,oe+=I):oe=0,V++,--Oe[O]==0){if(O===J)break;O=d[f+w[V]]}if(de<O&&(oe&F)!==C){for(ve===0&&(ve=de),M+=T,ue=1<<(ie=O-ve);ie+ve<J&&!((ue-=Oe[ie+ve])<=0);)ie++,ue<<=1;if(De+=1<<ie,u===1&&852<De||u===2&&592<De)return 1;E[C=oe&F]=de<<24|ie<<16|M-g|0}}return oe!==0&&(E[M+oe]=O-ve<<24|64<<16|0),y.bits=de,0}},{"../utils/common":41}],51:[function(t,i,s){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,s){var n=t("../utils/common"),r=0,o=1;function a(U){for(var q=U.length;0<=--q;)U[q]=0}var c=0,u=29,d=256,f=d+1+u,m=30,E=19,g=2*f+1,w=15,y=16,I=7,_=256,C=16,F=17,M=18,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Q=new Array(2*(f+2));a(Q);var O=new Array(2*m);a(O);var V=new Array(512);a(V);var T=new Array(256);a(T);var J=new Array(u);a(J);var de,ie,ve,ue=new Array(m);function De(U,q,Ee,ge,se){this.static_tree=U,this.extra_bits=q,this.extra_base=Ee,this.elems=ge,this.max_length=se,this.has_stree=U&&U.length}function oe(U,q){this.dyn_tree=U,this.max_code=0,this.stat_desc=q}function re(U){return U<256?V[U]:V[256+(U>>>7)]}function Me(U,q){U.pending_buf[U.pending++]=255&q,U.pending_buf[U.pending++]=q>>>8&255}function Oe(U,q,Ee){U.bi_valid>y-Ee?(U.bi_buf|=q<<U.bi_valid&65535,Me(U,U.bi_buf),U.bi_buf=q>>y-U.bi_valid,U.bi_valid+=Ee-y):(U.bi_buf|=q<<U.bi_valid&65535,U.bi_valid+=Ee)}function xe(U,q,Ee){Oe(U,Ee[2*q],Ee[2*q+1])}function it(U,q){for(var Ee=0;Ee|=1&U,U>>>=1,Ee<<=1,0<--q;);return Ee>>>1}function at(U,q,Ee){var ge,se,Ie=new Array(w+1),Pe=0;for(ge=1;ge<=w;ge++)Ie[ge]=Pe=Pe+Ee[ge-1]<<1;for(se=0;se<=q;se++){var Te=U[2*se+1];Te!==0&&(U[2*se]=it(Ie[Te]++,Te))}}function Be(U){var q;for(q=0;q<f;q++)U.dyn_ltree[2*q]=0;for(q=0;q<m;q++)U.dyn_dtree[2*q]=0;for(q=0;q<E;q++)U.bl_tree[2*q]=0;U.dyn_ltree[2*_]=1,U.opt_len=U.static_len=0,U.last_lit=U.matches=0}function ye(U){8<U.bi_valid?Me(U,U.bi_buf):0<U.bi_valid&&(U.pending_buf[U.pending++]=U.bi_buf),U.bi_buf=0,U.bi_valid=0}function Ye(U,q,Ee,ge){var se=2*q,Ie=2*Ee;return U[se]<U[Ie]||U[se]===U[Ie]&&ge[q]<=ge[Ee]}function Je(U,q,Ee){for(var ge=U.heap[Ee],se=Ee<<1;se<=U.heap_len&&(se<U.heap_len&&Ye(q,U.heap[se+1],U.heap[se],U.depth)&&se++,!Ye(q,ge,U.heap[se],U.depth));)U.heap[Ee]=U.heap[se],Ee=se,se<<=1;U.heap[Ee]=ge}function He(U,q,Ee){var ge,se,Ie,Pe,Te=0;if(U.last_lit!==0)for(;ge=U.pending_buf[U.d_buf+2*Te]<<8|U.pending_buf[U.d_buf+2*Te+1],se=U.pending_buf[U.l_buf+Te],Te++,ge===0?xe(U,se,q):(xe(U,(Ie=T[se])+d+1,q),(Pe=D[Ie])!==0&&Oe(U,se-=J[Ie],Pe),xe(U,Ie=re(--ge),Ee),(Pe=B[Ie])!==0&&Oe(U,ge-=ue[Ie],Pe)),Te<U.last_lit;);xe(U,_,q)}function vt(U,q){var Ee,ge,se,Ie=q.dyn_tree,Pe=q.stat_desc.static_tree,Te=q.stat_desc.has_stree,Ue=q.stat_desc.elems,st=-1;for(U.heap_len=0,U.heap_max=g,Ee=0;Ee<Ue;Ee++)Ie[2*Ee]!==0?(U.heap[++U.heap_len]=st=Ee,U.depth[Ee]=0):Ie[2*Ee+1]=0;for(;U.heap_len<2;)Ie[2*(se=U.heap[++U.heap_len]=st<2?++st:0)]=1,U.depth[se]=0,U.opt_len--,Te&&(U.static_len-=Pe[2*se+1]);for(q.max_code=st,Ee=U.heap_len>>1;1<=Ee;Ee--)Je(U,Ie,Ee);for(se=Ue;Ee=U.heap[1],U.heap[1]=U.heap[U.heap_len--],Je(U,Ie,1),ge=U.heap[1],U.heap[--U.heap_max]=Ee,U.heap[--U.heap_max]=ge,Ie[2*se]=Ie[2*Ee]+Ie[2*ge],U.depth[se]=(U.depth[Ee]>=U.depth[ge]?U.depth[Ee]:U.depth[ge])+1,Ie[2*Ee+1]=Ie[2*ge+1]=se,U.heap[1]=se++,Je(U,Ie,1),2<=U.heap_len;);U.heap[--U.heap_max]=U.heap[1],function(We,Pt){var gi,Tt,Ei,ct,Xt,Le,Bt=Pt.dyn_tree,vi=Pt.max_code,Ss=Pt.stat_desc.static_tree,Se=Pt.stat_desc.has_stree,pn=Pt.stat_desc.extra_bits,mn=Pt.stat_desc.extra_base,Fi=Pt.stat_desc.max_length,as=0;for(ct=0;ct<=w;ct++)We.bl_count[ct]=0;for(Bt[2*We.heap[We.heap_max]+1]=0,gi=We.heap_max+1;gi<g;gi++)Fi<(ct=Bt[2*Bt[2*(Tt=We.heap[gi])+1]+1]+1)&&(ct=Fi,as++),Bt[2*Tt+1]=ct,vi<Tt||(We.bl_count[ct]++,Xt=0,mn<=Tt&&(Xt=pn[Tt-mn]),Le=Bt[2*Tt],We.opt_len+=Le*(ct+Xt),Se&&(We.static_len+=Le*(Ss[2*Tt+1]+Xt)));if(as!==0){do{for(ct=Fi-1;We.bl_count[ct]===0;)ct--;We.bl_count[ct]--,We.bl_count[ct+1]+=2,We.bl_count[Fi]--,as-=2}while(0<as);for(ct=Fi;ct!==0;ct--)for(Tt=We.bl_count[ct];Tt!==0;)vi<(Ei=We.heap[--gi])||(Bt[2*Ei+1]!==ct&&(We.opt_len+=(ct-Bt[2*Ei+1])*Bt[2*Ei],Bt[2*Ei+1]=ct),Tt--)}}(U,q),at(Ie,st,U.bl_count)}function x(U,q,Ee){var ge,se,Ie=-1,Pe=q[1],Te=0,Ue=7,st=4;for(Pe===0&&(Ue=138,st=3),q[2*(Ee+1)+1]=65535,ge=0;ge<=Ee;ge++)se=Pe,Pe=q[2*(ge+1)+1],++Te<Ue&&se===Pe||(Te<st?U.bl_tree[2*se]+=Te:se!==0?(se!==Ie&&U.bl_tree[2*se]++,U.bl_tree[2*C]++):Te<=10?U.bl_tree[2*F]++:U.bl_tree[2*M]++,Ie=se,st=(Te=0)===Pe?(Ue=138,3):se===Pe?(Ue=6,3):(Ue=7,4))}function fe(U,q,Ee){var ge,se,Ie=-1,Pe=q[1],Te=0,Ue=7,st=4;for(Pe===0&&(Ue=138,st=3),ge=0;ge<=Ee;ge++)if(se=Pe,Pe=q[2*(ge+1)+1],!(++Te<Ue&&se===Pe)){if(Te<st)for(;xe(U,se,U.bl_tree),--Te!=0;);else se!==0?(se!==Ie&&(xe(U,se,U.bl_tree),Te--),xe(U,C,U.bl_tree),Oe(U,Te-3,2)):Te<=10?(xe(U,F,U.bl_tree),Oe(U,Te-3,3)):(xe(U,M,U.bl_tree),Oe(U,Te-11,7));Ie=se,st=(Te=0)===Pe?(Ue=138,3):se===Pe?(Ue=6,3):(Ue=7,4)}}a(ue);var he=!1;function k(U,q,Ee,ge){Oe(U,(c<<1)+(ge?1:0),3),function(se,Ie,Pe,Te){ye(se),Me(se,Pe),Me(se,~Pe),n.arraySet(se.pending_buf,se.window,Ie,Pe,se.pending),se.pending+=Pe}(U,q,Ee)}s._tr_init=function(U){he||(function(){var q,Ee,ge,se,Ie,Pe=new Array(w+1);for(se=ge=0;se<u-1;se++)for(J[se]=ge,q=0;q<1<<D[se];q++)T[ge++]=se;for(T[ge-1]=se,se=Ie=0;se<16;se++)for(ue[se]=Ie,q=0;q<1<<B[se];q++)V[Ie++]=se;for(Ie>>=7;se<m;se++)for(ue[se]=Ie<<7,q=0;q<1<<B[se]-7;q++)V[256+Ie++]=se;for(Ee=0;Ee<=w;Ee++)Pe[Ee]=0;for(q=0;q<=143;)Q[2*q+1]=8,q++,Pe[8]++;for(;q<=255;)Q[2*q+1]=9,q++,Pe[9]++;for(;q<=279;)Q[2*q+1]=7,q++,Pe[7]++;for(;q<=287;)Q[2*q+1]=8,q++,Pe[8]++;for(at(Q,f+1,Pe),q=0;q<m;q++)O[2*q+1]=5,O[2*q]=it(q,5);de=new De(Q,D,d+1,f,w),ie=new De(O,B,0,m,w),ve=new De(new Array(0),N,0,E,I)}(),he=!0),U.l_desc=new oe(U.dyn_ltree,de),U.d_desc=new oe(U.dyn_dtree,ie),U.bl_desc=new oe(U.bl_tree,ve),U.bi_buf=0,U.bi_valid=0,Be(U)},s._tr_stored_block=k,s._tr_flush_block=function(U,q,Ee,ge){var se,Ie,Pe=0;0<U.level?(U.strm.data_type===2&&(U.strm.data_type=function(Te){var Ue,st=4093624447;for(Ue=0;Ue<=31;Ue++,st>>>=1)if(1&st&&Te.dyn_ltree[2*Ue]!==0)return r;if(Te.dyn_ltree[18]!==0||Te.dyn_ltree[20]!==0||Te.dyn_ltree[26]!==0)return o;for(Ue=32;Ue<d;Ue++)if(Te.dyn_ltree[2*Ue]!==0)return o;return r}(U)),vt(U,U.l_desc),vt(U,U.d_desc),Pe=function(Te){var Ue;for(x(Te,Te.dyn_ltree,Te.l_desc.max_code),x(Te,Te.dyn_dtree,Te.d_desc.max_code),vt(Te,Te.bl_desc),Ue=E-1;3<=Ue&&Te.bl_tree[2*G[Ue]+1]===0;Ue--);return Te.opt_len+=3*(Ue+1)+5+5+4,Ue}(U),se=U.opt_len+3+7>>>3,(Ie=U.static_len+3+7>>>3)<=se&&(se=Ie)):se=Ie=Ee+5,Ee+4<=se&&q!==-1?k(U,q,Ee,ge):U.strategy===4||Ie===se?(Oe(U,2+(ge?1:0),3),He(U,Q,O)):(Oe(U,4+(ge?1:0),3),function(Te,Ue,st,We){var Pt;for(Oe(Te,Ue-257,5),Oe(Te,st-1,5),Oe(Te,We-4,4),Pt=0;Pt<We;Pt++)Oe(Te,Te.bl_tree[2*G[Pt]+1],3);fe(Te,Te.dyn_ltree,Ue-1),fe(Te,Te.dyn_dtree,st-1)}(U,U.l_desc.max_code+1,U.d_desc.max_code+1,Pe+1),He(U,U.dyn_ltree,U.dyn_dtree)),Be(U),ge&&ye(U)},s._tr_tally=function(U,q,Ee){return U.pending_buf[U.d_buf+2*U.last_lit]=q>>>8&255,U.pending_buf[U.d_buf+2*U.last_lit+1]=255&q,U.pending_buf[U.l_buf+U.last_lit]=255&Ee,U.last_lit++,q===0?U.dyn_ltree[2*Ee]++:(U.matches++,q--,U.dyn_ltree[2*(T[Ee]+d+1)]++,U.dyn_dtree[2*re(q)]++),U.last_lit===U.lit_bufsize-1},s._tr_align=function(U){Oe(U,2,3),xe(U,_,Q),function(q){q.bi_valid===16?(Me(q,q.bi_buf),q.bi_buf=0,q.bi_valid=0):8<=q.bi_valid&&(q.pending_buf[q.pending++]=255&q.bi_buf,q.bi_buf>>=8,q.bi_valid-=8)}(U)}},{"../utils/common":41}],53:[function(t,i,s){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,s){(function(n){(function(r,o){if(!r.setImmediate){var a,c,u,d,f=1,m={},E=!1,g=r.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(r);w=w&&w.setTimeout?w:r,a={}.toString.call(r.process)==="[object process]"?function(C){process.nextTick(function(){I(C)})}:function(){if(r.postMessage&&!r.importScripts){var C=!0,F=r.onmessage;return r.onmessage=function(){C=!1},r.postMessage("","*"),r.onmessage=F,C}}()?(d="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",_,!1):r.attachEvent("onmessage",_),function(C){r.postMessage(d+C,"*")}):r.MessageChannel?((u=new MessageChannel).port1.onmessage=function(C){I(C.data)},function(C){u.port2.postMessage(C)}):g&&"onreadystatechange"in g.createElement("script")?(c=g.documentElement,function(C){var F=g.createElement("script");F.onreadystatechange=function(){I(C),F.onreadystatechange=null,c.removeChild(F),F=null},c.appendChild(F)}):function(C){setTimeout(I,0,C)},w.setImmediate=function(C){typeof C!="function"&&(C=new Function(""+C));for(var F=new Array(arguments.length-1),M=0;M<F.length;M++)F[M]=arguments[M+1];var D={callback:C,args:F};return m[f]=D,a(f),f++},w.clearImmediate=y}function y(C){delete m[C]}function I(C){if(E)setTimeout(I,0,C);else{var F=m[C];if(F){E=!0;try{(function(M){var D=M.callback,B=M.args;switch(B.length){case 0:D();break;case 1:D(B[0]);break;case 2:D(B[0],B[1]);break;case 3:D(B[0],B[1],B[2]);break;default:D.apply(o,B)}})(F)}finally{y(C),E=!1}}}}function _(C){C.source===r&&typeof C.data=="string"&&C.data.indexOf(d)===0&&I(+C.data.slice(d.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Qr<"u"?Qr:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(lu);var Fm=lu.exports;const eh=Rm(Fm);var Dl={},So={};(function(l){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+e+"]["+t+"]*",s=new RegExp("^"+i+"$"),n=function(o,a){const c=[];let u=a.exec(o);for(;u;){const d=[];d.startIndex=a.lastIndex-u[0].length;const f=u.length;for(let m=0;m<f;m++)d.push(u[m]);c.push(d),u=a.exec(o)}return c},r=function(o){const a=s.exec(o);return!(a===null||typeof a>"u")};l.isExist=function(o){return typeof o<"u"},l.isEmptyObject=function(o){return Object.keys(o).length===0},l.merge=function(o,a,c){if(a){const u=Object.keys(a),d=u.length;for(let f=0;f<d;f++)c==="strict"?o[u[f]]=[a[u[f]]]:o[u[f]]=a[u[f]]}},l.getValue=function(o){return l.isExist(o)?o:""},l.isName=r,l.getAllMatches=n,l.nameRegexp=i})(So);const Ml=So,Sm={allowBooleanAttributes:!1,unpairedTags:[]};Dl.validate=function(l,e){e=Object.assign({},Sm,e);const t=[];let i=!1,s=!1;l[0]==="\uFEFF"&&(l=l.substr(1));for(let n=0;n<l.length;n++)if(l[n]==="<"&&l[n+1]==="?"){if(n+=2,n=ih(l,n),n.err)return n}else if(l[n]==="<"){let r=n;if(n++,l[n]==="!"){n=sh(l,n);continue}else{let o=!1;l[n]==="/"&&(o=!0,n++);let a="";for(;n<l.length&&l[n]!==">"&&l[n]!==" "&&l[n]!=="	"&&l[n]!==`
`&&l[n]!=="\r";n++)a+=l[n];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),n--),!Bm(a)){let d;return a.trim().length===0?d="Invalid space after '<'.":d="Tag '"+a+"' is an invalid name.",It("InvalidTag",d,Yt(l,n))}const c=Dm(l,n);if(c===!1)return It("InvalidAttr","Attributes for '"+a+"' have open quote.",Yt(l,n));let u=c.value;if(n=c.index,u[u.length-1]==="/"){const d=n-u.length;u=u.substring(0,u.length-1);const f=nh(u,e);if(f===!0)i=!0;else return It(f.err.code,f.err.msg,Yt(l,d+f.err.line))}else if(o)if(c.tagClosed){if(u.trim().length>0)return It("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",Yt(l,r));if(t.length===0)return It("InvalidTag","Closing tag '"+a+"' has not been opened.",Yt(l,r));{const d=t.pop();if(a!==d.tagName){let f=Yt(l,d.tagStartPos);return It("InvalidTag","Expected closing tag '"+d.tagName+"' (opened in line "+f.line+", col "+f.col+") instead of closing tag '"+a+"'.",Yt(l,r))}t.length==0&&(s=!0)}}else return It("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",Yt(l,n));else{const d=nh(u,e);if(d!==!0)return It(d.err.code,d.err.msg,Yt(l,n-u.length+d.err.line));if(s===!0)return It("InvalidXml","Multiple possible root nodes found.",Yt(l,n));e.unpairedTags.indexOf(a)!==-1||t.push({tagName:a,tagStartPos:r}),i=!0}for(n++;n<l.length;n++)if(l[n]==="<")if(l[n+1]==="!"){n++,n=sh(l,n);continue}else if(l[n+1]==="?"){if(n=ih(l,++n),n.err)return n}else break;else if(l[n]==="&"){const d=Nm(l,n);if(d==-1)return It("InvalidChar","char '&' is not expected.",Yt(l,n));n=d}else if(s===!0&&!th(l[n]))return It("InvalidXml","Extra text at the end",Yt(l,n));l[n]==="<"&&n--}}else{if(th(l[n]))continue;return It("InvalidChar","char '"+l[n]+"' is not expected.",Yt(l,n))}if(i){if(t.length==1)return It("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",Yt(l,t[0].tagStartPos));if(t.length>0)return It("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return It("InvalidXml","Start tag expected.",1);return!0};function th(l){return l===" "||l==="	"||l===`
`||l==="\r"}function ih(l,e){const t=e;for(;e<l.length;e++)if(l[e]=="?"||l[e]==" "){const i=l.substr(t,e-t);if(e>5&&i==="xml")return It("InvalidXml","XML declaration allowed only at the start of the document.",Yt(l,e));if(l[e]=="?"&&l[e+1]==">"){e++;break}else continue}return e}function sh(l,e){if(l.length>e+5&&l[e+1]==="-"&&l[e+2]==="-"){for(e+=3;e<l.length;e++)if(l[e]==="-"&&l[e+1]==="-"&&l[e+2]===">"){e+=2;break}}else if(l.length>e+8&&l[e+1]==="D"&&l[e+2]==="O"&&l[e+3]==="C"&&l[e+4]==="T"&&l[e+5]==="Y"&&l[e+6]==="P"&&l[e+7]==="E"){let t=1;for(e+=8;e<l.length;e++)if(l[e]==="<")t++;else if(l[e]===">"&&(t--,t===0))break}else if(l.length>e+9&&l[e+1]==="["&&l[e+2]==="C"&&l[e+3]==="D"&&l[e+4]==="A"&&l[e+5]==="T"&&l[e+6]==="A"&&l[e+7]==="["){for(e+=8;e<l.length;e++)if(l[e]==="]"&&l[e+1]==="]"&&l[e+2]===">"){e+=2;break}}return e}const Om='"',Pm="'";function Dm(l,e){let t="",i="",s=!1;for(;e<l.length;e++){if(l[e]===Om||l[e]===Pm)i===""?i=l[e]:i!==l[e]||(i="");else if(l[e]===">"&&i===""){s=!0;break}t+=l[e]}return i!==""?!1:{value:t,index:e,tagClosed:s}}const Mm=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function nh(l,e){const t=Ml.getAllMatches(l,Mm),i={};for(let s=0;s<t.length;s++){if(t[s][1].length===0)return It("InvalidAttr","Attribute '"+t[s][2]+"' has no space in starting.",zn(t[s]));if(t[s][3]!==void 0&&t[s][4]===void 0)return It("InvalidAttr","Attribute '"+t[s][2]+"' is without value.",zn(t[s]));if(t[s][3]===void 0&&!e.allowBooleanAttributes)return It("InvalidAttr","boolean attribute '"+t[s][2]+"' is not allowed.",zn(t[s]));const n=t[s][2];if(!Um(n))return It("InvalidAttr","Attribute '"+n+"' is an invalid name.",zn(t[s]));if(!i.hasOwnProperty(n))i[n]=1;else return It("InvalidAttr","Attribute '"+n+"' is repeated.",zn(t[s]))}return!0}function Lm(l,e){let t=/\d/;for(l[e]==="x"&&(e++,t=/[\da-fA-F]/);e<l.length;e++){if(l[e]===";")return e;if(!l[e].match(t))break}return-1}function Nm(l,e){if(e++,l[e]===";")return-1;if(l[e]==="#")return e++,Lm(l,e);let t=0;for(;e<l.length;e++,t++)if(!(l[e].match(/\w/)&&t<20)){if(l[e]===";")break;return-1}return e}function It(l,e,t){return{err:{code:l,msg:e,line:t.line||t,col:t.col}}}function Um(l){return Ml.isName(l)}function Bm(l){return Ml.isName(l)}function Yt(l,e){const t=l.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function zn(l){return l.startIndex+l[1].length}var Ll={};const cu={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(l,e){return e},attributeValueProcessor:function(l,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(l,e,t){return l}},km=function(l){return Object.assign({},cu,l)};Ll.buildOptions=km;Ll.defaultOptions=cu;class zm{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var Vm=zm;const Ym=So;function Gm(l,e){const t={};if(l[e+3]==="O"&&l[e+4]==="C"&&l[e+5]==="T"&&l[e+6]==="Y"&&l[e+7]==="P"&&l[e+8]==="E"){e=e+9;let i=1,s=!1,n=!1,r="";for(;e<l.length;e++)if(l[e]==="<"&&!n){if(s&&Wm(l,e))e+=7,[entityName,val,e]=Hm(l,e+1),val.indexOf("&")===-1&&(t[Qm(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(s&&Zm(l,e))e+=8;else if(s&&Km(l,e))e+=8;else if(s&&Xm(l,e))e+=9;else if(jm)n=!0;else throw new Error("Invalid DOCTYPE");i++,r=""}else if(l[e]===">"){if(n?l[e-1]==="-"&&l[e-2]==="-"&&(n=!1,i--):i--,i===0)break}else l[e]==="["?s=!0:r+=l[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function Hm(l,e){let t="";for(;e<l.length&&l[e]!=="'"&&l[e]!=='"';e++)t+=l[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const i=l[e++];let s="";for(;e<l.length&&l[e]!==i;e++)s+=l[e];return[t,s,e]}function jm(l,e){return l[e+1]==="!"&&l[e+2]==="-"&&l[e+3]==="-"}function Wm(l,e){return l[e+1]==="!"&&l[e+2]==="E"&&l[e+3]==="N"&&l[e+4]==="T"&&l[e+5]==="I"&&l[e+6]==="T"&&l[e+7]==="Y"}function Zm(l,e){return l[e+1]==="!"&&l[e+2]==="E"&&l[e+3]==="L"&&l[e+4]==="E"&&l[e+5]==="M"&&l[e+6]==="E"&&l[e+7]==="N"&&l[e+8]==="T"}function Km(l,e){return l[e+1]==="!"&&l[e+2]==="A"&&l[e+3]==="T"&&l[e+4]==="T"&&l[e+5]==="L"&&l[e+6]==="I"&&l[e+7]==="S"&&l[e+8]==="T"}function Xm(l,e){return l[e+1]==="!"&&l[e+2]==="N"&&l[e+3]==="O"&&l[e+4]==="T"&&l[e+5]==="A"&&l[e+6]==="T"&&l[e+7]==="I"&&l[e+8]==="O"&&l[e+9]==="N"}function Qm(l){if(Ym.isName(l))return l;throw new Error(`Invalid entity name ${l}`)}var qm=Gm;const Jm=/^[-+]?0x[a-fA-F0-9]+$/,$m=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const eg={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function tg(l,e={}){if(e=Object.assign({},eg,e),!l||typeof l!="string")return l;let t=l.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return l;if(e.hex&&Jm.test(t))return Number.parseInt(t,16);{const i=$m.exec(t);if(i){const s=i[1],n=i[2];let r=ig(i[3]);const o=i[4]||i[6];if(!e.leadingZeros&&n.length>0&&s&&t[2]!=="."||!e.leadingZeros&&n.length>0&&!s&&t[1]!==".")return l;{const a=Number(t),c=""+a;return c.search(/[eE]/)!==-1||o?e.eNotation?a:l:t.indexOf(".")!==-1?c==="0"&&r===""||c===r||s&&c==="-"+r?a:l:n?r===c||s+r===c?a:l:t===c||t===s+c?a:l}}else return l}}function ig(l){return l&&l.indexOf(".")!==-1&&(l=l.replace(/0+$/,""),l==="."?l="0":l[0]==="."?l="0"+l:l[l.length-1]==="."&&(l=l.substr(0,l.length-1))),l}var sg=tg;const hu=So,Vn=Vm,ng=qm,rg=sg;let og=class{constructor(l){this.options=l,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=ag,this.parseXml=dg,this.parseTextData=lg,this.resolveNameSpace=cg,this.buildAttributesMap=ug,this.isItStopNode=gg,this.replaceEntitiesValue=pg,this.readStopNodeData=vg,this.saveTextToParentTag=mg,this.addChild=fg}};function ag(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const i=e[t];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:l[i]}}}function lg(l,e,t,i,s,n,r){if(l!==void 0&&(this.options.trimValues&&!i&&(l=l.trim()),l.length>0)){r||(l=this.replaceEntitiesValue(l));const o=this.options.tagValueProcessor(e,l,t,s,n);return o==null?l:typeof o!=typeof l||o!==l?o:this.options.trimValues?Qa(l,this.options.parseTagValue,this.options.numberParseOptions):l.trim()===l?Qa(l,this.options.parseTagValue,this.options.numberParseOptions):l}}function cg(l){if(this.options.removeNSPrefix){const e=l.split(":"),t=l.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(l=t+e[1])}return l}const hg=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function ug(l,e,t){if(!this.options.ignoreAttributes&&typeof l=="string"){const i=hu.getAllMatches(l,hg),s=i.length,n={};for(let r=0;r<s;r++){const o=this.resolveNameSpace(i[r][1]);let a=i[r][4],c=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const u=this.options.attributeValueProcessor(o,a,e);u==null?n[c]=a:typeof u!=typeof a||u!==a?n[c]=u:n[c]=Qa(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[c]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=n,r}return n}}const dg=function(l){l=l.replace(/\r\n?/g,`
`);const e=new Vn("!xml");let t=e,i="",s="";for(let n=0;n<l.length;n++)if(l[n]==="<")if(l[n+1]==="/"){const r=Is(l,">",n,"Closing Tag is not closed.");let o=l.substring(n+2,r).trim();if(this.options.removeNSPrefix){const u=o.indexOf(":");u!==-1&&(o=o.substr(u+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&(i=this.saveTextToParentTag(i,t,s));const a=s.substring(s.lastIndexOf(".")+1);if(o&&this.options.unpairedTags.indexOf(o)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${o}>`);let c=0;a&&this.options.unpairedTags.indexOf(a)!==-1?(c=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=s.lastIndexOf("."),s=s.substring(0,c),t=this.tagsNodeStack.pop(),i="",n=r}else if(l[n+1]==="?"){let r=Xa(l,n,!1,"?>");if(!r)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,t,s),!(this.options.ignoreDeclaration&&r.tagName==="?xml"||this.options.ignorePiTags)){const o=new Vn(r.tagName);o.add(this.options.textNodeName,""),r.tagName!==r.tagExp&&r.attrExpPresent&&(o[":@"]=this.buildAttributesMap(r.tagExp,s,r.tagName)),this.addChild(t,o,s)}n=r.closeIndex+1}else if(l.substr(n+1,3)==="!--"){const r=Is(l,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const o=l.substring(n+4,r-2);i=this.saveTextToParentTag(i,t,s),t.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}n=r}else if(l.substr(n+1,2)==="!D"){const r=ng(l,n);this.docTypeEntities=r.entities,n=r.i}else if(l.substr(n+1,2)==="!["){const r=Is(l,"]]>",n,"CDATA is not closed.")-2,o=l.substring(n+9,r);i=this.saveTextToParentTag(i,t,s);let a=this.parseTextData(o,t.tagname,s,!0,!1,!0,!0);a==null&&(a=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):t.add(this.options.textNodeName,a),n=r+2}else{let r=Xa(l,n,this.options.removeNSPrefix),o=r.tagName;const a=r.rawTagName;let c=r.tagExp,u=r.attrExpPresent,d=r.closeIndex;this.options.transformTagName&&(o=this.options.transformTagName(o)),t&&i&&t.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,t,s,!1));const f=t;if(f&&this.options.unpairedTags.indexOf(f.tagname)!==-1&&(t=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),o!==e.tagname&&(s+=s?"."+o:o),this.isItStopNode(this.options.stopNodes,s,o)){let m="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)o[o.length-1]==="/"?(o=o.substr(0,o.length-1),s=s.substr(0,s.length-1),c=o):c=c.substr(0,c.length-1),n=r.closeIndex;else if(this.options.unpairedTags.indexOf(o)!==-1)n=r.closeIndex;else{const g=this.readStopNodeData(l,a,d+1);if(!g)throw new Error(`Unexpected end of ${a}`);n=g.i,m=g.tagContent}const E=new Vn(o);o!==c&&u&&(E[":@"]=this.buildAttributesMap(c,s,o)),m&&(m=this.parseTextData(m,o,s,!0,u,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),E.add(this.options.textNodeName,m),this.addChild(t,E,s)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){o[o.length-1]==="/"?(o=o.substr(0,o.length-1),s=s.substr(0,s.length-1),c=o):c=c.substr(0,c.length-1),this.options.transformTagName&&(o=this.options.transformTagName(o));const m=new Vn(o);o!==c&&u&&(m[":@"]=this.buildAttributesMap(c,s,o)),this.addChild(t,m,s),s=s.substr(0,s.lastIndexOf("."))}else{const m=new Vn(o);this.tagsNodeStack.push(t),o!==c&&u&&(m[":@"]=this.buildAttributesMap(c,s,o)),this.addChild(t,m,s),t=m}i="",n=d}}else i+=l[n];return e.child};function fg(l,e,t){const i=this.options.updateTag(e.tagname,t,e[":@"]);i===!1||(typeof i=="string"&&(e.tagname=i),l.addChild(e))}const pg=function(l){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];l=l.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];l=l.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];l=l.replace(t.regex,t.val)}l=l.replace(this.ampEntity.regex,this.ampEntity.val)}return l};function mg(l,e,t,i){return l&&(i===void 0&&(i=Object.keys(e.child).length===0),l=this.parseTextData(l,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),l!==void 0&&l!==""&&e.add(this.options.textNodeName,l),l=""),l}function gg(l,e,t){const i="*."+t;for(const s in l){const n=l[s];if(i===n||e===n)return!0}return!1}function Eg(l,e,t=">"){let i,s="";for(let n=e;n<l.length;n++){let r=l[n];if(i)r===i&&(i="");else if(r==='"'||r==="'")i=r;else if(r===t[0])if(t[1]){if(l[n+1]===t[1])return{data:s,index:n}}else return{data:s,index:n};else r==="	"&&(r=" ");s+=r}}function Is(l,e,t,i){const s=l.indexOf(e,t);if(s===-1)throw new Error(i);return s+e.length-1}function Xa(l,e,t,i=">"){const s=Eg(l,e+1,i);if(!s)return;let n=s.data;const r=s.index,o=n.search(/\s/);let a=n,c=!0;o!==-1&&(a=n.substring(0,o),n=n.substring(o+1).trimStart());const u=a;if(t){const d=a.indexOf(":");d!==-1&&(a=a.substr(d+1),c=a!==s.data.substr(d+1))}return{tagName:a,tagExp:n,closeIndex:r,attrExpPresent:c,rawTagName:u}}function vg(l,e,t){const i=t;let s=1;for(;t<l.length;t++)if(l[t]==="<")if(l[t+1]==="/"){const n=Is(l,">",t,`${e} is not closed`);if(l.substring(t+2,n).trim()===e&&(s--,s===0))return{tagContent:l.substring(i,t),i:n};t=n}else if(l[t+1]==="?")t=Is(l,"?>",t+1,"StopNode is not closed.");else if(l.substr(t+1,3)==="!--")t=Is(l,"-->",t+3,"StopNode is not closed.");else if(l.substr(t+1,2)==="![")t=Is(l,"]]>",t,"StopNode is not closed.")-2;else{const n=Xa(l,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&s++,t=n.closeIndex)}}function Qa(l,e,t){if(e&&typeof l=="string"){const i=l.trim();return i==="true"?!0:i==="false"?!1:rg(l,t)}else return hu.isExist(l)?l:""}var wg=og,uu={};function yg(l,e){return du(l,e)}function du(l,e,t){let i;const s={};for(let n=0;n<l.length;n++){const r=l[n],o=Ig(r);let a="";if(t===void 0?a=o:a=t+"."+o,o===e.textNodeName)i===void 0?i=r[o]:i+=""+r[o];else{if(o===void 0)continue;if(r[o]){let c=du(r[o],e,a);const u=bg(c,e);r[":@"]?Cg(c,r[":@"],a,e):Object.keys(c).length===1&&c[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?c=c[e.textNodeName]:Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""),s[o]!==void 0&&s.hasOwnProperty(o)?(Array.isArray(s[o])||(s[o]=[s[o]]),s[o].push(c)):e.isArray(o,a,u)?s[o]=[c]:s[o]=c}}}return typeof i=="string"?i.length>0&&(s[e.textNodeName]=i):i!==void 0&&(s[e.textNodeName]=i),s}function Ig(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const i=e[t];if(i!==":@")return i}}function Cg(l,e,t,i){if(e){const s=Object.keys(e),n=s.length;for(let r=0;r<n;r++){const o=s[r];i.isArray(o,t+"."+o,!0,!0)?l[o]=[e[o]]:l[o]=e[o]}}}function bg(l,e){const{textNodeName:t}=e,i=Object.keys(l).length;return!!(i===0||i===1&&(l[t]||typeof l[t]=="boolean"||l[t]===0))}uu.prettify=yg;const{buildOptions:Tg}=Ll,xg=wg,{prettify:Ag}=uu,_g=Dl;let Rg=class{constructor(l){this.externalEntities={},this.options=Tg(l)}parse(l,e){if(typeof l!="string")if(l.toString)l=l.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const s=_g.validate(l,e);if(s!==!0)throw Error(`${s.err.msg}:${s.err.line}:${s.err.col}`)}const t=new xg(this.options);t.addExternalEntities(this.externalEntities);const i=t.parseXml(l);return this.options.preserveOrder||i===void 0?i:Ag(i,this.options)}addEntity(l,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(l.indexOf("&")!==-1||l.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[l]=e}};var Fg=Rg;const Sg=`
`;function Og(l,e){let t="";return e.format&&e.indentBy.length>0&&(t=Sg),fu(l,e,"",t)}function fu(l,e,t,i){let s="",n=!1;for(let r=0;r<l.length;r++){const o=l[r],a=Pg(o);if(a===void 0)continue;let c="";if(t.length===0?c=a:c=`${t}.${a}`,a===e.textNodeName){let E=o[a];Dg(c,e)||(E=e.tagValueProcessor(a,E),E=pu(E,e)),n&&(s+=i),s+=E,n=!1;continue}else if(a===e.cdataPropName){n&&(s+=i),s+=`<![CDATA[${o[a][0][e.textNodeName]}]]>`,n=!1;continue}else if(a===e.commentPropName){s+=i+`<!--${o[a][0][e.textNodeName]}-->`,n=!0;continue}else if(a[0]==="?"){const E=rh(o[":@"],e),g=a==="?xml"?"":i;let w=o[a][0][e.textNodeName];w=w.length!==0?" "+w:"",s+=g+`<${a}${w}${E}?>`,n=!0;continue}let u=i;u!==""&&(u+=e.indentBy);const d=rh(o[":@"],e),f=i+`<${a}${d}`,m=fu(o[a],e,c,u);e.unpairedTags.indexOf(a)!==-1?e.suppressUnpairedNode?s+=f+">":s+=f+"/>":(!m||m.length===0)&&e.suppressEmptyNode?s+=f+"/>":m&&m.endsWith(">")?s+=f+`>${m}${i}</${a}>`:(s+=f+">",m&&i!==""&&(m.includes("/>")||m.includes("</"))?s+=i+e.indentBy+m+i:s+=m,s+=`</${a}>`),n=!0}return s}function Pg(l){const e=Object.keys(l);for(let t=0;t<e.length;t++){const i=e[t];if(l.hasOwnProperty(i)&&i!==":@")return i}}function rh(l,e){let t="";if(l&&!e.ignoreAttributes)for(let i in l){if(!l.hasOwnProperty(i))continue;let s=e.attributeValueProcessor(i,l[i]);s=pu(s,e),s===!0&&e.suppressBooleanAttributes?t+=` ${i.substr(e.attributeNamePrefix.length)}`:t+=` ${i.substr(e.attributeNamePrefix.length)}="${s}"`}return t}function Dg(l,e){l=l.substr(0,l.length-e.textNodeName.length-1);let t=l.substr(l.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===l||e.stopNodes[i]==="*."+t)return!0;return!1}function pu(l,e){if(l&&l.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const i=e.entities[t];l=l.replace(i.regex,i.val)}return l}var Mg=Og;const Lg=Mg,Ng={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(l,e){return e},attributeValueProcessor:function(l,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function os(l){this.options=Object.assign({},Ng,l),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=kg),this.processTextOrObjNode=Ug,this.options.format?(this.indentate=Bg,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}os.prototype.build=function(l){return this.options.preserveOrder?Lg(l,this.options):(Array.isArray(l)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(l={[this.options.arrayNodeName]:l}),this.j2x(l,0).val)};os.prototype.j2x=function(l,e){let t="",i="";for(let s in l)if(Object.prototype.hasOwnProperty.call(l,s))if(typeof l[s]>"u")this.isAttribute(s)&&(i+="");else if(l[s]===null)this.isAttribute(s)?i+="":s[0]==="?"?i+=this.indentate(e)+"<"+s+"?"+this.tagEndChar:i+=this.indentate(e)+"<"+s+"/"+this.tagEndChar;else if(l[s]instanceof Date)i+=this.buildTextValNode(l[s],s,"",e);else if(typeof l[s]!="object"){const n=this.isAttribute(s);if(n)t+=this.buildAttrPairStr(n,""+l[s]);else if(s===this.options.textNodeName){let r=this.options.tagValueProcessor(s,""+l[s]);i+=this.replaceEntitiesValue(r)}else i+=this.buildTextValNode(l[s],s,"",e)}else if(Array.isArray(l[s])){const n=l[s].length;let r="",o="";for(let a=0;a<n;a++){const c=l[s][a];if(!(typeof c>"u"))if(c===null)s[0]==="?"?i+=this.indentate(e)+"<"+s+"?"+this.tagEndChar:i+=this.indentate(e)+"<"+s+"/"+this.tagEndChar;else if(typeof c=="object")if(this.options.oneListGroup){const u=this.j2x(c,e+1);r+=u.val,this.options.attributesGroupName&&c.hasOwnProperty(this.options.attributesGroupName)&&(o+=u.attrStr)}else r+=this.processTextOrObjNode(c,s,e);else if(this.options.oneListGroup){let u=this.options.tagValueProcessor(s,c);u=this.replaceEntitiesValue(u),r+=u}else r+=this.buildTextValNode(c,s,"",e)}this.options.oneListGroup&&(r=this.buildObjectNode(r,s,o,e)),i+=r}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){const n=Object.keys(l[s]),r=n.length;for(let o=0;o<r;o++)t+=this.buildAttrPairStr(n[o],""+l[s][n[o]])}else i+=this.processTextOrObjNode(l[s],s,e);return{attrStr:t,val:i}};os.prototype.buildAttrPairStr=function(l,e){return e=this.options.attributeValueProcessor(l,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+l:" "+l+'="'+e+'"'};function Ug(l,e,t){const i=this.j2x(l,t+1);return l[this.options.textNodeName]!==void 0&&Object.keys(l).length===1?this.buildTextValNode(l[this.options.textNodeName],e,i.attrStr,t):this.buildObjectNode(i.val,e,i.attrStr,t)}os.prototype.buildObjectNode=function(l,e,t,i){if(l==="")return e[0]==="?"?this.indentate(i)+"<"+e+t+"?"+this.tagEndChar:this.indentate(i)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let s="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",s=""),(t||t==="")&&l.indexOf("<")===-1?this.indentate(i)+"<"+e+t+n+">"+l+s:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(i)+`<!--${l}-->`+this.newLine:this.indentate(i)+"<"+e+t+n+this.tagEndChar+l+this.indentate(i)+s}};os.prototype.closeTag=function(l){let e="";return this.options.unpairedTags.indexOf(l)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${l}`,e};os.prototype.buildTextValNode=function(l,e,t,i){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${l}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(i)+`<!--${l}-->`+this.newLine;if(e[0]==="?")return this.indentate(i)+"<"+e+t+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(e,l);return s=this.replaceEntitiesValue(s),s===""?this.indentate(i)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+t+">"+s+"</"+e+this.tagEndChar}};os.prototype.replaceEntitiesValue=function(l){if(l&&l.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];l=l.replace(t.regex,t.val)}return l};function Bg(l){return this.options.indentBy.repeat(l)}function kg(l){return l.startsWith(this.options.attributeNamePrefix)&&l!==this.options.textNodeName?l.substr(this.attrPrefixLen):!1}var zg=os;const Vg=Dl,Yg=Fg,Gg=zg;var Hg={XMLParser:Yg,XMLValidator:Vg,XMLBuilder:Gg};class qa{constructor(e,t){R(this,"date",new Date),R(this,"author"),R(this,"guid",xs.create()),R(this,"viewpoint"),R(this,"modifiedAuthor"),R(this,"modifiedDate"),R(this,"topic"),R(this,"_components"),R(this,"_comment",""),this._components=e,this._comment=t;const i=this._components.get(Gt);this.author=i.config.author}set comment(e){var t;const i=this._components.get(Gt);this._comment=e,this.modifiedDate=new Date,this.modifiedAuthor=i.config.author,(t=this.topic)==null||t.comments.set(this.guid,this)}get comment(){return this._comment}serialize(){let e=null;this.viewpoint&&(e=`<Viewpoint Guid="${this.viewpoint.guid}"/>`);let t=null;this.modifiedDate&&(t=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let i=null;return this.modifiedAuthor&&(i=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`),`
      <Comment Guid="${this.guid}">
        <Date>${this.date.toISOString()}</Date>
        <Author>${this.author}</Author>
        <Comment>${this.comment}</Comment>
        ${e??""}
        ${i??""}
        ${t??""}
      </Comment>
    `}}const mu=class Ji{constructor(e){R(this,"guid",xs.create()),R(this,"title",Ji.default.title),R(this,"creationDate",new Date),R(this,"creationAuthor",""),R(this,"viewpoints",new rn),R(this,"relatedTopics",new rn),R(this,"comments",new Yi),R(this,"customData",{}),R(this,"description"),R(this,"serverAssignedId"),R(this,"dueDate"),R(this,"modifiedAuthor"),R(this,"modifiedDate"),R(this,"index"),R(this,"_type",Ji.default.type),R(this,"_status",Ji.default.status),R(this,"_priority",Ji.default.priority),R(this,"_stage",Ji.default.priority),R(this,"_assignedTo",Ji.default.assignedTo),R(this,"_labels",Ji.default.labels),R(this,"_components"),this._components=e;const t=e.get(Gt);this.creationAuthor=t.config.author,this.relatedTopics.guard=i=>i!==this.guid}set type(e){const t=this._components.get(Gt),{strict:i,types:s}=t.config;(!i||s.has(e))&&(this._type=e)}get type(){return this._type}set status(e){const t=this._components.get(Gt),{strict:i,statuses:s}=t.config;(!i||s.has(e))&&(this._status=e)}get status(){return this._status}set priority(e){const t=this._components.get(Gt);if(e){const{strict:i,priorities:s}=t.config;if(!(!i||s.has(e)))return;this._priority=e}else this._priority=e}get priority(){return this._priority}set stage(e){const t=this._components.get(Gt);if(e){const{strict:i,stages:s}=t.config;if(!(!i||s.has(e)))return;this._stage=e}else this._stage=e}get stage(){return this._stage}set assignedTo(e){const t=this._components.get(Gt);if(e){const{strict:i,users:s}=t.config;if(!(!i||s.has(e)))return;this._assignedTo=e}else this._assignedTo=e}get assignedTo(){return this._assignedTo}set labels(e){const t=this._components.get(Gt),{strict:i,labels:s}=t.config;if(i){const n=new Set;for(const r of e)(!i||s.has(r))&&n.add(r);this._labels=n}else this._labels=e}get labels(){return this._labels}get _managerVersion(){return this._components.get(Gt).config.version}set(e){const t=e,i=this;for(const s in e){if(s==="guid")continue;const n=t[s];s in this&&(i[s]=n)}return this._components.get(Gt).list.set(this.guid,this),this}createComment(e,t){const i=new qa(this._components,e);return i.viewpoint=t,i.topic=this,this.comments.set(i.guid,i),i}createLabelTags(e=this._managerVersion){let t="Labels";e==="2.1"&&(t="Labels"),e==="3"&&(t="Label");let i=[...this.labels].map(s=>`<${t}>${s}</${t}>`).join(`
`);for(const s in this.customData){const n=this.customData[s];typeof n=="string"&&(i+=`
<${t}>${n}</${t}>`)}return e==="2.1"?i:e==="3"?i.length!==0?`<Labels>
${i}
</Labels>`:"<Labels/>":i}createCommentTags(e=this._managerVersion){const t=[...this.comments.values()].map(i=>i.serialize()).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<Comments>
${t}
</Comments>`:"<Comments/>":t}createViewpointTags(e=this._managerVersion){let t="Viewpoints";e==="2.1"&&(t="Viewpoints"),e==="3"&&(t="ViewPoint");const i=this._components.get(ki),s=[...this.viewpoints].map(n=>i.list.get(n)).filter(n=>n).map(n=>`<${t} Guid="${n.guid}">
          <Viewpoint>${n.guid}.bcfv</Viewpoint>
          <Snapshot>${n.guid}.jpeg</Snapshot>
        </${t}>
      `).join(`
`);return e==="2.1"?s:e==="3"?s.length!==0?`<Viewpoints>
${s}
</Viewpoints>`:"<Viewpoints />":s}createRelatedTopicTags(e=this._managerVersion){const t=[...this.relatedTopics].map(i=>`<RelatedTopic Guid="${i}"></RelatedTopic>
      `).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<RelatedTopics>
${t}
</RelatedTopics>`:"<RelatedTopics />":t}serialize(){const e=this._managerVersion;let t=null;this.serverAssignedId&&(t=`ServerAssignedId="${this.serverAssignedId}"`);let i=null;this.priority&&(i=`<Priority>${this.priority}</Priority>`);let s=null;this.index&&e==="2.1"&&(s=`<Index>${this.index}</Index>`);let n=null;this.modifiedDate&&(n=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let r=null;this.modifiedAuthor&&(r=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`);let o=null;this.dueDate&&(o=`<DueDate>${this.dueDate.toISOString()}</DueDate>`);let a=null;this.assignedTo&&(a=`<AssignedTo>${this.assignedTo}</AssignedTo>`);let c=null;this.description&&(c=`<Description>${this.description}</Description>`);let u=null;this.stage&&(u=`<Stage>${this.stage}</Stage>`);const d=this.createCommentTags(e),f=this.createViewpointTags(e),m=this.createLabelTags(e),E=this.createRelatedTopicTags(e);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Markup>
        <Topic Guid="${this.guid}" TopicType="${this.type}" TopicStatus="${this.status}" ${t??""}>
          <Title>${this.title}</Title>
          <CreationDate>${this.creationDate.toISOString()}</CreationDate>
          <CreationAuthor>${this.creationAuthor}</CreationAuthor>
          ${i??""}
          ${s??""}
          ${n??""}
          ${r??""}
          ${o??""}
          ${a??""}
          ${c??""}
          ${u??""}
          ${m}
          ${E}
          ${e==="3"?d:""}
          ${e==="3"?f:""}
        </Topic>
        ${e==="2.1"?d:""}
        ${e==="2.1"?f:""}
      </Markup>
    `}};R(mu,"default",{title:"BCF Topic",type:"Issue",status:"Active",labels:new Set});let oh=mu;const jg=(l,e)=>{if(e.trim()==="")return;const t=Gt.xmlParser.parse(e).Extensions;if(!t)return;const{Priorities:i,TopicStatuses:s,TopicTypes:n,Users:r}=t;if(i&&i.Priority){const o=Array.isArray(i.Priority)?i.Priority:[i.Priority];for(const a of o)l.config.priorities.add(a)}if(s&&s.TopicStatus){const o=Array.isArray(s.TopicStatus)?s.TopicStatus:[s.TopicStatus];for(const a of o)l.config.statuses.add(a)}if(n&&n.TopicType){const o=Array.isArray(n.TopicType)?n.TopicType:[n.TopicType];for(const a of o)l.config.types.add(a)}if(r&&r.User){const o=Array.isArray(r.User)?r.User:[r.User];for(const a of o)l.config.users.add(a)}},Ja=class ho extends Ke{constructor(){super(...arguments),R(this,"enabled",!1),R(this,"config",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1}),R(this,"list",new Yi),R(this,"onSetup",new le),R(this,"isSetup",!1),R(this,"onBCFImported",new le),R(this,"onDisposed",new le)}setup(e){this.isSetup||(this.config={...this.config,...e},this.isSetup=!0,this.enabled=!0,this.onSetup.trigger())}create(e){const t=new oh(this.components);return e&&(t.guid=e.guid??t.guid,t.set(e)),this.list.set(t.guid,t),t}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const e=[...this.list].map(([t,i])=>i.type);return new Set(e)}get usedStatuses(){const e=[...this.list].map(([t,i])=>i.status);return new Set(e)}get usedPriorities(){const e=[...this.list].map(([t,i])=>i.priority).filter(t=>t);return new Set(e)}get usedStages(){const e=[...this.list].map(([t,i])=>i.stage).filter(t=>t);return new Set(e)}get usedUsers(){const e=[];for(const[t,i]of this.list){e.push(i.creationAuthor),i.assignedTo&&e.push(i.assignedTo),i.modifiedAuthor&&e.push(i.modifiedAuthor);for(const[s,n]of i.comments)e.push(n.author),n.modifiedAuthor&&e.push(n.modifiedAuthor)}return new Set(e)}get usedLabels(){const e=[];for(const[t,i]of this.list)e.push(...i.labels);return new Set(e)}updateExtensions(){for(const[e,t]of this.list){for(const i of t.labels)this.config.labels.add(i);this.config.types.add(t.type),t.priority&&this.config.priorities.add(t.priority),t.stage&&this.config.stages.add(t.stage),this.config.statuses.add(t.status),this.config.users.add(t.creationAuthor),t.assignedTo&&this.config.users.add(t.assignedTo),t.modifiedAuthor&&this.config.users.add(t.modifiedAuthor);for(const[i,s]of t.comments)this.config.users.add(s.author),s.modifiedAuthor&&this.config.users.add(s.modifiedAuthor)}}updateViewpointReferences(){const e=this.components.get(ki);for(const[t,i]of this.list)for(const s of i.viewpoints)e.list.has(s)||i.viewpoints.delete(s)}async export(e=this.list.values()){const t=new eh;t.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`),t.file("bcf.extensions",this.serializeExtensions());const i=await(await fetch("https://thatopen.github.io/engine_components/resources/favicon.ico")).blob(),s=this.components.get(ki);for(const n of e){const r=t.folder(n.guid);r.file("markup.bcf",n.serialize());for(const o of n.viewpoints){const a=s.list.get(o);a&&(r.file(`${o}.jpeg`,i,{binary:!0}),r.file(`${o}.bcfv`,await a.serialize()))}}return await t.generateAsync({type:"blob"})}serializeExtensions(){const e=[...this.config.types].map(o=>`<TopicType>${o}</TopicType>`).join(`
`),t=[...this.config.statuses].map(o=>`<TopicStatus>${o}</TopicStatus>`).join(`
`),i=[...this.config.priorities].map(o=>`<Priority>${o}</Priority>`).join(`
`),s=[...this.config.labels].map(o=>`<TopicLabel>${o}</TopicLabel>`).join(`
`),n=[...this.config.stages].map(o=>`<Stage>${o}</Stage>`).join(`
`),r=[...this.config.users].map(o=>`<User>${o}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${e.length!==0?`<TopicTypes>
${e}
</TopicTypes>`:""}
        ${t.length!==0?`<TopicStatuses>
${t}
</TopicStatuses>`:""}
        ${i.length!==0?`<Priorities>
${i}
</Priorities>`:""}
        ${s.length!==0?`<TopicLabels>
${s}
</TopicLabels>`:""}
        ${n.length!==0?`<Stages>
${n}
</Stages>`:""}
        ${r.length!==0?`<Users>
${r}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(e){const{Guid:t,Date:i,Author:s,Comment:n,Viewpoint:r}=e;if(!(t&&i&&s&&(qa||r)))return null;const o=this.components.get(ki),a=new qa(this.components,n??"");return a.guid=t,a.date=new Date(i),a.author=s,a.viewpoint=r!=null&&r.Guid?o.list.get(r.Guid):void 0,a.modifiedAuthor=e.ModifiedAuthor,a.modifiedDate=e.ModifiedDate?new Date(e.ModifiedDate):void 0,a}getMarkupComments(e,t){var i;let s;if(t==="2.1"&&(s=e.Comment),t==="3"&&(s=(i=e.Topic.Comments)==null?void 0:i.Comment),!s)return[];s=Array.isArray(s)?s:[s];const n=s.map(r=>this.processMarkupComment(r)).filter(r=>r);return Array.isArray(n)?n:[n]}getMarkupLabels(e,t){var i;let s;return t==="2.1"&&(s=e.Topic.Labels),t==="3"&&(s=(i=e.Topic.Labels)==null?void 0:i.Label),s?Array.isArray(s)?s:[s]:[]}getMarkupViewpoints(e,t){var i;let s;return t==="2.1"&&(s=e.Viewpoints),t==="3"&&(s=(i=e.Topic.Viewpoints)==null?void 0:i.ViewPoint),s?(s=Array.isArray(s)?s:[s],s):[]}getMarkupRelatedTopics(e,t){var i;let s;return t==="2.1"&&(s=e.Topic.RelatedTopic),t==="3"&&(s=(i=e.Topic.RelatedTopics)==null?void 0:i.RelatedTopic),s?(Array.isArray(s)?s:[s]).map(n=>n.Guid):[]}async load(e,t){var i;const{fallbackVersionOnImport:s,ignoreIncompleteTopicsOnImport:n,updateExtensionsOnImport:r}=this.config,o=new eh;await o.loadAsync(e);const a=Object.values(o.files);let c=s;const u=a.find(I=>I.name.endsWith(".version"));if(u){const I=await u.async("string"),_=ho.xmlParser.parse(I).Version.VersionId;c=String(_)}if(!(c&&(c==="2.1"||c==="3")))throw new Error(`BCFTopics: ${c} is not supported.`);const d=a.find(I=>I.name.endsWith(".extensions"));if(r&&d){const I=await d.async("string");jg(this,I)}const f=[],m=this.components.get(ki),E=a.filter(I=>I.name.endsWith(".bcfv"));for(const I of E){const _=await I.async("string"),C=ho.xmlParser.parse(_).VisualizationInfo;if(!C){console.warn("Missing VisualizationInfo in Viewpoint");continue}const F={},{Guid:M,ClippingPlanes:D,Components:B,OrthogonalCamera:N,PerspectiveCamera:G}=C;if(M&&(F.guid=M),B){const{Selection:O,Visibility:V}=B;if(O&&O.Component){const J=Array.isArray(O.Component)?O.Component:[O.Component];F.selectionComponents=J.map(de=>de.IfcGuid).filter(de=>de)}if(V&&"DefaultVisibility"in V&&(F.defaultVisibility=V.DefaultVisibility),V&&V.Exceptions&&"Component"in V.Exceptions){const{Component:J}=V.Exceptions,de=Array.isArray(J)?J:[J];F.exceptionComponents=de.map(ie=>ie.IfcGuid).filter(ie=>ie)}let T;c==="2.1"&&(T=B.ViewSetupHints),c==="3"&&(T=(i=B.Visibility)==null?void 0:i.ViewSetupHints),T&&("OpeningsVisible"in T&&(F.openingsVisible=T.OpeningsVisible),"SpacesVisible"in T&&(F.spacesVisible=T.SpacesVisible),"SpaceBoundariesVisible"in T&&(F.spaceBoundariesVisible=T.SpaceBoundariesVisible))}if(N||G){const O=C.PerspectiveCamera??C.OrthogonalCamera,{CameraViewPoint:V,CameraDirection:T}=O,J=new z(Number(V.X),Number(V.Z),Number(-V.Y)),de=new z(Number(T.X),Number(T.Z),Number(-T.Y)),ie={position:{x:J.x,y:J.y,z:J.z},direction:{x:de.x,y:de.y,z:de.z},aspectRatio:"AspectRatio"in O?O.AspectRatio:1};"ViewToWorldScale"in O&&(F.camera={...ie,viewToWorldScale:O.ViewToWorldScale}),"FieldOfView"in O&&(F.camera={...ie,fov:O.FieldOfView})}const Q=new bu(this.components,t,{data:F,setCamera:!1});if(B){const{Coloring:O}=B;if(O&&O.Color){const V=Array.isArray(O.Color)?O.Color:[O.Color];for(const T of V){const{Color:J,Component:de}=T,ie=(Array.isArray(de)?de:[de]).map(ve=>ve.IfcGuid);Q.componentColors.set(J,ie)}}}if(f.push(Q),D){const O=this.components.get(cn),V=Array.isArray(D.ClippingPlane)?D.ClippingPlane:[D.ClippingPlane];for(const T of V){const{Location:J,Direction:de}=T;if(!(J&&de))continue;const ie=new z(J.X,J.Z,-J.Y),ve=new z(de.X,-de.Z,de.Y),ue=O.createFromNormalAndCoplanarPoint(t,ve,ie);ue.visible=!1,ue.enabled=!1,Q.clippingPlanes.add(ue)}}}const g={},w=[],y=a.filter(I=>I.name.endsWith(".bcf"));for(const I of y){const _=await I.async("string"),C=ho.xmlParser.parse(_).Markup,F=C.Topic,{Guid:M,TopicType:D,TopicStatus:B,Title:N,CreationDate:G,CreationAuthor:Q}=F;if(n&&!(M&&D&&B&&N&&G&&Q))continue;const O=new oh(this.components);O.guid=M??O.guid;const V=this.getMarkupRelatedTopics(C,c);g[O.guid]=new Set(V),O.type=D??O.type,O.status=B??O.status,O.title=N??O.title,O.creationDate=G?new Date(G):O.creationDate,O.creationAuthor=Q??O.creationAuthor,O.serverAssignedId=F.ServerAssignedId,O.priority=F.Priority,O.index=F.Index,O.modifiedDate=F.ModifiedDate?new Date(F.ModifiedDate):void 0,O.modifiedAuthor=F.ModifiedAuthor,O.dueDate=F.DueDate?new Date(F.DueDate):void 0,O.assignedTo=F.AssignedTo,O.description=F.Description,O.stage=F.Stage;const T=this.getMarkupLabels(C,c);for(const ie of T)O.labels.add(ie);const J=this.getMarkupComments(C,c);for(const ie of J)O.comments.set(ie.guid,ie);const de=this.getMarkupViewpoints(C,c);for(const ie of de){if(!(ie&&ie.Guid))continue;const ve=m.list.get(ie.Guid);ve&&O.viewpoints.add(ve.guid)}this.list.set(O.guid,O),w.push(O)}for(const I in g){const _=this.list.get(I);if(!_)continue;const C=g[I];for(const F of C)_.relatedTopics.add(F)}return this.onBCFImported.trigger(w),{viewpoints:f,topics:w}}};R(Ja,"uuid","de977976-e4f6-4e4f-a01a-204727839802"),R(Ja,"xmlParser",new Hg.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let Gt=Ja;const gu=class Mi extends Ke{constructor(e){super(e),R(this,"enabled",!0),R(this,"onDisposed",new le),R(this,"_absoluteMin"),R(this,"_absoluteMax"),R(this,"_meshes",[]),this.components.add(Mi.uuid,this),this._absoluteMin=Mi.newBound(!0),this._absoluteMax=Mi.newBound(!1)}static getDimensions(e){const{min:t,max:i}=e,s=Math.abs(i.x-t.x),n=Math.abs(i.y-t.y),r=Math.abs(i.z-t.z),o=new z;return o.subVectors(i,t).divideScalar(2).add(t),{width:s,height:n,depth:r,center:o}}static newBound(e){const t=e?1:-1;return new z(t*Number.MAX_VALUE,t*Number.MAX_VALUE,t*Number.MAX_VALUE)}static getBounds(e,t,i){const s=i||this.newBound(!1),n=t||this.newBound(!0);for(const r of e)r.x<n.x&&(n.x=r.x),r.y<n.y&&(n.y=r.y),r.z<n.z&&(n.z=r.z),r.x>s.x&&(s.x=r.x),r.y>s.y&&(s.y=r.y),r.z>s.z&&(s.z=r.z);return new ut(t,i)}dispose(){const e=this.components.get(Ri);for(const t of this._meshes)e.destroy(t);this._meshes=[],this.onDisposed.trigger(Mi.uuid),this.onDisposed.reset()}get(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone();return new ut(e,t)}getSphere(){const e=this._absoluteMin.clone(),t=this._absoluteMax.clone(),i=Math.abs((t.x-e.x)/2),s=Math.abs((t.y-e.y)/2),n=Math.abs((t.z-e.z)/2),r=new z(e.x+i,e.y+s,e.z+n),o=r.distanceTo(e);return new _s(r,o)}getMesh(){const e=new ut(this._absoluteMin,this._absoluteMax),t=Mi.getDimensions(e),{width:i,height:s,depth:n,center:r}=t,o=new Rt(i,s,n),a=new Ae(o);return this._meshes.push(a),a.position.copy(r),a}reset(){this._absoluteMin=Mi.newBound(!0),this._absoluteMax=Mi.newBound(!1)}add(e){for(const t of e.items)this.addMesh(t.mesh)}addMesh(e,t){if(!e.geometry.index)return;const i=Mi.getFragmentBounds(e);e.updateMatrixWorld();const s=e.matrixWorld,n=new Ne,r=e instanceof pi,o=new Set;if(e instanceof Ah){t||(t=e.fragment.ids);for(const a of t){const c=e.fragment.getInstancesIDs(a);if(c)for(const u of c)o.add(u)}}else o.add(0);for(const a of o){const c=i.min.clone(),u=i.max.clone();r&&(e.getMatrixAt(a,n),c.applyMatrix4(n),u.applyMatrix4(n)),c.applyMatrix4(s),u.applyMatrix4(s),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),u.x>this._absoluteMax.x&&(this._absoluteMax.x=u.x),u.y>this._absoluteMax.y&&(this._absoluteMax.y=u.y),u.z>this._absoluteMax.z&&(this._absoluteMax.z=u.z),u.x<this._absoluteMin.x&&(this._absoluteMin.x=u.x),u.y<this._absoluteMin.y&&(this._absoluteMin.y=u.y),u.z<this._absoluteMin.z&&(this._absoluteMin.z=u.z)}}addFragmentIdMap(e){const t=this.components.get(Ze);for(const i in e){const s=t.list.get(i);if(!s)continue;const n=e[i];this.addMesh(s.mesh,n)}}static getFragmentBounds(e){const t=e.geometry.attributes.position,i=Number.MAX_VALUE,s=-i,n=new z(i,i,i),r=new z(s,s,s);if(!e.geometry.index)throw new Error("Geometry must be indexed!");const o=Array.from(e.geometry.index.array);for(let a=0;a<o.length;a++){if(a%3===0&&o[a]===0&&o[a+1]===0&&o[a+2]===0){a+=2;continue}const c=o[a],u=t.getX(c),d=t.getY(c),f=t.getZ(c);u<n.x&&(n.x=u),d<n.y&&(n.y=d),f<n.z&&(n.z=f),u>r.x&&(r.x=u),d>r.y&&(r.y=d),f>r.z&&(r.z=f)}return new ut(n,r)}};R(gu,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let wo=gu;const Eu=class vu extends Ke{constructor(e){super(e),R(this,"enabled",!0),R(this,"list",{}),R(this,"onDisposed",new le),R(this,"onFragmentsDisposed",t=>{const{groupID:i,fragmentIDs:s}=t;for(const n in this.list){const r=this.list[n],o=Object.keys(r);if(o.includes(i))delete r[i],Object.values(r).length===0&&delete this.list[n];else for(const a of o){const c=r[a];for(const u of s)delete c.map[u];Object.values(c).length===0&&delete r[a]}}}),e.add(vu.uuid,this),e.get(Ze).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(Ze).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(e){for(const t in this.list){const i=this.list[t];for(const s in i){const n=i[s];delete n.map[e]}}}find(e){const t=this.components.get(Ze);if(!e){const r={};for(const[o,a]of t.list)r[o]=new Set(a.ids);return r}const i=Object.keys(e).length,s={};for(const r in e){const o=e[r];if(!this.list[r]){console.warn(`Classification ${r} does not exist.`);continue}for(const a of o){const c=this.list[r][a];if(c)for(const u in c.map){s[u]||(s[u]=new Map);for(const d of c.map[u]){const f=s[u].get(d);f===void 0?s[u].set(d,1):s[u].set(d,f+1)}}}}const n={};for(const r in s){const o=s[r];for(const[a,c]of o){if(c===void 0)throw new Error("Malformed fragments map!");c===i&&(n[r]||(n[r]=new Set),n[r].add(a))}}return n}byModel(e,t){this.list.models||(this.list.models={});const i=this.list.models;i[e]||(i[e]={map:{},id:null,name:e});const s=i[e];for(const[n,r]of t.data){const o=r[0];for(const a of o){const c=t.keyFragments.get(a);c&&(s.map[c]||(s.map[c]=new Set),s.map[c].add(n))}}}async byPredefinedType(e){var t;this.list.predefinedTypes||(this.list.predefinedTypes={});const i=this.list.predefinedTypes,s=e.getAllPropertiesIDs();for(const n of s){const r=await e.getProperties(n);if(!r)continue;const o=String((t=r.PredefinedType)==null?void 0:t.value).toUpperCase();i[o]||(i[o]={map:{},id:null,name:o});const a=i[o];for(const[c,u]of e.data){const d=u[0];for(const f of d){const m=e.keyFragments.get(f);if(!m)throw new Error("Fragment ID not found!");a.map[m]||(a.map[m]=new Set),a.map[m].add(r.expressID)}}}}byEntity(e){this.list.entities||(this.list.entities={});for(const[t,i]of e.data){const s=i[1][1],n=Xh[s];this.saveItem(e,"entities",n,t)}}async byIfcRel(e,t,i){Cs.isRel(t)&&await Cs.getRelationMap(e,t,async(s,n)=>{const{name:r}=await Cs.getEntityName(e,s);for(const o of n)this.saveItem(e,i,r??"NO REL NAME",o)})}async bySpatialStructure(e,t={}){var i,s;const n=this.components.get(hn),r=n.relationMaps[e.uuid];if(!r)throw new Error(`Classifier: model relations of ${e.name||e.uuid} have to exists to group by spatial structure.`);const o="spatialStructures",a=t.useProperties===void 0||t.useProperties;for(const[c]of r){if(t.isolate){const m=e.data.get(c);if(!m)continue;const E=m[1][1];if(E===void 0||!t.isolate.has(E))continue}const u=n.getEntityRelations(e,c,"Decomposes");if(u)for(const m of u){let E=m.toString();if(a){const g=await e.getProperties(m);if(!g)continue;E=(i=g.Name)==null?void 0:i.value}this.saveItem(e,o,E,c,m)}const d=n.getEntityRelations(e,c,"ContainsElements");if(!d)continue;let f=c.toString();if(a){const m=await e.getProperties(c);if(!m)continue;f=(s=m.Name)==null?void 0:s.value}for(const m of d){this.saveItem(e,o,f,m,c);const E=n.getEntityRelations(e,Number(m),"IsDecomposedBy");if(E)for(const g of E)this.saveItem(e,o,f,g,c)}}}setColor(e,t,i=!1){const s=this.components.get(Ze);for(const n in e){const r=s.list.get(n);if(!r)continue;const o=e[n];r.setColor(t,o,i)}}resetColor(e){const t=this.components.get(Ze);for(const i in e){const s=t.list.get(i);if(!s)continue;const n=e[i];s.resetColor(n)}}saveItem(e,t,i,s,n=null){this.list[t]||(this.list[t]={});const r=e.data.get(s);if(r)for(const o of r[0]){const a=e.keyFragments.get(o);if(a){const c=this.list[t];c[i]||(c[i]={map:{},id:n,name:i}),c[i].map[a]||(c[i].map[a]=new Set),c[i].map[a].add(s)}}}};R(Eu,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let $a=Eu;const Wg=class wu extends Ke{constructor(e){super(e),R(this,"onDisposed",new le),R(this,"enabled",!0),R(this,"height",10),R(this,"groupName","spatialStructures"),R(this,"list",new Set),e.add(wu.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(e){if(!this.enabled)return;const t=this.components.get($a),i=this.components.get(Ze),s=e?1:-1;let n=0;const r=t.list[this.groupName],o=new Ne;for(const a in r){o.elements[13]=n*s*this.height;for(const c in r[a].map){const u=i.list.get(c),d=a+c,f=this.list.has(d);if(!u||e&&f||!e&&!f)continue;e?this.list.add(d):this.list.delete(d);const m=r[a].map[c];u.applyTransform(m,o),u.mesh.computeBoundingSphere(),u.mesh.computeBoundingBox()}n++}}};R(Wg,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");const yu=class Iu extends Ke{constructor(e){super(e),R(this,"enabled",!0),this.components.add(Iu.uuid,this)}set(e,t){const i=this.components.get(Ze);if(!t){for(const[s,n]of i.list)n&&(n.setVisibility(e),this.updateCulledVisibility(n));return}for(const s in t){const n=t[s],r=i.list.get(s);r&&(r.setVisibility(e,n),this.updateCulledVisibility(r))}}isolate(e){this.set(!1),this.set(!0,e)}updateCulledVisibility(e){const t=this.components.get(nm);for(const[i,s]of t.list){const n=s.colorMeshes.get(e.id);n&&(n.count=e.mesh.count)}}};R(yu,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let Zg=yu;class Kg extends Pl{constructor(){super(...arguments),R(this,"minGeometrySize",10),R(this,"minAssetsSize",1e3)}}const Xg=class Cu extends Ke{constructor(e){super(e),R(this,"onGeometryStreamed",new le),R(this,"onAssetStreamed",new le),R(this,"onProgress",new le),R(this,"onIfcLoaded",new le),R(this,"onDisposed",new le),R(this,"settings",new Kg),R(this,"enabled",!0),R(this,"webIfc",new ln),R(this,"_spatialTree",new Qh),R(this,"_metaData",new Jh),R(this,"_visitedGeometries",new Map),R(this,"_streamSerializer",new _h),R(this,"_geometries",new Map),R(this,"_geometryCount",0),R(this,"_civil",new qh),R(this,"_groupSerializer",new xh),R(this,"_assets",[]),R(this,"_meshesWithHoles",new Set),this.components.add(Cu.uuid,this),this.settings.excludedCategories.add(bh)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllGeometries(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:i,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(t,i),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:i,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(t,i),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllGeometries(){const{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);const i=this.webIfc.GetIfcEntityList(0),s=[[]],n=new Th;n.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};let r=0,o=0;for(const E of i){if(!this.webIfc.IsIfcElement(E)&&E!==Fs||this.settings.excludedCategories.has(E))continue;const g=this.webIfc.GetLineIDsWithType(0,E),w=g.size();for(let y=0;y<w;y++){r>e&&(r=0,o++,s.push([]));const I=g.get(y);s[o].push(I);const _=this.webIfc.GetLine(0,I);if(_.GlobalId){const F=(_==null?void 0:_.GlobalId.value)||(_==null?void 0:_.GlobalId);n.globalToExpressIDs.set(F,I)}const C=this._spatialTree.itemsByFloor[I]||0;n.data.set(I,[[],[C,E]]),r++}}this._spatialTree.cleanUp();let a=.01,c=0;for(const E of s){c++,this.webIfc.StreamMeshes(0,E,w=>{this.getMesh(this.webIfc,w,n)}),this._geometryCount>e&&await this.streamGeometries(),this._assets.length>t&&await this.streamAssets();const g=c/s.length;g>a&&(a+=.01,a=Math.max(a,g),this.onProgress.trigger(Math.round(a*100)/100))}this._geometryCount&&await this.streamGeometries(),this._assets.length&&await this.streamAssets();const{opaque:u,transparent:d}=n.geometryIDs;for(const[E,{index:g,uuid:w}]of this._visitedGeometries)n.keyFragments.set(g,w),(E>1?u:d).set(E,g);$h.get(n,this.webIfc);const f=this.webIfc.GetCoordinationMatrix(0);n.coordinationMatrix.fromArray(f),n.civilData=this._civil.read(this.webIfc);const m=this._groupSerializer.export(n);this.onIfcLoaded.trigger(m),n.dispose(!0)}cleanUp(){try{this.webIfc.Dispose()}catch{}this.webIfc=null,this.webIfc=new ln,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(e,t,i){const s=t.geometries.size(),n=t.expressID,r={id:n,geometries:[]};for(let o=0;o<s;o++){const a=t.geometries.get(o),c=a.geometryExpressID,u=a.color.w===1?1:-1,d=c*u;if(!this._visitedGeometries.has(d)){this._visitedGeometries.has(c)||this.getGeometry(e,c);const C=this._visitedGeometries.size,F=er.generateUUID();this._visitedGeometries.set(d,{uuid:F,index:C})}const f=this._visitedGeometries.get(d);if(f===void 0)throw new Error("Error getting geometry data for streaming!");const m=i.data.get(n);if(!m)throw new Error("Data not found!");m[0].push(f.index);const{x:E,y:g,z:w,w:y}=a.color,I=[E,g,w,y],_=a.flatTransformation;r.geometries.push({color:I,geometryID:c,transformation:_})}this._assets.push(r)}getGeometry(e,t){const i=e.GetGeometry(0,t),s=e.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),n=e.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize()),r=new Float32Array(n.length/2),o=new Float32Array(n.length/2);for(let f=0;f<n.length;f+=6)r[f/2]=n[f],r[f/2+1]=n[f+1],r[f/2+2]=n[f+2],o[f/2]=n[f+3],o[f/2+1]=n[f+4],o[f/2+2]=n[f+5];const a=Hp(r),c=new Float32Array(a.transformation.elements),u=[a.center.x,a.center.y,a.center.z];let d=!1;for(let f=0;f<r.length-2;f+=3){const m=r[f],E=r[f+1],g=r[f+2],w=o[f],y=o[f+1],I=o[f+2];if(jp(u,[m,E,g],[w,y,I])){d=!0;break}}this._geometries.set(t,{position:r,normal:o,index:s,boundingBox:c,hasHoles:d}),i.delete(),this._geometryCount++}async streamAssets(){await this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]}async streamGeometries(){let e=this._streamSerializer.export(this._geometries),t={};for(const[i,{boundingBox:s,hasHoles:n}]of this._geometries)t[i]={boundingBox:s,hasHoles:n};this.onGeometryStreamed.trigger({data:t,buffer:e}),t=null,e=null,this._geometries.clear(),this._geometryCount=0}};R(Xg,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");class Qg extends Pl{constructor(){super(...arguments),R(this,"propertiesSize",100)}}class qg extends Ke{constructor(){super(...arguments),R(this,"onPropertiesStreamed",new Wn),R(this,"onProgress",new Wn),R(this,"onIndicesStreamed",new Wn),R(this,"onDisposed",new le),R(this,"enabled",!0),R(this,"settings",new Qg),R(this,"webIfc",new ln)}async dispose(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()}async streamFromBuffer(e){await this.readIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async streamFromCallBack(e){await this.streamIfcFile(e),await this.streamAllProperties(),this.cleanUp()}async readIfcFile(e){const{path:t,absolute:i,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(t,i),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModel(e,this.settings.webIfc)}async streamIfcFile(e){const{path:t,absolute:i,logLevel:s}=this.settings.wasm;this.webIfc.SetWasmPath(t,i),await this.webIfc.Init(),s&&this.webIfc.SetLogLevel(s),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)}async streamAllProperties(){const{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),i=new Set([Tl,xl,Al,Ao,Fs]);for(const o of i)t.add(o);let s=.01,n=0;for(const o of t){if(n++,eu.has(o))continue;const a=i.has(o),c=this.webIfc.GetLineIDsWithType(0,o),u=c.size();let d=0;for(let f=0;f<u-e;f+=e){const m={};for(let E=0;E<e;E++){d++;const g=c.get(f+E);try{const w=this.webIfc.GetLine(0,g,a);m[w.expressID]=w}catch{console.log(`Could not get property: ${g}`)}}await this.onPropertiesStreamed.trigger({type:o,data:m})}if(d!==u){const f={};for(let m=d;m<u;m++){const E=c.get(m);try{const g=this.webIfc.GetLine(0,E,a);f[g.expressID]=g}catch{console.log(`Could not get property: ${E}`)}}await this.onPropertiesStreamed.trigger({type:o,data:f})}n/t.size>s&&(s=Math.round(s*100)/100,await this.onProgress.trigger(s),s+=.01)}await this.onProgress.trigger(1);const r=await this.components.get(hn).processFromWebIfc(this.webIfc,0);await this.onIndicesStreamed.trigger(r)}cleanUp(){this.webIfc.Dispose(),this.webIfc=null,this.webIfc=new ln}}R(qg,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");class bu{constructor(e,t,i){R(this,"title"),R(this,"guid",xs.create()),R(this,"clippingPlanes",new rn),R(this,"camera",{aspectRatio:0,fov:0,direction:{x:0,y:0,z:80},position:{x:0,y:0,z:0}}),R(this,"exceptionComponents",new rn),R(this,"selectionComponents",new rn),R(this,"componentColors",new Yi),R(this,"spacesVisible",!1),R(this,"spaceBoundariesVisible",!1),R(this,"openingsVisible",!1),R(this,"defaultVisibility",!0),R(this,"_components"),R(this,"world");const s={setCamera:!0,...i},{data:n,setCamera:r}=s;this._components=e,this.world=t,n&&(this.guid=n.guid??this.guid,this.set(n)),r&&this.updateCamera()}get _selectionModelIdMap(){const e=this._components.get(Ze),t={};for(const[i,s]of e.groups){i in t||(t[i]=new Set);for(const n of this.selectionComponents){const r=s.globalToExpressIDs.get(n);r&&t[i].add(r)}}return t}get _exceptionModelIdMap(){const e=this._components.get(Ze),t={};for(const[i,s]of e.groups){i in t||(t[i]=new Set);for(const n of this.exceptionComponents){const r=s.globalToExpressIDs.get(n);r&&t[i].add(r)}}return t}get selection(){return this._components.get(Ze).modelIdToFragmentIdMap(this._selectionModelIdMap)}get exception(){return this._components.get(Ze).modelIdToFragmentIdMap(this._exceptionModelIdMap)}get projection(){return"fov"in this.camera?"Perspective":"Orthographic"}get position(){const e=this._components.get(Ze),{position:t}=this.camera,{x:i,y:s,z:n}=t,r=new z(i,s,n);return e.applyBaseCoordinateSystem(r,new Ne),r}get direction(){const{direction:e}=this.camera,{x:t,y:i,z:s}=e;return new z(t,i,s)}get _managerVersion(){return this._components.get(Gt).config.version}get topics(){return[...this._components.get(Gt).list.values()].filter(e=>e.viewpoints.has(this.guid))}addComponentsFromMap(e){const t=this._components.get(Ze).fragmentIdMapToGuids(e);this.selectionComponents.add(...t),this._components.get(ki).list.set(this.guid,this)}set(e){const t=e,i=this;for(const s in e){if(s==="guid")continue;const n=t[s];if(s==="selectionComponents"){this.selectionComponents.clear(),this.selectionComponents.add(...n);continue}if(s==="exceptionComponents"){this.exceptionComponents.clear(),this.exceptionComponents.add(...n);continue}s in this&&(i[s]=n)}return this._components.get(ki).list.set(this.guid,this),this}async go(e=!0){const{camera:t}=this.world;if(!t.hasCameraControls())throw new Error("Viewpoint: the world's camera need controls to set the viewpoint.");t instanceof Im&&t.projection.set(this.projection);const i=this.position,s=this.direction;let n={x:i.x+s.x*80,y:i.y+s.y*80,z:i.z+s.z*80};const r=this.selection;if(Object.keys(r).length===0){const a=this._components.get(li).get(this.world).castRayFromVector(i,this.direction);a&&(n=a.point)}else{const a=this._components.get(wo);a.reset(),a.addFragmentIdMap(r),n=a.getSphere().center,a.reset()}const o=this._components.get(Zg);o.set(this.defaultVisibility),o.set(!this.defaultVisibility,this.exception),o.set(!0,r),await t.controls.setLookAt(i.x,i.y,i.z,n.x,n.y,n.z,e)}updateCamera(){const{camera:e,renderer:t}=this.world;if(!t)throw new Error("Viewpoint: the world needs to have a renderer!");if(!e.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const i=new z;e.controls.getPosition(i);const s=e.three,n=new z(0,0,-1).applyEuler(s.rotation),{width:r,height:o}=t.getSize();let a=r/o;Number.isNaN(a)&&(a=1);const c=this._components.get(Ze);i.applyMatrix4(c.baseCoordinationMatrix.clone().invert());const u={aspectRatio:a,position:{x:i.x,y:i.y,z:i.z},direction:{x:n.x,y:n.y,z:n.z}};s instanceof Ih?this.camera={...u,fov:s.fov}:s instanceof ss&&(this.camera={...u,viewToWorldScale:s.top-s.bottom}),this._components.get(ki).list.set(this.guid,this)}colorize(){const e=this._components.get(ki),t=this._components.get(Ze),i=this._components.get($a);for(const[s,n]of this.componentColors){const r=t.guidToFragmentIdMap(n),o=new Ht(`#${s}`);i.setColor(r,o,e.config.overwriteColors)}}resetColors(){const e=this._components.get(Ze),t=this._components.get($a);for(const[i,s]of this.componentColors){const n=e.guidToFragmentIdMap(s);t.resetColor(n)}}async createComponentTags(e){var t,i;const s=this._components.get(Ze),n=this._components.get(Gt);let r="";if(n.config.includeSelectionTag){const o=e==="selection"?this._selectionModelIdMap:this._exceptionModelIdMap;for(const a in o){const c=s.groups.get(a);if(!c)continue;const u=o[a];for(const d of u){const f=await c.getProperties(d);if(!f)continue;const m=(t=f.GlobalId)==null?void 0:t.value;if(!m)continue;const E=(i=f.Tag)==null?void 0:i.value;let g=null;E&&(g=`AuthoringToolId="${E}"`),r+=`
<Component IfcGuid="${m}" ${g??""} />`}}}else r=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return r}async serialize(e=this._managerVersion){const t=this._components.get(Ze),i=this.position;i.applyMatrix4(t.baseCoordinationMatrix.clone().invert());const s=this.direction;s.normalize();const n=new Ne().makeRotationX(Math.PI/2),r=s.clone().applyMatrix4(n);r.normalize();const o=`<CameraViewPoint>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraViewPoint>`,a=`<CameraDirection>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraDirection>`,c=`<CameraUpVector>
      <X>${r.x}</X>
      <Y>${-r.z}</Y>
      <Z>${r.y}</Z>
    </CameraUpVector>`,u=`<AspectRatio>${this.camera.aspectRatio}</AspectRatio>`;let d="";"viewToWorld"in this.camera?d=`<OrthogonalCamera>
        ${o}
        ${a}
        ${c}
        ${u}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(d=`<PerspectiveCamera>
        ${o}
        ${a}
        ${c}
        ${u}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const f=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,m=(await this.createComponentTags("selection")).trim(),E=(await this.createComponentTags("exception")).trim();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${e==="2.1"?f:""}
        ${m.length!==0?`<Selection>${m}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${e==="3"?f:""}
          ${E.length!==0?`<Exceptions>${E}</Exceptions>`:""}
        </Visibility>
      </Components>
      ${d}
    </VisualizationInfo>`}}const Tu=class xu extends Ke{constructor(e){super(e),R(this,"enabled",!0),R(this,"list",new Yi),R(this,"isSetup",!1),R(this,"onSetup",new le),R(this,"config",{overwriteColors:!1}),R(this,"onDisposed",new le),e.add(xu.uuid,this)}create(e,t){const i=new bu(this.components,e,{data:t});return t||this.list.set(i.guid,i),i}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};R(Tu,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let ki=Tu;class Jg{constructor(e){if(R(this,"onDisposed",new le),R(this,"onAfterUpdate",new le),R(this,"onBeforeUpdate",new le),R(this,"onResize",new le),R(this,"frontOffset",0),R(this,"overrideMaterial",new Rh),R(this,"backgroundColor",new Ht(395274)),R(this,"renderer"),R(this,"enabled",!0),R(this,"world"),R(this,"_lockRotation",!0),R(this,"_camera"),R(this,"_plane"),R(this,"_size",new ft(320,160)),R(this,"_tempVector1",new z),R(this,"_tempVector2",new z),R(this,"_tempTarget",new z),R(this,"down",new z(0,-1,0)),R(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");const s=[],n=this.world.renderer.three;for(const r of n.clippingPlanes)s.push(r);s.push(this._plane),this.renderer.clippingPlanes=s}),this.world=e,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new po,this.renderer.setSize(this._size.x,this._size.y);const t=1,i=this._size.x/this._size.y;this._camera=new ss(t*i/-2,t*i/2,t/2,t/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new ns(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(e){this._lockRotation=e,e&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();const e=this.world.scene.three,t=this.world.camera;if(!t.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(e instanceof Rs))throw new Error("The given world must have a THREE.Scene as a root!");const i=t.controls;if(i.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(i.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){i.getTarget(this._tempTarget);const n=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=n+Math.PI}this._plane.set(this.down,this._tempVector1.y);const s=e.background;e.background=this.backgroundColor,this.renderer.render(e,this._camera),e.background=s,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(e=this._size){this._size.copy(e),this.renderer.setSize(e.x,e.y);const t=e.x/e.y,i=1;this._camera.left=i*t/-2,this._camera.right=i*t/2,this._camera.top=i/2,this._camera.bottom=-i/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(e)}}const $g=class Au extends Ke{constructor(e){super(e),R(this,"onAfterUpdate",new le),R(this,"onBeforeUpdate",new le),R(this,"onDisposed",new le),R(this,"enabled",!0),R(this,"list",new Map),this.components.add(Au.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a minimap!");const t=new Jg(e);return this.list.set(e.uuid,t),t}delete(e){const t=this.list.get(e);t&&t.dispose(),this.list.delete(e)}dispose(){for(const[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(const[e,t]of this.list)t.update()}};R($g,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");const _u=class Ru extends Ke{constructor(e){super(e),R(this,"enabled",!0),e.add(Ru.uuid,this)}static distanceFromPointToLine(e,t,i,s=!1){const n=new $t,r=new z;return n.set(t,i),n.closestPointToPoint(e,s,r),r.distanceTo(e)}getFace(e,t,i){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const s=new Map,n=e.geometry.index.array,{plane:r}=this.getFaceData(t,i,e),o=[];for(let d=0;d<n.length/3;d++){const{plane:f,edges:m}=this.getFaceData(d,i,e);if(f.equals(r)){o.push({index:d,edges:m});for(const{id:E,points:g,distance:w}of m)s.set(E,{points:g,distance:w})}}let a=0;const c=new Map,u=new Map;for(const{index:d,edges:f}of o){const m=new Map;for(const{id:C}of f)if(c.has(C)){const F=c.get(C);m.set(C,F)}const E=f.map(C=>C.id);if(!m.size){const C=a++;for(const{id:F}of f)c.set(F,C);u.set(C,{edges:new Set(E),indices:new Set([d])});continue}let g=null;const w=new Set,y=new Set(E);for(const[C,F]of m){g===null?g=F:F!==g&&w.add(F),c.delete(C);const{edges:M}=u.get(F);M.delete(C),y.delete(C)}if(g===null)throw new Error("Error computing face!");const I=u.get(g),{indices:_}=I;_.add(d);for(const C of y){c.set(C,g);const{edges:F}=I;F.add(C)}for(const C of w){const F=u.get(C),{edges:M,indices:D}=F,B=u.get(g),{edges:N,indices:G}=B;for(const Q of M)N.add(Q),c.set(Q,g);for(const Q of D)G.add(Q);u.delete(C)}}for(const[d,{indices:f,edges:m}]of u)if(f.has(t)){const E=[];for(const g of m){const w=s.get(g);E.push(w)}return{edges:E,indices:f}}return null}getVerticesAndNormal(e,t,i){if(!e.geometry.index)throw new Error("Geometry must be indexed!");const s=e.geometry.index.array,n=e.geometry.attributes.position.array,r=e.geometry.attributes.normal.array,o=s[t*3]*3,a=s[t*3+1]*3,c=s[t*3+2]*3,u=new z(n[o],n[o+1],n[o+2]),d=new z(n[a],n[a+1],n[a+2]),f=new z(n[c],n[c+1],n[c+2]),m=new z(r[o],r[o+1],r[o+2]),E=new z(r[a],r[a+1],r[a+2]),g=new z(r[c],r[c+1],r[c+2]),w=(m.x+E.x+g.x)/3,y=(m.y+E.y+g.y)/3,I=(m.z+E.z+g.z)/3,_=new z(w,y,I);if(i!==void 0&&e instanceof pi){const C=new Ne;e.getMatrixAt(i,C);const F=new Ne;F.extractRotation(C),_.applyMatrix4(F),u.applyMatrix4(C),d.applyMatrix4(C),f.applyMatrix4(C)}return{p1:u,p2:d,p3:f,faceNormal:_}}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}getVolumeFromFragments(e){const t=this.components.get(Ze),i=new Ne,s=[];for(const r in e){const o=t.list.get(r);if(!o)continue;const a=e[r];let c=0;for(const f of a){const m=o.getInstancesIDs(f);m&&(c+=m.size)}const u=new pi(o.mesh.geometry,void 0,c);let d=0;for(const f of a){const m=o.getInstancesIDs(f);if(m)for(const E of m)o.mesh.getMatrixAt(E,i),u.setMatrixAt(d++,i)}s.push(u)}const n=this.getVolumeFromMeshes(s);for(const r of s)r.geometry=null,r.material=[],r.dispose();return n}getVolumeFromMeshes(e){let t=0;for(const i of e)t+=this.getVolumeOfMesh(i);return t}getFaceData(e,t,i){const s=this.getVerticesAndNormal(i,e,t),{p1:n,p2:r,p3:o,faceNormal:a}=s;this.round(n),this.round(r),this.round(o),this.round(a);const c=[{id:`${n.x}|${n.y}|${n.z}`,value:n},{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o}];c.sort((I,_)=>I.id<_.id?-1:I.id>_.id?1:0);const[{id:u,value:d},{id:f,value:m},{id:E,value:g}]=c,w=[{id:`${u}|${f}`,distance:d.distanceTo(m),points:[d,m]},{id:`${f}|${E}`,distance:m.distanceTo(g),points:[m,g]},{id:`${u}|${E}`,distance:d.distanceTo(g),points:[d,g]}],y=new ns;return y.setFromNormalAndCoplanarPoint(a,n),y.constant=Math.round(y.constant*10)/10,{plane:y,edges:w}}getVolumeOfMesh(e){let t=0;const i=new z,s=new z,n=new z,{index:r}=e.geometry,o=e.geometry.attributes.position.array;if(!r)return console.warn("Geometry must be indexed to compute its volume!"),0;const a=[];if(e instanceof pi)for(let u=0;u<e.count;u++){const d=new Ne;e.getMatrixAt(u,d),a.push(d)}else a.push(new Ne().identity());const{matrixWorld:c}=e;for(let u=0;u<r.array.length-2;u+=3)for(const d of a){const f=d.multiply(c),m=r.array[u]*3,E=r.array[u+1]*3,g=r.array[u+2]*3;i.set(o[m],o[m+1],o[m+2]).applyMatrix4(f),s.set(o[E],o[E+1],o[E+2]).applyMatrix4(f),n.set(o[g],o[g+1],o[g+2]).applyMatrix4(f),t+=this.getSignedVolumeOfTriangle(i,s,n)}return Math.abs(t)}getSignedVolumeOfTriangle(e,t,i){const s=i.x*t.y*e.z,n=t.x*i.y*e.z,r=i.x*e.y*t.z,o=e.x*i.y*t.z,a=t.x*e.y*i.z,c=e.x*t.y*i.z;return 1/6*(-s+n+r-o-a+c)}};R(_u,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");let bs=_u;const ah=new ut,Jr=new z;class Fu extends Cf{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new on(e,3)),this.setAttribute("uv",new on(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Da(t,6,1);return this.setAttribute("instanceStart",new tn(i,3,0)),this.setAttribute("instanceEnd",new tn(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const i=new Da(t,6,1);return this.setAttribute("instanceColorStart",new tn(i,3,0)),this.setAttribute("instanceColorEnd",new tn(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new bf(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ut);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),ah.setFromBufferAttribute(t),this.boundingBox.union(ah))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _s),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let s=0;for(let n=0,r=e.count;n<r;n++)Jr.fromBufferAttribute(e,n),s=Math.max(s,i.distanceToSquared(Jr)),Jr.fromBufferAttribute(t,n),s=Math.max(s,i.distanceToSquared(Jr));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}ro.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ft(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};oo.line={uniforms:ul.merge([ro.common,ro.fog,ro.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class tr extends Nt{constructor(e){super({type:"LineMaterial",uniforms:ul.clone(oo.line.uniforms),vertexShader:oo.line.vertexShader,fragmentShader:oo.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}}const lh=new z,ch=new z,Ft=new un,St=new un,Ti=new un,Sa=new z,Oa=new Ne,Ot=new $t,hh=new z,$r=new ut,eo=new _s,xi=new un;let _i,Ts;function uh(l,e,t){return xi.set(0,0,-e,1).applyMatrix4(l.projectionMatrix),xi.multiplyScalar(1/xi.w),xi.x=Ts/t.width,xi.y=Ts/t.height,xi.applyMatrix4(l.projectionMatrixInverse),xi.multiplyScalar(1/xi.w),Math.abs(Math.max(xi.x,xi.y))}function e0(l,e){const t=l.matrixWorld,i=l.geometry,s=i.attributes.instanceStart,n=i.attributes.instanceEnd,r=Math.min(i.instanceCount,s.count);for(let o=0,a=r;o<a;o++){Ot.start.fromBufferAttribute(s,o),Ot.end.fromBufferAttribute(n,o),Ot.applyMatrix4(t);const c=new z,u=new z;_i.distanceSqToSegment(Ot.start,Ot.end,u,c),u.distanceTo(c)<Ts*.5&&e.push({point:u,pointOnLine:c,distance:_i.origin.distanceTo(u),object:l,face:null,faceIndex:o,uv:null,uv1:null})}}function t0(l,e,t){const i=e.projectionMatrix,s=l.material.resolution,n=l.matrixWorld,r=l.geometry,o=r.attributes.instanceStart,a=r.attributes.instanceEnd,c=Math.min(r.instanceCount,o.count),u=-e.near;_i.at(1,Ti),Ti.w=1,Ti.applyMatrix4(e.matrixWorldInverse),Ti.applyMatrix4(i),Ti.multiplyScalar(1/Ti.w),Ti.x*=s.x/2,Ti.y*=s.y/2,Ti.z=0,Sa.copy(Ti),Oa.multiplyMatrices(e.matrixWorldInverse,n);for(let d=0,f=c;d<f;d++){if(Ft.fromBufferAttribute(o,d),St.fromBufferAttribute(a,d),Ft.w=1,St.w=1,Ft.applyMatrix4(Oa),St.applyMatrix4(Oa),Ft.z>u&&St.z>u)continue;if(Ft.z>u){const y=Ft.z-St.z,I=(Ft.z-u)/y;Ft.lerp(St,I)}else if(St.z>u){const y=St.z-Ft.z,I=(St.z-u)/y;St.lerp(Ft,I)}Ft.applyMatrix4(i),St.applyMatrix4(i),Ft.multiplyScalar(1/Ft.w),St.multiplyScalar(1/St.w),Ft.x*=s.x/2,Ft.y*=s.y/2,St.x*=s.x/2,St.y*=s.y/2,Ot.start.copy(Ft),Ot.start.z=0,Ot.end.copy(St),Ot.end.z=0;const m=Ot.closestPointToPointParameter(Sa,!0);Ot.at(m,hh);const E=er.lerp(Ft.z,St.z,m),g=E>=-1&&E<=1,w=Sa.distanceTo(hh)<Ts*.5;if(g&&w){Ot.start.fromBufferAttribute(o,d),Ot.end.fromBufferAttribute(a,d),Ot.start.applyMatrix4(n),Ot.end.applyMatrix4(n);const y=new z,I=new z;_i.distanceSqToSegment(Ot.start,Ot.end,I,y),t.push({point:I,pointOnLine:y,distance:_i.origin.distanceTo(I),object:l,face:null,faceIndex:d,uv:null,uv1:null})}}}class i0 extends Ae{constructor(e=new Fu,t=new tr({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,s=new Float32Array(2*t.count);for(let r=0,o=0,a=t.count;r<a;r++,o+=2)lh.fromBufferAttribute(t,r),ch.fromBufferAttribute(i,r),s[o]=o===0?0:s[o-1],s[o+1]=s[o]+lh.distanceTo(ch);const n=new Da(s,2,1);return e.setAttribute("instanceDistanceStart",new tn(n,1,0)),e.setAttribute("instanceDistanceEnd",new tn(n,1,1)),this}raycast(e,t){const i=this.material.worldUnits,s=e.camera;s===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const n=e.params.Line2!==void 0&&e.params.Line2.threshold||0;_i=e.ray;const r=this.matrixWorld,o=this.geometry,a=this.material;Ts=a.linewidth+n,o.boundingSphere===null&&o.computeBoundingSphere(),eo.copy(o.boundingSphere).applyMatrix4(r);let c;if(i)c=Ts*.5;else{const d=Math.max(s.near,eo.distanceToPoint(_i.origin));c=uh(s,d,a.resolution)}if(eo.radius+=c,_i.intersectsSphere(eo)===!1)return;o.boundingBox===null&&o.computeBoundingBox(),$r.copy(o.boundingBox).applyMatrix4(r);let u;if(i)u=Ts*.5;else{const d=Math.max(s.near,$r.distanceToPoint(_i.origin));u=uh(s,d,a.resolution)}$r.expandByScalar(u),_i.intersectsBox($r)!==!1&&(i?e0(this,t):t0(this,s,t))}}class yo extends Fu{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let s=0;s<t;s+=3)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];return super.setPositions(i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let s=0;s<t;s+=3)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];return super.setColors(i),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Su extends i0{constructor(e=new yo,t=new tr({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}const Ou=class Pu{constructor(e,t){S(this,"scene"),S(this,"onSelect",new le),S(this,"type"),S(this,"selectCurve"),S(this,"selectPoints"),S(this,"hoverCurve"),S(this,"hoverPoints"),S(this,"caster",new Co),this.scene=e,this.type=t,this.hoverCurve=this.newCurve(.003,4473924,!1),this.hoverPoints=this.newPoints(5,4473924),this.selectCurve=this.newCurve(.005,16777215,!0),this.selectPoints=this.newPoints(7,16777215)}dispose(){this.selectCurve&&this.scene.remove(this.selectCurve),this.selectCurve.material.dispose(),this.selectCurve.geometry.dispose(),this.selectCurve=null,this.hoverCurve.material.dispose(),this.hoverCurve.geometry.dispose(),this.hoverCurve=null,this.hoverPoints.material.dispose(),this.hoverPoints.geometry.dispose(),this.selectPoints.material.dispose(),this.selectPoints.geometry.dispose(),this.scene=null}castRay(e,t,i,s){const n=new ft,r=i.getBoundingClientRect();n.x=(e.clientX-r.left)/r.width*2-1,n.y=-((e.clientY-r.top)/r.height)*2+1,this.caster.setFromCamera(n,t);const o=this.caster.intersectObjects(s);return o.length?o[0]:null}select(e){this.highlight(e,this.selectCurve,this.selectPoints,!0),this.onSelect.trigger(e)}unSelect(){this.selectCurve.removeFromParent(),this.selectPoints.removeFromParent()}hover(e){this.highlight(e,this.hoverCurve,this.hoverPoints,!1)}unHover(){this.hoverCurve.removeFromParent(),this.hoverPoints.removeFromParent()}setResolution({x:e,y:t}){this.selectCurve.material.resolution.set(e/t,1),this.hoverCurve.material.resolution.set(e/t,1)}highlight(e,t,i,s){const{alignment:n}=e.curve;this.scene.add(t),this.scene.add(i);const r=[],o=[],a=[];for(const f of n[this.type]){const m=f.mesh.geometry.attributes.position;for(const y of m.array)r.push(y);if(s){let y;if(this.type==="absolute"){const{horizontal:_}=f.alignment;y=_[f.index].data.TYPE}else y=f.data.TYPE;const I=Pu.settings.colors[y]||[1,1,1];for(let _=0;_<m.count;_++)o.push(...I)}const[E,g,w]=m.array;a.push(new z(E,g,w))}const c=r[r.length-3],u=r[r.length-2],d=r[r.length-1];a.push(new z(c,u,d)),r.length/3>t.geometry.attributes.position.count&&(t.geometry.dispose(),t.geometry=new yo),t.geometry.setPositions(r),s&&t.geometry.setColors(o),i.geometry.setFromPoints(a)}newCurve(e,t,i){const s=new yo,n=new tr({color:t,linewidth:e,vertexColors:i,worldUnits:!1,depthTest:!1}),r=new Su(s,n);return this.scene.add(r),r}newPoints(e,t){const i=new rt,s=new Kt(new Float32Array,3);i.setAttribute("position",s);const n=new Hd({size:e,color:t,sizeAttenuation:!1,depthTest:!1}),r=new jd(i,n);return r.frustumCulled=!1,this.scene.add(r),r}};S(Ou,"settings",{colors:{LINE:[213/255,0/255,255/255],CIRCULARARC:[0/255,46,255/255],CLOTHOID:[0/255,255/255,0/255],PARABOLICARC:[0/255,255/255,72/255],CONSTANTGRADIENT:[213/255,0/255,255/255]}});let Du=Ou;class s0 extends an{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new ft(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Js=new z,dh=new Ne,fh=new Ne,ph=new z,mh=new z;class n0{constructor(e={}){const t=this;let i,s,n,r;const o={objects:new WeakMap},a=e.element!==void 0?e.element:document.createElement("div");a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:i,height:s}},this.render=function(m,E){m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),E.parent===null&&E.matrixWorldAutoUpdate===!0&&E.updateMatrixWorld(),dh.copy(E.matrixWorldInverse),fh.multiplyMatrices(E.projectionMatrix,dh),c(m,m,E),f(m)},this.setSize=function(m,E){i=m,s=E,n=i/2,r=s/2,a.style.width=m+"px",a.style.height=E+"px"};function c(m,E,g){if(m.isCSS2DObject){Js.setFromMatrixPosition(m.matrixWorld),Js.applyMatrix4(fh);const w=m.visible===!0&&Js.z>=-1&&Js.z<=1&&m.layers.test(g.layers)===!0;if(m.element.style.display=w===!0?"":"none",w===!0){m.onBeforeRender(t,E,g);const I=m.element;I.style.transform="translate("+-100*m.center.x+"%,"+-100*m.center.y+"%)translate("+(Js.x*n+n)+"px,"+(-Js.y*r+r)+"px)",I.parentNode!==a&&a.appendChild(I),m.onAfterRender(t,E,g)}const y={distanceToCameraSquared:u(g,m)};o.objects.set(m,y)}for(let w=0,y=m.children.length;w<y;w++)c(m.children[w],E,g)}function u(m,E){return ph.setFromMatrixPosition(m.matrixWorld),mh.setFromMatrixPosition(E.matrixWorld),ph.distanceToSquared(mh)}function d(m){const E=[];return m.traverse(function(g){g.isCSS2DObject&&E.push(g)}),E}function f(m){const E=d(m).sort(function(w,y){if(w.renderOrder!==y.renderOrder)return y.renderOrder-w.renderOrder;const I=o.objects.get(w).distanceToCameraSquared,_=o.objects.get(y).distanceToCameraSquared;return I-_}),g=E.length;for(let w=0,y=E.length;w<y;w++)E[w].element.style.zIndex=g-w}}}class Zt{constructor(e,t,i){S(this,"three"),S(this,"world"),S(this,"onDisposed",new le),this.world=e;let s;t?s=t:(s=document.createElement("div"),s.style.width="15px",s.style.height="15px",s.style.border="5px solid red"),this.three=new s0(s),(i||e.scene.three).add(this.three),this.visible=!0}set visible(e){this.three.visible=e}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}}class r0 extends Xp{constructor(e,t,i){super(e,t,i),S(this,"three2D",new n0),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;const s=this.currentWorld.scene.three,n=this.currentWorld.camera.three;s instanceof Rs&&this.three2D.render(s,n)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:s,y:n})=>{this.three2D.setSize(s,n)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&this.container.appendChild(this.three2D.domElement)}}const Mu=class Lu extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"enabled",!0),S(this,"threshold",50),S(this,"autoCluster",!0),S(this,"list",new Map),S(this,"clusterLabels",new Set),S(this,"currentKeys",new Set),S(this,"_color","white"),S(this,"_markerKey",0),S(this,"_clusterKey",0),S(this,"_worldEvents",new Map),S(this,"_setupWorlds",new Set),e.add(Lu.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(const[t,i]of this.list)for(const[s,n]of i)n.label.three.element.style.color=e}create(e,t,i,s=!1){this.setupEvents(e,!0);const n=this._markerKey.toString(),r=this.getWorldMarkerList(e);if(r.has(n))return;const o=document.createElement("span");o.innerHTML=t,o.style.color=this._color;const a=new Zt(e,o);return a.three.position.copy(i),r.set(n,{key:n,label:a,merged:!1,static:s}),this._markerKey++,n}delete(e){for(const[t,i]of this.list){const s=i.get(e);s&&s.label.dispose(),i.delete(e)}}getWorldMarkerList(e){return this.list.has(e.uuid)||this.list.set(e.uuid,new Map),this.list.get(e.uuid)}dispose(e){for(const[t,i]of this.list){const s=[...i.keys()];for(const n of s){const r=i.get(n);e&&r.type!==e||(r.label.dispose(),i.delete(n))}}if(!e){this.list.clear(),this._markerKey=0;for(const t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(e,t){if(t&&this._setupWorlds.has(e.uuid)||!e.camera.hasCameraControls())return;const i=this.getWorldEvent(e);e.camera.controls.removeEventListener("sleep",i),e.camera.controls.removeEventListener("rest",i),t&&(e.camera.controls.addEventListener("sleep",i),e.camera.controls.addEventListener("rest",i))}cluster(e){if(!this.autoCluster)return;this.resetMarkers();const t=this.list.get(e.uuid);if(t){for(const[i,s]of t)if(!s.merged&&!s.static){this.currentKeys.clear();for(const[n,r]of t)r.static||s.key!==r.key&&!r.merged&&this.distance(s.label,r.label)<this.threshold&&(this.currentKeys.add(r.key),r.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(s.key),s.merged=!0;const n=Array.from(this.currentKeys),r=this.getAveragePositionFromLabels(n),o=new Zt(s.label.world,this.createClusterElement(this._clusterKey.toString())),{element:a}=o.three;a.textContent=n.length.toString(),o.three.position.copy(r),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:n,label:o}),this._clusterKey++}}this.removeMergeMarkers(e)}}getWorldEvent(e){if(!this._worldEvents.has(e.uuid)){const t=()=>{this.cluster(e)};this._worldEvents.set(e.uuid,t)}return this._worldEvents.get(e.uuid)}resetMarkers(){for(const[e,t]of this.list)for(const[i,s]of t)s.merged=!1;for(const e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(e){const t=this.list.get(e.uuid);if(t){for(const[i,s]of t)s.merged?s.label.dispose():s.label.world.scene.three.add(s.label.three);for(const i of this.clusterLabels)if(i.markerKeys.length===1){for(const[s,n]of this.list){const r=n.get(i.markerKeys[0]);r&&(r.label.world.scene.three.add(r.label.three),r.merged=!1)}i.label.dispose(),this.clusterLabels.delete(i)}}}getAveragePositionFromLabels(e){const t=e.map(i=>{for(const[s,n]of this.list){const r=n.get(i);if(r)return r.label.three.position}return new z});return t.reduce((i,s)=>i.add(s),new z).divideScalar(t.length)}createClusterElement(e){const t=document.createElement("div");return t.textContent=e,t.style.color="#000000",t.style.background="#FFFFFF",t.style.fontSize="1.2rem",t.style.fontWeight="500",t.style.pointerEvents="auto",t.style.borderRadius="50%",t.style.padding="5px 11px",t.style.textAlign="center",t.style.cursor="pointer",t.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),t.addEventListener("pointerover",()=>{t.style.background="#BCF124"}),t.addEventListener("pointerout",()=>{t.style.background="#FFFFFF"}),t}getScreenPosition(e){const t=new z;if(!e.world.renderer)throw new Error("Renderer not found!");const i=e.three.position.clone();i.project(e.world.camera.three);const s=e.world.renderer.getSize();return t.x=i.x*s.x/2+s.x/2,t.y=-(i.y*s.y/2)+s.y/2,t}distance(e,t){const i=this.getScreenPosition(e),s=this.getScreenPosition(t),n=i.x-s.x,r=i.y-s.y,o=Math.sqrt(n*n+r*r)*.5;return o===0?this.threshold+1:o}navigateToCluster(e){const t=[],i=Array.from(this.clusterLabels).find(c=>c.key===e);if(!i)return;const s=i.label.world.camera;if(!s.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(const c of i.markerKeys)for(const[u,d]of this.list){const f=d.get(c);if(f){const{x:m,y:E,z:g}=f.label.three.position;t.push(m,E,g)}}i.label.dispose(),this.clusterLabels.delete(i);const n=new rt,r=new Float32Array(t),o=new Kt(r,3);n.setAttribute("position",o);const a=new Ae(n);a.geometry.computeBoundingSphere(),a.geometry.boundingSphere&&s.controls.fitToSphere(a,!0),n.dispose(),a.clear(),t.length=0}};S(Mu,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");let Es=Mu;var gh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nu(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Nl={exports:{}};Nl.exports=Oo;Nl.exports.default=Oo;function Oo(l,e,t){t=t||2;var i=e&&e.length,s=i?e[0]*t:l.length,n=Uu(l,0,s,t,!0),r=[];if(!n||n.next===n.prev)return r;var o,a,c,u,d,f,m;if(i&&(n=h0(l,e,n,t)),l.length>80*t){o=c=l[0],a=u=l[1];for(var E=t;E<s;E+=t)d=l[E],f=l[E+1],d<o&&(o=d),f<a&&(a=f),d>c&&(c=d),f>u&&(u=f);m=Math.max(c-o,u-a),m=m!==0?32767/m:0}return Xn(n,r,t,o,a,m,0),r}function Uu(l,e,t,i,s){var n,r;if(s===il(l,e,t,i)>0)for(n=e;n<t;n+=i)r=Eh(n,l[n],l[n+1],r);else for(n=t-i;n>=e;n-=i)r=Eh(n,l[n],l[n+1],r);return r&&Po(r,r.next)&&(qn(r),r=r.next),r}function As(l,e){if(!l)return l;e||(e=l);var t=l,i;do if(i=!1,!t.steiner&&(Po(t,t.next)||Et(t.prev,t,t.next)===0)){if(qn(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Xn(l,e,t,i,s,n,r){if(l){!r&&n&&m0(l,i,s,n);for(var o=l,a,c;l.prev!==l.next;){if(a=l.prev,c=l.next,n?a0(l,i,s,n):o0(l)){e.push(a.i/t|0),e.push(l.i/t|0),e.push(c.i/t|0),qn(l),l=c.next,o=c.next;continue}if(l=c,l===o){r?r===1?(l=l0(As(l),e,t),Xn(l,e,t,i,s,n,2)):r===2&&c0(l,e,t,i,s,n):Xn(As(l),e,t,i,s,n,1);break}}}}function o0(l){var e=l.prev,t=l,i=l.next;if(Et(e,t,i)>=0)return!1;for(var s=e.x,n=t.x,r=i.x,o=e.y,a=t.y,c=i.y,u=s<n?s<r?s:r:n<r?n:r,d=o<a?o<c?o:c:a<c?a:c,f=s>n?s>r?s:r:n>r?n:r,m=o>a?o>c?o:c:a>c?a:c,E=i.next;E!==e;){if(E.x>=u&&E.x<=f&&E.y>=d&&E.y<=m&&nn(s,o,n,a,r,c,E.x,E.y)&&Et(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function a0(l,e,t,i){var s=l.prev,n=l,r=l.next;if(Et(s,n,r)>=0)return!1;for(var o=s.x,a=n.x,c=r.x,u=s.y,d=n.y,f=r.y,m=o<a?o<c?o:c:a<c?a:c,E=u<d?u<f?u:f:d<f?d:f,g=o>a?o>c?o:c:a>c?a:c,w=u>d?u>f?u:f:d>f?d:f,y=el(m,E,e,t,i),I=el(g,w,e,t,i),_=l.prevZ,C=l.nextZ;_&&_.z>=y&&C&&C.z<=I;){if(_.x>=m&&_.x<=g&&_.y>=E&&_.y<=w&&_!==s&&_!==r&&nn(o,u,a,d,c,f,_.x,_.y)&&Et(_.prev,_,_.next)>=0||(_=_.prevZ,C.x>=m&&C.x<=g&&C.y>=E&&C.y<=w&&C!==s&&C!==r&&nn(o,u,a,d,c,f,C.x,C.y)&&Et(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;_&&_.z>=y;){if(_.x>=m&&_.x<=g&&_.y>=E&&_.y<=w&&_!==s&&_!==r&&nn(o,u,a,d,c,f,_.x,_.y)&&Et(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;C&&C.z<=I;){if(C.x>=m&&C.x<=g&&C.y>=E&&C.y<=w&&C!==s&&C!==r&&nn(o,u,a,d,c,f,C.x,C.y)&&Et(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function l0(l,e,t){var i=l;do{var s=i.prev,n=i.next.next;!Po(s,n)&&Bu(s,i,i.next,n)&&Qn(s,n)&&Qn(n,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(n.i/t|0),qn(i),qn(i.next),i=l=n),i=i.next}while(i!==l);return As(i)}function c0(l,e,t,i,s,n){var r=l;do{for(var o=r.next.next;o!==r.prev;){if(r.i!==o.i&&v0(r,o)){var a=ku(r,o);r=As(r,r.next),a=As(a,a.next),Xn(r,e,t,i,s,n,0),Xn(a,e,t,i,s,n,0);return}o=o.next}r=r.next}while(r!==l)}function h0(l,e,t,i){var s=[],n,r,o,a,c;for(n=0,r=e.length;n<r;n++)o=e[n]*i,a=n<r-1?e[n+1]*i:l.length,c=Uu(l,o,a,i,!1),c===c.next&&(c.steiner=!0),s.push(E0(c));for(s.sort(u0),n=0;n<s.length;n++)t=d0(s[n],t);return t}function u0(l,e){return l.x-e.x}function d0(l,e){var t=f0(l,e);if(!t)return e;var i=ku(t,l);return As(i,i.next),As(t,t.next)}function f0(l,e){var t=e,i=l.x,s=l.y,n=-1/0,r;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){var o=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=i&&o>n&&(n=o,r=t.x<t.next.x?t:t.next,o===i))return r}t=t.next}while(t!==e);if(!r)return null;var a=r,c=r.x,u=r.y,d=1/0,f;t=r;do i>=t.x&&t.x>=c&&i!==t.x&&nn(s<u?i:n,s,c,u,s<u?n:i,s,t.x,t.y)&&(f=Math.abs(s-t.y)/(i-t.x),Qn(t,l)&&(f<d||f===d&&(t.x>r.x||t.x===r.x&&p0(r,t)))&&(r=t,d=f)),t=t.next;while(t!==a);return r}function p0(l,e){return Et(l.prev,l,e.prev)<0&&Et(e.next,l,l.next)<0}function m0(l,e,t,i){var s=l;do s.z===0&&(s.z=el(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==l);s.prevZ.nextZ=null,s.prevZ=null,g0(s)}function g0(l){var e,t,i,s,n,r,o,a,c=1;do{for(t=l,l=null,n=null,r=0;t;){for(r++,i=t,o=0,e=0;e<c&&(o++,i=i.nextZ,!!i);e++);for(a=c;o>0||a>0&&i;)o!==0&&(a===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,o--):(s=i,i=i.nextZ,a--),n?n.nextZ=s:l=s,s.prevZ=n,n=s;t=i}n.nextZ=null,c*=2}while(r>1);return l}function el(l,e,t,i,s){return l=(l-t)*s|0,e=(e-i)*s|0,l=(l|l<<8)&16711935,l=(l|l<<4)&252645135,l=(l|l<<2)&858993459,l=(l|l<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,l|e<<1}function E0(l){var e=l,t=l;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==l);return t}function nn(l,e,t,i,s,n,r,o){return(s-r)*(e-o)>=(l-r)*(n-o)&&(l-r)*(i-o)>=(t-r)*(e-o)&&(t-r)*(n-o)>=(s-r)*(i-o)}function v0(l,e){return l.next.i!==e.i&&l.prev.i!==e.i&&!w0(l,e)&&(Qn(l,e)&&Qn(e,l)&&y0(l,e)&&(Et(l.prev,l,e.prev)||Et(l,e.prev,e))||Po(l,e)&&Et(l.prev,l,l.next)>0&&Et(e.prev,e,e.next)>0)}function Et(l,e,t){return(e.y-l.y)*(t.x-e.x)-(e.x-l.x)*(t.y-e.y)}function Po(l,e){return l.x===e.x&&l.y===e.y}function Bu(l,e,t,i){var s=io(Et(l,e,t)),n=io(Et(l,e,i)),r=io(Et(t,i,l)),o=io(Et(t,i,e));return!!(s!==n&&r!==o||s===0&&to(l,t,e)||n===0&&to(l,i,e)||r===0&&to(t,l,i)||o===0&&to(t,e,i))}function to(l,e,t){return e.x<=Math.max(l.x,t.x)&&e.x>=Math.min(l.x,t.x)&&e.y<=Math.max(l.y,t.y)&&e.y>=Math.min(l.y,t.y)}function io(l){return l>0?1:l<0?-1:0}function w0(l,e){var t=l;do{if(t.i!==l.i&&t.next.i!==l.i&&t.i!==e.i&&t.next.i!==e.i&&Bu(t,t.next,l,e))return!0;t=t.next}while(t!==l);return!1}function Qn(l,e){return Et(l.prev,l,l.next)<0?Et(l,e,l.next)>=0&&Et(l,l.prev,e)>=0:Et(l,e,l.prev)<0||Et(l,l.next,e)<0}function y0(l,e){var t=l,i=!1,s=(l.x+e.x)/2,n=(l.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&s<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==l);return i}function ku(l,e){var t=new tl(l.i,l.x,l.y),i=new tl(e.i,e.x,e.y),s=l.next,n=e.prev;return l.next=e,e.prev=l,t.next=s,s.prev=t,i.next=t,t.prev=i,n.next=i,i.prev=n,i}function Eh(l,e,t,i){var s=new tl(l,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function qn(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function tl(l,e,t){this.i=l,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Oo.deviation=function(l,e,t,i){var s=e&&e.length,n=s?e[0]*t:l.length,r=Math.abs(il(l,0,n,t));if(s)for(var o=0,a=e.length;o<a;o++){var c=e[o]*t,u=o<a-1?e[o+1]*t:l.length;r-=Math.abs(il(l,c,u,t))}var d=0;for(o=0;o<i.length;o+=3){var f=i[o]*t,m=i[o+1]*t,E=i[o+2]*t;d+=Math.abs((l[f]-l[E])*(l[m+1]-l[f+1])-(l[f]-l[m])*(l[E+1]-l[f+1]))}return r===0&&d===0?0:Math.abs((d-r)/r)};function il(l,e,t,i){for(var s=0,n=e,r=t-i;n<t;n+=i)s+=(l[r]-l[n])*(l[n+1]+l[r+1]),r=n;return s}Oo.flatten=function(l){for(var e=l[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,s=0;s<l.length;s++){for(var n=0;n<l[s].length;n++)for(var r=0;r<e;r++)t.vertices.push(l[s][n][r]);s>0&&(i+=l[s-1].length,t.holes.push(i))}return t};var I0=Nl.exports;const C0=Nu(I0),b0={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class fn{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const T0=new ss(-1,1,1,-1,0,1);class x0 extends rt{constructor(){super(),this.setAttribute("position",new on([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new on([0,2,0,0,2,0],2))}}const A0=new x0;class zu{constructor(e){this._mesh=new Ae(A0,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,T0)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Vu extends fn{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Nt?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=ul.clone(e.uniforms),this.material=new Nt({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new zu(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class vh extends fn{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){const s=e.getContext(),n=e.state;n.buffers.color.setMask(!1),n.buffers.depth.setMask(!1),n.buffers.color.setLocked(!0),n.buffers.depth.setLocked(!0);let r,o;this.inverse?(r=0,o=1):(r=1,o=0),n.buffers.stencil.setTest(!0),n.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),n.buffers.stencil.setFunc(s.ALWAYS,r,4294967295),n.buffers.stencil.setClear(o),n.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),n.buffers.color.setLocked(!1),n.buffers.depth.setLocked(!1),n.buffers.color.setMask(!0),n.buffers.depth.setMask(!0),n.buffers.stencil.setLocked(!1),n.buffers.stencil.setFunc(s.EQUAL,1,4294967295),n.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),n.buffers.stencil.setLocked(!0)}}class _0 extends fn{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class R0{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const i=e.getSize(new ft);this._width=i.width,this._height=i.height,t=new zi(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:_l}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Vu(b0),this.copyPass.material.blending=of,this.clock=new Ch}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let i=!1;for(let s=0,n=this.passes.length;s<n;s++){const r=this.passes[s];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),r.needsSwap){if(i){const o=this.renderer.getContext(),a=this.renderer.state.buffers.stencil;a.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}vh!==void 0&&(r instanceof vh?i=!0:r instanceof _0&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ft);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const i=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(i,s),this.renderTarget2.setSize(i,s);for(let n=0;n<this.passes.length;n++)this.passes[n].setSize(i,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class F0 extends fn{constructor(e,t,i=null,s=null,n=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=s,this.clearAlpha=n,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Ht}render(e,t,i){const s=e.autoClear;e.autoClear=!1;let n,r;this.overrideMaterial!==null&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(n=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(n),this.overrideMaterial!==null&&(this.scene.overrideMaterial=r),e.autoClear=s}}const ir=new rt;ir.setAttribute("position",new Kt(new Float32Array([-1,-1,3,-1,-1,3]),2));ir.setAttribute("uv",new Kt(new Float32Array([0,0,2,0,0,2]),2));ir.boundingSphere=new _s;ir.computeBoundingSphere=function(){};const S0=new ss;class so{constructor(e){this._mesh=new Ae(ir,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,S0)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}}const O0={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new Ne},viewMat:{value:new Ne},projViewMat:{value:new Ne},projectionMatrixInv:{value:new Ne},viewMatrixInv:{value:new Ne},cameraPos:{value:new z},resolution:{value:new ft},time:{value:0},samples:{value:[]},samplesR:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float[SAMPLES] samplesR;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
    //  vec3 normal = texture2D(sceneNormal, vUv).rgb;//computeNormal(worldPos, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec3 randomVec = normalize(noise.rgb * 2.0 - 1.0);
      vec3 tangent = normalize(randomVec - normal * dot(randomVec, normal));
      vec3 bitangent = cross(normal, tangent);
      mat3 tbn = mat3(tangent, bitangent, normal);
      float occluded = 0.0;
      float totalWeight = 0.0;
     /* float radiusScreen = distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(48.0, 0.0) / resolution)
      );/*vUv.x < 0.5 ? radius : min(distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(100.0, 0.0) / resolution)
      ), radius);
      float distanceFalloffScreen = radiusScreen * 0.2;*/
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
      float bias = (0.1 / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = 
        tbn * 
        samples[int(i)];
        ;
        float moveAmt = samplesR[int(mod(i + noise.a * FSAMPLES, FSAMPLES))];
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projViewMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;
        /*float distSample = logDepth ? linearize_depth_log(sampleDepth, near, far) 
         (ortho ?  linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far));*/
        #ifdef LOGDEPTH
        float distSample = linearize_depth_log(sampleDepth, near, far);
        #else
        float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
        #endif
        float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
        float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
        vec2 diff = gl_FragCoord.xy - ( offset.xy * resolution);
        float weight = dot(sampleDirection, normal);
          occluded += rangeCheck * weight * 
            (distSample + bias
               < distWorld ? 1.0 : 0.0) * (
          (dot(
            diff,
            diff
             
            ) < 1.0 || (sampleDepth == depth) || (
              offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0
            ) ? 0.0 : 1.0)
          );
          totalWeight += weight;
      }
      float occ = clamp(1.0 - occluded / totalWeight, 0.0, 1.0);
      gl_FragColor = vec4(0.5 + 0.5 * normal, occ);
}`},P0={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new Ne},viewMat:{value:new Ne},projectionMatrixInv:{value:new Ne},viewMatrixInv:{value:new Ne},cameraPos:{value:new z},resolution:{value:new ft},color:{value:new z(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform sampler2D sceneDepth;
    uniform sampler2D downsampledDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform float radius;
    uniform float distanceFalloff;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);

        #ifdef HALFRES 
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.xyz * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

     
        float finalAo = pow(texel.a, intensity);
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},D0={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new Ne},viewMat:{value:new Ne},projectionMatrixInv:{value:new Ne},viewMatrixInv:{value:new Ne},cameraPos:{value:new z},resolution:{value:new ft},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.a;
        float baseOcc = data.a;
        vec3 normal = data.rgb * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
            radiusToUse * distanceFalloff
        : distanceFalloff;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.a;
            vec3 normalSample = dataSample.rgb * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
            float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        occlusion /= count;
        gl_FragColor = vec4(0.5 + 0.5 * normal, occlusion);
    }
    `},M0={uniforms:{sceneDepth:{value:null},resolution:{value:new ft},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new Ne},projectionMatrixInv:{value:new Ne},logDepth:{value:!1}},vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        vec2[] uvSamples = vec2[4](
            uv,
            uv + vec2(pixelSize.x, 0.0),
            uv + vec2(0.0, pixelSize.y),
            uv + pixelSize
        );
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[] samples = float[4](depth00, depth10, depth01, depth11);
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
       /* float[] samples = float[4](depth00, depth10, depth01, depth11);
        float c = 0.25 * (depth00 + depth10 + depth01 + depth11);
        float[] distances = float[4](depth00, depth10, depth01, depth11);
        float maxDistance = max(max(distances[0], distances[1]), max(distances[2], distances[3]));

        int remaining[3];
        int rejected[3];
        int i, j, k;

        for(i = 0, j = 0, k = 0; i < 4; ++i) {
            if (distances[i] < maxDistance) {
                remaining[j++] = i;
            } else {
                rejected[k++] = i;
            }
        }
        for(;j < 3;++j) {
            remaining[j] = rejected[--k];
        }
        vec3 s = vec3(
            samples[remaining[0]],
            samples[remaining[1]],
            samples[remaining[2]]
        );
        c = (s.x + s.y + s.z) / 3.0;

        distances[0] = abs(c - s.x);
        distances[1] = abs(c - s.y);
        distances[2] = abs(c - s.z);

        float minDistance = min(min(distances[0], distances[1]), distances[2]);

        for(i = 0; i < 3; ++i) {
            if (distances[i] == minDistance) {
                break;
            }
        }*/
      /*  gl_FragColor = vec4(samples[remaining[i]], 0.0, 0.0, 0.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[remaining[i]], uvSamples[remaining[i]]), uvSamples[remaining[i]]
        ), 0.0);*/
    }`};var Yu="5L7pP4UXrOIr/VZ1G3f6p89FIWU7lqc7J3DPxKjJUXODJoHQzf/aNVM+ABlvhXeBGN7iC0WkmTjEaAqOItBfBdaK5KSGV1ET5SOKl3x9JOX5w2sAl6+6KjDhVUHgbqq7DZ5EeYzbdSNxtrQLW/KkPJoOTG4u5CBUZkCKHniY9l7DUgjuz708zG1HIC8qfohi1vPjPH9Lq47ksjRrjwXD4MlVCjdAqYFGodQ8tRmHkOfq4wVRIAHvoavPHvN1lpk3X4Y1yzAPGe8S9KBs3crc4GwlU1dEOXiWol/mgQqxkNqB1xd04+0Bmpwj0GcCc4NUi+c731FUxjvaexCkCJ0qhrJJ++htWqetNC4NewClu8aFRSwrqiJEGe+qtTg4CYCHaF1wJI0sy/ZBQAI0qAMyBvVjWZlv2pdkCaro9eWDLK5I4mbb8E4d7hZr9dDJiTJm6Bmb5S+2F7yal/JPdeLUfwq7jmVLaQfhv4tWMJAt7V4sG9LuAv2oPJgSj1nnlBvPibfHM2TrlWHwGCLGxW/5Jm2TotaDL+pHDM5pn1r0UuTZ24N8S5k68bLHW9tfD+2k4zGev23ExJb4YTRKWrj82N5LjJ26lj1BkGZ0CsXLGGELoPaYQomjTqPxYqhfwOwDliNGVqux9ffuybqOKgsbB51B1GbZfG8vHDBE2JQGib1mnCmWOWAMJcHN0cKeDHYTflbDTVXajtr68mwfRje6WueQ/6yWqmZMLWNH7P27zGFhMFqaqfg11Q88g/9UA/FROe9yfq0yOO0pnNAxvepFy2BpEbcgG+mCyjCC01JWlOZlIPdf1TtlyOt7L94ToYGCukoFt4OqwOrofamjECpSgKLLmrRM+sNRAw12eaqk8KtdFk7pn2IcDQiPXCh16t1a+psi+w9towHTKPyQM0StKr61b2BnN1HU+aezFNBLfHTiXwhGTbdxLLmrsAGIVSiNAeCGE8GlB0iOv2v78kP0CTmAPUEqnHYRSDlP+L6m/rYjEK6Q85GRDJi2W20/7NLPpSOaMR++IFvpkcwRuc59j8hh9tYlc1xjdt2jmp9KJczB7U9P43inuxLOv11P5/HYH5d6gLB0CsbGC8APjh+EcCP0zFWqlaACZweLhVfv3yiyd8R3bdVg8sRKsxPvhDaPpiFp9+MN+0Ua0bsPr+lhxfZhMhlevkLbR4ZvcSRP6ApQLy3+eMh9ehCB3z5DVAaN3P6J8pi5Qa88ZQsOuCTWyH6q8yMfBw8y8nm6jaOxJhPH6Hf0I4jmALUBsWKH4gWBnyijHh7z3/1HhQzFLRDRrIQwUtu11yk7U0gDw/FatOIZOJaBx3UqbUxSZ6dboFPm5pAyyXC2wYdSWlpZx/D2C6hDO2sJM4HT9IKWWmDkZIO2si/6BKHruXIEDpfAtz3xDlIdKnnlqnkfCyy6vNOPyuoWsSWBeiN0mcfIrnOtp2j7bxjOkr25skfS/lwOC692cEp7TKSlymbsyzoWg/0AN66SvQYo6BqpNwPpTaUu25zMWlwVUdfu1EEdc0O06TI0JmHk4f6GZQbfOs//OdgtGPO6uLoadJycR8Z80rkd88QoNmimZd8vcpQKScCFkxH1RMTkPlN3K7CL/NSMOiXEvxrn9VyUPFee63uRflgaPMSsafvqMgzTt3T1RaHNLLFatQbD0Vha4YXZ/6Ake7onM65nC9cyLkteYkDfHoJtef7wCrWXTK0+vH38VUBcFJP0+uUXpkiK0gDXNA39HL/qdVcaOA16kd2gzq8aHpNSaKtgMLJC6fdLLS/I/4lUWV2+djY9Rc3QuJOUrlHFQERtXN4xJaAHZERCUQZ9ND2pEtZg8dsnilcnqmqYn3c1sRyK0ziKpHNytEyi2gmzxEFchvT1uBWxZUikkAlWuyqvvhteSG9kFhTLNM97s3X1iS2UbE6cvApgbmeJ/KqtP0NNT3bZiG9TURInCZtVsNZzYus6On0wcdMlVfqo8XLhT5ojaOk4DtCyeoQkBt1mf5luFNaLFjI/1cnPefyCQwcq5ia/4pN4NB+xE/3SEPsliJypS964SI6o5fDVa0IERR8DoeQ+1iyRLU1qGYexB61ph4pkG1rf3c2YD6By1pFCmww9B0r2VjFeaubkIdgWx4RKLQRPLENdGo8ezI5mkNtdCws19aP1uHhenD+HKa8GDeLulb2fiMRhU2xJzzz9e4yOMPvEnGEfbCiQ17nUDpcFDWthr68mhZ4WiHUkRpaVWJNExuULcGkuyVLsQj59pf6OHFR7tofhy9FMrWPCEvX1d5sCVJt8yBFiB6NoOuwMy4wlso9I2G4E5/5B2c6vIZUUY9fFujT3hpkdTuVhbhBwLCtnlIjBpN4cq+waZ0wXSrmebcl+dcrb7sPh9jKxFINkScDTBgjSUfLkC3huJJs/M4M8AOFxbbSIVpBUarYFmLpGsv+V6TJnWNTwI41tubwo7QSI1VOdRKT/Pp8U3oK2ciDbeuWnAGAANvQjGfcewdAdo6H83XzqlK/4yudtFHJSv9Y+qJskwnVToH1I0+tJ3vsLBXtlvMzLIxUj/8LcqZnrNHfVRgabFNXW0qpUvDgxnP3f54KooR3NI+2Q/VHAYFigMkQE5dLH6C6fGs/TKeE6E2jOhZQcP9/rrJjJKcLYdn5cw6XLCUe9F7quk5Yhac+nYL5HOXvp6Q/5qbiQHkuebanX77YSNx34YaWYpcEHuY1u/lEVTCQ7taPaw3oNcn/qJhMzGPZUs3XAq48wj/hCIO2d5aFdfXnS0yg57/jxzDJBwkdOgeVnyyh19Iz1UqiysT4J1eeKwUuWEYln23ydtP7g3R1BnvnxqFPAnOMgOIop2dkXPfUh/9ZKV3ZQbZNactPD4ql5Qg9CxSBnIwzlj/tseQKWRstwNbf17neGwDFFWdm/8f+nDWt/WlKV3MUiAm3ci6xXMDSL5ubPXBg/gKEE7TsZVGUcrIbdXILcMngvGs7unvlPJh6oadeBDqiAviIZ/iyiUMdQZAuf/YBAY0VP1hcgInuWoKbx31AOjyTN2OOHrlthB3ny9JKHOAc8BMvqopikPldcwIQoFxTccKKIeI815GcwaKDLsMbCsxegrzXl8E0bpic/xffU9y1DCgeKZoF2PIY77RIn6kSRdBiGd8NtNwT74dyeFBMkYraPkudN26x9NPuBt4iCOAnBFaNSKVgKiZQruw22kM1fgBKG7cPYAxdHJ8M4V/jzBn2jEJg+jk/jjV4oMmMNOpKB5oVpVh7tK529Z+5vKZ0NSY2A4YdcT0x4BdkoNEDrpsTmekSTjvx9ZBiTHrm9M/n/hGmgpjz4WEjttRfAEy5DYH5vCK/9GuVPa4hoApFaNlrFD/n2PpKOw24iKujKhVIz41p1E0HwsCd/c17OA0H0RjZi1V/rjJLexUzpmXTMIMuzaOBbU4dxvQMgyvxJvR6DyF3BaHkaqT4P3FRYlm+zh8EEGgmkNqD1WRUubDW62VqLoH8UEelIpL7C8CguWWGGCAIDPma9bnh+7IJSt0Cn6ACER2mYk8dLsrN70RUVLiE0ig+08yPY9IOtuqHf/KYsT84BwhMcVq7t8q1WVjpJGNyXdtIPIjhAzabtrX03Itn29QO3TCixE9WpkHIOdAoGvqCrw1D3x9g9Px8u0yZZuulZuGy0veSY34KDSlhsO1zx2ZMrpDBzCHPB4niwApk6NevIvmBxU3+4yaewDvgEQDJ6Of5iRxjAIpp9UO8EzNY4blj4qh8SCSZTqbe/lShE6tNU9Y5IoWHeJxPcHF9KwYQD7lFcIpcscHrcfkHJfL2lL1zczKywEF7BwkjXEirgBcvNWayatqdTVT5oLbzTmED3EOYBSXFyb2VIYk3t0dOZWJdG1nP+W7Qfyeb8MSIyUGKEA57ptPxrPHKYGZPHsuBqQuVSrn0i8KJX+rlzAqo8AawchsJ26FckxTf5+joTcw+2y8c8bushpRYEbgrdr64ltEYPV2AbVgKXV3XACoD1gbs01CExbJALkuItjfYN3+6I8kbiTYmdzBLaNC+xu9z/eXcRQV1Lo8cJoSsKyWJPuTncu5vcmfMUAWmuwhjymK1rhYR8pQMXNQg9X+5ha5fEnap+LhUL1d5SURZz9rGdOWLhrMcMKSaU3LhOQ/6a6qSCwgzQxCW2gFs53fpvfWxhH+xDHdKRV6w29nQ6rNqd9by+zm1OpzYyJwvFyOkrVXQUwt4HaapnweCa7Tj2Mp/tT4YcY3Q/tk1czgkzlV5mpDrdp1spOYB8ionAwxujjdhj5y9qEHu0uc36PAKAYsKLaEoiwPnob0pdluPWdv4sNSlG8GWViI+x/Z4DkW/kSs2iE3ADFjg4TCvgCbX3v0Hz0KZkerrpzEIukAusidDs2g/w0zgmLnZXvVr5kkpwQTLZ0L6uaTHl0LVikIuNIVPmL3fOQJqIdfzymUN0zucIrDintBn6ICl/inj5zteISv5hEMGMqtHc2ghcFJvmH3ZhIZi34vqqTFCb9pltTYz582Y3dwYaHb9khdfve1YryzEwEKbI8qm62qv+NyllC+WxLLAJjz0ZaEF2aTn35qeFmkbP6LDYcbwqWxA0WKsteB7vy8bRHE4r8LhubWDc0pbe90XckSDDAkRej0TQlmWsWwaz18Tx2phykVvwuIRzf4kt9srT8N7gsMjMs0NLAAldabFf2tiMoaaxHcZSX51WPc1BrwApMxih227qTZkcgtkdK1h314XvZKUKh/XysWYnk1ST4kiBI1B9OlfTjB3WHzTAReFLofsGtikwpIXzQBc/gOjz2Thlj36WN0sxyf4RmAFtrYt64fwm+ThjbhlmUTZzebLl4yAkAqzJSfjPBZS2H/IvkkTUdVh0qdB6EuiHEjEil5lk9BTPzxmoW4Jx543hiyy4ASdYA2DNoprsR9iwGFwFG3F2vIROy4L5CZrl230+k733JwboSNBKngsaFPtqo+q3mFFSjC1k0kIAFmKihaYSwaSF7konmYHZWmchuaq15TpneA2ADSRvA07I7US0lTOOfKrgxhzRl0uJihcEZhhYWxObjvNTJ/5sR4Aa5wOQhGClGLb746cJhQ2E6Jie1hbGgWxUH7YSKETptrTeR/xfcMNk2WM12S0XElC9klR8O7jLYekEOZdscP0ypSdoCVZAoK+2ju2PHE869Q9rxCs9DVQco4BriiPbCjN/8tBjsah4IuboR5QbmbyDpcdXVxGMxvWKIjocBuKbjb+B4HvkunbG0wX0IFCjQKoNMFIKcJSJXtkP3EO+J16uh4img0LQlBAOYwBLupu5r1NALMo0g3xkd9b4f7KoCBWHeyk24FmYUCy/PGLv0xErOTyORp8TJ5nnc2k1dOVBTJok7iHye9dwxwRVP3c7eAS8pMmJYHGpzIHz6ii2WJm8HMTPAZdA4q+ugj3PNCL/N45kyglqvQV4f/+ryDDG5RPy5HVoV9FVuJcq2dxF9Y0heVoipV6q1LyfAeuMzbsUV+rsSBmCSV+1CdKlxy0T0Y6Om0X6701URm2Ml6DIQgJ/3KO6kwcMYRrmKsY7TfxWhSXZll+1PfyRXe9HS0t1IKTQMZL7ZqQ8D/o+en57Y9XAQ9C+kZYykNr0xOMxEwu2+Cppm69mQyTm3H7QX6kHvXF201r+KVAf354qypJC5OHSeBU47bM1bTaVmdVEWQ+9CcvvHdu8Ue5UndHM+EeukmR82voQpetZ7WJjyXs+tPS60nk09gymuORoHNtbm0VuvyigiEvOsyHiRBW7V6FyTCppLPEHvesan91SlEh1/QEunq+qgREFXByDwNKcAH5s8/RFg8hP4wcPmFqX0xXGSKY087bqRLsBZe52jThx0XLkhKQUWPvI18WQQS3g2Ra1pzQ1oNFKdfJJjyaH5tJH6w0/upJobwB8KZ5cIs9LnVGxfBaHXBfvLkNpab7dpU6TdcbBIc+A4bqXE/Xt8/xsGQOdoXra4Us5nDAM6v2BNBQaGMmgMfQQV+ikTteSHvyl8wUxULiYRIEKaiDxpBJnyf9OoqQdZVJ8ahqOvuwqq5mnDUAUzUr/Lvs1wLu2F+r4eZMfJPL4gV5mKLkITmozRnTvA7VABaxZmFRtkhvU5iH9RQ1z26ku7aABokvptx7RKZBVL6dveLKOzg0NC7HAxcg5kE1wuyJiEQLOpO0ma3AtWD2Q2Wmn2oPZeDYAwVyEpxuwDy7ivmdUDSL95ol3h2JByTMovOCgxZ1q4E5nwwa7+4WtDAse6bDdr27XgAi5Px3IWbyZ/vRiECKwOMeJSuIl8A4Ds0emI3SgKVVWVO5uyiEUET+ucEq0casA+DQyhzRc8j+Plo0pxKynB/t0uXod1FVV4fX1sC4kDfwFaUDGQ4p9HYgaMqIWX3OF/S8+vcR0JS0bDapWKJwAIIQiRUzvh5YwtzkjccbbrT9Ky/qt5X7MAGA0lzh43mDF9EB6lCGuO/aFCMhdOqNryvd73KdJNy3mxtT8AqgmG4xq7eE1jKu6rV0g8UGyMatzyIMjiOCf4lIJFzAfwDbIfC72TJ/TK+cGsLR8blpjlEILjD8Mxr7IffhbFhgo12CzXRQ2O8JqBJ70+t12385tSmFC8Or+U8svOaoGoojT1/EmjRMT7x2iTUZ7Ny02VGeMZTtGy029tGN1/9k7x3mFu63lYnaWjfJT1m1zpWO3HSXpGkFqVd/m3kDMv4X9rmLOpwEeu8r6TI6C2zUG+MT6v90OU3y5hKqLhpyFLGtkZhDmUg/W1JGSmA8N1TapR4Kny+P6+DuMadZ9+xBbv06nfOjMwkoTsjG0zFmNbvlxEjw+Pl5QYK+V8Qyb+nknZ0Nb/Ofi9+V0eoNtTrtD1/0wzUGGG5u2D/J1ouO/PjXFJVx6LurVnPOyFVbZx7s3ZSjSq+7YN3wzTbFbUvP8GBh7cKieJt56SIowQ2I577+UEXrxUKMFO+XaLLCALuiJWB2vUdpsT+kQ+adoeTfwOulXhd/KZ7ygjj6PhvGT1xzfT7hTwd6dzSB4xV70CesHC0dsg2VyujlMGBKjg5snbrHHX/LNj3SsoLGSX+bZNTDDCNTXh+dCVPlj4K8+hJ/kVddrbtZw26Hx5qYiv3oNNg5blHRSPtmojhZmBQAz8sLC9nAuWNSz1dIofFtlryEKklbdkhBCcx5dhj7pinXDNlCeatCeTCEjYCpZ3HRf5QzUcRR1Tdb3gwtYtpPdgMxmWfJGoZSu1EsCJbIhS16Ed97+8br4Ar1mB1GcnZVx/HPtJl4CgbHXrrDPwlE4od8deRQYLt9IlsvCqgesMmLAVxB+igH7WGTcY/e3lLHJ4rkBgh2p1QpUBRb/cSQsJCbosFDkalbJigimldVK7TIHKSq2w8mezku9hgw8fXJxGdXoL1ggma52kXzjP78l0d0zMwtTVlt0FqnRyGLPGEjmICzgSp7XPFlUr7AeMclQ4opqwBFInziM5F8oJJ8qeuckGOnAcZZOLl1+ZhGF17pfIuujipwFJL7ChIIB2vlo0IQZGTJPNa2YjNcGUw+a/gWYLkCp+bOGIYhWr08UIE709ZEHlUoEbumzgpJv1D0+hWYNEpj+laoZIK5weO2DFwLL6UBYNrXTm9YvvxeN9U9oKsB3zKBwzFFwDgid5ESMhy68xBnVa55sCZd+l5AnzT8etYjIwF/BGwEx1jjzFv32bk6EeJulESARh8RZ48o7rKw67UZpudPa15SDnL8AL8xMV2SC0D1P53p190zhCFkMmEiir2olwxcJppl/kLm6/0QSUQLNaxi1AC3Pg1CTosX2YQr73PjEIxIlg4mJ62vP7ZyoHE55B0SX9YrrrCPtNsrJEwtn6KOSt7nLT3n3DLJTPbLulcqQ1kETP6Huts29oP+JLEqRGWgnrqMD+mhCl1XCZifjgQ39AeudE8pyu2DqnYU3PyPbJhStq1HbP+VxgseWL+hQ+4w1okADlA9WqoaRuoS7IY77Cm40cJiE6FLomUMltT+xO3Upcv5dzSh9F57hodSBnMHukcH1kd9tqlpprBQ/Ij9E+wMQXrZG5PlzwYJ6jmRdnQtRj64wC/7vsDaaMFteBOUDR4ebRrNZJHhwlNEK9Bz3k7jqOV5KJpL74p2sQnd7vLE374Jz+G7H3RUbX17SobYOe9wKkL/Ja/zeiKExOBmPo0X29bURQMxJkN4ddbrHnOkn6+M1zTZHo0efsB23WSSsByfmye2ZuTEZ12J3Y8ffT6Fcv8XVfA/k+p+xJGreKHJRVUIBqfEIlRt987/QXkssXuvLkECSpVEBs+gE1meB6Xn1RWISG6sV3+KOVjiE9wGdRHS8rmTERRnk0mDNU/+kOQYN/6jdeq0IHeh9c6xlSNICo9OcX1MmAiEuvGay43xCZgxHeZqD7etZMigoJI5V2q7xDcXcPort7AEjLwWlEf4ouzy2iPa3lxpcJWdIcHjhLZf1zg/Kv3/yN1voOmCLrI1Fe0MuFbB0TFSUt+t4Wqe2Mj1o2KS0TFQPGRlFm26IvVP9OXKIQkjfueRtMPoqLfVgDhplKvWWJA673+52FgEEgm+HwEgzOjaTuBz639XtCTwaQL/DrCeRdXun0VU3HDmNmTkc6YrNR6tTVWnbqHwykSBswchFLnvouR0KRhDhZiTYYYNWdvXzY+61Jz5IBcTJavGXr9BcHdk/3tqaLbwCbfpwjxCFSUs1xfFcRzRfMAl+QYuCpsYGz9H01poc1LyzhXwmODmUSg/xFq/RosgYikz4Om/ni9QCcr28ZPISaKrY7O+CspM/s+sHtnA9o9WgFWhcBX2LDN2/AL5uB6UxL/RaBp7EI+JHGz6MeLfvSNJnBgI9THFdUwmg1AXb9pvd7ccLqRdmcHLRT1I2VuEAghBduBm7pHNrZIjb2UVrijpZPlGL68hr+SDlC31mdis0BjP4aZFEOcw+uB17y5u7WOnho60Vcy7gRr7BZ9z5zY1uIwo+tW1YKpuQpdR0Vi7AxKmaIa4jXTjUh7MRlNM0W/Ut/CSD7atFd4soMsX7QbcrUZZaWuN0KOVCL9E09UcJlX+esWK56mre/s6UO9ks0owQ+foaVopkuKG+HZYbE1L1e0VwY2J53aCpwC77HqtpyNtoIlBVzOPtFvzBpDV9TjiP3CcTTGqLKh+m7urHvtHSB/+cGuRk4SsTma9sPCVJ19UPvaAv5WB8u57lNeUewwKpXmmKm5XZV91+FqCCT6nVrrrOgXfYmGFlVjqsSn3/yufkGIdtmdD0yVBcYFR3hDx43e3E4iuiEtP3Me9gcsBqveQdKojKR//qD2nEDY0IktMgFvH+SqVWi9mAorym92NEGbY8MeDjp553MiTXCRSASPt+Ga5q7pB9vwFQCTpaoevx0yEfrq9rMs3eU6wclBMJ9Ve8m6QuLYZ58J41YG3jW/khW92h6M/vbFIUPuopZ6VVtpciesU74Ef7ic8iSymDohGeUn4ubT0vRsXmbsjaJaYhL8f+8I5EiD5l680MJbxX/4GYrOg4iPQqpKp0qddSu/HKtznHeVyxgTwhfEORMCwnaqetVSzvidaWN9P+fXtGXfEP9cTdwx2gKVfDdICq7hecgRhIs0qlCt6+5pGlCc6kWoplHa/KjP+FJdXBU/IDoKMxRjFhSYkggIkhvRKiN/b2ud8URPF+lB87AGAwyMjr/Wju2Uj5IrppXZWjI3d14BdKE2fhALyQPmHqqA+AXd2LwvRHcBq4mhOQ4oNRWH7wpzc6Pggfcbv9kqhLxrJKEaJqA6Rxi+TDNOJstd5DoRVCDjmVspCVyHJsFEWPg9+NA8l1e4X2PDvOd5MPZAGw6LRhWqeZoSQcPf9/dGJYAyzCmttlRnx0BfrKQ/G9i5DVJft9fuJwMi3OD/0Dv1bRoxcXAyZ0wMJ6rwk9RjRTF4ZK8JviCCNuVt/BqQYiphOzWCpnbwOZt6qXuiAabQWrS4mNXQ7cEErXR/yJcbdFp5nWE1bPBjD0fmG3ovMxmOq5blpcOs0DtNQpci1t+9DKERWAO53IVV/S4yhMklvIp0j0FIQgwjdUptqmoMYGVWSI5YkTKLHZdXRDv9zs+HdFZt1QVcdlGOgATro3fg6ticCrDQKUJC7bYX50wdvetilEwVenHhlr85HMLRLTD6nDXWId4ORLwwe5IXiOhpuZTVTv+xdkTxJofqeCRM/jcZqQlU0gFVTlYlfwMi6HKR2YG4fQ8TOtgR+yV+BMZb6L5OwDc/28/xdfD7GXFaVA2ZSObiIxBwT2Zev637EuvpM6rxcogdM4FJFa0ZhF7nrqtNsqWg5M7hZMORpjd4szf/wS+Ahs1shY54Ct5J1dOBO4sdEtSnRc0P9PhgyOCt6aQW98R22DpAcNTDe72AHK40vutKTPfpokghRPuGvz0dulBPKfC3O4KVDCyWrJGO7Ikdu06A0keKlVfi0tGcpO0NhzXEh75NHyMysAMV19fq7//sPC0For1k2uFEvq8lwrMAfmP7afR69U2RqaILHe7glpc8HmVf87Qb2ohsw+Di9U+ePdHLecS66MhB/0OwdcXR5WBcWTZLGq/kiAaT+bzkjR8GIpWdv6pfIgQ+Q0xdiKvo+gNB7/Nf9knNJGxnh7LeZEFtMn517tNc74PPS0M4K3I6HHZqNPA+VZcBc/g5a2ARyqKrJ4Z3krsuA+VOJJz2KJpBMgCCWFln3u7k6/q3DETAubKG/pt3ObaNT0NI0Qug90L2ip5dHnZJUjPTvK5E96aX/4mRU2u8n8kh6MKbY7ANBro3huF06U+JvfyELQP25oIaj+n0ITQ4KT9rXZD4EtBIOj95fYNldDN3io/VMIvWNj9P/b95WEMq8UAVfG2XG0N6fSYdnBEC7sUEbatbDICH9qA8TTuW9kEt9DlFOZFP7bdfYLa/khSY8W5K/AkIIAPXtMvyVKyESjKx9nfragssxC0jFMVY94d8lOAwRocdS/l/P43cBGa3IqDa0ihGPcmwS8O8Vj16Uy55rOrnN0shhRJZdW8I7F0Q0KeHc35GFo4aJOFc25gNafBu1V/VO0qS4Qkb6wjRrnlepUWjtYyaDABZceValuOMtoDdeIITWKOJiwGPpB12lQgwkmXh9M86podb0D117mNQ8ElluFvbaS8RTKQ6lyj88dUwoJU/ofOeubhoXWBF8eNumkVJu+As3ED/AvLlrV91UowIWI2m8HBG+a3k247ZKAGYsOcWe7fTWqL8eqwM5ZFuoXbeugPKuMOAtOsN+4dSwkhrSAlfGNTzFwEmCNWtzpa9CgPbYNcmoHtO8pj8qMvlGET6nrkJoQ2lp5MEUV1E2A4ZH70JUlCLXvqTIpZlzyxdr5p/GZiD1/BuFOGbyfFzhuxaC/l3lC2jjt6GNRBa06AqqPlYtdA7kiidYa5Qi0/XpXiMDyMXNOj3kmJEaXufW0GO8+DF8OoMULX1vvjCePKNis4AmxQKLCF+cjf/wyilCJvuiyLVPSdsuRTPZ0AhpdDF/1uFmDwG7iP3qYwNsKzqd3sYdnMolCOuQOIHWy1eQpWhuV+jmSeAC5zCc0/KsOIXkZPdiw8vtB33jEBpezpGDBP4JLY2wH1J7Fzp8y8RICqVd25mDT2tDb/L1mh4fv9TOfDH5dTeATqu+diOZi+/sIt18hiTovPsVQVaqXLPRx/4R/uH/86tBMcF+WBkThKLfblcVCIECc8DgNRVX97KdrsCeIK+CvJZMfwrftcDZDZyp7G8HeKl7bPYnTKX88dXAwAyz66O2chkPDHy/2K2XcT/61XnlAKgPwtI8yP9Vu45yh55KHhJu93mL4nfo8szp/IyDjmFHtSMqqoWsj8WaVhbjXgzZxcqZcyOe7pUK6aXF/Y32LnBOt0WN28UmHRiOpL525C63I2JQPX8vvOU0fz2ij74OeJ1Apgu3JRObfdo9xGDpp7cv3TdULEfNS6Gu3EJu7drBsBsogUqUc6wAUW3ux0/1hLVI/JEKJrAGm8g72C2aJSsGAsKFW4CBvBXVlNIKa5r7HvT1BeGYBfxTR1vhNlFFNN8WQYwr39yT/13XzRGiF2IsfE8HcN0+lN1zN/OnzekVBKkFY11GgrK5CLxrE/2HCEMwQb9yOuP2rTXiZzTEETp/ismFGcTWmbM9G1Sn2D/x3G74uWYZY4rgKB2Zo2bTKS6QnM5x1Yee66Y1L7K44AyiY5K2MH5wrTwxMFh+S8LzNQ25z6sunWZyiRwFIIvSnioltUXNiOr+XMZ6O9h9HcHxZJkfF0tUm6QkU7iJ2ozXARitiL86aqVsMOpmvdIBROhUoanPtCjgft8up3hAaKpw9Qs9MzYtBA2ijHXotzarkV3zKEK0dFFQUwT74NgCmGGuSCEDmFCezXPC9BhyGhmzNa6rQeQQz+r9CmGUZjIQEPsHwe86oCOQhWaHERsv5ia9rZvJ//7UXO7B329YUkLLAiqpLRsVV5XpcfdawlJqi/BVcCqO6dr9YJTFFRMVGhfUbB9YWNvYPY6RyaydAFYq1YIBQxuNAGfYWLMAHtt2XRHoOKCLz+qf5HCVBDOPOktQ3SdJBfxUkaiD585bmTzMwU3oeXUHZ55EC99Kz9kk4ZXMIENwVVpqW2JmGIcUiutIMj2KkpjE2QD+dIZUCxcX57kH7hiuUPnKCTdaw4KN95XPeFRvMcvo5L8LexWqvaJPECzwXCs/4XPAlSMpWUzBBjK3pEnkbueMkMJQrYcnXf7PjbAoJra1VLX4YuscQLpaeYWbT+h24hCFrfcHjxxx6WTSe4AGY/KHRZCQKqTuFWt0D8RmGWmvXSdg1ptIefYPshuIVZT7CV4Ny67fvjJugy0TNYHqoCO45CB88kxrvIsih19DqjD0UqiJsTFPcGW3P/ULOG3nb8CjpgVTIoa5nO9ZYEX4uEHu8hLXrJPjV1lTQ5xTdZVagg+Wj8V0EE4yPsTc345KM6lVXqLiHtm+G6edC4GVEiPgd98g+twSYm18gCsPnjqlLcFm9e72CLJbYD+ocIZOxuVjrX6IKh9fh7WqdIZ66x9PWkDGOVVGkx7jM76Ywe16DX9ng205kg5eq+R2q2MguTJxYv/wWHliD9mOYpzZKNXYC3Wr4iBGkm54hBwkPzFhiX/VBHdVH/KJ1ZIMOHxIN6arKdxrm6EBsgwDt0mPe0MX1HRUMq8ctcmysU6xX0bzM1J07kAvq33jw1q0Pq2cyMWme8F7aVkfhzZEFdyi8fVBQav0YZqvAjZ83WKH726rBx5Bn7GHFthR6H4lFsltu+jWmsAibJ3kpWMG/QbncU7n9skIBL0MuXXtj9sJg+4Dl0XhKJ1LcrMydaIgyrgZgScP4k8YQvcsBmD26X1iYXKLzMYfZn2IfRjznsrJ1e5cnl/3a5xiNoI6n1x1U36FWckJbyx+hiSZg0QqAqeeSvzFYMlZ2REnO/a6yoQhu7PdHMYEPFIvfyGeyCU8e7rpju4DrlOhszj9rOIpNsvCkuD+TLyf5J7D/wsPkBpscFVI1q7oUSU9bN30vH5AqnO7bsf+9rGhtVjOJQ32H9hHSAzR2ape4L0Cz4WxaySm4jvuGXwkFp5NMMLrgZ8LdA+5uLuyxO5SMOmJNDBcbbLefv7z6LyxBwltnfQLd7qqpG1MmNcoLUcx73BkNF/xpdS0cKd6G646ntChXSeTZJJTFYGw39T7fqXDPKoG2cF7/ZcTvME42gXLVjTqzAER1Rt5m7GYsh0X0+XgOeW9MJqE5j/rpGzY6vUu6ACcCTzDMdZHiWELpDnvgE1hmztLcSYz0MtNyUBLqvylUJJnJu79Sku9NMHCTkgqozTnhMFfduV2NLCSYvAI5HUvQp1h/M02vKFD6eosIkGTg6mujUo1W8hy5Knf/erkBQC9LzNqPAYCgR+hczgevta88NNqSlBZryq9QNeUK7RpbvHjoNhUKAAeNYH55LeTW36KyFaXdAkBvyNP9xmRuBokPi2OhqDby6IZ61mwfzG+GmACkS+G80A4WGON5izgJWeeDK91jzusfOi0RmEsVJXwbVUr8u/J2LCQaMnHhi+wJTEPN9tS2b6W4GRGCNmtjAMgPsP357nOeD3H2tcDAPu5xQBKMHf/j4ZhXlkvvy3YmBJsjsd4pSOlfPZCnw5JvzxEXM5JIc+E2mU4CgB0mdJnH4NEsCHYNeVRDXFNuyZUE4nuvaJf1h+11AWLdAZ72D9XNRcxfb2+XHZN/SN48U7yl+sNZhg5gn/PD8wkBtnRj1zBUPIWnoMP6yGUEEzuT+VaX3x2jEIZAZsr3rs9wCfY1Ss0EdIFFzBbyruUup4EPanbSYew5tf16/ZWVup5iykttuqL4xoC/jdZWsAZeSfDSd3fP9kbyAFYXkf0Q2lmxaTkKRZrCo9XCoiUG4yP1URJ5G7+HSOhhJp0Anz0N07QZtyFUye6rcgiOFbtyoO1lkuV0iQ602MTyFK9xLqNHtNy4cJaTO6hjtiwNynVc34ZA6H7k8ai6S6eF6jIG0xJx+JfP97lzuCZr8vU5SIzImaNpiQhyvDbz23//PJcOk7hD4iIvJzfIgOGIR6ZPEJpWHZQoacbF+omeHw8aWHaNOfaIyGeG4lEryMfhtNmWh4RAIpn8dLs7ZE2eTVDwK++xDoSUgh47WDmKlZ/k6OosEUoQjk7Q+Kp7OxwgMFShAv6z4pTW8loVj2+qXLQ0T3hmIue8qHy1o/HXjm089m71t6mrrUyDftqMYtmfvQXKDlZ+K1HR/FkqPSqcjGlcPPIwbMw3wIFKBdVMJ4pFLt+oOIkWZMw8pkoYZ3byw4LmAF+7BdicGXFcb5PWtDw5XNNVc6eB9dv0rAEpgr5J+bLr010bpfGw+IkRoxDbkDFmQdEQUSElP5bViLo1ur/23KN0jEwl+rGC6AUMKxHcv+T9F1Ktpn8jSSrKxJnVkK8UD/tH5DN6nXB8mjUdFU539e9ywLtLYCwmHYVEVqnFmdubduaSd1ivIo4pTsX+mJcOAkrR1D60RIoocCBIdwJhCBM1rOE2XSlPo0U+khALvw+zfxYzwzd4roWlLJkZheFRR8QB8v4USwmAcDswUZ2P/7v7Xa51Fs7orYebYyww4YW5869Y/c6Kq2eTR9HLSjYuChTkXaDygoo8nz/yJ0KzfX8oowaNAwz8HvQdlLU9V9hjqYMURyYvPzZ60G0itmUdZwB+sY6rUkMAZZtWStbDFmnk/dQorhwr3121XQWffrK3as0g29ASwxbsZ3dZAq/96b7/XWckbjmo8+jwdE680DzoEUUivnBgowMuBQxHXoGyp+w/cSGY88rWtmwoyNNIvChs/QsZRnbdV7y8x7t2RkliJV/j8e6qfctrTsMV22zoqgQuTSNFh7U7p/Q49L0kygXNnEYXCBDgi5BeNWxu7VjULcUHI+lGj+OTCEATzWrDmaynq3wT9IAejtvh3esCu6sEu9JOsXxMDpqxm4Tzl+pt2Wa5Bq3TM5TKH4N7KLir8FGIPA569+uJ1VEL3fW8Jyigz/nEUjAVYrdCWq2MnS4hQVgcvXq9aF7Xke/k++rAtIQqckPNwjKrV2t7HCOrA1ps88Y5Rw1Zp+9itnB71j8tNiQc7mV1kUCQXkoi5fOsq1uC6hUPUL7Z69NAM6lg0c/aeiifHoi35v+pVBh7CDM1XfvYpiK5JIbIQFHafmnhHfRTnMagKcjdE7zzgtxkTPKVrObTySTT51g9bB5ro/dzn/sB24fNM2LGJuRQsmC49PLi1jTRfZaLpo8Txxxczij5Pl2vur+S1wQW3W5qyVcIUySZHtFDQHv+EYDoZG1T1J7D91vEIV8dHzUBzW1UyuxRbP+M/CM/vsas6RzmS5traXnQ0Jzv9hYXxKHcs15TQCP744XsLjzFjILYURXFnhM+nnV0iO6nwls9TR4tlz1J9/NvE8FGg5mgpZA4htS05AK0NnU2gxuqf2vjCyWlm3ypKvaX4vxh8Um1MHGB2NTeAFhbDyGm+5w2zqJAWxVlj6dVePb5yR+aMhuz05YubCQJ0BOtoYQ6PoDoW5fCwCtXj5SHvCgL/3B5z2mcXWaRTf8/GsFAfX/ntdWZWFc2xg8MJeenwZ4dZUToce43If4zVb1ex3BMAWGhgkPwR5EgktZhW3Yi+nsnZTUr9FYI160YhAraB0zMV+ouHz6hYm25/ETDM0MTmcypoGgZISSkfwYAQaHGY45yZ91K4A4Mm4fnbMk8GTc4orypT3NLBqAxYdcY/qCH82PpIkmVOEHi1NoYaUymuImLLcib5pmd2MHTB3JR+4rLdRc3gtQ9zeFdciciRiWviu3HkqaLSxJeI2rgc7OKQslItumACQow89elXmi4P3gTZeCauvMH5nF4VrBcLjjwGD+KlKqe/RWIEgT2wGqAgSuL6b+RTTPnQZzxZ5y5HQJkEEKJp5NfoB8hJBM8qn6xbOFtyzBjVBrwSS1zCJR3lEc9ODQ5Wu/xct9/2Q6qLHnmNx6XwZus/i8rEd6UsVxGtoDrm+Br0L5oUojlwdcqyVV4PIMsR60JhZwJtgX7izQWj+GOeF9DA8Wexdmv6DWjgR8LEBp9YuPAM8tJDu3uCumNqHnF2ATYX/tuVO55OgQuiUhmDmJbF9jJyifBRtxOVI9DCNLUY71IXZYTuiYcnILQ/XHuVJ8aHDStL0N+3eYNvXwHi2vEiTPnBqzsC4TsPnFVnYY042j5i7C11AVdBZ1pGSa52jM9dIL119rry0mgGxFzI8xPs+7bmMfYKh37A4HtA081olG1m9S4Zch2hoNCGVvVhd6UL7C2d5hKIBHoB+Uxarq/4aQXhh7IWjSj+ca7Vhqb4+ZwY3nHXh2S9JH4XZxQojbe/eINxYlozTYtT2rpU/xbj+W2hXjFQ+z+dQ8wh9751MP0UpjutQdxz3/FJYAEG5BF400JXWCBs7KrCRf/l+F+d9EuwVk6thOPDB+HNS9iWlLmDgXvY6K0vgiyoeA3An+jWufdAG1suUMBuJT+/w0FNJZbObUT8c5q5WtQxASQF6E+/u8UwVBs1eo8jTamCrcdhZJlADJbqn3crcDHQlBQNGq7btcGKiJXW6q0cn3F0xzf+k1JJS2testB3rx15ZPTDXm8QV5XE2qxBOdM2n6t5YbxyNOmEdsHx+hMp+y9pWkcgw1NikeXuafJvzcjaNwE1Ad6gG79S68aO7jWpKgBETYLmV4ONHhBk7Be8tjf2WVvWMDQvQdOnk448yeMv1tQKU1xev0L171e/qxkMZbmkfKnd29XRCK2hgNNJhwt1qiYWZGKz7Di6K3fGDT7DO2YQ7WU33svE/WKGbWQEvzUV2w+VNYDocI4yxQ6i3i4zU2TjmjCwu5Pk+Ja9HSwLpEoUswq3tFJ1jimthgMXd7KjSl6Qd0K+vxWT8G4/+xITHsWDGSfQTSdFQth5uVVfa8wrkDZHTGVgpJys2ik+3I0dSf6TNo6A/sVptyY/kx1hdAWKPI6t/xj6s+fPMU3hg1vkEB0RRHq/tCy3KUUhzU/d0JKxTyjvUms5iy1GbOFco0NA4t83SK9sBmtLWm4kOLLflyxqgQYP08iyXwYXzKnlQ6VTipuaspSJ9g5H5Lu3eLMnPKbhcwuEg0VZ80ppJWjUnhS3rL35erzysp+fJhxsUs86m28/UwW+IgrS5Y0zWaxlFJ8xML5wk8sg1ragF+eNajyI0Y4mwStxt1RZH2BjaAhvu+SnNNIK88thEgZEsoHv+ii+OMmXJL7dnAiINVDz3tCnqDgpQX9OguNGgZj3axcjq1UgxDw785yNIpqNiLgv57399jVmJ0/RStNswaFIs6FtnkilFZldxj6m562jL4p5g3Y9XCiXRJX6nq2PGJFifFR7EyPG4jDMnBM4t+O8ZpEp3th7TCxEw+ZG4afHl4sNFaqxyLh6+979tt0Aq9BrqI+CS2U7HJoKiGmyVU1lFa3/0O5mNC1bzRgNMy+GXyifLwJP7FwUSUmxmVRpn+gnXWoIuswPutsiciurvN6lsMG7yqEc2Y5ZI3jrPgPq0xEKPZpF7teJa0TQn8BQL4Th+hjv2ByfwKookyXEmj0d1KMcsmfKaeKK3cZZubiYqmSCrnGpYTwgPk5itKucVtjViuswQsDR6TuyGSIHYvlz7wkLg1Rr0K9kV1o8RgABlhbLrN74cVWJW6TnfXN0q12JFMpUbEa8t1+j440FA+17o8qa8PQ9igkctVROVIfB3jU5vtGm5pYYHYSDvU2TEc15pIz19ka1q6c/7WXfF8+POkApdOw7nn7Kqz6V4tru7NXgnA/u0g6+fPRT3hp/QrDQwMsjwNCZxdWrR6pgCBDJNc7/KAlwC0UZ4yWQs0KsuwbbOgcTxQPK54wiXr7s+221hzZ8RVxfoRUKM3e4lpxHC83JllxlrV760tl06f7/65qhE1jhMfivAUXIXfRMe3uY/G2TpWYzDrw5Cm5cS062Bx9lhHq9gtJp8xZwAtSdSuW/Kd7+orEAiswA76N8ezmVGYgNaYlQ/xk930LAWAtKVBC4U6R08L45IohB1kFia7XJs0TcaT2zBZoLFuOGu4iJaoAnfjL3uS6gnRH7G7A+aT6ETlmkYUfgrBuaSLLDJfhPJe01PfN0oqBTeQURasl3N8BZiQSgdr0aDv3hPTiog4NSyfAUyy98WP7dnTDWQTY+Qwzgk1uxwRqHl5MpC/84Cuw1TXfRlgJrwPop10kCHjmffnFdxCe2J3R3J5j+3H/sZn3IUu3Suy+I+dAOMWvzwExNR3RRPVelZAhtarKlXPWNjPRIVP4JsAFSRXs3o/fSYAPaV/zP8q6DltH47/rYhCLdy/LrpOsbaLf09eACcClJosNefetNElkSFSuCgeY7oTAAl+8Y2zOXJb/bgEDpoDXfQqc6lnlBr/WsmVznkBS1M7ufiqpxvKXjwvR4WxLbh5NbMNy8LsnX4UiuAi8XonbSUcVZKQOWBYUecSOMj6jMG8gHu7WNreBHY90lV7FocDprSrSbexkAtMW9KlXcnrOyLnZdodGYdxz8aw71HztIqLhRdCOB6NyzHPoS2hDy6wLk0I5Jr2t+U0A+A7EsgSn/Ih03A5CspHnVF4MOic+Lck3m61Um+GHDEe4DrHBhmgtDlRQl1XJ/V/VumCHtUDDcZCkgjVMBOmVOGYW0Rcdi1ahdjhBcFlfjA+5cRjBop1aNDvdrf7CxkLVgxiCxhRctW8wczM8+kVmIrGtkaHGlr8y2D098HXE23r7fnJFUU68zyeyM265igNOGPzFG0dIgUDWN6S3ZcfMERJdWVvpGhVEHXNLeWqHiTcF3wOt0FbJY4XHEpmkoG9MQPJJ4ueQ01+MB+SR0rCSGzlE8zod19q75LlLWgzogpnJoD4gPxUYcX+Gpc5Ly4nk+Zm8LDXcNR7SNVxLh6NAcx8ekjb/AC7ADlRnfuHaHJaBodZr7RBX9FLTvocY6kY8bavdAkQicE9bbwGLkZu6whTCJ56lOvM39ijehpTOFqR3V53nQx4hfOvwRPU2y2w7UU8yiRbcyaX6jGJ9CRvl9ybV1tebTp5MMuMnwLcx/lven0w9T0atJuiUE2WtYGiVMaP3EchABl5AsyaCpu/BKAWDFvU2vaCL2/fJBKCKLjxG6xzT4Mh4wHhH3/EqsGSoQAHu2wbHmXHj2LvoW19GXDa2oyeKRwGG1PU+S7mE/S+UmjHiDF1oqJ0R5QsdjAZYN1MzpNX5YDqWYfhfdjAXyFQaVyGKkp1oEGTR8MK6jaGfRDFd41u2Ex8ac8jKPYu3pXsk8gu+m9tr1RVzTTuDsACW4S1h32yFHX7qpXSmA0QVEcR8W9j2Juu0pcYqTmdis88VgT3gq7iYue5Hx/3K6hFQa9rZrNSDcjaSQlNn4LSqs20bypnKqpzvnnxjMdz5StbzvoAJKgVZa4DLCVoJW765/KyTF4s4YztmAT1c0pTmKJHTpa106FegDo8p2zD6uOnwpYi0vJlRMDe9wPT6964UfAf6lq3qWypUOx9q6BbKEYt7K3gWMXDNN6wAm1fNnSOnZ4JkbPq7jLQrl0wL1V7QwO/sXneKGfTgUL28I5iPVG9dA2gS7Ki005JUR7Vmw4gX4TJvy1WS74cIXD08LCF5obqcZwamuoZ+FPMJEck0TLHjyH1baPr55/Cy0ptDfRJ7d89pbP48tLMHG5dO11Z8xSSpPGQSgXDWmpsNsmm+MvxJjMCi7OFDHxxpmTtjgnOCq+c7Fi1DybfhAntviKccz+sj+OPKPYOKeYYPLvq6MpUx/chSvBccg9dfbeqetQNCs3eiCFZTU1mrDido/mib64STMgsa+IKLk9PyxGGbVSQB9GsHto6f5prAFIbRDSItDedz3t5+Nn69FFS0nEfmkF7hKBmNVce5xv65USKGBoHYxJyutSGnRIq7vMDsAMvirOEJOzNi5Kt7fypuSU2c2Npo6UH5jMOkePH0TwgpammO3Fb2FX6f11309z/mqRmQ949HHRj/wMzKNx95M9pwKf+UQkMEwisL3YVotvHhCv4y00Ui0Ql8dR7tGqFcSdYtmoAOuAodkBNs4PZSjAAF7S/szwLddFMdCyB/dWPgFUiUE+WmUUCjYrKfJLQfNNpQ4NKaF57w7Kp/isZVwQPUJyjJavN3fQNKU+F74jVBJYQEcEdw0Niinyea0l9PJ1/AcTm/LI91RZjDvLI81pnat7RKU2P4/TnIAa3hIEfeg4iGQ+wTDlURK6YjNpN5s5VkQW9w7sDYKU4XmjyZsCQLxztqd4SDQvLyuPDhURAJXKfR1c7tq3mRu4usFHPqz7HgS0X7kNxiWWR3fb3uVwbgKpmgLYkwKrXKt09COw4MjhxeZlDXKy7nNLHXAIKPtferWQnZLboonQXK81x+BB3oUidBehK1swSXxVbscj/LsfONu/xYEXYPM3aMqIYd+2hAnFvDHbdrJLhGEd3sG5PyxqhzejhQJo9wauFK3xmPYqxB99J8zYU9/yzrEZNzzbvPoR9vUlE3Ha4zspVDzHHffPZMJ1VLZkKqGCf8ZqupqMt6T+NRPfmPm2xeDgvzMrRJEL4/zzlu7Z35smvzbgeC25VP2CUrZkRxEi15A0769ojdO1d7C9OG+swj1ROMM3NgKdeBADoRMeJkRZcZ1FbQu6C0BS9NNSaoxtFzYT4lX7+PQ7BKa84yrN+ujVVef+SgnEie1G0N+eOtbZF/UU+wkeerWjloYqFiqo0vBnmxh+TwNMo9I/8lfU2XTCT0K4OoWE08ipyNHjxHvfhY6qa3x4HzdQ8+jkiO5+j91YkihS5memfpFREHP/2veN5XcRue2zCVuAub8V6vDlOvyP+PBm+owyRhMmng5wwGGIXsOkQekXrXpE/6dFjkHwwoFoj5bIFiqp+4wHpSWRbv2xGrRpd2c87FzMP6Hfj/3LWIBqFiNOAxBw+AAP1XqUBszdZhzOSQrQS4Ein4fyV7MaGsB0VsMF4bPb4lx/foTGQRJv45LpoxDd84xCawHaX7jpXUrOdkFxx2oUvY2xqpgIvcVufwd+zAnaaVTnEyDXD7S/o/xrrk4mgTjXhcjj5Rzrbr23NmuZQvpdNzny5MCR9bwvIRIqzOZZLsstZSCDYa56JTvzxgBs20dYTtTUbe21uljlWqGfSh2bYAzOpf6UguK30ZxNXgLHs6Y6urtxFA5iLYvlue5mDONW0MOtQjhqr8fRbCkYneiDkvzHkQVT4F9v9vxh2SIGPBH8bZb8ugo/BSgXojeSdNXbBAIDsB6DUNSXnwlu/bFLaCqSbvu4+YLplwO1JbtrMf9ZUfsxerAZjB7E/zl3qwgK27FswemUmSM4i37YAVhQSocuV8AcDI/CSeCDNPavESshDQ8A/lVIrAJAMdP/rHXouiNU8RL/TIvfQiuZEb6dkIKMGGOW5kT8vO8pivWnT4v7qmwuJo52AS1r/RyQ2g/7c9ZJgmMIzf0GvJJRfMNu1utRNuLWHOm9JIMcJK3qiDtVpGCDP45W1oTTMUnMC91kYhP0GHjhCW8V38xhjHgFFBfuWMsmSQ9MvNqKXiqtUhDAkIy0PW7YSKaKUv6zctAiIk+Jt17kG6LpNVOeMvJnlVBaJSkKe0HTJJUMvf8R2zna35/yh2wNlWLzIP3BJR5aRNxkV94ICOlycI1/JYRZtzvWMNoIpQrdNvyBuBydhSwhRwPo079Xk/XQZpbhzN/KK4NbdJQV0JIMP+Y5UBIM3TTYlFGYVjcvA5yVozkimco91Fx/eo+ydgAx1gMezTh+bYxCtXPYkMoPdtaElRusxlmdSV9zgF4Np+iylun3LVxCycAFxGCFsmARf6y4I6zXY0tx81aQyalr3/ih+ZjxGNWdhItgNLdEZ/BOIJpPoAveh2bKbEFxU/M0+4xqDo3Ox8MnNn8Lmv15NJigSvJV+y2W/ZogEXNiv0/nuFzZGr0pKujOShzcdkEVlMw8mNZXZCbtM9V+mfawtLxCTvo+enFWhJcFv8LVTFycDjPGBXRQKNN+z68HJtYdpH++g5WdhQpCO+DE7Qdu6TmZgtetrpU2ZlgpslOx+4hb3aXaqbdc92LCh51er8vm1GQ9uWD9+fAPRV50ixhgc5zi2Jsg1xQVxzlaELRWJ5biyF+eCwNV0oFnTbBHr3Glm9qlGVOpoOsQC8hlNG88fxeAekkCGnHFn6i5WzyO7ShDYbZ2KM4eqndyy01v+6TFhmkxgc0dndt7EzRCcEfBxSaWZwcev6MDZcuvSZQ9CNSd4Tx25TY6UAbrhikuP1vNFfPdZhCG1pe6vx4D6Ez3zIb0zDa42FPpxWvIpEeXb7YTcfZOahSpSYaWLH/vq0F3U1KO7ZxliZpoMBBYJs91IE0bOkrPNQ/USYY0qKCO3CU+AFbOYxzKWBkIglrX34377BZ18MKQCv1KWfIHEeguSpvrNH5RQOD4LeiH2gdx1MOAKphlL41F4RpxaU4dy8xERFgqoyICQq9XmQ8WJSokwqvhQM0fLtsvyCO2PAkJ3BZg5IqoR5q/GdTLgOWPFR53Nqw9Ma5vBzZcQ4+iZgetmKg5ZIn+/7Jbi+VlViXuD9CaAUtdEmnwWTS7wZWuskVvc/SDaaKV+Jz6HrZTHo3UrAu0IZDBkXWmL+mTTjdTb1A+MdhKkY/hvFNwXj1FzUngsN58u/kTdJ3Xi0hy7efR6faAOi4SKGaiOty8lxDFkiD9wq2GW1EZEsoWGw/WzxXhWDzYY8CC7WuLFHc+x19jhH+FiLXwDIARRtnkJPF2BUPZ9+grZ3tjqAWhhN3h74w5pooRQUNATy05A9HDLnILGSCtfESoSilqtqAIQ/TV2t3KhOc+teDf5t+DqZDdB8Ob9YXyklrSO73pR0QAxPvQj57c6FIR5dOciqeHZ2LRABMROo8Jk8V6JFewCL8TCd/A5MSbXLky1cW7mXobqgeEXdFDoEydKo5oCuyn+2JYI/7pIGFAzErlHZ5hOaiT17HC3zp2HpJwsIAb4/oIoZ8x8ak43Yp83Ermq55Dg8HxKGHXbXs47sh0PzQELTGFsf5eO3lYAuJjMneoYWk8W/3tW2WLntEKBZEW4hOFgo8K58Rj0vk5KLyezu1d8SO/JcuxpOJqFUM2sxBmbQ/9qqwb90R0WulpR/Ju84bQ5/fTh7po/pbBb7AQaYNdK3fatD3K4TLHAaa66MQzp/+ZGyCjzo5OXRzJ8UHyg/YpNHvvlOpwQIOjakpLHwGV4WsLDPjEIqG23ily3LL0dlkYQxj3Xx0ApCo35zYGoGOtIclYS83MnI5TwVdQ+Hg453WFQN694DaqhGaL/dm0KncXYqXLi5polgT4DOrzD4oSVhrkh8GW2PaXjOFDCLPcn4RQj8dRGIJuV81LxMPZ0UL6zpkaebhbFBxcRJe38UiTbUPDjFWk2jBqzrBvXcKmgdDcmRyJhIpuq+3DQY464AlY42z2EM0yIK0I6b+VgpanMfpdWo7OxKY8RM5tSJv340/qD8SxrYsybMuUkF8fHj7HcvxEPC5YYrH4LW1YKg6QaeFZLvPbrHZHvi4OXLKkN8cGQO8019OKqcv6QnBlj01e7qS5evoGm53rv+VmDxxCXDiOrDg+IaPeMPrn8TJ1oReXYI3yb+4HQbikxP5TQXHk4YXPUv95+KmkxGsRgTwP71YiMpqNXp0loHZeXRp9i3euKrVtxMM0e6XAoACwNtcc6sOuhZVb1htBLudzahrDFt5GkdlwHjZl5y0LbvSHwII+qYeDwRKTTzyXaInHIM+8rc5TrjUlPRVwB5LKFpQnV8e7vLv7T7V/iJTW9h9TnRtNCSGcofBWYm5P7wZcAq3AFamEW/GMbo27ldz0plt5HI53ddWkn9IuCZY+Iy0MATUh3YenRTbVgdLYtu893SuN6EL4e9V4NhlzUjI8nOS6B99ecyC1Ot8sDahQpWHbmt2YvWGyL3S9tEVLKYs+LnghBmmSl2uPWfqPobPwBHNLW21LUjfZb7jfLMTsMp3icGO1npK/rCsUgdBVKVg0Ys+/WKuTmVJoC8Oe5h3PK1TQhbpZ2ytP9nlutQPtLAEt+CVT90DfVkn7lHLOX8AfS6HLzfHeAhu1alnl19RHKV1LI0G7RPzYgVaSpX7th9f06uo2WpxjL86i/2uzK2qj/ClHbGDyQr3F9/axmq4kJ7zZFVXVVwfiFr5bhUGVZeQJHKFAcsnqPKsb8vHyB9SpFpT9U1U7D4aS9vYgqajxhC+hOkolJV2dKAxysCkWBo3SPiPUrSQYZxOWwWCoQzbV0oeaDEcgUtqI3nq9TSmpQ688/+wb26P2CHLY1H7q5lypXSrnwnnztq/jN1o9lyvLmLyGguV0VJnDCREkiUNrZqGG06MsyA+Phd9CuFoM5M1Pyk7S6TJaHdTw0ni3n5ysAup0kyxr65lFc81NcH8xSmpp+iOEtQZrH/y01k1rGMRJAGFhi+nDecpUlnrh+qBOCMZCcSCovOPJrxjZnZJDMLdpMVu+tBSVS1nKxsYjY9Dtq1/++riVfLUVhzofIcIgQQPOqHioELxU3EpCcZMoL9laa5YlOZAMEp5apx7CphrkL+fyKbBAf8ctwVd93FTo7F5Oc/alNsCgK6lHruPROtN2RybiLqx8P5LTUZXU+Aoyz08zYHasR3U8hPDKj+6arWXR9yWdJoMn45prCSURKKy3+JHgvs2Ot6v6GbEtdCumgCttv2VNoU3KOqUwqNIWHqYm4eMijTM9VWB7umEyp7UPOI8fduHJY0W9xSCZdvc2xMjo3Zdu2o/WZKDMOSh9UmLvo45IBppD2dG++HJu8kbfFdlwuIxk2KHhgHQeNKcHhFkYGRzL2VJVMOAb0Co64wvds5CaYl9ZmBm4zuGDeaO2eI1XM4+rD/HmZyRF62SabgAe8TF43VuMutigJJMfbW2UK0azGLFbOfujnHD+GGBYmSmOQbUCOY99HYvswBQA6r9hrc2jtsUUxLVjxnZ4JnIrTwIVdWCTPtpJpvlA7m01/4tbUMyz9mv1jdN1jkiHQCJXXKg8bJ+aqW6rbwbn5yDSHBTcFXIegrhHGAjJOZI1pyP83Z3vMYTAJoo8V9IwyS+U6OVg78+IhSYHDYjRs8FrF8smHQ9h4qAYxp49rRP2d5uxLAuP72GvZaYvfeLOkMrcg0PkPuq7NsXhMFmiZa6PKBH1l+oKHI5DBLdZCvCwTPdXqmnz8gLzVRb/ixLTSdit2nrzt0x+5rDeZT+ac31NKNskQs6noKlQccyD3UxzfVZFmcbpmrfPsZD0Ve34xpKWk/E9Khn4A5yVPVq+dwnv0EyYecPqXGU7R8suTW0A6NJWweLI3iSGDlQXzMYsSWkSMhFTfyA2vTDt/3wXk+mVU6bRNkZvNnyVHYiA4tmnNwdh/RVsk/EgSerfTIf5VBmuAc2IKSeL5Nbrg3acgFj80mI8SWsc3dNAGCBLLMP89gH5UnLTKq78d9SxQH/g7DVnBh/qnBdw5CDrw/uMzcdXSxWqGIFcnQZt/1aOHxUg88MN2w+FPx/V75gy2wzEVe6G51PQIR2tZsxbv62HhgjwtlzrVREw/yzlaAiuXC26cnpvQzWXp2mOgihyPCWqq38nEadX2T7f1Y5zGxEGBaT//IcL/BsquAJX5EDbX8X1p8nLWR2yyjFRvqC/jssoCJBCDJOsZvoBfXqQSEKhNARH1YfueeKBslAwLi24/wAO1BHptlf1kQFNsOPlDvlYednrEp3a4SAz/G7LIVEsZBu0EKWZu/euB/XKdkGonP6t6lgEcCOw8mceuzvEVzyoPnMyzrqoNQXJb9C8ZCXSiedKiCgNwfNkpVlHbUgE2Rb9WFScOeEad+T+jT8XlSc8rcvkIuhAv/gxRu2eb2GonLTyokjcGF1EBpCJbhy2H3lhL0rdZIw1okA5pBg2oRfQceXTPzhuNKorTEF7t1UIgDqIo7/loxyTgbtKu29o9K9KujvCqUGyPY7upcfiZLNBVKh5uXAAZjQjhlhBp0ukmO4Avxu4xAVhCtnsOIA/tAm94U3HEuSr3wq+ZLo8pyoC9EB/q3pOzQRyCTkozmJwo1Ln/2xEbtNnS2S0NUIS3yz3/mBIdxONHxqP9FW+uoGI1F415lI1nZwK0SoPA0+flaokBGEoXgZnO4GOExU7VOjdPns59ekmDxqNhEHeAF5i5N/3W2NC1XGFjTpqLrnCECiwVkOTrLtp2ehUIaejOG6+1336YQSKMSsL4zhUjw6SQKryVRz5Ldn3R5/r8AOi02RJkQXPdvPsl/FMg96E/cJmIFLmEDzr1Gkh9G3zisG4pqM/MV6XIz+CtDUh6hmJB97VzN8jaPSS90vgDjvnaNlKky2/zIhE9ObugwrftI+Oi2a4VVaB/Mwn3VmaWjsU9NOf2usbcN/GLQMjvfeU/YvyEERPKw1leXZWWk1HXzY3P9MUq6MZq1hkEgFzds51mv8mnp1i4pQprPwY0TId1szXwe5TG+R5mMD76nGPQr7/EhQWksjsgGs7Zy5QYvMcGV5tcXJR+6hlHFIAc/M6XjkKYtwm673Bi+K1tNO9i1YBePTur4I+gMsOK7f7980mcJXhgdWdhNzUN2JvFsvXq3zZRG2V30sJtJYxj0aUv1u4/ppVHi1iHnTY3gDHsrQS8YwMX5XwZ2gcFYYe2wd7ZO9swr0gb8zf/fXx8QWKPXcK1UdJk3760B/TMlpWLCbhkqVoSTsOqzgkmFmFteCCTGhNyvFhw1RrTIWzRxq8Tj5FirvKvtkp2GAVhnZ7vnr71pyI0rKwQbVxKZuqM7GAvn2mRBj5p8djlHUsh/r/eBECptpbbjP5nFyuN4mvQLZCaxeTkDUzd/kNGLIzBFv1CElQO+xmf7Dzt1f7GM1Bh+wLDCJZlhcVDXbtPuGssdEie3lZNiWcXMTjZtWAT5MCmpq6JCRuFSHZYGKcSFZ9kOYJfEqLIcWdzpTA+Hmu+ktgSUwXVSwkaa/aHdZXh7IOyrudCBalCZpgXGRNbhN2XpEY60DXXO1Ci5ayZSoxtG0WRCC50+XtgWz7qgX5MRA5S+jzXCYy7O7Nn0ljVxiBxQNCZKZMTqi6mPfy2LZx76uyRUXHjnpJJEimflHDUxyX7fFg7iJvSrsZMH6Uv2xbfQNx5eCbx3oKycUrBY22KPmgfg/w07CDVsw6tb5VxPg5/X38cQtXI47U7MAGGjO28II12T+PjaXHlstPtkUQNn0DKkCYis+kVAkA1wyAJgYKLGnKD3nlVCarYqCkNIZbiVwO2Ydjl7N6iOtvvbAfuq7VKZLo0jEdw1YdsRaHcuJQulgb51JyELzYBkP1hd03IDcZfPg5XmNvYQSOINsCSn3BuLtkCPZRalK7+S97zxvJHiJCZJM9XP785NZ8B8fqDe/Ot0BS3PH1ptErwxBtpgfOj4d/41nrSjJQf9bV1kfdBHJxYbHILxOsWkZvoP/Z4Sl0Yx3bDjTF96xf96+6uIoQ351Ce6DeTwTnkPr20YwATlnhskWIddUohklNITCq/07zkiEc3B58uiBG6d9YAc4h/7s44FN2RG1UuZWeojrOZIhElvDP4KqHcOYbqqS95o7ilQH5ONJfy+aYiB+sPpn35HfHG3duLpNvBjXc+Klf4IKrFHjeVty02xPTNnbdL4gtkqPqMLhSgR/fDXzxJbSScqewiF1wdVoJ/fGL/nGWZfVlDHOQKD+/i/mqwXqvNqxtZeRHwoe/bodk66B9soOnZp36gdzVMRRQsQiBFf+HXjRcrRf9FsGghw3+qoN0JeeMvDJrkSBPsESDai/uVOzn2Ohge+UVdi050fdWpsjP0D/QuTdYs6QyI9xnhU8WT2+KBKzoZ7Bq8fOdKPeLulUhJjT34/EOnUloqus8+pzqNh/UdUOhgTlrbkuTfsaIYDm87u/GNIl3N53uaU8bgaBjpz0jdu1f59K4KFDtwUUeEUoeYx6DEkWKHdi7dtHhQF44lbysk7PqERrsuAQu2D5tDMl7kFoGdI8r/s8rMytJzYBU40wqeFvTl0ZVLdOB6Ya9E/f8VPbGx5MdpYqYMLMyB0QxVdnoJ+tgAQVWfH+jtOHD3PsjuT8dOTSrupuvHWRHQoGI1Qj1Hc6k+Mg84FAZ/gzl3SEzuGWZKFwuo2D3EiG95D2Z1szTqAuFRmT1nEh20tkC4ysmXx6JtN0taK1iRR62s2uNW5rSAvMEJ8yotr3UhJe22brlQn8Gvcq1I0aODaHJucQKVe6SXyfcDWODMw8xf+2C7Zx5a4Qlh7pJs550DictL4OxcDXKvVmLgVWRwb3moxv4kcxzm89EERJXCl7X/BziBkGQWOHPGF+6K5NFJYOFVv4+NyFq+OPMaSWZKoydplufY+CYyL63T8MCMmwqLTmAE8h0prhi174wnx7DHZWYuRJSYZ63uz97AGOzyI3aebclnud77znbZetbWUripe+AadLQeZPtWsF+FNiaXCy/98km137lWewyc7Gamai1Hd3Ls+KMMVh0R3NKTQ08TIClDfMKwUGKy/7YZlJHU3uW60X0r74Afh02v5MJgVOYkjmors6GAaDU7yKHydfkXYd6nEjYc76xws1LDLWCNNKBtUHNyLseOyNDgmHiJ41lXvq638RzDGis8WIniOb/pbTs+HsQVGPi6mxG+CU+oflMR6/qx3pVP+GPgqa0U0lo8MVmI1cBgSnPGgrh+J+m9TVg8nivua0EQP7xai44ruC5gsAVOp9bLsDXfHQujo6IpBmpfbbU8PDavZpTuJtmflVQuOImnRQ5kKoQz2NBFjdiHH3cF9QLgDP5vz/W5trCy22Uk+TCjXjdbCCHB3rJhKYTwiyQUf8xu6yTKtIwrbw4tzFgXDODmWYEnnpDupk3b4AP3qz4AZ2En5wi6aZV287AgCF4vH8TlWLni1E5Hd93vLxSYLBWSuj3eXGFtWyWpBkIeKu+YsBh19VeakA8OePM0ILu6dYYl9DNIK3kU1ybH+A5xYhFI/EqSX3vtNs6V5eQgxYLvu0hYFjiG+n8JzqLQVROiVa8XNQDYJtDAetPFSuEtGI3B8rnbbrNo9TJn/z3lRYq0ecBIe7a03vLESwhKOm1bGTk2kPMv/Sh9wyCOmIore7JhSFT9HIjonBfi+gcdDLfFt7dpShJmW1gkcXmitWwm1cC480CraHm/or2MHphB9Q1bmt/SBXFqXJdcv5GTt3IS2fRgqThhInCjRkh7Dk1iS2vMBLSGtRPppb4FEu762JehUMQxxLQre365CKoJGvJwVde91XQ+bDp5ZsMu/QHmLgITmwGXSpQFQlQBajqquxlwIOe2cyfezaSHIoRNLcwjW+epnmAtmmWA9KU29v/cA2iuWbj9ZV7HR4anhHkjbxnzKPHnIZ7Mm5wAf2o/3xUhnfH++quS20TdhalHgNhusidPKWyKWV8ZjFLgb1fX2r7ifLyUtxuKHHIfCWXQJ/DKeU61vxmPT34MTi2Q9r7/sK1CYuHVqMBsgtfenn31bUzCoyPN89KiO5wHveqnk3uyHnJSUBVTQQ3NyRPmeRKTQvWEBZ4QWcSgMyZF0RQgvUXRcp6KflF056fwahSioP622TdcTVYi4cAwSZLWDvfjoKFLMowPQpzn6ogXHc93fFA5NZmnwslSuesOyNI1EE3RM8kzat6thkmpOiGmm69Yn8yNuxz1YuuPWekoybkee106T9WTPXo44ea9E5QH2Ig6FZn716DBa2FyXHG1B+YfnmhbEpANlOi61BoGO4+G3WMJDokJXj9GhNsFqdaLjA1pkhLP+/mGCZoYsxNI+A+sMvWyoj+PMWeR8koRz+r9pNVEWT70WhiAkNTrojdr0sBLwxIM7D4zT+cVy96ZE+ABi9CqkM9VK7iOfkJVp7AqCqQ9EZ9emn8rB8zfoQZUBrVd6YS2AqiTFt0nJ8HfPGmnBWf3Xi5CgyWoLAmHJp/AfTdHB0+Ns5DlhL6UJ+O/6xys+CWVKtL9S8fVHkpwZZMJn6jVtiUTtXjywmiVXw9a6f/G7Qd4tZtcoS3aytxXYA9aGGmEeBobjiammhUaMDicH3nlOkDvvz19NqWOvHC2SMv7OQHtDIykYerPuoLz6SQNOBtw6oX2Sj3ZLITBDcWNx9CuZYYVaE+vleXnATrwn+PnuQ34jL52tp85aIOk684SUlQ8uyO2t+eIOHndZ3oxD+BcMAba/JVxRYUAUZoEw3D80WWOz0/ul+fYbhFnffx3PgOy2LLiu82D5FMSpi+Pd4EkIFTgfv7p/0vnX1wp0VpNzyXs/5S/4z0RFS21vIF67k1ERTfFuhLM/8fdbKognohMqTNF/+oqvXXLuJB7IHeDdn1X2eParLBEpz8y9CAN2g5VdE7EimekAOhkw+tTzqeEsgyQL4iVDnWrP/RcBd6CDm16/5t+I1SAxCn9wo8knzmpg8DYP8V/vHw8Stu7cliAt+G/VR4XPNZXWF2rZBeQO75os2jFJrbtkfhN9BzHT4HGgXTjyTy8NGsiQdeOw12GjYKCyxP+34kRHZqYsn0pFvVubB0+/emKRgiGXNRWQwMSvAB1xvTprD0Zyt08BjP/4W9HGNfNBcA0Qb9qF5hdQ4dDqpKAFLoIW2gFEVKOganw3M9/4WP9ckP0/g6kaJDRurtxNgT+PjvWYEWlFa80wKYCkd/0ZChV94njjGyg0t98Pz3AL2AFAhvRRiJwdfRcQqqhWkv/o6X45d5w1YLJOye3v7rgta7Ya0jAl/an42ng5Wz4S5we7n2+1W94JnpoGyV8WW2HYjKLkKmp4hBKlNtb5y4W1MrsG/wfq2N5Xrz2kqhdPQL/YoxgCQd6Y2KNkADVu7TxugQRWVuNL0BUj3JRFyWNeCmB74Wsz54OPnbq0GFFxzSkoiJ3Rtq8yEJMKvOMMalFKH7YFHKjb2nwrKVfuUUuRtTfJDiBuaEHHoX+MUrM2bBaAsSdnY5PjqcMBn/wwojQxzt2MoOCC3OEArr09ghhsj2M0mue5ntQcmcC1R/sK3zfShGJuazS+mJUeKxk5u36CYj8+SJCq8ZEv7bNf1+BywGeDQoTDGq6Yh1xW3Suwo2O/ykazTPK/TdVOICyiwK8MuQpK+FX3mqSPzxfLwFJ/iYDjs0WgW2kqXYgm+gkNToB5+jYH83Xlt0cbtEmkkBaVGlHz61rVuWzrK1yjn5nYHKvKCrBPPRth3AKDQQB83fdrbgIeIfB3iHya5NPpEyxbzmtN5Dnk7GqrQ4uu4h3QSoHU+74zs31cWqIx4SZ2bwWLvIxUtR6gufZhNZoMcmSB5z1O9TKvHMORD+VmuiqzsyJKA1OaApB+b9x6u9FTvUkalgl0r7raV+wRqimc2D7B1z/OiSagdd5UME2igLGUcgPlMSX1VsKQp/9yDiYei87KTBA2NPCUmgaLwVdvQFFFxWp2vGCY/KCUvxt3FOu6xIgwS4Vybvbj6feUCkrQPpO/wPHJPhAobSj/aa5YrUvjHMcQkDZwfc9mvghrk/PIPvcJa5InhVBfjh3Xr9vIvA4ac+m+pywS/EqkSX55xgiyj0TB1EE0NT3W2CPFdVD88P72SpdFzHS/6XsmbGtM8JE/m8eojzd4PM1bNADliZ+XG/9hbcKg6PftVKyKKt/8Bz4lGsHyT0VKj2vDGp/qDGBajSHrqzmpEjW5LXsb5kTV6HgbMcnPW2dzQju9N1sI/gPVlgGmk0bHKOX2Ws1q4aPizhcM/XiJ5EZNUK6bZNUeFaUJVTvGxglRUY7vdnoVOe0Raho3huh1XDeTlHpk/2gBjjhUQXe8FN5A4zcRqkNtKpSVq0xyw9j3yQlQxq/Lnqklpz8lXmzHkz8sX9HJjHwyn8UAjblvN0ZFIk4liejx0lVACoKvpsT9+pQoLY4weMHRzcuVC60DUFkaqLfclS4UJti5WK4FE3dYcc0OilX50uscLJomlR6pXriD6ELNNBWOSMt50CJjPkyt3Zn/xj1dlPVP1t6XExK+b3jMoULLPOrEGvjELfAMM1qcuBb0AijkIuFca8f8xapUlkvLjmmJW7RK94r8HaPzvmHHSqX9MXdivNI4A+JHy0VCe79UZZJvzMGzpnsj+Q6k3EItDBiA12fTMlSbEOMAWCdQq9TtyUiAaAqJozMzryEg0k+yVHqCc/DyJcCE2V4WXIhEnsOc5c8f4ChWfUaONhPPWogpDs/lyVCvp3m0NSfrAJKNiVy5aNC9gZ6c9BqwYgj/cDO3kdam6gCjhR+akALFYmt4ixHkWxKhDTGs5K+CwRiKJnvxP9dbxRPCBHbiVa8gsd2GuiNHZD98MNwXMdMC0MubVodd7dnyk3UQFfCIIL1osPxY0ZJ6DvZXwtZ2I0th6aqlTMULVo+lhSIU/5qO63lTSa3MgPRJEOi0AJ8/UlZuvgqLw9dyEDQoHTKWOsq+6fzoAyvIpv14fLaY+braPd6NkSaq0RClMenK1QLH87NZriUaeuCo6SZ7/CfUt2K6VOt0AjIK2jR0vorf6R8+TVzxZb+QdLimH9pU5tQc73xW93QRPMGy/gCK+R+YzmV4fHK52GWBEBL05EEoTY6OYG1WWji66dWnVTg0uPNw839p/yjLxkCfdTaH+v6hVUCd6HlROj6W8Mil6AYGC7NI2+qkZvJh/dAw/iQspXQNwwWHr6slLIp0hBHYTDh/J7Ba7ZR6cp3iU4bSXdmzhTahYDev4yKiIHyN64EANhI5OHYv1G4KXfIOvQizYWchPhzQg5eVGNMxsqrvWVxjtIbkKuHzE+IcA2NZ83GKz0D8z5zmgRnoJGKigseP9TmMS7BgAqtqyixA/SLc1KEUWrhXOQ6kA5ZQRazp3wwSa404cppBnfsS8EsEpbr/gXyW36cZ9pt1RhzyxGxDUmnZeBz/Uf1AP+gyLIg9x04u1fThm2w/H1ZXGvVqsO1VqutV5gUhFkdkwoCjzz3F3FUr1v0njGYT2mSZYvoF/fSd1W11c5VIhkEO06US5wYRmHVPYXmZnbK5YHQ8pkIDJ0yqssqFK34CuHE8RWb+Dr4omk779QOOcYomAMYQ9ILt2KUk2uNlahW/IjGtenuGLxb/t3aFoVz4oNwMZ7iyp4td8mdzgJAfnCcYtklubGAUB9k6bGC5DSkf5VFarnGEBWz600VGR8QywZ+jIYFZbtKT2QdDOYP6k7D8qVgEZByGmRedZRWaQDTggLyNgDD6pQwEeSs82+hTxWypqwU3zuAWqfwil+mytzVnKztyvMFJyJwPFaPr4Z3mTjyxCR2Jv674JVGGMUSWb0l+GtcYtd+NBGChwr8mB2hlyccget9liJhQEb0XgXfgVRlHlbO+jlZ9CcAew0Nw+tRcWgNnz/GL9Kur7RohRhaYZBBmQA6JhvzkazHRcdZDn0zDkfBmYP1PfQjP3d6qqx6gE7vrb3lBKEfK3Y/nCe4COdpr23oZCoIpssGXmqE8CGpO2bEwkSN6uqeqR4UtWR+xsgOzNeR49PTLJpFEAkXha5YaecJ8t/KR+eG7/HKV23zPZAMvHDC1rdxQ0l+6wlIgZbUybjBe6yusL7isRuuYYwg4+8+4lia2ox8RCdvmXlt00ZshBnAIfLkSwIqUzCcsD/d1ZG6Az728L4FCIqBKpbA6bzkJ87lYQpbaHpwPpqu3S0UqNDCwgg3q9MEn02X16E4xibz/rLx7NMDtHcwMOt9r1dVU6Hws9TvJVH7THrnSFESgN5eBy53Nq2Fdb8mySTxz5CitvVE+ZjHaYS3hq9Bax+uS7TxMIT4qJE7HGdsHM1/9uPNBylhP04Lck39JMe8v2dPOSJzyQoy8m/8Fc6h+X+5/mBVA9jAsG4vmx/KdUW+NXxgRt//SS2Ib7aGILsjOz+ZZQu/NMeuAsP1pFRTN90rqIVULbJ20ZJlrjoZD1VxHEoDFFGVWCVOT3jGK+vFD06gc3yDUSnZ7ZHjGmw4ZiAglY2nm78aUpXxI4BfUHqL6YQKFDCazUIryLi53RczlaTh0ry7WN4WpWK9sPJ0J49fu6RGUMYZd3+NrRvEdOrS5n+EJOTkr4lNzo8vawcYnR/n1Dq0rCHu5o2BGBEHABJbsFLi/mlWFO1MjpvUu6UPJjXlXse6MtBROT/mQfyegWGmFRQ7Q/O+rJp471+tQF10+bvkExfBoTQrewd5UwhAUODpyeW+aK6vx2AroUo2bGBZ/ZjcsJFfMYEMsm47LdQSq7T7peI2Ex+4/9oIAJGfhidbXA9UYPNhxigFTg83CETNYfYVkoambj3vv4MZNtE/wrIfTguBNqkQk9ebLPTmY2U4UCzbYqPKO5vjaZXeVksobDAJzhVjoU7p9TdFmNMyLyCQJryBSOcm0hFk/pcwcV15KZ/+IIqeQGPkTbiY1haWSnuQYBeyW5uSPHGtYw28cQS/v3rToNAUGVBSQ6zpBt4CHvaOfEJhuDJYZCcxvPeOStdCzaoSQn9nDe8wDc1MXrJ0+9N9TAKcS6u8ANLCLY4UfHLGf884/LFIn4OLOlRcNl7FS1IJgu1/vLm4INkgHt5ISp2vC3MFJHz1zJnopnKS1AgJtCmhJRZDaW6wis8CJ0KAJW0Yy0+kWI3lJ9N8yqJht68FMNVgkgaAGi5LuKmkZWm+ztKvf9gT8hJrXZkM/QdHI6wy9BqVeWa7g7ZM1YLbUv37YSnLmGsCrl/UVi/tG+fZbzY4bGye0zH08VQpGmyd/v++fS9EtasmbkQEIYnmLZLxO+tNHp3myIGwYBZVXjlWvrCiQcsP/Fu9l0HWmLBu3gvuJ4phtJsXXllJdM8iZIQR8Z6zEMs+cqVL7+TYhxDd0c0l4sbyIEw6N+V0v3ZbUlidyekdcz/aIomGdZtmdI+1QUrrHw7eDXT+G3zbTZMXxpEgJc4zY5bH5az8eHzwoo8QUleUKpVRrsErGmSF6GPJ2OltKYL6/C4zx4rHdcfsrQTcWBmrBWMMiFiU4NGtpYeACqYafRyu8j8x7ltp3nxVbsPO0MSoaR8tv61/q+YCqHX3h4vy4HzjCYEl+4ZDtj2+mawuj4J0rBpcDw+spzuCQ2khFbks09lPGxK8HYJl0Y/lNLUxGLZ+2h6+EFSaD22bYzF7dk/EhCWh6u/v1HUVKC/r/Wl6JHtd1V68J9zdOTgbvJuQug4r4vUV3JJolQQ5tecHKqcNoYjOIs6BZTlfB+yHGfGdxTKsGxbU/4taKuH8Qpd/M7fIG5zebrpiDHV97T4jiUNt7K64/u1e/+erXV34aOjfddcKNO76EzIf1pfD+KivBsRlzlsjj17aDPq/lnKHQCLsD+3TK021HNzhZyuwpLRKS3KE0XH/0TqUOr3VqLMcsSZM6349QJDznPG+sUqeS6wwMWp28TAoDKdmjzW6f+2au71HsOzLIeWencRa5JapKkVTYpvwMIC8u2L+/hYGJmk0588rq6Nnqe041NMzU6lj1K5KmSj0ZRiVpzu2FSTl4PBYHAuhe5dtwnRQwvvNqIELVxKMFWedxxB7UO4zpYRe2x0zH4X6pI2m4g6YdCs08vR9B7omy/goQUYbUZA+wJamq7/c0FhkNm74Mp05NSCK1Dcy1+9qp82p8XVkUB4+SsVRJ/Tqtn8v2esmemr7zjCfjLicMb05JqNoL6zzz0KaYkXeStBrF9+T7EbZTo2Fa/wS5NhJvRoZc8QUfS46HX8HIZ8A6LK8zKtROnakAnEEFoonVlvYR71xYuBAXbjtxfu/bteN8WkArB3//qp+3btpi2SIMyK6rX03iCLnzOd2OrPnD6xqgVT35e6NUMpN7EJSz0DRRzyze1J+Dx3cfx0M577W84qifD51mZG8VNbBf+5PxmGGrGOmkO+Q41YnCkx51D+X3CXsNAjaz/XfcPJUXJ00vaQyfYDtmFq4kU1ZHdnep48T4IskzPsYT9or3rd/ubiYLqeBqjnGbuNWb9ZdPDxkeBmJwYTjsTU+VugQmtz5+C3QBX0piVh3d7BK+Hk4mO3q8qJVQXeIqs4hKuRvBfIwwUyKg9W1x8dv+EwESuk2Bgs1+Zc3wzx4eGasynWs3V360wH3fKXZFTckeHZdgtzTqcQPC2hCHhSXyFMyljvrneLE+c+b/YQ0XcDBam1oAPzvKmmcgER6AqnyC32Ic4HMP4FQN2rh4Y2ntrawByV+9oq/Z8hdwQEPYRYiELBCnuGGXDQbl3ZLuUo0vfKU/AuMwYfNXmNM2vkn/GRrpc5WDP+MEL80tbJDZfDNBRfpfcvVpf75u0LrkIIjnU4adaolZWzB2yjIVwNrF7zF//n4N5xHeaGc7Vh1EYRdc0h2l23qFvLBNQ5kHbmX8Yta2Vj4DU6eBN3XyJBvJf9iL4x+hw1hx/7Ej5U8EZr/Qhgoni5r9PxBfU3fdvXICGW9DzST7GV141bvyMDXblFG5PizNjJUVAWNSxIAStz6+eDAbkYeAKTj6DIR6ysFvZAloBLCgSdMFd3ol/WXDQh3BbBtLqO9hp08BfumZjLpTJGRAIHzDizXZfhbgqejNSS27BIXQLV0muwzgXGqYt9McSvtLWo1Fos3k6Nu2qGyFftqQyDz0/bmgvtZyiFce/SLYnjt2Q9BnlmUVBWOtbDPvUgOSizvJDhdiSkbLLP96MJ7dKO3eUK2nZnpb4s4b2XGF4T6gC4qo9TDv9z2SY4Rffb/RjPs76P0YiWADpPB/nQjC2tDRlxt4sdNCIjmMsLgU+cr8cpyaMSYI9maP4HHww2jTPkGKvF6H6+DFAF+jAZKT9oi23gpZ2zavE0xXPkF7a2FTNJ3bwxvsJV+o0fXZAkmouYq6B2+6ccHhnUIeL10QtZaPoZPJB7/Xry/2Nv+JJFmQ/p2NSiO5bYGA8ej1vh5QlWhaX3JMs5gMBnyyIfXIMf4im0WEUnCPAJzq9q04Tmxzy7nGKKEf31kAp6IFk95aj0AogL7iljLVJlOXNvV7BwZn4dKfuZweSEZBqy+Mvual0TVDHiwHuIuXbvaw+OkU7aeAfck0Hc6H0jgt9g6Rxb6dAuaiKEN1cUYtD88y0b9Arq1q6ML9B20/FunTnZNF+IHgsg641FfllDFpQ+dqrIPKQ8IkLx/2ppx0ivQSrehNaf5dwtBjnPHroRGzG/RWOdiW0COPzepxIqcsWjhfmBXSUD7YCvPm/qTGcSnhcriFKew6a5s0AgK03I1gEifX6y90cJBY9REbQ7yW/XB+zAXN1XZQVEs7r+0ajtx8KvVBKJksKj5YFGdhEennMbwgCJJIMdt/pJD6FIcNVegt2LiQS70DAJeiNNG86dQVNYNZmYEfo8oa002xKLh1+rHlBX40iY8Wlv7FqswQFktpyLn5oSdo1jBRz8V3aRIOmhSnrs2wxGwGBEVEXvRm8RZVvSQ0xlKMVWs9Y7nnmJ9jEVuDL08D2ES3plzvCNP3FpKQeSknFeVBXv5T1Yk0/X5vdj1J1LYa6Ffxxrv90ObLHARkCI+tz6+0i5cZTinvgIYLMVnV/OL+m4RCsTy/+9VQPsYv6X2qSSlVdQ3KM1SOntMNUBpb4C0MsDh10xHQ0cbJK0gsR6X93ru63BDYbRZmPISt1casVwVVE7+u3l55XJGJ0Ev6S+2zpNqOAH66RuzpVskXE6X8x6wHOfp5PAI/7YG3Zozh1U27IXGEEKIm13Rt/nTE3pKWA7i1NFdVQKQ0CNdqEsBkjiuM41dd5rIbR4DMnoDva07v1esxYBGU4JWJUJQyejYbI9p7pqjrpHZUNlz2exX1lTAks+WxY6CExoPlSlNNv6AIsE0VdPmHOj4m0a8bigDelTpIL1WoePLhblmhRlkPDKiZvkzz6eG8vLeJjCGJL1+VFa4QREBVyuhcpZm1ygJm9kuQ+8v4yEMw0VO+TKee6sMFRVc/kS4IirJupnw48LoR2aRk+GuDBZ25xnKFxdSYqZqvWlEcemsbzl7wvQg5z2xKxEUsquyGziyzd/X+XFl/ct9KRLzyyb6ComIL8Wam9x6LPNZXvhO0QQZmQ8T2MFjmRJ42WyRzfyLGkJKft94uO0Yy6Fflo3AoIEon3XBygpi3Je932ToU5EKoikvqkeLFACpsBN5dseemiMdHxOJKrVJDdTS0qCcTzPCyz506oyENFdelskwdghmUnWyXK2WeJX2CBXudNUBON/i8kMdtJm52REvmGqVmxe5aricuTCGLbgZtYvigT++E7xltEh/ZgUoMP+d8vaPU/HdhZaUjsgQ8OoqZeezvNR2JFm2on+IliVyYQ/58LmZ2stgKoBbs4SllwiTpNRw7ecL2WR8bbg05aTN00C8aGWtReWSsYsirJ0K0I97flI2gJRRN717wESryWahXUAFZAdyD08j9SIZQm+wq5GkoUkK5cQ3wk1x01x4fKLPgPIj6D6lZiylqvWGtl6KxCfoSQXlNZIHeDsrIRqhINxdrCinM0iMMkveNxhqrEzhnBn8F6nXVY5zUDLzOXpp338I2HycFa2pueObEof3HQgFEMnHS3/CDKwJAyYl3HyA4X5vXUE8MMa79gYELseTf0IEUJRsfSa873vl6n29lFq+GCqF1I+mB5PSyLFvgHv6hG5Hd14PAHTKhY+xzCgOwwRZxygPwNET0UiO9ynH0p3j7GAFEs+VSjl4ArhHJbySohRLfm6B7FxxYJLJxJlQr5UdD+5Vs0nM6CehSZZNYw4FzcpYoL6nS+wGGSNKLVLXgbgvzAbT4B1J4GMS16IKMlo5S/dzM/NM4NI+a1Fuk4qwaewoHqGp78vgp+SkuhLyAVhI2Or50Id4LlHwRon9o7JT3D2pibchFvFi2VTEx6cLX/qorW2YGSSmnu9+M8teW9DIRH1TfabuDIuLk16NFz3kNr5QLPGAd0JzN2IYFA140yqfi9LfBcZI3aUK/Gt2bfMMk8eqttN8c92OmUYKUaHbB9C9cpEwaOYs49MztuGtI0VMqDDHN8HiRP55BpRIJtIWbSyi0/LOC94XhzqGVyuzaVaBfg0f++sV8wy7ytxlQYA9w1ejE0XaCkpM9zbOrymf4OrEaIyQX84Z9e6wQ1czIvOihnSaq/fcFdkxJcMzE2kWcARwWT1U80dW6B+v6HdclWMyMWLYr49iKWrhm7o1yumJKxVGiv1Rx3Tw61jrh+vuNjikpFRxa0F9G7ZWs57nuhaIeT8ZRjYzuyq4WZBEXs4CyfvmZxGcS4/G2aWon2O/UkjqrfdbBUF0yavSPdNJacaaZxFQNejGDPK7SCF82XxiahbNpwFs/t07gbCJkDUvvKjqaYv1SNJBa21RKsOuGJNKO/F6HTjc1Q5t8lqLL4e83gWTT4aubYGtE+D4e9zdPPo2R3dvG7bDrCQosp62YhTaV3B/kEQGqtzvu59fbgA6lFyGe7urhYr3TWCBFYBmrEpB78fWnXUEd1z0LSzMcWL6vuh4CJYR0tg1jX4H0wkw9mkbM07MXopLJ2Rt7/aL3Hl3MjO8h/1lqNlK74QTbgkurmgd23XflEcMhjO52Y/Wsz+CqwkBCDN8SUcd0hvJ6srikURdDKw75ZZMyms8NdzvzfsXreeCzpVaPKbkgWo0BlD+qWqaXziVa7YTSezNkCD1UBphMwE3IFwG3+Oja0AILbwR+VMjirrIkRPt+DMtp+OKLpkiE15AVv3jn19brZGZkhhAsuT2sTiWSjLvxJkMICAGdQY6CcJ1bmQsycrXCCxoxrME8B5k7aYQkl31h4kmnvmUA1Uo5bGEJkzebQNuMeVIRwKr7shM3Y3iowzuO8Jm833ALhjeDbR9i+ajGdiv5nuQcBDW0PZ0CB/GHvnmE702e3iEmWKin/StmkbfvsVh9mXnjLzZCRfht3g5Fu6OpDSsq1DSVUie4hNThGTSTWkOhTKbARv54Bxp1m/BqW0CfvfUJMQYci+HzQBrAw7lHJI8klNzq1wbwtxf0zzTFIpYQcsU3ddDWDMuciKmN+BHJ47B6FkgX4uR5QSWzLqgN2wQK1aLp2hgMJGqMII4rLK56VcDk89QQhw6cy8PCM19olNpuDwdrQFvP+77wiyyKx8Z4MVJNxV5vJWOwvF+aDouZMW5HNno5d960qcPPO89qYm6Zh6UO7MyFx272aWYtu/0+UZ6eThOP3s/uMGRarrYNGVN2bkl0VbM7ZArP2AnCQLuPoIbkry4nTS/RsIdFmPg98zeYI4R0RY41FQsBym1OXnJcHtmKPjfEXuujVQGfCPrCZsaT+vFbMFWIvUy7OxquIvdi2DVp3+q3E3NGG06d/cz77wgHGWrfcy5LJIzCMZHkk6m2QnZCXYVXwMsVhJI9nJcgG/CrU5lgDb/DlVEsXG06BHIuqVfnTyLdAQZYmJlEEk43pdgF69V12XC+sB9W5Tfm3jPwiHn/VmGszkYx+Er49CLbyk3hDBSKuzDj+nzCo77ZO40EIP4ZROdSwWlf5S8wfYcAzjNdj/aZ8uknw3tur126RfCzMA+cUo5mPaZL9cVp33X0mRTUIS2vgtwDRgsSSX5xcJUWR8gZbdeqyqQEEAeDu3+BMlrgYP2SH/le2u1yfVFn5JX9VQ04X9mmABR/KOd3rAYqR+OQwLWao9MXVS1y+0OKo0FlXuirKuPaY1BQbY3Vo05Gf/+N+u4rDcFBQqiCrYhgRAEjvVW9eNCaOsukcJWEaDuo/pWCYGJLadm4ssTCPvVVEJNBfVXAcTIxH4EFtWFMJUy5of50QNXNZBl+oRuFIkdbt04DeU6j2A3vzzP+IkMahLD6zBVJv+xRBIc5fODvnJMmJRMI8kcyMFqxpeWZAHxC68tGFNyl6yyGN95SwNYXwDSIQCPlL9bzjZaWNWvs5puiP2lbEBlDw5vCHtVmb/sD8QBgOhRassChwM5o5g4lhlD4u86wmdmVmhmEXnCyLeQJ0rRtqYIWRhg72ieDnqmPvOkDTWtKR38TeJwrK/7IRYfbNspygrU6yV9YtJyw3I3uEkDgbPrpcNUpISYvzv3beFg3ZN+swedqf3IVKkcdiAezu/KpHGHPyvX9oT6qzTS342/DenW9ctM197UfFl4rk21KxSma1KnLIWlGGasMF4+G3dxTnqBscul4CqNda6Qy8ita7HCzKlYa86yljm+HQA2B5ArJoZy4LNxeT9izFuQhEoEhUTNJQj2pCc/O44h8GpQX6XgpaAvAQJLVNq0yXGFbzb3O54XQ6sm557+lT3A+VWPyCJn1MLbsssHIdFhJcMtBFQYi0bS+exQ4Rq74xNE2CIRSzi3nj5TNy2AoO0gdyBC0/2iH67UB581jmM92OHqgD4EzAzyxDauPnlIdZu0nWwB4dtxWN+meq/faIuQpK2hoRP/ULwIJ9r3xyxtXxfFwJ3YquXldSEnxoPiYD85u0OAHvKOG6+3eBraUiOgvdfp1EjiroeSLLFutuPPV9XqhAReYPaRy87OAkV5tzSqvyfufCvOMTtkpxApWsJ9n+cNM2uBWu4lj1oDjGasCfCt6cfgCzh6UbZanbL/qCgf/iHjKYaavIiRLJrU2BuzdsP97XHkXLYbbfsHVTlXSohKOXOJ+3LiR6ix9UFLo9qieejYk+P4e5wC64jGQLSxJzYt3cErx1Rtc2+xlJaEBynLN4hLl/qOrgBM7a+yswC0Mh2OieA4SR6MfM9WK/FOWbVyoUBIUAKOhhIZp2LOgukk0/DInn7sF7dRP6Nw77MaAcYg6k0gdjQN9/1wtGVSBm+6LwkI+xfcK9l+JiWepXul+/EEdV7XXp/9lUsW4RQmIkda9H38FJj3EYJTrG4hEU9YWtNd2lKI1683cXFVzSMkh+2nuu9K0JUBoAnrYkKVZpAKF9G7y5n/KMZrP2xPuUFSOaruqriffSEX9Euj/k5dgewEyQCFTif83LhkIjt5qJ1LyI4ynIznWl1SoAdecEp+I5WmKBB2fr5yw33NX94q6HIP0jW3Np2E0r1f7fUjqdxV+iCRULU+yAwPXFvTL7HqfFLj+wCfIbOg+nsW03rGTf1haLvAZA/nC52pSDnC4f0qOiA6WtK20BldZUaA6GO3m5ZOCGyemGK4a12hM3BXnbladA/yTRV+pH7IiT/9WOijGGNXzV+K4wmdmRjU3It+QwUCRat2mGkEHhOcQY06pWeQqBGjHkWcceX8/drkk+tYysHMXVk8hLhLGjUVgivK1Ra4K+RtUcZO5fkVkWQ4W8fyo2tafhGEDSsflUH7yj8wsATBE9YpskR+r7Ac8xqdxtEAfRioGXSprjbLI2DAZZz9HAYR7rUHzvh/UPpFvrLbd/hFf7sF3RimWNpiGsQRZ11RqfZkck9IJu/FPU2DYr/HWUdskJHuLufXCvDbKn0F9sM31Hn3zIuAMTUc+tQsO9ll6jnNnW9Ulo7d32jEQMqJIrWQL5+Se0a8lKRp+XhYp4IfyUaTRC58vFEjKupeFEpU4EOp1AjeALc7vZV0ovza8QSl3ru6xFpY0/ckElMOChkhLWSDHLCKaFK/qC/SIfT50GJZnkCr5SgXZRddXq8Gc6XNjIzSdCF+9YlUFKMiri/sn1Gp/dEMhARah97GidLqitLNBlF+H8XoQmdrM3GXBSCN6izNn2ON0OzpCxOuM917OZCw2ZC0DSvNuTOFCGGYf1TYgUbgK2KKc4zm/25dz3GhVpFqs6x4yhZBbiy/6FD1vXW/aIcDiSUoIhwrUtxuGGZijb47Jz8JfUTblzx4eNPbXeYpygkQo1xXonjeouTuJvAH/zH+FK50zOLAtbN9AO6xjfX09CsjKitMVlHWmmQybLoBHBPkC5IbAZxvs3cH1VAcy2X90WL6y/0SXNsGeLBdr1OWVuYg+/wUNiR7QnP2ec7jNrZZOosT6Olwn02Dh6zSwKoDnMFLfk7lBO0p9mWjex7gEFXNfxFO19qmaoISUZEgdTuy7sHgrD/36o3XeFdzLFoFnOJa4yaENBXdTSmVZacz+5IGdVkEgjQt/TxuhNGHGtQuzNDfM4iNZ28Ly9S9WkUGMNAfDRLr4ipZkJxUA6HnlOi4Yb04/Ze8rB+HEXpDGC5Jpr4fN62LQh8o6kxknE1P5/rNmz43jehFlRUvCyNi3Y5St7lC7a2ogCt3Za6M7AshQdbVV2+R2DuuiLEJz0MLhnn/1/F2Z2U3h560PrnhR0Gc/5GW5DwO/DGrR/4PvL046BKjUp1lfrtKfE4osRTS9/oB0GrNW3cYgvhU8ld61sHhKOf4P94t4n7h9zdRXDaFv4ORPHokkY+NA9QA49RmsGMfJLu1/RXuluq0J4fsUUBoa9dL9T0yDJXvGtuoln8aYrNzoapa7E8cR73/wX6KwBPpwCUUlxsBtOj0rnca7zu5FqJC5W0U8Yt529SAI0S6nmWnS8zguQLRzf/gRLaqSQ6E9T6Q84u1cs56dzBMv2eBG+zAKw2V0x1NJX1gC8M2MYZpScdXEKPG1442UFWTEUlkM9OjbR4FurtJNV4IqEu1htlgltESO0SeZMHZ1JM7bNtYegevwPSCmW+S8uEGj7FTSSV0HbDg1rOnt4Ws8DxqN2T/HOXNd5NGboZ8VTSD6g6rLWcoWOwsyeG08GPG6KHPiLRunEdTPNmY74ObRGT1VCHP7nmBYmjnH+kqK6rDyrEoNjdqc8uG8yZrHWBXU9weqD5rpQ6S/annq7P/GiYepA2ZDdJA/GbdxpHYatPgkXt5sop564gVHZamW6cq/cdADaLCXWt1WgK7y11WaQR90YOen8BECQ56pmJbLvzzfWBhUUJP+dAEEK4o4wZv2+IBAFEdNkNF3mKntsLE5PDLA/IEiV0rziyORzLJsoxRMCQV/HlpCkXsaizcHT/vxU9iadf2hOkKehGum3973fFs7uRlqxz/oDerFL0617PqG+VYIxjeRb2IRLZJGH8vp8ITzF7U7HUg8Crs3WpVY5r8wxn8tzGvUUwY5csVu15Vmm1xcs0UL/lUCkrOXdLtlaa4pHLeQgpd/vu1ZzjMOcgzfQaIwiZK+fMZjRLAHUf83TSCOkovb3xPkD0jElmb4TBqFrwn8G4KWr+RM58qhCnlVimQ390m8YLz+fNHbBRDs7GJgHSK+v5Z9cwZq4glnR2eTjnqTy8Wo7BEg24CL/RT1AKzOIE7muo8oegzn8R6qab08LzTcbb0ippsScfjQoJhsr4jKG2pMVczpCYqptZcGD5rxTHFbL3+NDnEUptRMyARhF2FMiM7pgaB/IpAna1AHa5EPt7oBdzMGg7kOdSOpxrPXbdP3l/+QCfCLMpCsxFd3VAxA/IPVvK8JaenCYCadhyZ6rJeGxTUh11+OOAjrXIJxb/EbIy8rv6h7hywPp9ZhPCcgt9BN808JhGIaKwtL85jO5nipQyAF690xJ9A2DMuCx55TSG88fN6rqBMYDI+I+DtFmoAqJB27B/xxN9xMLnQwLcLCHOx4GIFCq3/6i7gwJePjoG/HKNb0XjhuEQmYFzTgtt/uIo1bBX4C+y1jrb+R0mRj+RyaDkRus8W4WW73qbcjpjIh2tGUY6KJyhEaKiK+LHG5euQeYZO4zXoKbZOWiJTvJNNVrWugpXkIIIE4zK/g4JKATQjtaC1qbJ6khaJHxOTS2goU5zGyjmaPKvVPrBh27E7E2iZ/6omwpBARV/9EKeU1m4Msz8Q7y3MzEF0C8VIIqAxB+Fk8qG970lhV/ZIX6CsxiHqybemqil3Qv/cWKm96fPoMJWSA1dcF03dSwSyNMdvKKBCYVYLuqr2pISKPaNRJJw2R43RNE6avh/TNA1tGJ/ilW/e4LbOvIh7cS2OsbjyXcD6WS0DYaDa+og0lSxehZQiDSt2fVdtF+DO7/cEUAM3uju47Fl17rUPkRPaheA+6/jpSYK5Nh6rSwO8Pbi1y4/L0L5SStva0NcscpH0pw/3Y9+Eqw1SDVvRn2r2d8vRC6YhQywdhKWraKGBMILqjiU2l5d3jb1tnQIwi95QiTJW7MAjJD4Plr9FGRGlM4NQyAiG8wSAKUbRCpmxE+zk9YhXjiC/Rbt983pV0VzovJW+90dH65IOb2VS+Wk+MpsRgZ86uEuxeGPyB++07HlAwqFjq0sm5Lvom/rcHSaLduJrDdabujYJRWbbY2QZptvGwTHAiaqsAafE9NQa2oq6hV8+E2YRbdEcrirxyx9JVWpti7CsFfA/egMevH0MR40/X1jQzMYbw6mr01MI833RiE3EuU79cpspC8tuN6QxFB7ExHF8yrFQ4vRniEkTgKc8kT2tC2HgNJJ+l/FwYXky6qbHj1cMtBGVOw3SFMHn5l5odYVrLqhL6R4DujKq/CEsEj742QjUogvrSb9DOh1Mm5Z7n6MI+YHii3bWp2abi25FJIiX3GM/137MQVr4wwQ5IQETnYx0CoXX1nLeqLjQ2VlOulhy58iVxN5d0Q2TEV6MPr+wA6lluGEC5890db42elDUvTbbMcjHGrT7WA4eEhNLqVT35NhLruSPkwg1UCAUz94Dj23i6dqS1MPh40Oyi0W+wfoWYXIw+siweU3qKdQM/IWLUwDjgMQuiK+CTyRgR/Cg+XmfazCLiF1JChK7C2x+ROCl4t2WjYngGRxBWRQqqrNqx1EesLx8Z8GOimBJK3Ip3O0TWp1z6fhibUBvCtBpCBH7Wz0MrsYEtW/6gd/rLbB2IcMxOrxgW5u+/ZBOjd+9Zg9SRf7ln5tqXgM7wZE2rj4u7BOezWvuyca2TpJkQOR8U/bR+LRjmN6RAS7MCfYSPtJWSbZYnQL8vGmJb39SyiYiER2Via1nlShjJEe3JgCwTOTiIQJ5h+NQeEs7qWkpIDJiQHb7VwcR7T1gLGhKAqUT5DPO5zvGPny/DOh+Lo+Xhxf5wTkF5p5yY0vM1gw2UZQ2nhCedQ+PBxACaAeuBYTyBs9aNWvYATPBLUtXJ3H/+rMIUQ3Xz5MJKdV6OhLEEK73rb9hfjPlA0gKO4j120U6VHh4AJvL3WqjaY/KCbwpCzUCADZmnJdpD4p4U5ry6/YuhcWXcVV4dFm5J8qADBWw9jPITjUtkf0lhIJkzhXLTcXQBZaaunvCCxyWh6ifYzNTTCGJcUD6DyfGam2zj4qdBy7DwBaL2S2IxicF7F2ubPDvx0+DEQVydAIF4Utn+/niyxDQpGlaaG5eRQcfYEHaZeHBOfZ8x6KnSsZnB8YZbLVBcEF3Mv/87cj4r/BYDYAaUWrrm/rWPImSVpvPlB3xQvVG305B+bCj4kIW4ZWzFnX7/nApDibPZxncAV04laDsD872g54z55DZylkUKHXF7Y5iFwsc0HDovYpJ1P+XIAb4pKZnw/e2BrTZn6jCeAAvAt6Z8EdXqS/KoRwK37xhZL7w17n2PYpqnoCtRAvnU/CocUq+el+PFEwM2GkhLBAJXvVbqxBMfPWlA8XMNY1+dfsV9Uy0C+WgSzcXw/ylN23DlELK9DPZ1nzFCvyDWygh1ABv0LXhuVuDEraYOrX0J/NpbYoxjl/mfncXN1DorfumMjOo/dWEk/OvdZ8w/66CtISpGM2htGRpT929qEz+kRM+2XpAqcSS9GOrLWVVUVIm3Ez/yIqAWm019Td/ytbE6eeYJaY+mJpelcp0h+4Y1hmcF9J6cZQEJi7foY8n1psVTCzE0QYMX+ScYxKxb/bU9eproUaSNTxHeNhomtba4y/CfLAZYXndn5ndeIjFIsRWRpwX3HwrIsKxRgd52tRs/iun5uy44w8u2wZgayiPbOTWGXUn/BDqak5EZebXbdQHyE0yEhUO5HcDnE6xlAuZFDSKLDTTZz9bWcfe1wy8KhSOwh15cBRibt+faUQgl7/5na6Nl5d1o7iUWTjOhjQa4z2Pha1PNGSn0hZFeICMKGtHJ6EGQbB+HF6+M2e8YSQjJ2cnG2SVpdzXlnkzxYqwXv0s0WM8nggSh7Viq5joXNiF3RJ0A9637p1HFJd2I7GrQ4ZTOWRi8jcZaL/25Pox9feMT7VDPV6TT++0Ri3a1aLS8IABZh2dWfxnBmXDWPdvrxmBiF3eePVqd2ZM5bI9YAN23/3qVLElDeD61xvgRdjkXkl2tqif3zsX1gGp9mzEm6suh1kWL75XC2kXlrCreiNi2pfI+iWVFJDXPd3MBNp7VSAZRp1jpt3ug1pQEM470lZXwotpDljklvGxuNeKwTuKNJw0EK74nc0d851QXL9P4pxZdM7pkmbA7IU2S2Xa/AJRP2VOz3Kyp9oW6FgoQi4noNkoHeNnprbQod8n+dQSSbMzNRZIuL/riHaxoOHkaGYwROCZwqcbK1tUnU2Qt1J+3UTvklj6wOD/d8lrZG7ucjZiCyHxK5XVtzq9lDJ4N1FvARCTUfnLeOLc5bmrtGvb8mmsr0lDDyR5607k41wzglZH1fExfmsXrEjiNLSzSKGb7FVusl07/BgeCclDsQkds2G654GVeUpX7UHaqQBEmJsIyvfxvz85+WyRaoYuQfSH9WpJLeUoXpUt7+Crnl1Jqz+eARyCmzL59OUUBwBuoQAl5VddIrfG6xvDA/RZBOV5AfwjOrJ2xRo4N42rCSFCcnOY7xfewl6tVLetiM2tGLqRLc9k/owyHriX1A9BnluzfDc5xdEUKyuwzWPG+tZGNDV0WLl1JyHPflzcBpj92G0AR0lGaMSZuKui5/LUMn69X9wPKc6FVkNEHEjHjQKPQjuFCokjN+N/6DlMscpE48IhHIa0Ghrc36GwGEiPRymXWKD/di92yfjZjDM3fdHBdwSxJRSBVKHSwh6Ey1/zWZRZ4kk+KMS8HuroIw1UPa+PDVpsSIKvmqZnZisbfHFWNW/dl9n5+wM4VIzhmrETz3k9WU3s+z84SHh2f7dGT/G5WvoisBYAgwm+pqFS0A8xyhy4PiKfgS+6TgnQD5hDEerpzgFSaMcw3yvDZ0+xfL0yznf0uY8N6APiqHdoJZOWqTPnTIbeBLc5dvFdh+mvD+sDtl8BAWzYR7QkSgnx30Ru7TH5a/g4byacurCNvG0lTgpkj9w42uqBp1zMsKr2riOCQwfCRKkuSX9CGADOYGqCHh1JUsk6RwvI9OvM9fCJoL7Sap8NUQ7mAvdB2ougA01NdqxVo8NeGta0R9C7QybiN4uAtDxw2zLTG9+0we68JkqZrj9tJilUV/f4wOLc83GfstXOVF2bAJ6zf56YworQQEDj6QnC+lqyMkGAr0QuAikm0jqS7fy9bYSBz5hekPILc94b8aUau3Kt69QI1kFEmcb19aFQA4bSegA9/hFi61RDIVQ7iOBqViYdGaK8d3zH5qWIjed0hR9e6o4zELdXWhOVOcPCmZIYYXvgUsAyGUoCszsCiTdwOaPEL2kRnYh0mNSZGb6/kr8XfbyUdbEZ7mDBYy0yTDxhkrpIoJmVutN6FHk/E4cTEolaGnv7x+QxQIKZus8IEygpdtBDxj+lC5M6HaJ313pLDYbjpCA+oYl11ISRJ/fB2oIdDBHFLefQmF1uHk7vtSmIyI7Q9HG0qxu8QRWecP8ipKR1o4bGrAhR2KcGEDE6k8r2F7N9lNUZCswXi/EXaOlPb9fdsaw1Sspku1xrmyADIImEs//XiPqI3Jl8BlrsHf1mAVCBmlqE7usMbDEpilt45ia5CXzVqlIZ95Fesu48LEATS3dyXVEjwQAqVbFBttbLfXvX4LhaGKv6P3XBsKWvqEFfq1rPYdohHtQH03ehlVMpZ/BRCBFV6dffGCrIa7OngRAbORd6wsIcR/gQSxhfrfHFmb9Ws3Pk/SikwIvAIYljNbXbvIpKTROSiPcmBDp4hxLkrjR+MfBFZLV5I4usLY6WYmjhT2kzW9XAxxLYCELLIf6lg6p/GFgpoRTm+yQ6PYtmKVvdTHyBxv28y3vTiy+reYBZqmC7x0TDasiMCcA+TxdKgDY4s61MpZyI1+RUzeMfx1qh9MBXg1tI/HSKpcUj7+qTrwp35J3ezefo6UZiEWMPBtx0/tJyaej7NUmUHVRBJfB1q0bsw4yHfui2ZOPNh/6R2/I0j09t9QGeRxpuJzB6DNbaPTOmER6WTXYEGXq7DhzkvCP247uSz6r7MfaasDs419fVF4RAt4XoxkFRmk3sjrhpNSeuDoG5RpjE4pI3rH/ESPaF6RIIJBiAbVU/ct/nKrDmBQPBYlNob0WmW07GhOvvz0m/BXTsPB8qA8Iesm6PsDuOLEEm5+jbniDFyXfndwIXHgWBB1GCyGV52MU+5iXguncQS8T+WyxaPDqCCXMjwPJxGObdF8mBkG2+SpqaBQkeN+1IL8Cbb72d3ySQUR/uO+N9v36KAiKVEPx8EERU0vfKi53JWN50+LSYqgHmF0UrnnHCNpcwfX8ezokGL4sK/rgFZlXnIqg6a8EJh7DfMOwMgTwRjjZ+TrXsj7SA6EaMRroFgxXRIOGDPYZgkadllrCosfuVZqNQwAY1cDJzuD4ocR7PgZYXbCA3g9Jd1PRx7PyRTNad56qFMVIv/9AYYd32opL/KQOuEa2LIoyMUHWsHVeJEgDnTAizkdfigKSmZVUDrztoGXA+B+9B+MYT2q5BETXJUKRLiEw3upTpXnlh7hkEk8/0D3rV1lUxxSlnDzLfFArxdnXRhBNu085RxiTwTISjItGPuj0MQknBfLTi9AeLTT9QUKRG7bxHm7P2Kei6fVAeNBP31q/OVsTuBJZfKaxLodsCxObxFdyJNLV2tAt+2SCAO5/VWcDOd7Or0wzbVGwbXJr73+/PYn3VfNQ4CSxdqgXNPWDqh9ZFVRQbSeb+bFmOpdkO7C70y6dTSHVuHlIY33/KV1QHDJ226atG4ltS4fk0ZNDrmPZ2Lps6qyMYO+Wkmsyw/ECuxfXcZ0zM7vmLjkk/LsX/XG0vaL3KZb2C51I5TVf8fBJmMxHHzKvaXDwSTGiya0f8ZZ3olqbqcd2cjXM0jicXlX0cJsaB81POyuItwEiYZwsHn4gymrnlD0mfAro2YoSC7KxDdL1DQVO+0a7fN1fLkv8ElaXx46Z8EGJ/W6akIr6uEuiFIQB9fHujgNzIzAgaDEYVITJJO5XQkyimdgaTBvra1hUbw4jb8imqVpd7G9dSoQVNPatqBlbm7NLsdI/einfpw6HdFlo9bpLb/wBxf2BGK/YWhn6LhzEvBuRuBZJTDv7HV9WfnA2SyT3HV/F6f+23aOYC8rxO7QQ1FI4/0m/OAHdCwYedzx6F6TIlSh668B+Id3ZxNP3V+Z82Tt/AHYSzDsxyYC8mxyk+Za4Q6u8y70AKpUm1NPP2WMeSHfqCc5mUcG67RR+sJWZg7P5iG4FPnFmWKv1nwwk+fM0IIA5p7xmHnj1zbj89sN0hc81tzI6enBjIyPd6P5GXzsmp9IRHKS506SAEK7IxfjQLxkNK1x+M8YAYLrD1qWXqo03kTvXgYllmtbguZX1FQGpXYjbZzgqSLxcXTKqQ/GhYqBJzZtvPaYGODBTozt0Rw6/vP+hTUJGOAYcEWWr5Mqy4792lLWmElkf2k2HiF5268DSkEL2oQl+VXl2NXgbfa8xxQoI7lpuNkURcA/pNz/go3LD+w41q4eQy20ecjCwekr0XfODump0XPUm2vvNfk4P/tAVA2PLhl21zoFOrSKjd6D1AiMtz/f41uWlBWCDDY4tDRMhyGsls4GW7P8b0/dGx6VTgC6oCCWxMyJyOgl5RPaFDE/EzGGGL9XUm5X9L3crn0DvEELm/Vx6HwlGWtnfZK7dA8/zJkr9b7PBgLeFlmXyfUBxZHF8kxgW5tcxvkEz0roS70jNLvk3QNCTUIwCHnqk5NRDEaewDCzjTR5lKzNzx1RHHJNiZZJ0lXrAsSM03iKPyYNdJfMwUAvRlKP49yIx7XS9cvseBWVvGNAc2I0PmR6Xc9KjqauqjgG/Q8i16OIPtQ2Ll3qDkunTNq2O65AEFG5qycHaB2/159N4n67iMEpyNowNdkq/ZlDxsX4dRKNvBUJaYqhID70qa2Rgq8+AzqTaJhuYrqrDDO1n/0rWggrBcFsYwo7ujJZblKGamFf+3B5MTAXNUOKn5PW91Gx56gtqTqz1dYMML1dFR/KZUZom7Wky7v9EfKnYbBseAvDuBFBFFCuXnhvWc/JS4ipUIe59Ls/kL+W5lteo1xt5bkJYfug17vGw6cqrOjTG4nQXZ+RbEDCMTf5JZ4DBcuVv+tGPyucc3B6R9NMF/lc4ubulrqcBPhRUjGBILbQ+4uBJ9eUHMAj2ijfMskRMLcV5FdgqIWhiEvxNVlZSRrzTzySfBUjZHCJQtbgDZ8nRWLwk6rQKWD5aSHuJh0vBgvlNTP+a4P7p59l0FYBPtoNpiFl/dOo05KHesQCueTxj7IB6io9sqTWxTu2PK2C3ACiXWNyxs52441hxg3eco87pSRV1NUvQeac35o3tgUpXtmtl2yHh3QO1mQ55wSqIri3PtVxJ57l0nOuyav/0ixzLEq3QlLZmLb8Y2JVlrdQMjhpcC1j0DS+VHrYIB4JgyXacVu9PCRoC5Y2+p8qfeJA3OFreaabxWxz5omyn/l55+ufQkO5e9iODCdLWl2crwLrUpaMCi8EUcVXGb3Z8oBCUdwuuohn1sivwQp1O+DaRFYXIbHQibdPfq4dU8WeiYJ4WKMlNEuQr/BRIGwOrAIM3Ppjmzvh27Lyx6xK14sUHgNy2ggNG57CBbXznFP/0NVrUQef5mMdso3AJ33SJxInqYebzcZ2pEVYHYczXE/+mcptBHb4ANtGohwQabL1xmFHav/wFH/al8TKjzGnYiFLEifJHL7OJD0x/rtzWuCrDToEWPBNtRKXFZqz/kBH6gsxzy/TUzP6R+C/A456FbGm8soK/uYyafgNmX0re6fgXeehUvtDCXdAUJElJt7AMv+VMdIrrOK7TAaHo6E8Khx1rq48yOqMqtC08so9cQh/AV760CiEtSm6PBL7JKCZBV4m7t8Gbbc4TQRawpuwTFyS/vt1JBnAQUBDPdEddlJlVAfbGy+OKkohOw9BB/JY9rDZQK1o/kpfl82umHijUnj0gVqhJCsrzUxYl+ygkRPDEPZqUIo/+AtsGplmBSxL8bUE1iBc8lCtShF2iqMC1DdHIH1DcucbSNtxOF9LY4IMng4T9eTYzDr+gnOPVxWBYMambJUexTzxyvFOneFg3r4FBEHqG3QZRgnKISYUQKv9B23A8vhFRe8uNZpBtiMtXqOQlVEbO/HzkRbqVaGj4s2XRVlhO+ewkvEaTp4pNLXG1OVF6ncxf3Fq94KmGuG29LLsFI1fuX35J0TsRNGo+TCioyTrXLVEjPztNVQL1/q5tGSrMPhfJEaQxHcrnqhVVqN1gfF+JK9Pgcud/lGa+Ig7eKQpJuUN+PYhBYQ/b6ahi4nLNe5+d8rQlfK/gl3OQ3WDGWuUMOt1YlBKoX+99JWlZr6tTAVgDF0NSHs5fqbU0euO7cXKnvVB3taBFHP6/KKZCBfGqzNo6DgZgiAELh1EYOni64dmOWUuwAQCKu+L8tnTFLlL6uKkaNtO8YGlOBVU9mQFYx4aGPgGEI/HTycxYXBClfKbmSErtcsuhalOh73FnzRz/thPjvRJcRwPtZmCHs1nYjivLMWWGprl4fRUOlrCDiwNU+9TZuaVsuCxj/4DzKfcla139igH7Z+0uskWkEq/c0mrsRLlVpl8ln0G77hwK9rLKc+RLeI6KLKy3Um5C6Of3qiKNoY/7ad3EFvdP4VICsuTMTii/bee9efmKAiym0A+l3hS7SofuEJ46In7BEO+Kf597wnd6s5mL1d5zNRBdOEmfNKyPdUuCW3u/SfFQes7nYlfV/B1DOE9p/pmgK+bx+eZdZUMu44uBGlaPvej5wxU9aumiyt/uCCZ4PyO0OYfFAMMqTaYcI8GxYeHO/3tDJsJisLleLpS/gvPLbEksIm3R4OCJ21S4P//uyzQ4EJZyYmWZjtknKJbz0vFEi0zDWnZHl4kvpMSPlVI8cEAG5r0JoNN59joEsMhUcPZ1YtIDYX9cnR711x6SQEnBGgTz6d3b1iebIdotlgqE03w87xlD0+qEykcVizaOB3Z+ocaMGWybZTIdpR4niV9mDm65EzKK8VQq59iMlABk54A7zAlMdkYNmaRuWJN+bLJ7RqEZf8vrpM0+3cwD0NctuwJJA13JIJVFlPStNIXzAW4pp1OnTx3rMZQfF+o4p92WDkF2tx1MUdC14Er9l1RlYsEYnOubj2IotL4tkgKwnE219ZsjXb8PJFkzakaWhRBJAkgbR6myiYFsJgC/lellsN9g1ML0j4HX4rwIzHbq20FDkBdfqN9SUnIbJf0QQr+QxHx4f0kRekXaqKZYUXYMbRKa6OObLPOaKGft7xFAgT2pHuSw7kdfloER91zsJPWQJbkAzyDFkkgUg80kW7n7n+WBN3CMXA3lU6QR23Ipx/98577h2OGkpcp5YiTX/TikBkcza+iwBGNBi/j+GwW8tGbKxpiSNEQqUDdqfscbVMQ+OSYGoeQKSLwREfUGDjR/emc+ZAJsy3sraTZkpHFZAI69dwO1dvsOw/Q+O/2lgghmEsk6NKzmfI+OYuOG2UoagP9Le/y9UABk4VHk54+6fW891qe1yVDT2KUc5hNeePBaQwVb5BQYPt/+2xEpqsHC4GY37hXyRSGvfwYa7DGUDbMKd8vud28h67mpOl7fe4uFRe/HOKf3TFs+9RX+QpL0+C2b4R/8VfkUQOABt4tcaDV34nU/UFXBUDvPYMYe0F24AZPIWphY9bLwt+tWvmuWwhvAgPN1rxvo3hpXvQNSPsVKgFUKENrmSCjWPYCUoQfJFpepI6oqpsVwJt6IlBFGO4soABNOS2KtnF9P7E9sSLK1WWOdGvYNhxKO5/D5ACMSM3oLy6XvjzPe57hP26DKKsIbhLZqcz8tJOcm1zlVKV87cVqDh5iOgGkNIKp7JU8eBp4VRPvv6peu3DR+ROhro3GOnpo6Cdltkq395hUi+pDXzwcONA2YjC4BKvX3JGZi77wJboSzwwPelRCe5297Gau3hHdjkNfDMaoCdfo4BX1IthlFNEHUm2nTsuiPe/rOux7FSlxIwT09NqnvyBmWQYcleqlPEreuoCZRFvXL07v84AxlxNdJM/atDmCjpmzumIoYOf4uVqV/8ZnSwV78WW0S0R7AwI0EDq4B6IaI6AUBwPrNLY0eeSw24zQ6qVAgBGW5aK79Mg+Skj4XxdPl8axMl4x6nwmnAfEBIju1ssp4yr/gdi9kl+ScGW3r5NVqJ1fXRkW9O0A6JBottvWGypQioSH2C46bepNpt5dXRK28XY0hseEnW9fDBaUMHziavWy8Q7jttulrsjOd5WunqGz20rPiwX/3fdKuQgv0g4CDqGBMamo9htCyKqN0qTOxWP5MmZG0lur+eIMwtcrfYqJujT19J3dps8mrCySt1MRdmlNIykG8cIMszw/nMlRV1DmpxNn2zf3gflXm1sXSH00EqrICj29dnyNSbIteQOqjPLqBf2QDDVVCAgcCz7vER9m5X4XkTIeB4ppqaFa2UHE05QSkAhs7FkyPf40UFGlKG8GnrdKq0ZLUk9m5jleTBwhdDsYP8HCDKRE6LS48qLHD4pvSl3XFvmH8KBEmyeyNwwJzAJQd8MqhmKsdandB6Ec1bHOw8agmVGP/vvY2C60X8AnR2r2HhdkUbclW9+ozjmxmipA1AJIZnqxg4aa1Le0RHfU2vkpf68y/rFMYgCXue7eNqxoS0NkOw9a9/WcDFJOh0Grb8zYjPgaSDENIFMCM0H5OlIqq2r2FKGkaQSMzVm87r9L7fysa4xxVMD0h7CIExLBVbCe1/r/WavK3yPhHVe3XBjyVTDOqI4/90N/Cm5KnqxFrVYOHbwMIXa3GwNwVME+38OpXvNwD6l+jN8BDCRDEjGDFC+WObTdm+5/tfm0QeEfVUYFtA7gTobiCnl8rywroMyBHNClofz+W7OhssrGuos+fRhh8kBA+Ni0fYdhKK+qCZaY0LUDpn17UUKCX6dOZccCYzSsD2iSQP74pFnhlkOzACsapdT20zbjF6ZqLgELUPT8IglaX38zP6zfdyBF+NjNf247XNtmIz4QCO5iRy/GcS8jjaWMfTxI3EbUvzrprtgRQDOz/eMnyVQVbbFiTMZfhfQLeu+j6iY0Qs/QYGFdHefwzAYuVpPhVZK/tXsy6DAioLlmNDzAu1eQ5ihCnobO+MOZtSD0+uTpiOAvPwGWf52xDUHj4zbdFtZULPV4c1TmWflDGMkg/Ia6kPHprHErwFTGoBg+1D6oX8lSPdz5srAF0RbktUTmq44+USAYYowZQOVbM3BWMc603Oy9SQD3buNTgzJ7yaMBbo/pjkzVrpW5xYH0Ra11ykiz32vo4nBg9Zvm92KHWhJm7uQJV5DMPA1JHBWBMcjz/uZupwXqjoTffeHZ17N3waXUaR7cZDs94ewlhsbQrmI7/A4zJDUZj0qKiVQhn3f3AneEhDwl6GUdCBdKY14q9n6ay58twW2PRXXPJ6UE6TUs6oqH/0xgDpP3bx/mfcCUy5oo91agCPtpTfowGZ0tyw5mIOsUqvdURDhjuWLX/WIqaPlYx3zmJ3ahTcxtC5xQgKWrQskF57LaOvwYN0lzIwz/joNYkiZwLyB7Joi0CsWWRC6SapEN5TClIisNQtNPmfwKaKYb+Hguo76RtcQMXdRZWjEJNHq8KZKeg/uWWDOW6aygLP9JDrNNW7JfWDyHPR8GL+29zBAD5FY1WZXsmYfdKU1VTLLzAHERJJGTpwKZH5k0uZrDYM8zG9WX+RVDM8bsmN8cI2wKz0Td8GEq9T4DvY6FuhMsqPGHC1tkLdxuwBYP0Lu2RvjXaxodrZhKfkkIwGcfm+lFS4WMFPCz3FwWwuvNLNqv7c85xnk3aXWl49yCW0YTzTqwyKuKWSIFJum5G8BBjvxx2yDOZMh18M2WhRGX5VA0p3eAilBsGa54P+iEat2c0lLnTrXg7fzDLJrjO/213hRmT/92zHwHShntUiR+9KUWKWRcx9OrMWfefEo/p2FR7dbNWoP/P/se7JJUfBzJixcPvTzMvSTQrccDAmpwoLnh6pnsAF37U9Cakvwb0EZzywhYhfUyAZ4oAu4R1X55yrbJifKRbLIC6NaYqZxbpzV9ec4/SFSjJKEvmVGa9tHfUJayAvrPPbVHNaxlbdJOOn7f43GTTdGGufXu/daAhuYtol2y5rFVUxlDpyKCfYRz3fOyJZEjhxizetlF5kpK8kUuEpKNWnSG9VEdmcn7Tu0/U9Pho+IZiTincXepD9zQXGusmr6j19TKRCe4dmbGmRl1cDDNABYeOKT51fHc6+d1Q9T2n1UMmkd+aiSUgNIrogqtnInezaEs7HmtmpjKttWg7ulLhPvEEnGE5TqPY3iCItPzYojGET4V755b+cNmqdG6OBTlbYjDs4AAp+ho1Iq8R/eWa0/FOyB4K5JLQ/WqwpaNPuaoufHcJMEld4peiw/7uIRZ9U4otV2lACBY2PfSUUu7vJ/iZUtvPoJmd8K/BmbnNo2iumTtQxEeARnjsHdzf1JrE1L6NGFsI7t81c5GCgmWILKM5pWDA5HO53I6aju6916JkUl1YcYyk9Hwwf/waKzGbNaeXD2d1jBd+rriDyPgR5p32kxAb41vjMM5QjUrVztISMmbVDBnx2qArnLJ6ECRGZcfK4U6LCAMxRtE+Y32MobWIYqbeJLCsaF4pCXyZjPABVmN36NRAavX8RXO80JuF2m/Snmg2NL0dSW67EVH9I4fcFSjpL73r6ohLh/V+uK3786Tpz4u9p1byZEEFVjn4eK4wBNeQ7DGhdbFbRTt6/9b55EBMfJGakrqZ4U+Fgnh2uIpidUcG+iBjHE5HMRX2ZKkKLyYQElkw/Kbj2w8OvDaxd8rzWoSUnwkiP9DB4L1FBdrrf9anTqNfPehHTBlyG9cgcQLrR8tQEZN9zuxs8BV1Zf+cIk9kSStcCODphQCbZP7NYhgTuqPh967gyo6DhJVEeM/gq2arEo3NkVtX7D7mzM4zzsjwEazeZbygY6xwP5F5NLqPJ0Hxncni2XMn/GdHQmTbQF1zee4LOhZaDlBzMZLsKXcJ3sJsBmPODcSW/FKYiVgzz7wLdz0C3bFpTwedWpIZzG+H0kpS6hOFF5yNj/xUGHEQK75qxYUFuXq2vFITPVf7aaAWUF+eBV5VbBqFcUccHNaTmGaDdRTdXTurKJ8ATxX0DHWz2qNhGP4nrYJRCKI12hvvahdfR6RlR+zca42mjybVuHEEGrU2KvnHy9+mmlQDH4jYHZKC6knkne5Q28ldgrISAF0p2u8YVTy2bGLZqUkIV6zWDXi0DuZMiQhOJwUgZQNnrjzpboxif7CaCAFdxHukA5fPTubF6aLOTWCnS/EP8ZSOIyNGpkn86BVLEgxNoCo5XDdJHdnSB0Zy+5O4NQSsoKdZzikwg0eSvXAE6j6WW27irlXjNHHxiuOY/LaFsSgXv62JfK2/O09r1DMjpxv32Y457Wd8wFBf9V6i6CdLP2Z9qNFsxcP88S7N6b5FAkZAkO78T3f4mpUVnXed/QQC1AAudBr+gg118i202+jHf4m1tBvD2iwt/8PqoAWQSajReU2kDJ91lZ9cqfgKVbzge5mUlKDSh7aeClFOoVz9UEdTQyNyjj+u7JaX9DWyqtt6955fcvBJF1aKEjjPQjYV4+FQr9Fnd8NqWavBRL91OUcILzXVselzvLQtPmmvtdhkUNi8G+O+b/qcVyHvls9lJjRGbe0YWtuq9zXA02yIjtBjoQd1vY0EmEFvb3u3xiPt9Wix6NZ7ljWQVbw229SAPrh/hsIECHTLmxKxWD3/K6TUieQeqJIfpcIoOQcgmvHDyyRUevzKImeikRzg+ly1+qSicz7hh/DCm/39Fyk6M86XNkhcEgJKANNt1matUHBPuMmqkqR0Irsee0uIofjg8efSzC4Ml6OzAV1PuydANODV+SaVqKrg8qTvT2ROpiQHqoOAq3EdFRo1QW+1ak/AYmGEVA4cF99A82GRm5mLHhLHqOSqBVNF5d+tjFko2morW+bAtWqE3Mhi2uYPJEeL+puWOoJaLV9uHtQIj2GvjqEnPiF3gSNk2kq1rb+v31DDwcalu1nsmfE1n7J39uQgliDyyoBoudkZrUtnIUrDsC6iGs/DA1YU+EpC8VYQ4iw91D0O8kJIRK0Zo3YzUzYnm6vxq+9EDAP5SWf+Eyupwlhcyq7rgfu0UcsS/cyy18bZBvpooyg1q0GNkTJ+MwtXBtDoaChHEqMdF/a7GjUgboSb8jHDJrfqRhQ/bbI62r8nHoOa6UgOaJLxxg1EhXpXmkd3Rch7uNxgpPzxP/mBdrGsygnoth1z7Q/YLYJb7LwpuGREdhP+ef4imi3CBmJrq9pWR8/s43S4uxqNYHUv9ha9RBACBhuz+S4xTQTZaCKSoDHnxC8CxGhiHczvJUTlt4rrWQpu9+AvsrR2wMvwqpTTd2ETTsO/P3JJiLBUvcs0TXCPCRY2h9Nx8ZqMz8XSEqa9ByDLoNM8PxxK/62v/Wkztb9dlxfHsl4u4UjIZo5lD7knNDevOZvFRYHhwFE22lXrX+Sffrt3y9R1DKaG/GlAPLQQX/Hetzpmce0TT69U3cFZSUWj1hcJa25OoCXx3O5jXSizjPu68eF6JRu4ly0GPmihJAcdY54LAu+PeTtHdGWaRfb6RVp9zxwP+2PoTSQm+qFhD5LkhsYuT1IwWLIAUjU9P0z7IOUj2QP4sYABt2vX5hJCVUnjOBPVGQTmwyR8LSRc2WvhlmD4DMitovW8AmruHvsuxxMnY/ybXB0f6jgvY+7tMu0sJN5r4DBEBXa37SH5PepbiAlY5L6+09qF9dbg57qZdXr+Lkj+9ODwIdoY9Ogs9QXAMPBK9sNLNDM1mFaODMVpqeBBx3+/X8BkyPofOmxl+kYJsG1PP50FDBXj0A4uVUwSXOnyDvjHd5pupMiy5DyOMVDjPDi22YVTeKKPxtGz5/wLm/x/DzHO4PBKlriUyR2fdazZ8MZwZO2yzm40RwLqezNhsNT7aqhOqWBMfTbYcyVtVzrROKLQ/cw8h9MBYgLQZ5m7RtajLhjAmwWRubbOysVY9+MbTxulvSqQymjxTj0/yGmowXOk8LorLHbyciHZbi5Wipq5e028xOnXPq0SO1Ei/BmXFCr+iw4toQwld1d5KXZJaq1eDPduqLEuVRpKA9CzB7KJsTTpdrYpMaOsIFM7Wgr9Oh/caoRAohQN6A6HSrmbUuxffYlS4ymc4W40QYfauuqpQ/JTXe2l3gW1vBU3Q0CQWi+YnGMAlM7QCe806vIrrgQmejgYb3z21bFn0KNZj8qMbtk0fubcrDYYwmBhjZezZtAK7N3MQKKCODWwtmN/WYEGctudKJzRB3xrBGIXPbh2oyOsQ4psvw2packPl36ulG2AlW5rvS3xsDrZG0jPgcLNOBZVquBKudvtx5EyYnivmLREWPn30cbkfL4RsfTwuJVSFZZJFh6UkofGq/bkz/WqbPwyDk8xppCVNz7JQstijvxEWrb40THMQJebLnzyY2q2jx2SLecaR7/0b676f5ddR3aDQqQxzS6YlPvFcYbw+8vic5SAk75H9CSsEorQCVlJSk7DU5HBRkzDnV2QtTJe9fsfqy1sQNBXqUXzv+3HDVDSjlHNPKEmNGm5+zlEP/Pa0mLR8hxOG5PeuHfsO4YAaC+btxGwKVWC9Se7tv8fBJBx1n+Kox6GyPB1SVukkNQkjh9dl8s6dR8uwRo6Ep3zrpyoDHwNvpGU0zV5/27gpveUjCyrt2ZF4TOPsS/WygLkfE2dbNXsNDXjU0kggbh+REnbrOGVNbeYAoc4ZX0aRdyTYOFzlRKaGo4MoHLkMH9FMwYlY+jItBYVbIzsByLIUmu7xM7N3q4VtOAzdBtYpwYx/5yTIIJ9yh2VZWg/uPZimDRgASUeaIeF/TU+n3NBLOkQvsf4CKuJi9s4FqpE2p0HLaw6yIcFU8mcl8Jx6XPWv+eL9Uv+Eyr1QVYQfaJcVwJ6kjFn9GSZ3uvbIxaZMwi7x+nNLp60sgdzogotqc5oVT+LDsygUDk+S361me7L2BWYFkcDER/Rx+J0tgDZ6wwKRu7kFtxCpqtt19WgsF6LzpqmDlLORvOsY68JnuZgBdo7ozFmFR6uGXxbySNeCvPKl92vkVsYEYjZ70nSsNQz9WiIy0pcd4Cjnd16gHVj3X+IIr+ZH/gTnYy0JQvVtpoQKA3yqTH8ZK5WAWFLSXjNeHCwtYmaan6uJoOWW3ktmR0n9j0uxSEniCHfobcaa4adhh6U65iKCHer9DsvpoFJxkj5jhGLhPSjJ+hLddzatV/1Ocn1CE5uZoZAMtgkhUYN5zk9+VUjJxOTjDsX8kQFan+fCSw0rK8IhXNp3dynfHXSYCNq076Pn60lpsgbLC41pl75UNjAtdkXJ0OFBP9SOFxYd/qxoACmCf2c4BNjgll3P8P77ikGQPLbKe6Bprf5RR7SLTcoLj+WEriYD+XvlnCQ6gwN09MIkc6PH+xS8JfJD7iyBoSsLx/L/1AzaxG7e0eIP2dxroERhpC6jg8arrg7XQBksDHIJZIPRhy16WjWaucMUOLtxrgBU9rezETjoCtMnBYdaOAagkVHdueRkp+p0+SRoZ4ejQaCwhOiYRYYJC7NsV73oO8dwYLioC3qILoo9B/eMud5uERJdTB+L3gaZcXObntZ43fegezhpmSwHyw4dM10xfsXF1MY5XAR1XmGR9Qz8Yrc2BSBiUUf1wSye1tGQLKtmsheBI0zWEKzJu8/tdWQ84lcWgnXo9INPwDU5XiJi0OyBQbwRH1ahR14L10g9kAYWlDK/0N3VzcgYYursjTtw/2wSHmfTGJsx5NOXmMmVliBLLHGu6G0jFBLZtUkH7EzFzorhlKhKRrLqXXlXpO8crQ3CHEcZLu9XzwCc9SvkPe94gxwonijdizLHtGfLLKLF1cdtXMFa7Mf4P/JQHiBZIRXBzCKoqPaIuvh7X4/SQdEJnxbsIECUF90ZnrLUpBjTXiX4XAc3Mse7eTXKyZp8Q3Sf1S3esZyDQl+BBER4PmbGOeQ+K1112FbEeyqQZg56WiQ0jRCUmP+Kew9A1ZxSjutLVOfkpuBwoSkP4RGNoe7WrmyTXKI6nk1Tnz0oe2Vm3PjBDf8Gwhe+fwAYSAjlPra1TtCj1uu1GcdIAm6ViQn9Srqf1ym9fPIxInLxt48mCIl6DSTi4ZJ+XkJrz2dXWQqhpSF4nNWapdIjJH+p1Opedufkw0xHlr4vORb9BCJ3W8vAPdZSqI7VxbNaaOfqhI/8w7L9horVKv7MLnEr2l2XgUM6+i5Ix58xgRlYVxa+ltEdaupD5yktPEOlldMIatEHTM9j7h7hxVvQPEbtQP6BmDdVaPz2u/o7+Aiy4lsXGE+Km2ss6828uqY4y28croxcwQBaemP2+4hEA88WmmXnQTmIMFje/i5qVzP/dynhApy5GEB55hU7+jPdveexxyrULupZB1hjyqISvKscuKXOXZUnp8dPLlTkOIlOhMu9t4Vx5PLPIDK0SdUiZ95AlS0+/1macnq6hXYYejgXigt9NePxN2PY9CC0HftH0q8httvBeLZ48ootbmSIZgK7/Wm1zqq/lUDZBL6CYC5KDyLg/WfRKIQMNyN2X432uLr/f/9AoV132hvDNWvIbdgJKmzFwnqjd8+MjwrCINW480Y/0ve7EpvtXHg4WzJv5MuILg89gjdMk86QRO9Q/YKdmb+HV6eMqRTq/oudO/E6zvH3NzGgHNz/zI4Clc1kXUMDTrnDpBI2KbWe//7iI6d1A8nhX4F+4tGki7hfsA4VOK83fdLmcdAGqQRjtItVXa3J7vhE+x0h3K+fVJpM2FZDdY7gVF9ME1rtQmyQOE+F7b6vQAUregqMnIegpxtIKRhyTvfx+DFWZLf+VUZHUO+CicH8sE+9LpldACFUpG+WMfE56X+8xIB5l+Eu4ij2kBUNYythq4o1kyIEuD1kt9XQ97gS9+waaIHokWae6jm/Y8Govgmk31Z2M0SBZAIeudbA/y6RkBys3zsWVHoPxD73jIs92cougppJ3Uxf/pQcoOw/qt20epdVJgHhT5/Rg5mNf+bvQ4LJnwSxs7VE9Qc/myZF4IFBUAom49bMTIghVW6RJ2gfXkP6ovc0THTEpxZWx4zTkARVTfH75vftaIkZptS+h3ERciwL+zFBfxojqrdRqqdkYWAVmXpf+ueckOfXPrN5b9eEwl8OJWgoXwyPM73RDn5ix09+qYTUbhIRquBAIHnO03H3q5TFdSXzP+sPDF+FV61ALiJwLttts7/NF2qhFJI57p4sixeZfoEtm0Dg5wGwPCH6tc6aqO8oe5R+IkDR8TuyFEN2w2kBdTxxvejaSoap3bQlCW4svakUIjVrpe7zCbbcGL0xSe/T3hysCfb20Xj0oFitmmY1Q+1QAbHJj3MfeeZfxuvYYoF7mLnb9sF2SPQEFrRwt08qapY0ODw4ReEM3TamVg4j3BvgKWWLIeWrMXPSM+I3hBzjUn6TbqMNWIPDWj5FBYrWBwXYB71BOpmX+5iYomjHoQ7LUcQ867QRS3qZXYnBbLy/FO2tEGfzE/rGyNxED2nvMySIIs4Fx3fZIsIZn/tCkocG9krZ5TWha4eDI3zmyCQeBMYsXlRDNsMfjEEBFh6/Qhq12c9IUp606kEY5bwbG/QnU+IAyJhlftn2f8iRL5A7v4R9oAJGU2GYjNHqZUGg2z6az4YMtQyXcV9X9WBRlaYnfVIRsmuVGDhDBIoG6C8AkCK6LdXd0NgeShgVCNpx7iacd6L5r4rVi1Gco6rCBwBfwyIJs4Fhnq8IZrURn9zhkJ2FenUPijnbIom4cDNJT3zqMfvySGt4ko2KqwoGDH25QLfuWMbcuRhuQwYKgCX9VgClxETR6DM5DNjTv7F3ysG0kI8NKZ5AZDzjJnJD4VVPwVR/fNKHpzgM8QQGSapVEbQCuiSw0xjHphp0eDxZeames1Mp9WwQ2puhmhj5ql1Lv0eYJEpN8RFa01yfNY0KZkTpYzcO/Ckhbb36k9esVXSMPl1G/K7/sR9Mcqvz7tEmdFwGaO02c6azfLxlRg6byx5y5aqHXBgH+N8X+0pGSjHsaENs0tEcJU4XtLrRLBJGIFVEe3TvIYkvc3siaU1d3xi9t7TPq1L/+hMRqojqmp8jBLyo7KEuYZeOKHFM3mUkV+XkyhiFhmwxtLgSsGMbh8fE6hCR2rTOIinlmsF74yj7IpViQkLbyCbrvDt5/yX6I7Y1abrFs7QBI3D9QnlxlwbgZHvFTKeaFKcI3NvUQFQURMimQ5M+eF6vwSlYff+7/cWpYmvPrIh9BVONzVYOe2tQdAWWT5fJSYL5Upt0L6Dl/pZObBEdo+FPC4b2+iU09eJ6vb/kc2/uq9CvCUV9KB+C/CPAJdOu7vq8wf/Yxy8081PEnm7VGsIzzoFYnDvfYTUyPhdXV2yICWljxWqkyEe4e1n+SZCRACDyiLTdzj5Dq5ThMdA+CNJhV09iM2iW1Pgf2XiLDkIpNo8ugDtNdVTMEBsO+uHzrqEI+EwMOFr2gevD8TkmyjvrYH9Bw6rkARUFwc7DRpOCIaACn2Edjv7bmiS3MFeVgdj1y0Rv+v1DYqY6EwHst3CNlpq6XBW7Q/fu+F1R20aHUR5Z1LIZ7wvY0E/w99bKzAyUjG7671ZUYF6F5+Ynv4Cm0twLZ+GTrBp8VL/LMeq8XYgzYldrklMglyWJS7iWBhdA5GraO3m3rO2AorN4N62bHcpIhG8kbvIkybnRVTEWt5a5f7iIYJN61OO1gLp+lMKa9CuaUR/y9eoF3/jHgqh6iPSadglFYQ/GTsLkzIXMTFtBelXwJHtvmQtoXItuOsLGvL2IK/M295YD8SaNfSND8zTfgUXGYQRyrzsPYC1cxWOto+YkW9R3EinZBFUy/5HWXF6WeqLcPADGeJH3U642mjV9hMqA/GY+7DcN2bpls25VizlGv+FyH0qhDmmd0gUS8y90rDX+Xk6y6McJ6S7gM/DYcoTHv/2NeKg4rjMw8TqrlL9LBcLKWQxtuJxVX7ObKDCs6fNlfUj6iRrGPFdJD+ziFknCJKgixZ5RJQEQZi2MefRmUYi5crYu3Oh50a5Jf+upvNzFAo7KhxO8WRvoqnLO0wvvdcPsaVUOIcvfZoUierdTyFyoxwnJI91KCBroEodybtBGshuLseewOL8RJP+H2Oqsca/SYdeeRtivXY+FFQeTQ33eeX3DdtS0+wgHXVCCQk/CkG/az4aY+ExO9eyJRmpeKAXose57USPZEoRKo6m3uIY0rsGhjw0xAS7X1DuBTFVuo29v3dChgu70cPjpl5/xQmrPdA36PXNZRWOszr9FtTYYxG7dHUooremnYo1QnUGWsN/xygLq9TDGLLhVH/pc4pD+15uGiALFzU4PINmfD25G8LAsJea1dQlpC1s7rkYJUQqIwFNDY4Eh0dawLn8fCol/rhUCEbEHM1dJlCBpXxKfm7zt/ZpsbXgy68nEkEoLjs9rk0E9GFFZoYLZv/4qZR7nl7qBbeALu0FWvdWoNb4hCvlkME+i5nbMafn9uVxxXlpXBlOxHA7IKvKJLMXQanWkuK9A+2VI1JSDoY06+R0/g5TPJIHfO3roljfhM9ncx6Qrk66xY1H0+2UgF+oQgm28A27u9+T4rGo0sT6suA8Jdwthg1T9gojZro33dFb5pubkZ5ZHchLzsKkibaR3DHxf769V4iImNuKKrpgMMK8vcvF4YgFx9Asca63MVyNPtp5+zXPASns3bwdmsxnn1S54GTdkB4DwX4L7JXMnQGqIaS+mPgWxbIZbFcDNIrMilEIEGFczfvcACtmReTyzqnpITyfsh5QK4RKX9ZWtvUy4bWXjsLYbNV7MrrZsT82c9cmf4f8I0sSYqVIlcUYgI782imxBuEKs3OWcogWDmwlr9TGLtVSSTlyzHUW4PU9f7Wv06gLioBSoAf5esTj3FD9kKtTKQZfTKEIOcCYWcfIk4IkcfoFGKSLqsHhBpBOTfEJ6dxkBJXCSlknDrb8XJYO4/96XFd4ThAg4/Heg3u5p1kP3QG2yMuUrty2cFQaT3cWMABIB2diEu/1KfFFSKbfjTp8aUhb99C/ZA5m7h8JWsGwT5Ml9Uhw6CmNHyRA15TyVwIsOH0I1tFeVqQaoqT7wGjyqrJ9bI+WtpjMv5CAGQfj+k2aPOJZ/zLvxAtkd/Bzh9BZPEwVE0I0DI82uWK72P5+mHKig5zbXYrQE5bSNA9/gHvSND2qLV3hLPnoJp5q/NeZX7mhb2aWf7qkF8iM4HEHQ6YiYA+E+kPmfMGabHq62QBi8sSJ3yb68iTcA4YT6f+gJb6G3adGkY9eeu7XQZiQEi2fXRSKUOj/zLkyh4R3hOAX6xhT1yCvCHT2Jb9tAzSMxe0RFbM3g6b/VHgP8nyZkt45j1ZYBTwOpQIaFU7nU5focNbiclNOds9b6I+FOnBXwyAf1ViJPMKBBofmR8wg+77g5o3CiYUzQ+KdNxUo14XQc58/GKrIq3XSIefM9azql5sX7KlTsU8DGT1HlHIYnd10cJYsAEHoN0mLKcHTySHsjTFesKWsmK+siZFXhlavE6F44mweXOrX6FBoELRrvIrsst4OH+O47VaML4CK/cNrjlTodfRr3u2XZsHCcw9kXLGX/15sm10DYmP3G3387x7LDyVoplrs0pzIvfcy41eb2Ob/wM6tQNLxQKnfSbL0eyYL+RWR09qeHT/lWpCFvcISYlmdF/jMaIWDyxE/LA1tguYOSiQtSqHfgqHr1n/k5nFhnUBnU1J1eys/8qySmWwIplgfD3uNcFHlg6trf2B11Om/f7E9onO53sWHhas4nNuhBJsUn2OjOnOAFZi2dcAvexHytVxIdybjHcEdXUcp0jkab19hwZ0RddTUGjtyulBmpbfGD+4d+oynTEjmMlYS/pfoCyhEk9XbgbBf7wtFs5qleFrCmB0NrUYZLxmw+2wFqYEUy2hYP3ZxY8uhRZeFXZfhOD58zGBx7lo4yMjiBc0zvOGqVQm8d4tk1CRpyGJOGJWVU4EpHPxqgMP6hV7f0IxJugziIEJHavrZauRXe0/THYEOKpl/a4jm/fah+oAzHRBqwetjJBSjNp5LaZ3ZUNQElZJBDOF1e4muumSHF6da394Cvppq45QN1B2wYBfbx4Y9fnq5b+heTNTCmP9XhMQGniDhmdhGzfPUY5YPvTUhEcaaA2ucNDUO/xvaUVhXDIodrM/05R31bnFkjUjn34N7Aiuagl9VB9SjYsu83Ws9eoevaZVwZMC4uiZko2GtNzZCyMHRq6GKhvEGBiM1gLyvMZk3eR2dGcn19YX72JnDBY6RWncG7lGAg0YZR9lyoCyQ13gtnyBi05gPlO9yOeIYGqQrhgRpR+pAvx4czdaBMpVI7SgZMAhMSsdPUEQ9stTtwSabBmrln0uHsOMhDvi0bNRUWUmqnu3eiLgzk2XKGyTaHCe59vZZcmDkk8aOO6pTw5H+DWALBPMcCOmfIz4cF9E5zesXbQkQNDFk7vlnAcetbpid+Ce9MnTb3Clhv0lL7lyusJYCpLpalVXmQ67YNR+IIDh9vW7XeWnU3FFfdnO0yqCON1josSLVMTTaH/T3Q7Y+gOUofDwwXaGyGRB+4GRC2kk7zANlgd7PmE5kXda4IpmTbP2OqUJ/O9EXW4aslQR5PtYy3tNMamtk4Lwzb6WIFll7MVBneG5vPfEGslblvK4unzLLIvceI6WxhiZNc/nr10k9nn8ikKPz5jmA9oC+lWIE8QR4XYTcO6WZ7VMORykmWLBbTE1NQc8/TBpYSaYjlsyOK50EEwZC6/hyMiltFDU/OcVfSs/4s0Rk68qJkU5mIFxzQcySQSzLKmqQzkbb2ZlC8MLMP8Tt/ui2UK3r3IoyOWjDNfAV+2/iYAbaU/gcEuC9PqZbBCpHpobrsMSJpIpAbdk+lZArMaQfdQP2kY9Krk6TsjNb/ad7Ghc/HTlJyxRISEoijGyuLhUJB5Ch35PrR1oibmRE3vvhC5cWj/AFFMlliT5ELHoj9ieMLEG0BOkVRUXKuv2bfaF8AdXORnzTtMfXYqB8UVY5TvybX4Mkg9YXaiDDrp7KV8wVHpmx3MIlmRkznG4Q7DbYNTZBEi2yxQfQW37NrAOyCP8AXP/EHi/BLLFg/ip1tleZLojlnpdzKgSmJyi4IRDWNifCtFxTRjzh2z9DNa3KUZLZnixrksQWHwp2gRkmuu7HYPHYIQrdjih0WnNb7CL7hFDLjbfGaVLQh5Fu7SHtZTqDYzgY4QnM/x2PC8v6+qmCAMbOvWxZOIxjgpUF1ud2/e41K1bJAXPTZ0ctJLsigJDqNH6fNsXGGXNx7cwJPgP6INK3Qxc3ylfv0L1e9m37k+CqkJJTN6MvvQuae8WjO1l0JvBh6yHIrZgf/Bt/DNS1QULgHfUCLdwH6GVXxn8JChzrTEJL4dTZGD6nCwPWD+eeU/jxNc/wph/HYngIZcSTOnA7ZoHemc7pUYXx0Nr45Sbce9CyAvFnCzoIYbXxoDXYVwt/7sf509VEfvoLzjbFrRKr4vntb5dgeDiwRX6neO0yQZsOSoVjVvOOSAuP4PT+ezKgOTL5CMeBFh5fTyCTneXHNexLrs1pBpLHH3kmt/Gi6938ByjJyGR1wM7/rvRQQoS1drQjQ0vefqIJKlavxUAyi0PuILAyGGfaeCzz00DKjY1cowpRuwwf7rYPEZOByjttnqj6EUZ84F5gZp+4HJmTpMjNq0q/lyKFhwHKG0wkVp5h+gESx82VKGR+mbao8YOh23JnEy+eNJ45yos7d1gFc6GC67dt+OzE5TpAYicEpe2YtuuIHNt0hQpdLBdS8eqx9D9RSrya3h16jYIp9Ogfv58USTrQa6bOJgC6Fuw3VSohoUOQpQ/XY+PVKw2eV8Q1N6yxzymT6QIiLizm3kcA+jtFVJVj/IlTTGr7Tj6P8fQmh0ag3AJfRbLs8nmEQ1QHGUtaUv9djTgKNG5hVLyiujHLL77tNlHcYLwqquU6Z2V+WMoDwfBiMDqK39/tNhs7dXQhQTHYkold5VgNmV+WJr8ETyoKTHTS8g1RZL+KCbZw1LZoGTgR6eNleq+XGRggG9pbw1+WcW0jzJpvQle+pDWTA3yPaJogeuohg7EijR/48Se6kjwNpGStelAHWNOtzrfgmNxtH9r1eSRWLz79nRNF5th43Vy+rZ9FcwK7PlfJojQmk6yDIgDVpS2IJtFflHkl2pdrA/ZK4Grks9dfURGUNk54HimplKaYEZX5dE2M9W/60vxTLBE6XeIZ01h4YiHBHGMX+eAHZAHpSk2dFZUbQL/ylbq8VdzyOCnwzB532xAsz2XqmJFNJCZ6YuvEpyZtLa07GuhPki8MeZUI63KN4jC30SSX7/bWpsMyfpqrzmMI+cCYlmRUB0Mu4kG/untuIlFzWG2JnuSThOvNB87WuxDF4K9MPLtApA2nPV+2yMqZtQu/5eBgMzg8/6FBhddJz3kV0onK4Jbo71w6dhI4czF3ksh7/wVe0vAH8B/pVGb1v7xscPIhg6KL+hvTtq6g1+kCPpBURUhkj6yrfPgZ3/Xtc22MaQJp0ouI8smF0IW7P8ZfkCNRlxyoz5rOlXJ2YoBYf+hZJACLpIW6Ecg7s2fptIWtvuAgGvGV7dSNLkYv17ghjkJQx6tLucnApd6V56PAKNj/7Yyi6MOC9uwvXC4HnQSolMT49c6/5ZRIfWauOyw+arQBxET3gqjgZPldHDuhPDdYxffuJ1ityuwa75OUwVzCfQ3DhhKAfuieBFYqqN1i5usxjNFwKad4V39gjt2wLjcS1yX59qz0LCyVW9KbSYU9A28hy5DC7hdtdQxRU9PX4vfg8R4KZzpT7OhJe4Rwnuob88KsYJT3Xdb5uQj/iI2b9k+IAL2RazReg2nxwi3ia771jH8mWcStAs1NJu+cMgx6oarFqLe8b1HSRxQ7za0WtQhVKdhOSo+l5MyUbO7l4rtMf8vOidRDYSBoESyiDirZR/lirb7mNwOHR9B00U3KDHjR+/6/p0FjHCVpWNOzJcWfIRQkZ6XmbdXoGNbYi+/6K31kVQSpEiFHlf0XTAzQKDh03BJv6aoldSXInQfAEINY34mN7TGvaILI1iq1F8qQD9LdUyM1y1GkmIcoViAyaqPmTF6srtanuyTM4L1D0wyuj0tEVAfuycGdwEON4fnsCqlt5T6S1obgnUutprS4s5WpzQgzd4U9TRXJErli2+o2bS7A/uISBZhgh/679K/zLda6gWtuZwAvTGNdCbAN9uwZti3Hk9kKWrIq/zDHz00+fSYLcc5sgjgY5sWd/F9nGirgGojICMTxUzGmVVyjsC+0iZ7i++UKuLA2KCekIgylXj+DAZVKUFgBgXYW5+1bwyASMUltB5MhCcaMuivyyhZw3MJ7OjjmJyH+sH7zwWOwFaztw+KQpl6ETunGZ4wgXDkkep9RDpXHKdERy5R1KfOfi61l4kXklOVi+UvIPbGuKxTqSuKxjgg5aUU0X3V/EKdOugbYyeYKlYTyfe6Py6u2Z+A0k4k2giHiUVqkoC8MKxTXxmChSs68WryAMhUxyo84ORdwTONcLdmrVJbnyH+ugmyyx9iKEPADsMijuo2U3uJDa7Wnfr9gcycQq006VxIwrhk0FV/BDjqzquNOsEJXdrimGw0G+JVU4/5BNk+lE5kSCYz9cOOfNBtbtPUoVHnu1jfPwwGlaTc7GUxPcDFnEgwaHh5znVnSwPAAdXz5o6vI34Epz0NKfx11wmUjfW8nTAn60/CwPV4XjHM2yzXbq/EA9hUimpPyH+gMWQc8fiEpaTtk7l1iADxvDO8EMdlaQ0nXdXnhCuCrsoC+Uvlb9IaXpTbhDyzTzYYUPRsJ1khYU6+UMPk1YHn7mE5V3/F28Yia/wrwDdF+R6TmVzsqudzix7NyUGk46wXs0WaHIURcZDicGiV7SEhoVNTU0zgBoaSd49LNnCcmSgWRMUa0JKdpcVnfovdDcIyEcqOXD4VeP1baW1O5XKi8DuZzNuEL/drafxlkHz2RIla0Jp8ILNn7S3fdeg9UhAx9q0+SKtkZq2KsJrdjjyAjr3GfTjVIDAz98414NxYOtS7EWs2ZaFK7+4WBYoC5Hkeq4b/TVXen2W5sxGUXGVbea0PfIOieEzqtacY9iZH8JBwrLvaO9mQx8S8Xs1qoQA5mRuhLUFIcDGMj1wJK/K+vclB5Bl071Plrpq5+L4WJ77f/haemR3QBDVN+DYo/NMMFkqokI7b1nRwuzDmI5dEx4XMlGANd6UtZZVQ12+CHjwiLfAM9yPWaei6wRjGbxBRZUWxyt/lA3BanlqVbrdSdMBG5p3j4Pa9sSfYjUr77zB9h2qpnC6V8u1+XFmGBTP3y97KCCHykGfB6mbCNng2OYcDfFxSp12MaqtqOwry+xB9gUkHlnfW9DENAGqcYOxFOWwZHAJEeIuPuyLr3pc8euQGkJA6K1rmHJDoeAl370hmHY+Wk02WBNr6bOj8owlbEPXZobBQ/xU4JVN9l2GH0nnIedokXyCvBiq+jOf90wECFhhyXgaKiOos+J5t5i72+cySCooSeyr88ULT2mwUuMCLDw9Pty72PByiEtatpiqNeZF8Kladg4jD+8iY+w8ru/PveAVmrABMft/YevFyzmyB1LNidUz8yrnolKmitwK2bPJrQzSfyMg7RCZtnj801QmxB2Hh1RdODJ04NYCR84mkyeVmLrySQsPfWBiZawIPusj3W803YTrCIFZh55a7RhYSAh5uolGsv0TMC+pfZ8CJFMfhrjIkPX4iPlpoVij0m+1EDPaObMhssohxiQLjAb8un88eH/6Z8SnJxoDDY9JjIkM28xe9G9BMqE8CdRizNqXF+yzFoq+i0JXmGCunk6mGwVz7dw0Aht2yZLXL1jgrrUpP84ikBVljLiJmABWcOUt5aq4e2FLPP4IYwNw6/6kBGhUw92jqGvzzSz2IXFoSGkFThCZ6Hdi95k3hbTR+UyOtNXxKf3qOHtoG1+tO5u2H6XvCe4OZ0IsSdV2C22f4X0XRjnoLI9dkAJcmaPzyLbgrWgj/dizWHsrNz5PzGCCZ7zywhZMyk6RrEJ5ucZ5k4Fosm8+U94ZyJFHYaHthMhJSLgoHd9plpggxNFeaBMx2BdSg8d0qM1P9s3xHTr7n+uvFsfU5qJafAkyfAi/gC+OLxCw0uMl/XJ+id3bpdG4VxQwyKvZaxCWrPaRHIy9KcdR43jv9jfykGUTzB9KjyF1G0SkyMHMeY5wgAmcEp9B8ffD92GR4FQExXAD/Rm70xyf9mrg0HowJ+Y5o1trz3gJx6Em+pGPt0PvCVSXsmyA7BLMqIiL8iKyvmFzR0O7FJPoUD5dZJ1eKn4tDUJJ4Umb72XTHqR1qs8KsHPpu1Bas2jM6FoTMyoX5aScTz2RVJH0xso6SkxxuMBg3uUblz4fj83SnK1GADX8ZJtrY6l5lrbF1/ZuSi1BShVAdFnfBB3Sh1SW4KQz2mL+Y4svWwspzeGp4W6pTFKdMDjOxHzkJHkAfLjLjqf+T1Axa9og+Cl7gRTi70bSWjsQM9F19HqH1IdJOoerLMQTLpuVpFU//G6/hsxG6sFsnzMJ7n73SbIizBrcriqJQot6sKe+uP1gONUVuBIPlDJA49atkvafSdkS4NR+zciAFrwoHjdIsVSJKqDxAVrM15uFJb4cUI1Z5j3Wgo4gLqLZDMdNtYKJ1P7oBTGSBKZGTqguAYXj9FtcQ4sSbuwAvEKj0iSHfGzNYpAzMhIVEl+O5tVLe4s/3uEd9Gsrl6bogS5HKQwX3XK8Vnj7lf+5qIQiTSzRnfkEpdxxgU0LAZG7OSxjiHkVD2gFaZ1GjKhIedce7dFUwac8qA8Ut250wwH7O4rKHFECWEhhPfyyNNFFWeFrcIjCB9QkpXuz0U80DXFirexggv6bCvxlzrpYL2A02HykHogeIIum14ATyzZnKSfKNZqYUHkFr6qN2/mPO1WK01C9CpwXcl3fLEficn+qMiFNH5a/JFJBAF2ZZWJ5EP8mGzPCF9CDlr0z0YHruP+6bAUG47CNw5yDdR0WDTjq/DqDE8W+/fc6iTB4r9945YbHjR76ZqoOFAkp3KnRniRLdWK5iKvLCCH/Jf9vzHnX4LfdHlAiEucOADd6aaTJnMDTB0DnLoW9pvA/TvJPoH2GYOwUyBgDkGv7VLqRPzjz9nIWylnnWqIlm7L9YRAuucHIleKaTQCeUrXP0Wnyp2nmBxzeDiVOPsap6l6MYLHO4xg8HBAK3J1dgvBpIjcYDKZexJV5mf8c0hpw5ODKTwdkKCeeTezcPXh/9nI/FlRcIYy8sH3nKCQ0EEucVi+uinLNXGTmZXSuB5jYC2k1R6X8FYDLSs7G3qg+Wa30/SZZVsN+vbIWPDRqs9HMz/V2eXRrxClGwzMRZTnpwuqrD1GTjLUluOf9uPygJGxe+/EB6Ak5UCCsCWe2GLD5iZX8ywqGyaP9CGKOOsQ504tSVjAMPPpKo7Ex8LT3xYdh4QReijfasLvMKd8/bu689y+WY+S8IO9LXV7KYzmOOycnb7imsjeiBPCZgNd2Hd2fLIQOaLorPkKjFZcGRaNO6lp+pBPTMvw9QIbYuQZBlhu48VmV3i/3Y0m71BChUWR3cdNSS4D96YC5J0Y7ZFqMHBW6G9p9pf1EMvsoq2dzX2wSvNYXqdP47zyePLrk+nreb97cBNao7U34lHDXeFQ+HqT8XvcE26g42SyQZmHFRlH2UZ0kohpcgm7Li2wAo0IHMre/0XfRV0HtarB6og11KC3Z7/RUcqKzEPA7ZEJQgZNgBZE02MFT702HN67p516Nvqkm0Gjx83wQdQMeqxlml8LDK0V5SdTdnatEK7C+bhiQ3CLRBupVuTeGYhJY/BbrqiE1SY1vdXZ2SFuvNbcrI6ErGJV8/qH1acDEtu58Cm9IYXlR4R//8FS+sjKjiIPcuzVQ+9bV25MODrRYTzxFJYbLhp2Um/HKOncgLdKHj7tOrMZfxR6CrV1qRAGh+vD5dMMDkqvh3RtFI8M/B+95gOm4879zLjARkfVycAOqjJdoBfgWjWNsJnafTkmc7B3nIQv/Doeol9zaGW/DlpeEHHLSCVAFpPcoRFbXqIB0NIfCnsKcK8GmaNVe1S1WmDjR9kV2WjYdDpu3d+gX3edjZ363f9jQEbUhFXtuRXOQv+gmYCubqBrqUoagUdP7xj0HIFEZg93/KZ2CrZfN9t0A6WcpUJBI5WLyoLnqf11jJxzi7XP7icTGifXh8HPdPwOvmb7A1BFcfY2H1yrgpQ9LL1WPc8f4dqfuE91BNq8DtcEql3/06rGk4gsNyWI77GnH9IKwUsAFlrpUmA3zzUPojorig8/2Cbd3TjsCKM9wxliCLyKPngKsM1KFkqM6bMFtyxYYrU2eewcxYM6RkLIzuCbt2tjjkrWkSVoIS5lGaeH9ACsgsCD8uBJTg2FG+jOXwTTSCvGIWOiSPmrIKKcqEISVvUcMWhHEeUKjXTMdtBmPl8s4WipwTYa2j7rmaa0RNf7IXAOT77NGep/q0h0KdWRo5UPERTufgAqHgtum1dZEPq6OH8ILA+nokd8MXPhCko+zgkNqNlrLQew5ugiVBI+TSaF0+Nh/0lIpsCoBQWlDacVD+Vx3x3aSXTbkp6URafBo7r4W0YMJYL0MnwFM5mzSBvH459mHAZ0yzT09dEXgjVW9/ggg2LxRO6yGo5FTpGQS5EwMSjG3crtd3U4X4CO+KX5W46TC5B/X/DpEipFhWLaE6rpYO0r44KwsS9Ge9H2dfFY3QNvXA1sWHN6WR25HgQ091u/FmxcmTXpvXerH0b5xRi1MwmGmrK4ZAT1TapoD8+smzXuW4xfFWkVDOL7zk9xNtB53A3+dJrIzc5OTB601UXSFtQkX3hWaSnhB0fIWaxp9w7vGQDYtDAeTTDigrLMhVNfLUpJcIxhrMjO0Amicb+Ubauev6gApJbByzVQRTWq047GGRSYgxukHnlk5+xWTYTi31cQQCJ9ILZRJ3tV05M1AIgNeeDW2H8IBJqkzSl9nnKSajGYOD7eMyjHHWbG4SEV8CvAH8Iew6SodPSlX4spOyb4O8XdYQ2bne98jMMolgBIbc8j1VfPhmdPcqVcmf5qMjZcC2VzGSMF9s4863hYPVGq86Huy5cmg6zBz+qDU3yje9vmEr3yJ6kZhF5z8UdlkJdjq/581O9VuCR2B3lyEAfQoUZot9HdVILawreyRxAy11JlpE3UoO/fi5/5omkUs0A7Gvb5+bsteFVIW+9l+qR2dINow47smAidv0bLLEr/yqKcUanjvixyzAQCM5CVzq0r7rDR9M7wjLxBq9eBWRVmyK9TfSJqXHjL8T3l8phqzWGZrkRC5oiPO6C5Wf59fFDP+ituUaiEqytebX0Feyu7U5Leql5gBMTdDPsmK7KUOyA5TuWxjGc7dN7kJKEYpro0VWRhjMArMIGbutu6vN2OSHb6nvd508S4Q34uCRKu96bSAD7YHASNVhzXv8N8jroYf5Y7E9s4wTpkvo3BZkkWqpF0M1vka3jjUC/JuZvw9V8avX+D9bciICl12vr/bQJxDe+TN9MQwDJwOe5HRWZKtCtH/1/2brHVDE381FF3JIILjZf20UTFL4MLwmZtFv3M88Bv1x6hEyoaAlZ5p5QEWzlw8bJBt8orARhiododtduYtJBSF7octT9JzbeKdozaif0LBWL/u9RjbeVNLZ8UV44Ye6Sz56Vn8QlwftWL01WoPryii3ZZ930Zx6Ins/HGvGQmHAD+2qvuKQAs8Y6ublb+Dvhp3Y2NNMjsuzOvb6m4YtkPzbhlctKadex8tBQuo0zhmSxfDIZm5VnEDdG2vZ6kcykYFxgAz3wrkVyXQnwxyQIeYMIHQYT+257jBWD0yJIiC3PqmohMzTC/65XVgSsowG2kgnlR7pYY18nBQ8aVfJ64D79rH2pymM4xMU1Zk/OS14XiDcldhO0c0RhQxiPSY72XYxpiaKVYmzOcEvI1PzQa7+LVZ6pBIwn8ffWvhqa38b3IskTs4RBkYs9i+i9/AqdAQg2IOeWv2fuo5tEcFyefI9nATJXQchbBEQO2Cj3kaBe2X+81o97B22kYSwjOkgZybf53qZFQ6p/N0dL/VnuL1cYTGi8k6rMpkKGx4j+Mc/fcHUVNXTKhyO10FkvHiN+qSbJGepJ/aLXoLZ8RET0Bshv/4hAQgzeS7yl0n74cedqdnmAeHmQ2CyXvMM0MWpEvA2ezZIKU+WvUSaGpTt1kvMloerqnqxHLfT01Yh2n3iD29EWnrQsyjedi1I5SUgvQKBM9G+oAai15cO1con2QFz3UK7w7ZgzM+vPmbk2QqR87fzlbdTSAhrLXzqVfLnWBA/4+5aC+0BRMZ6iX9lH3QXtKU9D01K3HprdilL456y5lsl38VQaMbz9hk0LgquziMY01Znz2WE4ClHG9cF/e7stVmn89oNFUE9NZ1RAc97KzDEWHLoKwlCG6L20/2Gj7/M6PDhsvhY+FMzYRg+v/0jo2gPT0UTCfaLBDRVvKQgUSYPMG1dr6ox7ohepBUS0msHq/V7A6Y9WfKDgSLatqTzwhOXnuXAoFc1LsdlV/Nv7XHqg5TAohZGa1mOn44SyY1fyPMCxL1QmxvhBC7mxDyj9DUnBpbjdAzrBW0mUzZ51brDVW3f0A8oKL6FYBf0mwK6YxDMJogq94OPgpZyKHKBYvJXMfs6u0pYnEn/jPeTVQMK6uY9Egww5setjqwdQmwi1ea0/uoNw7QKPorCWZohFt4VB+HUy/ObjCDdxryIg/y0wXGMwFyftSyf0v/ESOVaUNOHg1aA0SQ0KOwx/oqBneMvSoxZc7SqvQaHcx3ZLg7I0FQgQ9799KuVGTfGNgWvzIMnHqMNnCyCLJMNoNQK9XA4Wkq+6tVuCUREehKj+szE6KlaSwgAPfb6JeGqIyBrjJK/wNw2yPaYB9wHia3A56M5r4OplAvdVjO1vrsc4I8LAy1zqqpo0yM1hfixHeLNDG6ufXaX/4mWxYpqL3hBHpPbnox49P3jj/wGgdZFaJe1JTer036xd0Xak5qCI6SV86xqAdAChv6sj7ESw0SU7w0leCi/08lfYfucRQHdzjO3JkA7lvHw0ouMCSCweP+ms5HlStT1HLlgQ/pkLQ0HiDkuoPtTY6fDW0UPlH3ebKJKJsiIlEwAnWQ1ExfQhfs1IRdbEO6sgyC7u2YqSye9WFoH3s0+d4P2X78UPcUsRitbiSflMds3+5ixk47wEAbwHOouv3l0AUb9zZIP32hh+8n3fJx3LXT4wqErJXRmufydvyJuKW5IkA+rD7B5y3hJGUFrf+je8x2WEZ93MMZZjKF3R4hY4E82J7y0z9znWEXqtnGce0dejOBkrf6CbP1VCh4ixhRvmOXO9yA0A2XQqeWYNfk1eUkRWlybRDBiE5SOOtjudxOpqC6Hv0XRqdL58/dsrEItVoppvb13l9MrZRKzOe/vtw9JP9aAkOa7ra6MbT/3YE4LlEJ5ticKWKe+rOGibg+N20Vx6Vg7J3byZG9+hIpULnZWH4Tq3LmlMA+oUfgAbbzPl3twbDuQozSElI95KSsXaBWevUxIWPQdY+4eolMlTtLwn+51SP6BWFEiioYy+r2Rza4OqKJPMbx7t0CZCtpMKxYQ5JCowbAH7J4Y3Eh3C04j1H/2a7qH3cVo01mg0KjVVR59qENmLLCnQ4LNMS3i2XshEK7QAIvi4D+egZPpMUywog3s+tqRiaGXIEMFp3rd3TuvLXVT9tpJGxjgQLGMKXmGL1MVjoN97by2NaOn0JoIbOQqeBIHTVbBYNON5DD3XP+rStPIfVbuHd+90TJpGh8BlfV0dLneK2wDMnndVGVvQLhvaQxu6sL3XsvtxmQzeFWUSHLeAlmTc9yNQKkXtOJWS9faewS8yotiXdJQ6EI1vpVOHgh46gljSllVDRx9qlH7i2QFU/dKpaQEbpAFUBI/eSUGbpgT2ORGcUGXXDWjQJQo+nCkQVnIMRUCP367os5Iw4Rb3LDvOi+/mwcBozzUa4WkjVcSIURKO3RTFCiY9j3O6C5MBS6Y0WbBooC0nOzhKxL8xMIIaM/tnyEzIdlABrz3f9XlCiQ0hh+C7/bNp14eUvnjcHWjBOSw8E7BjzeXkRQkpIuZSOriwZ8PiOLZxCkXFOQ4hbXa4Tu69lccJ9Hd0F1lxkg5QnAhhfx5WdcTkBH3SibBUMCLPb/cYypz6s4GGDMV5smYibldp//j9gbCEhqanpxLsoexOMik4SOt879z21iz+8V3wgG8CicQsmxcsqCc5QUqOZhnpO4qAFgzHF+noxN835P4xf5EsOcPvYWwtzK3WEYVGy5tuvxE5WZB246SGIDgeC4sMge0B4p70Tse4b6NjlPHW+90GmqnySqY83r0ilaew46qmwi4RzmOcPehbn4YPCoISjQ44RURV++dfU53vcKhkSj6cWuh75tdSSUNMysFwoP+lN2gGTwxOfrha9wWxDPpimhEBVrt6dcBIvdoUbCLTDQDZuUOVVhZP4sATqq8z7Ai0STnGxzKmAHG+3I+/tvrDN/OOTHwR6W5aWSRj+M5wmS5hfdvimlus2z4pE6RV+l6scSEX3XjFUVgbSuuufln4qZfmgBxNvIZmkPtMh4WHAtuqRVdgDOLksqdhjqc9jrNVpRsYL4L5fXaKhNXYNJfTorxbaoSpoqj6ZEp05xsc4y4Qryx7BRs3iYvuHRbCUsiCPmmGdUPXDn6H7woEjiz1YeriH6NPF5au5aVrtcw0DvEgLLKMuVq6QvzE1mu+x9AFhhIEE3jVvzGWs7x+IBGJ2hfG8Kb57q5sDsPmddrc0s2doavGt3j59SpKkbETAVxcSwwHbpAEsYTNPM1KhVl7EPpQp+gNotyPx7hI11xG47CrYE7+4xlCFpaDwvf9FWescjE9qNrcgCXvSeme0GAOo6QjsttWQcRguwWZb6OG1VPN2xZcfyUeEGLHhPkrziDDf4SHNaCcXXJ9CtFdyRMVueZNWqaoSKhpFI91MMLSXju3pGbSzJlM8FPf/oxZbRADvlZZCyb8fbb4mQVBZZ3GWV4hj4PCrLA1qQvEqs9XLsRnoal9WaSQhWRzLJmCurnGGRc6wxyAAejp0pAR70k0M8R+ziXphTbSz5jU2xp2cFe1EhegrqPqjFAtYWbYwsm9X969oYf76RSVpD5DfI8iDfFILBkfvnZaZtHikQ2tfNY1T0QOYafZ+dfiQjWZxqrDxXDWbc/jYZSbOzpgJ0HvC9wodOgTk5d5d9dmNrnM0LH8bvtI4zgktUZdf/DkYM10EF8yMhbFqvpMTi+TaLBUNd9aLSzSGAqu41xsKxsEYHFPhxozYZMPCafc4U5t8Ja7k34czb9pTsN2JFnwl8AmZSpI39KzBoEcD8fz0CAcio2KlaDIhPF8V0HkEbwc2c0mkpBazhOMI1d4cxnKG15nlJ+haP4D9g/H1z7jIEHS7enL9st+r19iJpqLFuJiKD2NT7LXyBzaAcFxIJ/fo4roeZSvHUyfgqUjSVcPiszEAuk4Fgqjxih+ln6TZW8b5sbDIvrB1Ul++c1B63XbFgHdVJTaRPzIXeh5f5u+QYvfa7pHyQV0ZUIv4SnfFMvTC0g0/fdaaBd9rcpxu/CBpbobKZgCIyVRDZGdPlZs8UGyu7+Hxb64E/k0YIIyG0d7ZSIcU1dOwyAQt25Ow5B4W/oUhgU+Gf+qB/Eqf+V11+GylEkiyGag2sSabnAwgaqTr549u7USX8FH6EnKLv1g9jl2zIU7C6GM3aeDn8kP+9aBM0Agrl165RV4/UHaXPnrBjs3YOHlrMK9jziNkwwt6+rC5FPPvSm2uVuOQouD4+Rk/8X2VoT+8bijB9PNpfsOsNhiSOVgntu7dzfzJItraFExs2ylPt0vanTgZJP3SIxPvZsgaDSBNmxIh0KPLS+EZkJ1Xy0gY8WVOZDbYF9v0GJta6+GUy7ek8lisYumJ1nyw90NF5n7L6H1aFMYqA/WI2COJA7pWaf9Ugf5pniETIJNyNXtonwZOLeCG380p2a2m5Fs4WDJIbVCtkJ77ah+h3HMvJJ0fzW8OXfnZDuzbWB935lP5zr2+vOc7CL44LjNt8p2deJJKd+d8n1mwKwxWxUjkxJRVlpIqwq1a+Sfeu1oNGDaOXyS/LVoiWAi4/RFFK77j8sVBWyTeqc13DCYWKdEbHTgEcIdtBewm3fvU99V8J4gYLJijdis2O/D+3FBz8kG/SwAXwjzKgO1TmXuA3syLPxxfnEUxttkUPpzQJgAzcN6o79tpHr3QWX3TVy4USKZJPX/G7/sFv7TB2RKaM9LvG8518UTl/oNK6/mqMpSOqsv0xRVzNjumgamqz/e3LG3e1lkrW5SquqlrDJIrN90AProjO2hsva2vAv1ZNPbHVfvH6K8KnMmDbXcZImS+YAXafdXLVILS/Q0MSKuRaLPQABT6AsH1SpBlkiSLXyhT/gT5IbfD6Z1Jx0n7l33o2uGW4lgd8BRn8WUeEHBHEn2SCXVQwlREQtvN7iSC2y8qSngF4ytc3vgOucrGccauebyUn9sdKmkhMom+XHRGLg4yr7NW/ZAq8UDCTjimw0unj204NYoihtZTNdXwgmCpqzA6Y4a3S/braI7FEXELgpjVSnB+dqkyFq3Tny2G8lAz1OtN0TZdE3wgbqL8XtsE5Ut1NayTqmPNmEhJVC0f6ZfMop0HP5VawTxA+lq1XoeRAoIGH0ojuV+9O13sh2V2zoxj5jVyNGuZDtqZVlEeSIRI05PVi7nZfKw+EuT5YTkdX/qnx/AmQXABJR8mEbt5A8Oab2RqMdG+P0zvDI0gODnGDSO2w4ZOrD1zi5LnYaIljibbOMhpDWcwsd6Ry5eUmiLQ24OpaErO6a3/sYLybm9xOJLqfn7DNg/5SKBxEfKNyyUYP4KtkSMQI5Xo7dHcIhqH4l3CRK/gB7WtFU6bj0mReNJIitL8grYbUyZpqDuMDT5s5WQsWjOEmRSbMiH7HIkEIPvRu0WxMnRCJKjGFWdlKGqK96T7jlsEHCjsPjk/9VEQ4W5qB2tRAFGJ5YGgbmyYxqxGxduvkNdd3IZKcIbvtEtH4X7aHeyV4Dcn4wkEzUNRRhISM51Av5I1mwi2lj3DP8d6K9iFzNVDCSb+eb9pBu+SEqYrvFC8WKSi8OcZDj50KV871120hgz6n6OZy1KOh8OzKNuCKFt9mVlUfJKzD9gcuL53q+oTHGGIKFz4+4/zLC13N3l3y4Fn9dzM02uGyBGoJXmF3jrwW9OguOsh1FVykE1suM6kC/e005VRngkgcn29tixbfGSx7k8JzTId+5wTXE1HgKXCtGlwA7L6FxS+RUGGP2az1Em91D7THACjjqlVdoDOltQ7Yb4S8n4kG/m/CvtFfQB0e/e/JMgICLGKds6v5THENB7WYOdJ0P5s3GQzdbeXjUAG5Y2WCUBs5LZ6xDZzv1L7jfUHqBbmnHW7U4g+UTYB/tW7B0Ya0JAbpzWFSoVQH6CbY6q9fM8ccelwWdxeWdjZm+TcmBAHpje+emw8T5mUgl7Omvks7D2xk04/HjynzVyBN2dI3dBgxTkB1keL9tMN0WgyjY0ddKI8pigHP9lOa8hb7F2bZIa/FqS6JJPPHnlyPbVl+weIG7j4ocmWH/OkvaT4qtcbnafk2ocwOkjSqUob66ehit1UDMwKXreD2R92MZugTHNe/PWAZesANg9eBbm2p+4kqK52j8MW3AhqaffDN+kK195DUM4FLVYm8BQhOF+OWoM5tTD8LImCNRenutbU6qRxpaMDXCBU37/K3Y7eobcg/IaZaBuw44FteI67Hdgufk5VqCDjlK7jDBUtVq07hpPI9ymWW/m3nNLQlusNGDSBNYXOUBDRWNnHira/1eo9GEwVgpXn2tG1PUUxT15p/fbfGXCvpsj0QlzwErC0ge/Oqlsh7E0QhpqDAcvlBJOiXDD/bv01SkM269rmghWHJPUbmpq4trj7H6cCMXMIwWgOLaTXR0w3tamzJpReC8FXDNwkxSCbmg/ag17JdPyptz7mR3k6KvXor6tFCfEv85TW7CDWLEap1AC12Ym+LK9/CxdKPnXz9Qz4xNXGn3sG1wAfthifQfjDyiCnLo2uhuMzI9yKxH4PUTt52mReMLmnHFrrLpDYcPC+cU7ge55guYhGv/ANB92YzoXrI+Hs6gdXnnfE8GGhfydGwvKBKCtpDecGnu41Mz28j9/LTVtSV9WZEoxANMgPGo4BDbY2p69ixYGQWATdyg9TRDAK7f/Lrlubat60yuVZ9wcwqZ7NBP71mX6NEgdvfK1EgMnkZzsDQl/wWDHdAoOYCo4pKwY5I/V26cKTO4aMYcV/YDdgglOtas2KtIXBJAcgotsV4YfF+CDN4T5WdX808VdXh3/UXLrAdcMDF3QIXj1HyUHIOkXBH7DXICbJt9eNiowRXiuB0d1J/FqjPFe2IlNdXnwFwpRusB5PLSv0Lk/AdI1gQmao8wwLmnoh/L9riMbMMsWAOI+5B71d+lGTKlxx4hQn4ixRfedyZUUsRcpGrgAS1XqCKzggl0/LFuyQpe9BsgvZGkEHQ4ELkl6bcLtiHZ+7uFxmRjnV7v8PP1Whug1igIT3OTMnmb/dGJPuGKY5fRdvWoatxfNU3ABi+fY7eHiPqC0gQDpAC19twVfWBtBur+ST+y7fzmSE5Q0C3mcp8/31XIdqm7sEZJHtFnXBgaTyG+fWRGAY70K10IBvKH2TE6IMzm1k92/Cn2payTupKTtojgP3uaWIgFVgV0lD0WGR0PanqiKtrBFwqznvb/rz2PgpSjWd2BESLQpxY+6tmKXZnjvY9xfR12CQ8o/aKz1t+XxCSzy0uE5f/kaFUCrwxjL8gT7SEUJshp//5/yvPFJHgJlgsvXp+gRQCSzz+vS6rl3BhMsbj/HzwJYz8GsWppOQDGVswlOHEaFE/qhImhDrt2DUfNxtt21GW7KwJRn9/mtYIjlnnwgESPEpwoLyTru3SsVGzRxnZG6x+BiseUs57lTdb3H8KG7UPeH1SSjy9wZHELnar9x5cOtOR7lOvyjWm4Ab18Q+qoMxxLCFit0V8SmOu7AU8XGY3eSXb6Ly+kaQmDkRlOstgmcj+rD34KNz7LTvLL0O1Z9J/nCjp+1flOFgtbd7Yg0t5eNrPuppxYxJfSpnJRNL4S3YTffnV+x+zVsuioseET/On2wNi/TnL2rAQIKswi7Er3Sv48D/+PLsa2WJOSk6DqcCLmusILDiz0FwKEhMewrxtNyM2IAE0/6hiopIQoUgC6U8CLirhWbfVibSnCGZlF5uywIcaUlcEaYP/evokbi1NSquO62XNnWR4+fB3M1N7LaI5pwdHYOKEjg9OaSiTtEDypKGOVxZhdQS0jEvZ46foNS4SBpwZfPn60p6pQldNUmimhWeU5LUnEpZYjPJU6hmAsh4AKaLFfJANrZ9ou428yoEIFuiY9UgOYkqtSUocWxyijxK+NTtuDdbh7NJcyLIl6CUBWQjZiL34Bk0Qe3vmT9tpIKus3r5CvEdEu5Va2Wxm8CQJT9bESzuFBeH0QIRybKFAUVqNa9tCXukd1jwLXYKWsuMuFda8R1UjVG2cvAZ+R3lBV+nLksL4Ti6lubX3hKFcSyFsG5rK9pJt5nlSGIkBLP/HFqLL/KX0S96NdOo4CS+GYPBk+lBZxz6Yie12vvUj8l4t1ik/5PmvbLOTPCcaoPeZ7APUQIKIcxcNUDin3R1okbeAUGwt7Ja3G0ntQokBhlajisyXeqbfPLrTTKpTauclKp+DGdyBsbzFHEYtIqZnlLe5wjluF/UID6EgwWPGj0FVKM59Jom3+0Y1QTb+IKqHZv/0FIEEuVItlJHSixdza2w0UN80Hyc/eUGv6SBybC/EEs9cOcLBR1eeQXXe7p7hfIhtxxBrGhk9n7jom/4LXF125WzPmMCUiNyE8iO7sVSmRf/iSNFBveZWGPeCirfJ8a43fk5jCfA3NPEJyMAamu3Q5im0DKo8aonWXtye9iE8vraixlVTAGSXFMjP3+XiOE9jrnXTDzARnt7+9gvHctQpaAI0za6N7bq9R1lb55jILwmx4Ih4OA0K1/Xx7B9jytPFBRhEO8xqXLhxotsIRjnGRvnkMK/KJ1YhE9T2mNmclLYgMSn+7dzik8BzoHt+EcXstV8yNpTspqsnS96ATq3A66NbF449w9JqViBt4gWi7yVzt3kR4XSJ8iEB5anMqG+EsSyrMQVv0sMeEysGx+yYs6G2xPJw3zqTq4RzDQXPhYra/VMlt7E8zzl4D7L3HS3kkWf4ZkmFmnjcENPQdkmohl6p/gqkOg+8McyzNxxb5Fl19DsSr3MTuSMqhSKDn95ibzYCEdrZXJiKaqu7BFBuju+jSObOPchog2IsE/u/3U/UK2mntvSnD0qNkPYoRTskBnLJ3NJamL0V4sEbryX8NMr7MKMJ0+h2+xMKY4KERpvUrd0c6ABXWHqLdY1QTugC/5dhdoLy3+KwgG5FnL0MZw6qvOvHkKQRoQrcKLuwUld15s05QxurH67A9eAr02a/vUWNBIgP6vOa69ZZuZKElWttIerRDGIAkZ54fw7HBctSZtfspPxaliwbOEH/Laxot3ZQonzvXknSVodzZHA1Jw7BcNRsYvl+KJ0Y6pMRPpIbaN/QSuHtnjUoej+vlVhq5021xMUPKxCK/D8rSRbOmduHG85/JrIimgo5wXWP83lLvRaxwCxeTGVt44fTUqsfUARmQcS3f5DbHR9SZ4nJYIEvcCjIqLezJ3I6S7xBop57j3ZyMQX0Xxr5mc6IUmrlOXM9fJG5iDZQQ9rWsGZ0Y26GzTAEsD6pjPuDa1XAT1MRpxyZ8zN53sl1YEV0E0EHvZqcnBnqMTXRh6zC9PwDXEk3OHs2zLLIjBhY5+7lDxp1X0qcm8XtWorat33mUx+kEDDgaDUdpclQq/ZM6mMYoF433nKbCKDxCozugSPVaRjNPosMDy8FujvIJSb763XuBGBIYLS9x+HZhYiUa9xod0xKV9aRt7yczWWlLgfK8qn4fULHMBSP48m/wTWfDBdTH8uDAKt5WM033+2bCpxDhmZtE+d7XP65yBTOf9/EWaCG+Gs9/5kVbWS0JlfoDH6Si2tVCzCRGfV0XZAUWfXOMJ5F9dkMagbwaeqVqqbVONDQGg8zID5MUV7IkazdAz4JLOXsn1RuZnoZNIGV2Na15+dRKYUAmXFmkWBJpPMBwT8N4bd8VZwBnhm3WzH9S0sbpoP0sgf2OmPvQ6smMyfkVK+OLjXYubmtioAhdwDb5/pLRg3PGwfHEz6v9OOe4AK8iw2cma49tV44In8Rc9jGcqSQlFXPdlC8366ke4U/ITFy0/SQBl1vWvGk40KycwWGaLf8cCtEi/4X2W8961i6lYnpfNQhGcQyC8s2oIOW+Pw545Thq3ZBEyNC8YDr/pzCEmBI8U3A4IiQJoHiD9kUMNd8wfzysC2Kqc4OGeWYsJxmDev4Jn4HV+vqpgN6xxSEMABhRMdTteHiJAgnQEX9BR2V1sNqh5EcMvQNYYa5+bblQn7Rli1UFCtQkP6ECmGkxmPNkg2CGS2mmf0/WEuTZSyPMtbbrnftPgleOmJ3jSm0m1EU9fQHQo1NZti+KczpJ8mSYIVtXzXh4rNJcL3Fm7Bbftpjmj5UnuDpPk8HvqKOj2DGJyk4R0Md1x7umiH0DTOXaLwO0EI94k7n6R8nfqiwekgUQZ1rRek0HViM5YN0JLWp4f4NRE8ErcGNSHZd58+9Kx8lmkc9ogfQmX0rX1kB8QQzNbH+eVDee0jOQNUgQcew3y+0QbifXrtLHXDIxsqsej41Kz7vfcQRE1zUnY2phYNILK8a657zyHNMzPiRhxs28s1JX2kiCMEloubOXnc8BzU+n7LM9wztf63eFWN/eWHXVivSdCWg5DfWsk2CF8aFJrOP277QEPdkWlOlewCVEkLjyd5wUn9ZzaKOJKnDQDLfliiRLTKlU8TOeQj8jOU8FfpM9tayJTDpxw6sVlZuJRAILfxn+QAGIB/W1FGDjuuVu62hFDBdvzVSfge95Ebf9pclp0GrpV3S+gwBWn5J7aGiim/fRyIN7YVVXJsnAnVeq90vDdAV0XearTqjT2Ck/AMkBW6T/ls/6VUVnFWs01wxkahKR0tRwyLRKgHefm3RWie/pTVQpUMZw+/7ozQSW+7vuZd8lsvT1iX5rwlpiaFnOnDbHsr1As6vLETd5HVbcBCGbJHcS7ax9Byd50jdYyagUtjAaHYX8ryyuR/bDkw1o4j8+hXMfbzy+CVmgrfRDyl4dn+5LxrqRAXLoDKpQREAHqdLSsVSJh1s8KnZ/SsUVq27cq+O6LMSBmhT4X3E750rmWwCsoCre6bT//oFWYALjp2SbcxnULBaTvnYDHtfEbO1m/3c9nJk8ZO5KHQTV88ivTWN/S2EXwmisTPdcupMrvI8e48QZdkZu9WHyKron7MKhGFJw6Z0KZ3tleVrvvJo89siUwByPY+Hs4gkKPBQbLQOaedcv/xeM+Ih8rl1eHEC/C65xWVciToVqSGp9HfbhVzFSrO6kBnv7mJwnRLvMEwqiNankVdJJMw4icU3lKyw/ecNSWIUddqlbThYMiq8nHjRRufs+28cq0OI9zhpvxFvFgSZE/eAYvm0x+9lZO+EH9NkBngaqU1NMYhdombNuy3awUN9p0mJQ//e9L65YbShgoc+ZUlNy+c6F6gDEHXV0JrzevPIZFAe2RyRa2dNqzLvihAAMCszYueqszzXRkSyobx5+LTLK2V3lfg3wbS9DzP3QW7VHdHbjZcttQRvtjrGveJnNn2DE2ZDIbvkCrT0H8RzbGDdmIq4P1ey+hoY/W6NuZKOz4dv4HUNznxdKV1Wf3MvqUv35r2jTKvpPWBUWNm5fytX/QJwp6qkIOsSx7Y67BSCbCDVLM8/VcMG+T0j+INrgL9sfT1ICtACH8BI0G6ViUZPVzzCmQHW2oVIwZjAoFl6+meO/pD8teO1E+1y03mCpYfW9S8qhtH2GhlFlebPf4NbezVv9xbXKWz0xezRNQWqUqtYRTUbuzK7KTvjG4rQHfzBpVmK4wDLnSIwdSzTSk1fPNeY0WOpPZTLlvQ59xwgfFrb326vT2hS1JAZ9E6sujFtKTiJ7bxI6o4cBhDaX+adXREThhR+MwA4TqD7rga/o9iY7d6TVRe14CS2S3iSQsD0R6ApnhG/2Wa0A0AY2NtWTjmabdKU+KgIRDP9RQYVjXiF1qC+xyNVG03I9vpmEpY/G/zC4nLOKgXAZ/uTikHI9Afbkhfgfgo9arWbix5eH7WUo9RQygDzwCnVSjbXc7MihEufVj6WGbK963pw8VjY3RS8IH1cy2yZbIcKLO5CgAUcXJfF2+McnDLKtXxyZaf7SPA6KJq+zF2NHyfoeTOwHhGqNcnHVr1hT73pcoyXyfvCYBnG1Bp/aR9t8hoI7CXM3UZOisWGA1SHZ2jf7k9GlRnp3mF/c1AV+JjvUsnZrsybEOQJg/dn/9eJkyykQHjbF56zgcPX6DdMG03WKUMlYz+uOZ+5DZy9E9MZOZ9GMoLFdrIPPQQLjv+GlCMpoyHPXkzIODjHAID2PrnaRpqWVHh0rnieDILKq+Emrd5RnjgE9pDUXWTmHaKuqqYlcgEz4zbi46dbWrAAFBjsQq1rLHIiPJEcwFLCOY4JNlXRXQJqCUKXk2d1RSBGzDP6HDSpo863BhVRFFF6uIpjQV7j5ebFe3UkkO/+coIo2BTAcgBqOtQ134s9a4QJvofuqBYMGOBMsWZ+sn/2AOxDx6SfAnDFGw==";Uint8Array.from(atob(Yu),l=>l.charCodeAt(0));const L0=Uint8Array.from(atob(Yu),l=>l.charCodeAt(0));function Gu(l,e,t){if(e.getQueryParameter(l,e.QUERY_RESULT_AVAILABLE)){const i=e.getQueryParameter(l,e.QUERY_RESULT)/1e6;t.lastTime=i}else setTimeout(()=>{Gu(l,e,t)},1)}class N0 extends fn{constructor(e,t,i=512,s=512){super(),this.width=i,this.height=s,this.clear=!0,this.camera=t,this.scene=e,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new Ht(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0},{set:(n,r,o)=>{const a=n[r];return n[r]=o,r==="aoSamples"&&a!==o&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),r==="denoiseSamples"&&a!==o&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),r==="halfRes"&&a!==o&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),r==="depthAwareUpsampling"&&a!==o&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),!0}}),this.samples=[],this.samplesR=[],this.samplesDenoise=[],this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.beautyRenderTarget=new zi(this.width,this.height,{minFilter:An,magFilter:Ui}),this.beautyRenderTarget.depthTexture=new af(this.width,this.height,lf),this.beautyRenderTarget.depthTexture.format=cf,this.writeTargetInternal=new zi(this.width,this.height,{minFilter:An,magFilter:An,depthBuffer:!1}),this.readTargetInternal=new zi(this.width,this.height,{minFilter:An,magFilter:An,depthBuffer:!1}),this.bluenoise=new hf(L0,128,128),this.bluenoise.colorSpace=uf,this.bluenoise.wrapS=pc,this.bluenoise.wrapT=pc,this.bluenoise.minFilter=Ui,this.bluenoise.magFilter=Ui,this.bluenoise.needsUpdate=!0,this.lastTime=0,this._r=new ft,this._c=new Ht}configureHalfResTargets(){this.configuration.halfRes?(this.depthDownsampleTarget=new df(this.width/2,this.height/2,2),this.depthDownsampleTarget.texture[0].format=ff,this.depthDownsampleTarget.texture[0].type=pf,this.depthDownsampleTarget.texture[0].minFilter=Ui,this.depthDownsampleTarget.texture[0].magFilter=Ui,this.depthDownsampleTarget.texture[0].depthBuffer=!1,this.depthDownsampleTarget.texture[1].format=Fh,this.depthDownsampleTarget.texture[1].type=_l,this.depthDownsampleTarget.texture[1].minFilter=Ui,this.depthDownsampleTarget.texture[1].magFilter=Ui,this.depthDownsampleTarget.texture[1].depthBuffer=!1,this.depthDownsampleQuad=new so(new Nt(M0))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.samples=this.generateHemisphereSamples(this.configuration.aoSamples),this.samplesR=this.generateHemisphereSamplesR(this.configuration.aoSamples);const t={...O0};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Nt(t)):this.effectShaderQuad=new so(new Nt(t))}configureDenoisePass(e=!1){this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);const t={...D0};t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Nt(t)):this.poissonBlurQuad=new so(new Nt(t))}configureEffectCompositer(e=!1){const t={...P0};e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Nt(t)):this.effectCompositerQuad=new so(new Nt(t))}generateHemisphereSamples(e){const t=[];for(let i=0;i<e;i++){const s=2.399963*i,n=Math.sqrt(i+.5)/Math.sqrt(e),r=n*Math.cos(s),o=n*Math.sin(s),a=Math.sqrt(1-(r*r+o*o));t.push(new z(r,o,a))}return t}generateHemisphereSamplesR(e){let t=[];for(let i=0;i<e;i++)t.push((i+1)/e);return t}generateDenoiseSamples(e,t){const i=2*Math.PI*t/e,s=1/e,n=s,r=[];let o=s,a=0;for(let c=0;c<e;c++)r.push(new ft(Math.cos(a),Math.sin(a)).multiplyScalar(Math.pow(o,.75))),o+=n,a+=i;return r}setSize(e,t){this.width=e,this.height=t;const i=this.configuration.halfRes?.5:1;this.beautyRenderTarget.setSize(e,t),this.writeTargetInternal.setSize(e*i,t*i),this.readTargetInternal.setSize(e*i,t*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*i,t*i)}render(e,t,i,s,n){e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer));let r,o,a;this.debugMode&&(r=e.getContext(),o=r.getExtension("EXT_disjoint_timer_query_webgl2"),o===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),e.setRenderTarget(this.beautyRenderTarget),e.render(this.scene,this.camera),this.debugMode&&(a=r.createQuery(),r.beginQuery(o.TIME_ELAPSED_EXT,a));const c=e.xr.enabled;e.xr.enabled=!1,this.camera.updateMatrixWorld(),this._r.set(this.width,this.height);let u=this.configuration.aoRadius;this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(u*=.5),this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.position,this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.samplesR.value=this.samplesR,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=u,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let d=0;d<this.configuration.denoiseIterations;d++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.position,this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=u,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=d,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=u,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),e.setRenderTarget(this.renderToScreen?null:t),this.effectCompositerQuad.render(e),this.debugMode&&(r.endQuery(o.TIME_ELAPSED_EXT),Gu(a,r,this)),e.xr.enabled=c}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}}const U0={name:"GammaCorrectionShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = sRGBTransferOETF( tex );

		}`};function B0(){return new Nt({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
    
       vec4 absPosition = vec4(position, 1.0);
       vec3 trueNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          trueNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       trueNormal = (normalize(modelMatrix * vec4(trueNormal, 0.))).xyz;
       
       vec3 planePosition = absPosition.xyz / 40.;
       float d = abs(dot(trueNormal, planePosition));
       vColor = vec4(abs(trueNormal), d);
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      gl_FragColor = vColor;
    }
    `})}function k0(){return new Nt({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
       
       vec4 absPosition = vec4(position, 1.0);
       vNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          vNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       vNormal = (normalize(modelMatrix * vec4(vNormal, 0.))).xyz;
       
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       vCameraPosition = cameraPosition;
       vPosition = absPosition.xyz;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      vec3 cameraPixelVec = normalize(vCameraPosition - vPosition);
      float difference = abs(dot(vNormal, cameraPixelVec));
      
      // This achieves a double gloss effect: when the surface is perpendicular and when it's parallel
      difference = abs((difference * 2.) - 1.);
      
      gl_FragColor = vec4(difference, difference, difference, 1.);
    }
    `})}class z0 extends fn{constructor(e,t,i,s,n){if(super(),S(this,"components"),S(this,"resolution"),S(this,"renderScene"),S(this,"renderCamera"),S(this,"fsQuad"),S(this,"normalOverrideMaterial"),S(this,"glossOverrideMaterial"),S(this,"planeBuffer"),S(this,"glossBuffer"),S(this,"outlineBuffer"),S(this,"excludedMeshes",[]),S(this,"outlinedMeshes",{}),S(this,"outlineScene",new Rs),S(this,"_outlineEnabled",!1),S(this,"_lineColor",10066329),S(this,"_opacity",.4),S(this,"_tolerance",3),S(this,"_glossEnabled",!0),S(this,"_glossExponent",1.9),S(this,"_minGloss",-.1),S(this,"_maxGloss",.1),!i.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.renderScene=s,this.renderCamera=n,this.resolution=new ft(e.x,e.y),this.fsQuad=new zu,this.fsQuad.material=this.createOutlinePostProcessMaterial(),this.planeBuffer=this.newRenderTarget(),this.glossBuffer=this.newRenderTarget(),this.outlineBuffer=this.newRenderTarget();const r=B0();r.clippingPlanes=i.renderer.clippingPlanes,this.normalOverrideMaterial=r;const o=k0();o.clippingPlanes=i.renderer.clippingPlanes,this.glossOverrideMaterial=o}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this.fsQuad.material.uniforms.lineColor.value.set(e)}get tolerance(){return this._tolerance}set tolerance(e){this._tolerance=e;const t=this.fsQuad.material;t.uniforms.tolerance.value=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;const t=this.fsQuad.material;t.uniforms.opacity.value=e}get glossEnabled(){return this._glossEnabled}set glossEnabled(e){if(e===this._glossEnabled)return;this._glossEnabled=e;const t=this.fsQuad.material;t.uniforms.glossEnabled.value=e?1:0}get glossExponent(){return this._glossExponent}set glossExponent(e){this._glossExponent=e;const t=this.fsQuad.material;t.uniforms.glossExponent.value=e}get minGloss(){return this._minGloss}set minGloss(e){this._minGloss=e;const t=this.fsQuad.material;t.uniforms.minGloss.value=e}get maxGloss(){return new ei().color.convertLinearToSRGB(),this._maxGloss}set maxGloss(e){this._maxGloss=e;const t=this.fsQuad.material;t.uniforms.maxGloss.value=e}get outlineEnabled(){return this._outlineEnabled}set outlineEnabled(e){if(e===this._outlineEnabled)return;this._outlineEnabled=e;const t=this.fsQuad.material;t.uniforms.outlineEnabled.value=e?1:0}async dispose(){this.planeBuffer.dispose(),this.glossBuffer.dispose(),this.outlineBuffer.dispose(),this.normalOverrideMaterial.dispose(),this.glossOverrideMaterial.dispose(),this.fsQuad.material.dispose(),this.fsQuad.dispose(),this.excludedMeshes=[],this.outlineScene.children=[];const e=this.components.get(Ri);for(const t in this.outlinedMeshes){const i=this.outlinedMeshes[t];for(const s of i.meshes){e.destroy(s,!0,!0);const n=s;n.fragment&&n.fragment.dispose(!0)}i.material.dispose()}}setSize(e,t){this.planeBuffer.setSize(e,t),this.glossBuffer.setSize(e,t),this.outlineBuffer.setSize(e,t),this.resolution.set(e,t);const i=this.fsQuad.material;i.uniforms.screenSize.value.set(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y),i.uniformsNeedUpdate=!0}render(e,t,i){const s=t.depthBuffer;t.depthBuffer=!1;const n=this.renderScene.overrideMaterial,r=this.renderScene.background;this.renderScene.background=null;for(const a of this.excludedMeshes)a.visible=!1;e.setRenderTarget(this.planeBuffer),this.renderScene.overrideMaterial=this.normalOverrideMaterial,e.render(this.renderScene,this.renderCamera),this._glossEnabled&&(e.setRenderTarget(this.glossBuffer),this.renderScene.overrideMaterial=this.glossOverrideMaterial,e.render(this.renderScene,this.renderCamera)),this.renderScene.overrideMaterial=n,e.setRenderTarget(this.outlineBuffer),this._outlineEnabled?e.render(this.outlineScene,this.renderCamera):e.clear();for(const a of this.excludedMeshes)a.visible=!0;this.renderScene.background=r;const o=this.fsQuad.material;o.uniforms.planeBuffer.value=this.planeBuffer.texture,o.uniforms.glossBuffer.value=this.glossBuffer.texture,o.uniforms.outlineBuffer.value=this.outlineBuffer.texture,o.uniforms.sceneColorBuffer.value=i.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.fsQuad.render(e)),t.depthBuffer=s}get vertexShader(){return`
	  varying vec2 vUv;
	  void main() {
	  	vUv = uv;
	  	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	  }
	`}get fragmentShader(){return`
	  uniform sampler2D sceneColorBuffer;
	  uniform sampler2D planeBuffer;
	  uniform sampler2D glossBuffer;
	  uniform sampler2D outlineBuffer;
	  uniform vec4 screenSize;
	  uniform vec3 lineColor;
	  
	  uniform float outlineEnabled;
	  
      uniform int width;
	  uniform float opacity;
      uniform float tolerance;
      uniform float glossExponent;
      uniform float minGloss;
      uniform float maxGloss;
      uniform float glossEnabled;

	  varying vec2 vUv;

	  vec4 getValue(sampler2D buffer, int x, int y) {
	  	return texture2D(buffer, vUv + screenSize.zw * vec2(x, y));
	  }

      float normalDiff(vec3 normal1, vec3 normal2) {
        return ((dot(normal1, normal2) - 1.) * -1.) / 2.;
      }

      // Returns 0 if it's background, 1 if it's not
      float getIsBackground(vec3 normal) {
        float background = 1.0;
        background *= step(normal.x, 0.);
        background *= step(normal.y, 0.);
        background *= step(normal.z, 0.);
        background = (background - 1.) * -1.;
        return background;
      }

	  void main() {
	  
	    vec4 sceneColor = getValue(sceneColorBuffer, 0, 0);
	    vec3 normSceneColor = normalize(sceneColor.rgb);
  
        vec4 plane = getValue(planeBuffer, 0, 0);
	    vec3 normal = plane.xyz;
        float distance = plane.w;
  
        vec3 normalTop = getValue(planeBuffer, 0, width).rgb;
        vec3 normalBottom = getValue(planeBuffer, 0, -width).rgb;
        vec3 normalRight = getValue(planeBuffer, width, 0).rgb;
        vec3 normalLeft = getValue(planeBuffer, -width, 0).rgb;
        vec3 normalTopRight = getValue(planeBuffer, width, width).rgb;
        vec3 normalTopLeft = getValue(planeBuffer, -width, width).rgb;
        vec3 normalBottomRight = getValue(planeBuffer, width, -width).rgb;
        vec3 normalBottomLeft = getValue(planeBuffer, -width, -width).rgb;
  
        float distanceTop = getValue(planeBuffer, 0, width).a;
        float distanceBottom = getValue(planeBuffer, 0, -width).a;
        float distanceRight = getValue(planeBuffer, width, 0).a;
        float distanceLeft = getValue(planeBuffer, -width, 0).a;
        float distanceTopRight = getValue(planeBuffer, width, width).a;
        float distanceTopLeft = getValue(planeBuffer, -width, width).a;
        float distanceBottomRight = getValue(planeBuffer, width, -width).a;
        float distanceBottomLeft = getValue(planeBuffer, -width, -width).a;
        
        vec3 sceneColorTop = normalize(getValue(sceneColorBuffer, 1, 0).rgb);
        vec3 sceneColorBottom = normalize(getValue(sceneColorBuffer, -1, 0).rgb);
        vec3 sceneColorLeft = normalize(getValue(sceneColorBuffer, 0, -1).rgb);
        vec3 sceneColorRight = normalize(getValue(sceneColorBuffer, 0, 1).rgb);
        vec3 sceneColorTopRight = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomRight = normalize(getValue(sceneColorBuffer, -1, 1).rgb);
        vec3 sceneColorTopLeft = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomLeft = normalize(getValue(sceneColorBuffer, -1, 1).rgb);

        // Checks if the planes of this texel and the neighbour texels are different

        float planeDiff = 0.0;

        planeDiff += step(0.001, normalDiff(normal, normalTop));
        planeDiff += step(0.001, normalDiff(normal, normalBottom));
        planeDiff += step(0.001, normalDiff(normal, normalLeft));
        planeDiff += step(0.001, normalDiff(normal, normalRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopLeft));
        planeDiff += step(0.001, normalDiff(normal, normalBottomRight));
        planeDiff += step(0.001, normalDiff(normal, normalBottomLeft));
        
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTop));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottom));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorRight));
       	planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomLeft));

        planeDiff += step(0.001, abs(distance - distanceTop));
        planeDiff += step(0.001, abs(distance - distanceBottom));
        planeDiff += step(0.001, abs(distance - distanceLeft));
        planeDiff += step(0.001, abs(distance - distanceRight));
        planeDiff += step(0.001, abs(distance - distanceTopRight));
        planeDiff += step(0.001, abs(distance - distanceTopLeft));
        planeDiff += step(0.001, abs(distance - distanceBottomRight));
        planeDiff += step(0.001, abs(distance - distanceBottomLeft));

        // Add extra background outline

        int width2 = width + 1;
        vec3 normalTop2 = getValue(planeBuffer, 0, width2).rgb;
        vec3 normalBottom2 = getValue(planeBuffer, 0, -width2).rgb;
        vec3 normalRight2 = getValue(planeBuffer, width2, 0).rgb;
        vec3 normalLeft2 = getValue(planeBuffer, -width2, 0).rgb;
        vec3 normalTopRight2 = getValue(planeBuffer, width2, width2).rgb;
        vec3 normalTopLeft2 = getValue(planeBuffer, -width2, width2).rgb;
        vec3 normalBottomRight2 = getValue(planeBuffer, width2, -width2).rgb;
        vec3 normalBottomLeft2 = getValue(planeBuffer, -width2, -width2).rgb;

        planeDiff += -(getIsBackground(normalTop2) - 1.);
        planeDiff += -(getIsBackground(normalBottom2) - 1.);
        planeDiff += -(getIsBackground(normalRight2) - 1.);
        planeDiff += -(getIsBackground(normalLeft2) - 1.);
        planeDiff += -(getIsBackground(normalTopRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomLeft2) - 1.);

        // Tolerance sets the minimum amount of differences to consider
        // this texel an edge

        float line = step(tolerance, planeDiff);

        // Exclude background and apply opacity

        float background = getIsBackground(normal);
        line *= background;
        line *= opacity;
        
        // Add gloss
        
        vec3 gloss = getValue(glossBuffer, 0, 0).xyz;
        float diffGloss = abs(maxGloss - minGloss);
        vec3 glossExpVector = vec3(glossExponent,glossExponent,glossExponent);
        gloss = min(pow(gloss, glossExpVector), vec3(1.,1.,1.));
        gloss *= diffGloss;
        gloss += minGloss;
        vec4 glossedColor = sceneColor + vec4(gloss, 1.) * glossEnabled;
        
        vec4 corrected = mix(sceneColor, glossedColor, background);
        
        // Draw lines
        
        corrected = mix(corrected, vec4(lineColor, 1.), line);
        
        // Add outline
        
        vec4 outlinePreview =getValue(outlineBuffer, 0, 0);
        float outlineColorCorrection = 1. / max(0.2, outlinePreview.a);
        vec3 outlineColor = outlinePreview.rgb * outlineColorCorrection;
        
        // thickness between 10 and 2, opacity between 1 and 0.2
	    int outlineThickness = int(outlinePreview.a * 10.);
	    
	    float outlineDiff = 0.;
        
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, -outlineThickness).a);
        
        float outLine = step(4., outlineDiff) * step(outlineDiff, 12.) * outlineEnabled;
        corrected = mix(corrected, vec4(outlineColor, 1.), outLine);
        
        gl_FragColor = corrected;
	}
			`}createOutlinePostProcessMaterial(){return new Nt({uniforms:{opacity:{value:this._opacity},debugVisualize:{value:0},sceneColorBuffer:{value:null},tolerance:{value:this._tolerance},planeBuffer:{value:null},glossBuffer:{value:null},outlineBuffer:{value:null},glossEnabled:{value:1},minGloss:{value:this._minGloss},maxGloss:{value:this._maxGloss},outlineEnabled:{value:0},glossExponent:{value:this._glossExponent},width:{value:1},lineColor:{value:new Ht(this._lineColor)},screenSize:{value:new un(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}newRenderTarget(){const e=new zi(this.resolution.x,this.resolution.y);return e.texture.colorSpace="srgb-linear",e.texture.format=Fh,e.texture.type=_l,e.texture.minFilter=Ui,e.texture.magFilter=Ui,e.texture.generateMipmaps=!1,e.stencilBuffer=!1,e}}class V0{constructor(e,t,i){if(S(this,"composer"),S(this,"overrideClippingPlanes",!1),S(this,"_components"),S(this,"_world"),S(this,"_renderTarget"),S(this,"_enabled",!1),S(this,"_initialized",!1),S(this,"_n8ao"),S(this,"_customEffects"),S(this,"_basePass"),S(this,"_gammaPass"),S(this,"_depthTexture"),S(this,"_renderer"),S(this,"_settings",{gamma:!0,custom:!0,ao:!1}),!i.renderer)throw new Error("The given world must have a renderer!");this._components=e,this._renderer=t,this._world=i,this._renderTarget=new zi(window.innerWidth,window.innerHeight),this._renderTarget.texture.colorSpace="srgb-linear",this.composer=new R0(t,this._renderTarget),this.composer.setSize(window.innerWidth,window.innerHeight)}get basePass(){if(!this._basePass)throw new Error("Custom effects not initialized!");return this._basePass}get gammaPass(){if(!this._gammaPass)throw new Error("Custom effects not initialized!");return this._gammaPass}get customEffects(){if(!this._customEffects)throw new Error("Custom effects not initialized!");return this._customEffects}get n8ao(){if(!this._n8ao)throw new Error("Custom effects not initialized!");return this._n8ao}get enabled(){return this._enabled}set enabled(e){this._initialized||this.initialize(),this._enabled=e}get settings(){return{...this._settings}}dispose(){var e,t,i,s;this.composer.dispose(),this._renderTarget.dispose(),(e=this._depthTexture)==null||e.dispose(),(t=this._customEffects)==null||t.dispose(),(i=this._gammaPass)==null||i.dispose(),(s=this._n8ao)==null||s.dispose()}setPasses(e){let t=!1;for(const i in e){const s=i;if(this.settings[s]!==e[s]){t=!0;break}}if(t){for(const i in e){const s=i;this._settings[s]!==void 0&&(this._settings[s]=e[s])}this.updatePasses()}}setSize(e,t){if(!(e===0||t===0)&&this._initialized){const i=this._settings.custom;i&&this.setPasses({custom:!1}),this.setPasses({custom:!1}),this.composer.setSize(e,t),this.basePass.setSize(e,t),this.n8ao.setSize(e,t),this.customEffects.setSize(e,t),this.gammaPass.setSize(e,t),i&&this.setPasses({custom:!0})}}update(){this._enabled&&this.composer.render()}updateCamera(){const e=this._world.camera.three;this._n8ao&&(this._n8ao.camera=e),this._customEffects&&(this._customEffects.renderCamera=e),this._basePass&&(this._basePass.camera=e)}updateProjection(e){this.composer.passes.forEach(t=>{t.camera=e}),this.update()}initialize(){if(!this._world.renderer)throw new Error("The given world must have a renderer!");const e=this._world.scene.three,t=this._world.camera.three;if(!(e instanceof Rs))throw new Error("The given scene must have a THREE.Scene as core!");const i=this._world.camera;i.projection&&i.projection.onChanged.add(()=>{this.updateCamera()});const s=this._world.renderer;this.overrideClippingPlanes||(this._renderer.clippingPlanes=s.clippingPlanes),this._renderer.outputColorSpace="srgb",this._renderer.toneMapping=Wd,this.newBasePass(e,t),this.newSaoPass(e,t),this.newGammaPass(),this.newCustomPass(e,t),this._initialized=!0,this.updatePasses()}updatePasses(){for(const e of this.composer.passes)this.composer.removePass(e);this._basePass&&this.composer.addPass(this.basePass),this._settings.gamma&&this.composer.addPass(this.gammaPass),this._settings.ao&&this.composer.addPass(this.n8ao),this._settings.custom&&this.composer.addPass(this.customEffects)}newCustomPass(e,t){this._customEffects=new z0(new ft(window.innerWidth,window.innerHeight),this._components,this._world,e,t)}newGammaPass(){this._gammaPass=new Vu(U0)}newSaoPass(e,t){if(!this._world.renderer)throw new Error("The given world must have a renderer!");const{width:i,height:s}=this._world.renderer.getSize();this._n8ao=new N0(e,t,i,s);const{configuration:n}=this._n8ao;n.aoSamples=16,n.denoiseSamples=1,n.denoiseRadius=13,n.aoRadius=1,n.distanceFalloff=4,n.aoRadius=1,n.intensity=4,n.halfRes=!0,n.color=new Ht().setHex(13421772,"srgb-linear")}newBasePass(e,t){this._basePass=new F0(e,t)}}class sl extends r0{constructor(e,t,i){super(e,t,i),S(this,"_postproduction"),this.onResize.add(s=>this.resizePostproduction(s)),this.onWorldChanged.add(()=>{this.currentWorld&&(this._postproduction&&this._postproduction.dispose(),this._postproduction=new V0(e,this.three,this.currentWorld),this.setPostproductionSize())})}get postproduction(){if(!this._postproduction)throw new Error("Renderer not initialized yet with a world!");return this._postproduction}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger();const e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.postproduction.enabled?this.postproduction.composer.render():this.three.render(e,t),e instanceof Rs&&this.three2D.render(e,t),this.onAfterUpdate.trigger()}dispose(){super.dispose(),this.postproduction.dispose()}resizePostproduction(e){this.postproduction&&this.setPostproductionSize(e)}setPostproductionSize(e){if(!this.container)return;const t=e?e.x:this.container.clientWidth,i=e?e.y:this.container.clientHeight;this.postproduction.setSize(t,i)}}class Y0{constructor(e,t,i,s,n){S(this,"mesh",new Ae(new rt)),S(this,"components"),S(this,"world"),S(this,"styleName"),S(this,"_precission",1e4),S(this,"_tempVector",new z),S(this,"_plane"),S(this,"_geometry"),S(this,"_outlinedMesh"),S(this,"_plane2DCoordinateSystem",new Ne),S(this,"_planeAxis"),this.components=e,this.world=t,this.mesh.material=n,this.mesh.frustumCulled=!1,this.mesh.userData.indexFragmentMap=new Map,this._plane=i;const{x:r,y:o,z:a}=i.normal;Math.abs(r)===1?this._planeAxis="x":Math.abs(o)===1?this._planeAxis="y":Math.abs(a)===1&&(this._planeAxis="z"),this._geometry=s,this.mesh.geometry.attributes.position=s.attributes.position;const c=i.normal.clone().multiplyScalar(.01);this._outlinedMesh=new Ae(this.mesh.geometry),this.mesh.position.copy(c),this._outlinedMesh.position.copy(c),this.visible=!0}get visible(){return this.mesh.parent!==null}set visible(e){const t=this.getStyleAndScene();if(e){if(this.world.scene.three.add(this.mesh),t){const{style:i,outlineScene:s}=t;this._outlinedMesh.material=i.material,i.meshes.add(this._outlinedMesh),s.add(this._outlinedMesh)}}else if(this.mesh.removeFromParent(),t){const{style:i}=t;i.meshes.delete(this._outlinedMesh),this._outlinedMesh.removeFromParent()}}set geometry(e){this._geometry=e,this.mesh.geometry.attributes.position=e.attributes.position}dispose(){const e=this.getStyleAndScene();if(e){const{style:t}=e;t.meshes.delete(this._outlinedMesh),this._outlinedMesh.removeFromParent()}this.mesh.material=[],this._outlinedMesh.material=[],this.mesh.userData.indexFragmentMap.clear(),this.mesh.userData={},this.mesh.geometry.dispose(),this.mesh.removeFromParent(),this.mesh.geometry=null,this._outlinedMesh.geometry=null,this.mesh=null,this._plane=null,this._geometry=null,this.components=null}update(e,t){const i=this._geometry.attributes.position.array;if(!i)return;this.updatePlane2DCoordinateSystem();const{userData:s}=this.mesh,n=s.indexFragmentMap;n.clear();let r=0;const o=[];let a=0;const c=this.components.get(Ze);for(const[u,d]of t)for(const f in d){const m=c.list.get(f);m&&(m.mesh.userData.fills||(m.mesh.userData.fills=new Set),m.mesh.userData.fills.add(this.mesh))}for(let u=0;u<e.length;u++){const d=e[u],f=[];for(let w=a;w<d;w+=2)f.push(w*3);const m=this.computeFill(f,i),E=t.get(d);let g=0;for(const w of m)o.push(w),E&&g%3===0&&n.set(r++,E),g++;a=d}this.mesh.geometry.setIndex(o)}computeFill(e,t){const i=new Map,s={},n=new Map;let r=0;const o=new Map,a=new Map,c=new Set,u=this._precission;for(let f=0;f<e.length;f++){const m=e[f];let E=0,g=0,w=0,y=0;const I=t[m],_=t[m+1],C=t[m+2],F=t[m+3],M=t[m+4],D=t[m+5];if(this._tempVector.set(I,_,C),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),E=Math.trunc(this._tempVector.x*u)/u,g=Math.trunc(this._tempVector.y*u)/u,this._tempVector.set(F,M,D),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),w=Math.trunc(this._tempVector.x*u)/u,y=Math.trunc(this._tempVector.y*u)/u,E===w&&g===y)continue;const B=`${E}|${g}`,N=`${w}|${y}`;i.has(B)||i.set(B,m/3),i.has(N)||i.set(N,m/3+1);const G=i.get(B),Q=i.get(N);s[G]=[E,g],s[Q]=[w,y];const O=a.has(G),V=o.has(G),T=a.has(Q),J=o.has(Q);if(!O&&!V&&!T&&!J)a.set(G,r),o.set(Q,r),c.add(r),n.set(r,[G,Q]),r++;else if(O&&J){const de=a.get(G),ie=o.get(Q);if(de!==ie){const ve=n.get(ie),ue=n.get(de);if(!ve||!ue)continue;n.delete(de),c.delete(de),o.set(ue[ue.length-1],ie),o.delete(ve[ve.length-1]);for(const De of ue)ve.push(De)}else c.delete(ie);a.delete(G),o.delete(Q)}else if(V&&T){const de=a.get(Q),ie=o.get(G);if(de!==ie){const ve=n.get(ie),ue=n.get(de);if(!ve||!ue)continue;n.delete(de),c.delete(de),o.set(ue[ue.length-1],ie),o.delete(ve[ve.length-1]);for(const De of ue)ve.push(De)}else c.delete(ie);a.delete(Q),o.delete(G)}else if(O&&T){const de=a.get(Q),ie=a.get(G),ve=n.get(ie),ue=n.get(de);if(!ve||!ue)continue;n.delete(de),c.delete(de),a.delete(ve[0]),a.delete(ue[0]),o.delete(ue[ue.length-1]),a.set(ue[ue.length-1],ie),ue.reverse(),ve.splice(0,0,...ue)}else if(V&&J){const de=o.get(Q),ie=o.get(G),ve=n.get(ie),ue=n.get(de);if(!ve||!ue)continue;n.delete(de),c.delete(de),o.delete(ve[ve.length-1]),o.delete(ue[ue.length-1]),a.delete(ue[0]),o.set(ue[0],ie),ue.reverse(),ve.push(...ue)}else if(O){const de=a.get(G),ie=n.get(de);if(!ie)continue;ie.unshift(Q),a.delete(G),a.set(Q,de)}else if(V){const de=o.get(G),ie=n.get(de);if(!ie)continue;ie.push(Q),o.delete(G),o.set(Q,de)}else if(T){const de=a.get(Q),ie=n.get(de);if(!ie)continue;ie.unshift(G),a.delete(Q),a.set(G,de)}else if(J){const de=o.get(Q),ie=n.get(de);if(!ie)continue;ie.push(G),o.delete(Q),o.set(G,de)}}const d=[];for(const[f,m]of n){if(c.has(f))continue;const E=[],g=new Map;let w=0;for(const I of m){const _=s[I];E.push(_[0],_[1]),g.set(w++,I)}const y=C0(E);for(const I of y){const _=g.get(I);if(_===void 0)throw new Error("Map error!");d.push(_)}}return d}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new Ne;const e=new z(1,0,0),t=new z(0,1,0),i=this._plane.normal,s=new z;this._plane.coplanarPoint(s),this._planeAxis==="x"?e.crossVectors(t,i):this._planeAxis==="y"?t.crossVectors(i,e):this._planeAxis==="z"||(e.crossVectors(t,i).normalize(),t.crossVectors(i,e)),this._plane2DCoordinateSystem.fromArray([e.x,e.y,e.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,s.x,s.y,s.z,1]),this._plane2DCoordinateSystem.invert()}getStyleAndScene(){if(!this.world.renderer)return null;const e=this.world.renderer instanceof sl;if(this.styleName&&e){const t=this.world.renderer,i=t.postproduction.customEffects.outlinedMeshes[this.styleName],s=t.postproduction.customEffects.outlineScene;return{style:i,outlineScene:s}}return null}}class G0{constructor(e,t,i){S(this,"onDisposed",new le),S(this,"onAfterUpdate",new le),S(this,"onBeforeUpdate",new le),S(this,"enabled",!0),S(this,"fillNeedsUpdate",!1),S(this,"components"),S(this,"world"),S(this,"_edges",{}),S(this,"_visible",!0),S(this,"_inverseMatrix",new Ne),S(this,"_localPlane",new ns),S(this,"_tempLine",new $t),S(this,"_tempVector",new z),S(this,"_plane"),this.components=e,this.world=t,this._plane=i}get visible(){return this._visible}set visible(e){this._visible=e;for(const t in this._edges){const i=this._edges[t];e?this.world.scene.three.add(i.mesh):i.mesh.removeFromParent(),i.fill&&(i.fill.visible=e)}}get fillMeshes(){const e=[];for(const t in this._edges){const i=this._edges[t];i.fill&&e.push(i.fill.mesh)}return e}update(){const e=this.components.get(no).styles.list;this.updateDeletedEdges(e);for(const t in e)this.drawEdges(t);this.fillNeedsUpdate=!1}get(){return this._edges}dispose(){const e=Object.keys(this._edges);for(const t of e)this.disposeEdge(t);this.onDisposed.trigger(),this.onDisposed.reset()}newEdgesMesh(e){const t=this.components.get(no).styles.list[e].lineMaterial,i=new rt,s=new Float32Array(3e5),n=new Kt(s,3,!1);n.setUsage(Zd),i.setAttribute("position",n);const r=new Kd(i,t);return r.frustumCulled=!1,r}newFillMesh(e,t){const i=this.components.get(no).styles.list[e],s=i.fillMaterial;if(s){const n=new Y0(this.components,this.world,this._plane,t,s);return this.newFillOutline(e,n,i),n}}newFillOutline(e,t,i){if(!i.outlineMaterial||!this.world.renderer)return;const s=this.world.renderer;if(s instanceof sl){const n=s.postproduction.customEffects.outlinedMeshes;n[e]||(n[e]={meshes:new Set,material:i.outlineMaterial}),t.styleName=e}}drawEdges(e){const t=this.components.get(no).styles.list[e];this._edges[e]||this.initializeStyle(e);const i=this._edges[e];let s=0;const n=i.mesh.geometry.attributes.position;n.array.fill(0);const r=[];let o=0;const a=new Map;for(const u of t.meshes)if(u.geometry){if(!u.geometry.boundsTree)throw new Error("Bounds tree not found for clipping edges subset.");if(u instanceof pi){if(u.count===0)continue;const d=u;for(let f=0;f<d.count;f++){const m=d instanceof Ah,E=d,g=t.fragments[E.fragment.id];if(m&&g){const I=E.fragment.getItemID(f);if(I===null||!g.has(I))continue}const w=new Ae(u.geometry);w.matrix.copy(u.matrix);const y=new Ne;if(d.getMatrixAt(f,y),w.applyMatrix4(y),w.applyMatrix4(u.matrixWorld),w.updateMatrix(),w.updateMatrixWorld(),this._inverseMatrix.copy(w.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),s=this.shapecast(w,n,s),s!==o){if(m&&g){const I=E.fragment.getItemID(f);I!==null&&a.set(s,{[E.fragment.id]:new Set([I])})}r.push(s),o=s}}}else this._inverseMatrix.copy(u.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),s=this.shapecast(u,n,s),s!==o&&(r.push(s),o=s)}i.mesh.geometry.setDrawRange(0,s),i.mesh.position.copy(this._plane.normal).multiplyScalar(1e-4),n.needsUpdate=!0;const c=i.mesh.geometry.attributes.position;Number.isNaN(c.array[0])||this.fillNeedsUpdate&&i.fill&&(i.fill.geometry=i.mesh.geometry,i.fill.update(r,a),i.fill.visible=this._visible)}initializeStyle(e){const t=this.newEdgesMesh(e),i=t.geometry,s=this.newFillMesh(e,i);this._edges[e]={mesh:t,name:e,fill:s}}shapecast(e,t,i){return e.geometry.boundsTree.shapecast({intersectsBounds:s=>this._localPlane.intersectsBox(s),intersectsTriangle:s=>{let n=0;if(this._tempLine.start.copy(s.a),this._tempLine.end.copy(s.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(i,r.x,r.y,r.z),n++,i++}if(this._tempLine.start.copy(s.b),this._tempLine.end.copy(s.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(i,r.x,r.y,r.z),n++,i++}if(this._tempLine.start.copy(s.c),this._tempLine.end.copy(s.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){const r=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(i,r.x,r.y,r.z),n++,i++}n!==2&&(i-=n)}}),i}updateDeletedEdges(e){const t=Object.keys(this._edges);for(const i of t)e[i]===void 0&&(this.disposeEdge(i),this.disposeOutline(i))}disposeOutline(e){if(!this.world.renderer)return;const t=this.world.renderer;if(t instanceof sl){const i=t.postproduction.customEffects.outlinedMeshes;delete i[e]}}disposeEdge(e){const t=this.components.get(Ri),i=this._edges[e];i.fill&&i.fill.dispose(),t.destroy(i.mesh,!1),delete this._edges[e]}}class Io extends Fo{constructor(e,t,i,s,n,r=5,o=!0){super(e,t,i,s,n,r,o),S(this,"edges"),S(this,"edgesMaxUpdateRate",50),S(this,"_visible",!0),S(this,"_edgesVisible",!0),S(this,"updateFill",()=>{this.edges.fillNeedsUpdate=!0,this.edges.update()}),this.edges=new G0(e,t,this.three),this.toggleControls(!0),this.edges.visible=!0,this.onDraggingEnded.add(()=>{this.updateFill(),this.edges.visible=!0}),this.onDraggingStarted.add(()=>this.edges.visible=!1)}get visible(){return this._visible}set visible(e){super.visible=e,this.toggleControls(e)}set enabled(e){this._enabled=e,this.world.renderer&&this.world.renderer.setPlane(e,this.three)}get enabled(){return super.enabled}dispose(){super.dispose(),this.edges.dispose()}}class H0{constructor(){S(this,"onDisposed",new le),S(this,"enabled",!0),S(this,"list",{}),S(this,"_defaultLineMaterial",new rs({color:0,linewidth:.001})),S(this,"onAfterUpdate",new le),S(this,"onBeforeUpdate",new le)}update(e){this.onBeforeUpdate.trigger(this.list),this.onAfterUpdate.trigger(this.list)}create(e,t,i,s,n,r){if(!i.renderer)throw new Error("The given world doesn't have a renderer!");s||(s=this._defaultLineMaterial);for(const c of t)c.geometry.boundsTree||c.geometry.computeBoundsTree();const o=i.renderer;s.clippingPlanes=o.clippingPlanes;const a={name:e,lineMaterial:s,meshes:t,fillMaterial:n,outlineMaterial:r,fragments:{}};return this.list[e]=a,a}dispose(){const e=Object.keys(this.list);for(const t of e)this.deleteStyle(t);this.list={},this.onDisposed.trigger(),this.onDisposed.reset()}deleteStyle(e,t=!0){var i,s;const n=this.list[e];n&&(n.meshes.clear(),t&&(n.lineMaterial.dispose(),(i=n.fillMaterial)==null||i.dispose(),(s=n.outlineMaterial)==null||s.dispose())),delete this.list[e]}}const Hu=class ju extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"enabled",!0),S(this,"styles"),S(this,"fillsNeedUpdate",!1),S(this,"_visible",!0),this.components.list.set(ju.uuid,this),this.styles=new H0}get visible(){return this._visible}set visible(e){this._visible=e;const t=this.components.get(cn);for(const i of t.list)i instanceof Io&&(i.edges.visible=e)}dispose(){this.styles.dispose(),this.onDisposed.trigger()}async update(e=!1){if(!this.enabled)return;const t=this.components.get(cn);for(const i of t.list)i instanceof Io&&(e||this.fillsNeedUpdate?i.updateFill():i.update());this.fillsNeedUpdate=!1}};S(Hu,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");let no=Hu;const j0={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},W0={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`},Wu=class en extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"enabled",!0),S(this,"cameraHeight",10),S(this,"darkness",1.2),S(this,"opacity",1),S(this,"resolution",512),S(this,"amount",3.5),S(this,"planeColor",16777215),S(this,"shadowOffset",0),S(this,"shadowExtraScaleFactor",1.5),S(this,"list",{}),S(this,"tempMaterial",new ei({visible:!1})),S(this,"depthMaterial",new Rh),this.components.add(en.uuid,this),this.initializeDepthMaterial()}dispose(){for(const e in this.list)this.deleteShadow(e);this.tempMaterial.dispose(),this.depthMaterial.dispose(),this.components=null,this.onDisposed.trigger(en.uuid),this.onDisposed.reset()}create(e,t,i){if(this.list[t])throw new Error(`There is already a shadow with ID ${t}`);const{size:s,center:n,min:r}=this.getSizeCenterMin(e),o=this.createShadow(t,s,i);return this.initializeShadow(o,n,r),this.createPlanes(o,s),this.bakeShadow(e,o),o.root}deleteShadow(e){const t=this.components.get(Ri),i=this.list[e];if(delete this.list[e],!i)throw new Error(`No shadow with ID ${e} was found.`);t.destroy(i.root),t.destroy(i.blurPlane),i.rt.dispose(),i.rtBlur.dispose()}createPlanes(e,t){const i=new bo(t.x,t.z).rotateX(Math.PI/2);this.createBasePlane(e,i),en.createBlurPlane(e,i)}initializeShadow(e,t,i){this.initializeRoot(e,t,i),en.initializeRenderTargets(e),en.initializeCamera(e)}bakeShadow(e,t){const i=t.world.scene.three;if(!(i instanceof Rs))throw new Error("The core of the scene of the world must be a scene!");if(!t.world.renderer)throw new Error("The given world must have a renderer!");const s=t.world.renderer.three,n=e.map(c=>!!c.parent);for(let c=0;c<e.length;c++)n[c]||i.add(e[c]);const r=i.children.filter(c=>!e.includes(c)&&c!==t.root);for(let c=r.length-1;c>=0;c--)i.remove(r[c]);const o=i.background;i.background=null,i.overrideMaterial=this.depthMaterial;const a=[];for(const c of e)a.push(c.visible),c.visible=!0;s.setRenderTarget(t.rt),s.render(i,t.camera),i.overrideMaterial=null,this.blurShadow(t,this.amount),this.blurShadow(t,this.amount*.4),s.setRenderTarget(null),i.background=o;for(let c=0;c<e.length;c++)e[c].visible=a[c];for(let c=r.length-1;c>=0;c--)i.add(r[c]);for(let c=0;c<e.length;c++)n[c]||i.remove(e[c])}static initializeCamera(e){e.camera.rotation.x=Math.PI/2,e.root.add(e.camera)}static initializeRenderTargets(e){e.rt.texture.generateMipmaps=!1,e.rtBlur.texture.generateMipmaps=!1}initializeRoot(e,t,i){const s=e.world.scene.three;e.root.position.set(t.x,i.y-this.shadowOffset,t.z),s.add(e.root)}createBasePlane(e,t){const i=this.createPlaneMaterial(e),s=new Ae(t,i);s.renderOrder=2,e.root.add(s),s.scale.y=-1}static createBlurPlane(e,t){e.blurPlane.geometry=t,e.blurPlane.visible=!1,e.root.add(e.blurPlane)}createPlaneMaterial(e){if(!e.world.renderer)throw new Error("The given world must have a renderer!");const t=e.world.renderer.three;return new ei({map:e.rt.texture,opacity:this.opacity,transparent:!0,depthWrite:!1,clippingPlanes:t.clippingPlanes})}initializeDepthMaterial(){this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1;const e="gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );",t="gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );";this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.onBeforeCompile=i=>{i.uniforms.darkness=this.depthMaterial.userData.darkness,i.fragmentShader=`
						uniform float darkness;
						${i.fragmentShader.replace(e,t)}
					`}}createShadow(e,t,i){return this.list[e]={root:new Eo,world:i,rt:new zi(this.resolution,this.resolution),rtBlur:new zi(this.resolution,this.resolution),blurPlane:new Ae,camera:this.createCamera(t)},this.list[e]}createCamera(e){return new ss(-e.x/2,e.x/2,e.z/2,-e.z/2,0,this.cameraHeight)}getSizeCenterMin(e){const t=e[0].parent,i=new Eo;i.children=e;const s=new ut().setFromObject(i);t==null||t.add(...e);const n=new z;s.getSize(n),n.x*=this.shadowExtraScaleFactor,n.z*=this.shadowExtraScaleFactor;const r=new z;s.getCenter(r);const o=s.min;return{size:n,center:r,min:o}}blurShadow(e,t){if(!e.world.renderer)throw new Error("The given world must have a renderer!");const i=new Nt(j0);i.depthTest=!1;const s=new Nt(W0);s.depthTest=!1,e.blurPlane.visible=!0,e.blurPlane.material=i,e.blurPlane.material.uniforms.tDiffuse.value=e.rt.texture,i.uniforms.h.value=t*1/256;const n=e.world.renderer.three;n.setRenderTarget(e.rtBlur),n.render(e.blurPlane,e.camera),e.blurPlane.material=s,e.blurPlane.material.uniforms.tDiffuse.value=e.rtBlur.texture,s.uniforms.v.value=t*1/256,n.setRenderTarget(e.rt),n.render(e.blurPlane,e.camera),e.blurPlane.visible=!1}};S(Wu,"uuid","f833a09a-a3ab-4c58-b03e-da5298c7a1b6");let n1=Wu;const Z0=["Station","Radius","Length","InitialKP","FinalKP","KP","Slope","Height","InitialKPV","FinalKPV"],Zu=class Ku extends Ke{constructor(e){super(e),S(this,"enabled",!0),S(this,"world",null),S(this,"_markerKey",0),S(this,"_list",new Map),S(this,"type","horizontal"),S(this,"divisionLength",100),e.add(Ku.uuid,this)}addKPStation(e,t,i){const s=this.components.get(Es),n=document.createElement("div"),r=document.createElement("div");n.appendChild(r),r.innerHTML=t,r.style.color=s.color,r.style.borderBottom="1px dotted white",r.style.width="160px",r.style.textAlign="left";const o=new Zt(e,n),a=new z;a.x=i.geometry.attributes.position.getX(i.geometry.attributes.position.count-1),a.y=i.geometry.attributes.position.getY(i.geometry.attributes.position.count-1),a.z=i.geometry.attributes.position.getZ(i.geometry.attributes.position.count-1);const c=new z;c.x=i.geometry.attributes.position.getX(i.geometry.attributes.position.count-2),c.y=i.geometry.attributes.position.getY(i.geometry.attributes.position.count-2),c.z=i.geometry.attributes.position.getZ(i.geometry.attributes.position.count-2);const u=new z;u.x=(a.x+c.x)/2,u.y=(a.y+c.y)/2,u.z=(a.z+c.z)/2,o.three.position.copy(u);const d=new z;d.subVectors(a,c).normalize();const f=new si;f.setFromUnitVectors(new z(0,1,0),d);const m=new yh().setFromQuaternion(f).z,E=er.radToDeg(m);r.style.transform=`rotate(${-E-90}deg) translate(-35%, -50%)`;const g=this._markerKey.toString();s.setupEvents(e,!0),s.getWorldMarkerList(e).set(g,{label:o,key:g,merged:!1,static:!1}),this._markerKey++,this.save(g,"KP")}addVerticalMarker(e,t,i,s,n){const r=this.components.get(Es),o=document.createElement("span");o.innerHTML=t,o.style.color=r.color;const a=new Zt(e,o,n);if(s==="Height"){const u=document.createElement("span");u.innerHTML=t,u.style.color=r.color;const{position:d}=i.geometry.attributes,f=(d.array.length/3-1)*3,m=d.array.slice(f,f+3);a.three.position.set(m[0],m[1]+10,m[2])}else if(s==="InitialKPV"){const{position:u}=i.geometry.attributes,d=u.getX(0),f=u.getY(0),m=u.getZ(0);a.three.position.set(d-20,f,m)}else if(s==="FinalKPV"){const{position:u}=i.geometry.attributes,d=u.getX(i.geometry.attributes.position.count-1),f=u.getY(i.geometry.attributes.position.count-1),m=u.getZ(i.geometry.attributes.position.count-1);a.three.position.set(d+20,f,m)}else if(s==="Slope"){o.style.color="grey";const{position:u}=i.geometry.attributes,d=new z;d.x=u.getX(0),d.y=u.getY(0),d.z=u.getZ(0);const f=new z;f.x=u.getX(u.count-1),f.y=u.getY(u.count-1),f.z=u.getZ(u.count-1);const m=new z;m.addVectors(d,f).multiplyScalar(.5),a.three.position.set(m.x,m.y-10,m.z)}const c=this._markerKey.toString();return r.setupEvents(e,!0),r.getWorldMarkerList(e).set(c,{label:a,key:c,type:s,merged:!1,static:!1}),this._markerKey++,this.save(c,s),a}addCivilMarker(e,t,i,s){const n=this.components.get(Es),r=document.createElement("span");r.innerHTML=t,r.style.color=n.color;const o=new Zt(e,r);if(s==="InitialKP"){const c=i.geometry.attributes.position.getX(0),u=i.geometry.attributes.position.getY(0),d=i.geometry.attributes.position.getZ(0);o.three.position.set(c+2,u+2,d)}else if(s==="FinalKP"){const c=i.geometry.attributes.position.getX(i.geometry.attributes.position.count-1),u=i.geometry.attributes.position.getY(i.geometry.attributes.position.count-1),d=i.geometry.attributes.position.getZ(i.geometry.attributes.position.count-1);o.three.position.set(c+2,u-2,d)}else if(s==="Length"){const c=new z;c.x=i.geometry.attributes.position.getX(0),c.y=i.geometry.attributes.position.getY(0),c.z=i.geometry.attributes.position.getZ(0);const u=new z;u.x=i.geometry.attributes.position.getX(i.geometry.attributes.position.count-1),u.y=i.geometry.attributes.position.getY(i.geometry.attributes.position.count-1),u.z=i.geometry.attributes.position.getZ(i.geometry.attributes.position.count-1);const d=c.distanceTo(u);o.three.element.innerText=d.toFixed(2);const f=u.clone().add(c).divideScalar(2);o.three.position.copy(f)}const a=this._markerKey.toString();return n.setupEvents(e,!0),n.getWorldMarkerList(e).set(a,{label:o,key:a,type:s,merged:!1,static:!1}),this._markerKey++,this.save(a,s),o}showKPStations(e){if(!this.world)throw new Error("A world is needed for this component to work!");if(this.type==="horizontal"){const t=this.generateStartAndEndKP(e);for(const[,s]of t)this.addKPStation(this.world,s.value,s.normal);const i=this.generateConstantKP(e);for(const[,s]of i)this.addKPStation(this.world,s.value,s.normal)}}showCurveLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const i=this.components.get(Es),s=e.length,n=`${t.toFixed(2)} m`,r=Math.round(s/2),o=e[r],a=i.create(this.world,n,o,!0);a!==void 0&&this.save(a,"Radius")}showLineLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const i=this.components.get(Es),s=new z;s.x=e.geometry.getAttribute("position").getX(0),s.y=e.geometry.getAttribute("position").getY(0),s.z=e.geometry.getAttribute("position").getZ(0);const n=new z;n.x=e.geometry.getAttribute("position").getX(1),n.y=e.geometry.getAttribute("position").getY(1),n.z=e.geometry.getAttribute("position").getZ(1);const r=`${t.toFixed(2)} m`,o=new z;o.addVectors(s,n).multiplyScalar(.5);const a=i.create(this.world,r,o,!0);a!==void 0&&this.save(a,"Radius")}showCurveRadius(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");const i=this.components.get(Es),s=new z;s.x=e.geometry.getAttribute("position").getX(0),s.y=e.geometry.getAttribute("position").getY(0),s.z=e.geometry.getAttribute("position").getZ(0);const n=new z;n.x=e.geometry.getAttribute("position").getX(1),n.y=e.geometry.getAttribute("position").getY(1),n.z=e.geometry.getAttribute("position").getZ(1);const r=`R = ${t.toFixed(2)} m`,o=new z;o.addVectors(s,n).multiplyScalar(.5);const a=i.create(this.world,r,o,!0);a!==void 0&&this.save(a,"Radius")}deleteByType(e=Z0){const t=this.components.get(Es);for(const i of e){const s=this._list.get(i);if(s){for(const n of s)t.delete(n);this._list.delete(i)}}}generateStartAndEndKP(e){const{alignment:t}=e.curve,i=new Map;for(const s of t.horizontal){const n=s.getLength();if(i.size>0){const r=s.index-1,o=i.get(r).distance+n,a=s.mesh.geometry.getAttribute("position"),c=a.count-1,u=new z;u.x=a.getX(c),u.y=a.getY(c),u.z=a.getZ(c);const d=this.createNormalLine(s.mesh);i.set(s.index,{value:this.getShortendKPValue(o),distance:o,point:u,normal:d})}else{const r=s.mesh.geometry.getAttribute("position"),o=r.count-1,a=new z;a.x=r.getX(o),a.y=r.getY(o),a.z=r.getZ(o);const c=this.createNormalLine(s.mesh);i.set(s.index,{value:this.getShortendKPValue(n),distance:n,point:a,normal:c})}}return i}createNormalLine(e){const t=e.geometry.attributes.position.count-1,i=t-1,s=new z;s.x=e.geometry.attributes.position.getX(t),s.y=e.geometry.attributes.position.getY(t),s.z=e.geometry.attributes.position.getZ(t);const n=new z;n.x=e.geometry.attributes.position.getX(i),n.y=e.geometry.attributes.position.getY(i),n.z=e.geometry.attributes.position.getZ(i);const r=new z().subVectors(s,n).clone().applyAxisAngle(new z(0,0,1),Math.PI*.5).normalize(),o=new rt().setFromPoints([r.clone().setLength(10).add(s),r.clone().setLength(-10).add(s)]);return new Ct(o)}generateConstantKP(e){const{alignment:t}=e.curve,i=new Map,s=t.getLength("horizontal"),n=Math.floor(s/this.divisionLength);for(let r=0;r<n;r++){const o=r/n,a=t.getPointAt(o,"horizontal"),c=s*o,u=this.getNormal(t,a);i.set(r,{value:this.getShortendKPValue(c),distance:c,point:a,normal:u})}return i}getNormal(e,t){const i=[],s={start:new z,end:new z};for(let o=0;o<e.horizontal.length;o++){const a=e.horizontal[o].mesh.geometry.attributes.position,c=a.count;for(let u=0;u<c;u++){const d=a.getX(u),f=a.getY(u),m=a.getZ(u);i.push(new z(d,f,m))}}for(let o=0;o<i.length-1;o++){const a=i[o],c=i[o+1],u=a.distanceTo(t),d=c.distanceTo(t),f=a.distanceTo(c);Math.abs(u+d-f)<1e-5&&(s.start=a,s.end=c)}const n=new z().subVectors(s.end,s.start).clone().applyAxisAngle(new z(0,0,1),Math.PI*.5).normalize(),r=new rt().setFromPoints([n.clone().setLength(10).add(t),n.clone().setLength(-10).add(t)]);return new Ct(r,new rs({color:16711680}))}getShortendKPValue(e){const t=e.toFixed(2),[i,s]=t.toString().split("."),n=s||"00";if(parseInt(i,10)>1e3&&parseInt(i,10)<1e4){const[r,...o]=i;return`${r}+${o.join("")}.${n}`}if(parseInt(i,10)>1e4){const[r,o,...a]=i;return`${r}${o}+${a.join("")}.${n}`}return`0+${i.padStart(3,"0")}.${n}`}save(e,t){this._list.has(t)||this._list.set(t,new Set),this._list.get(t).add(e)}};S(Zu,"uuid","0af12c32-81ee-4100-a030-e9ae546f6170");let Zn=Zu;class Xu extends Ke{constructor(e){super(e),S(this,"onHighlight",new le),S(this,"onMarkerChange",new le),S(this,"onMarkerHidden",new le),S(this,"onDisposed",new le),S(this,"enabled",!0),S(this,"mouseMarkers"),S(this,"_curves",[]),S(this,"_previousAlignment",null),S(this,"_highlighter"),S(this,"_world",null),S(this,"updateLinesResolution",t=>{var i;(i=this._highlighter)==null||i.setResolution(t)}),S(this,"onMouseMove",t=>{var i,s,n;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const r=this._world.renderer.three.domElement.parentElement,o=this._world.camera.three,a=(i=this._highlighter)==null?void 0:i.castRay(t,o,r,this._curves);if(a){const{object:c}=a;(s=this._highlighter)==null||s.hover(c),this.updateMarker(a,"hover");return}this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),(n=this._highlighter)==null||n.unHover(),this.onMarkerHidden.trigger({type:"hover"})}),S(this,"onClick",t=>{var i,s;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;const n=this._world.renderer.three.domElement.parentElement,r=this._world.camera.three,o=(i=this._highlighter)==null?void 0:i.castRay(t,r,n,this._curves);if(o){const a=o,c=a.object;if((s=this._highlighter)==null||s.select(c),this.updateMarker(a,"select"),this._world.camera.hasCameraControls()&&(c.geometry.boundingBox||c.geometry.computeBoundingBox(),c.geometry.boundingBox)){const u=this.getScaledBox(c.geometry.boundingBox,2);this._world.camera.controls.fitToBox(u,!0)}this.onHighlight.trigger({mesh:c,point:a.point}),this._previousAlignment!==c.curve.alignment&&(this.components.get(Zn).showKPStations(c),this._previousAlignment=c.curve.alignment)}}),S(this,"onControlsUpdated",()=>{if(!this._world)throw new Error("No world was given for this navigator!");if(!(this._world.camera.three instanceof ss)||!this._highlighter)return;const{zoom:t,left:i,right:s,top:n,bottom:r}=this._world.camera.three,o=i-s,a=n-r,c=Math.max(o,a)/t,u=40,{caster:d}=this._highlighter;d.params.Line.threshold=c/u})}get highlighter(){if(!this._highlighter)throw new Error("Highlighter not initialized. You must set a world first!");return this._highlighter}get world(){return this._world}set world(e){var t,i,s;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(i=this.mouseMarkers)==null||i.hover.dispose(),(s=this.mouseMarkers)==null||s.select.dispose(),!e))return;const n=e.scene.three;this._highlighter=new Du(n,this.view),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}async draw(e,t){if(!e.civilData)throw new Error("The provided model doesn't have civil data!");if(!this._world)throw new Error("No world was given for this navigator!");const{alignments:i}=e.civilData,s=t||i.values(),n=this._world.scene.three,r=new ut;r.makeEmpty(),r.min.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r.max.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const a of s){if(!a)throw new Error("Alignment not found!");for(const c of a[this.view])if(n.add(c.mesh),this._curves.push(c.mesh),!r.isEmpty())r.expandByObject(c.mesh);else{c.mesh.geometry.computeBoundingBox();const u=c.mesh.geometry.boundingBox;u instanceof ut&&r.copy(u).applyMatrix4(c.mesh.matrixWorld)}}const o=this.getScaledBox(r,1.2);this._world.camera.hasCameraControls()&&await this._world.camera.controls.fitToBox(o,!1)}async dispose(){var e;(e=this._highlighter)==null||e.dispose(),this.clear(),this.onHighlight.reset(),this._curves=[],this.onDisposed.trigger(),this.onDisposed.reset()}clear(){var e,t;(e=this._highlighter)==null||e.unSelect(),(t=this._highlighter)==null||t.unHover();for(const i of this._curves)i.removeFromParent();this._curves=[]}setMarker(e,t,i){if(!this._curves.length)return;const s=e.getCurveAt(t,this.view),n=e.getPointAt(t,this.view),{index:r}=s.curve.getSegmentAt(s.percentage);this.setMouseMarker(n,s.curve.mesh,r,i)}setDefSegments(e){const t=[],i=[],s=(n,r)=>{const o=r[1]-n[1],a=r[0]-n[0];return o/a};for(let n=0;n<e.length;n++){const r=e[n];let o,a,c,u;for(let f=0;f<Object.keys(r).length/3;f++)if(r[f*3]!==void 0&&r[f*3+1]!==void 0){o=r[f*3],a=r[f*3+1];break}for(let f=Object.keys(r).length/3-1;f>=0;f--)if(r[f*3]!==void 0&&r[f*3+1]!==void 0){c=r[f*3],u=r[f*3+1];break}const d=(s([o,a],[c,u])*100).toFixed(2);i.push({slope:d})}for(const n of e)for(let r=0;r<n.length-3;r+=3){const o=n[r],a=n[r+1],c=n[r+2],u=n[r+3],d=n[r+4],f=n[r+5];t.push({start:new z(o,a,c),end:new z(u,d,f)})}return{defSegments:t,slope:i}}hideMarker(e){this.mouseMarkers&&(this.mouseMarkers[e].visible=!1)}setupEvents(e){var t,i;if(!this._world)throw new Error("No world was given for this navigator!");if(this._world.isDisposing||!this._world.renderer)return;const s=this._world.renderer.three.domElement.parentElement;(t=this._world.renderer)==null||t.onResize.remove(this.updateLinesResolution),s.removeEventListener("pointermove",this.onMouseMove),s.removeEventListener("click",this.onClick),this._world.camera.hasCameraControls()&&this._world.camera.controls.removeEventListener("update",this.onControlsUpdated),e&&(s.addEventListener("pointermove",this.onMouseMove),s.addEventListener("click",this.onClick),(i=this._world.renderer)==null||i.onResize.add(this.updateLinesResolution),this._world.camera.hasCameraControls()&&this._world.camera.controls.addEventListener("update",this.onControlsUpdated))}newMouseMarker(e,t){if(!this._world)throw new Error("No world was given for this navigator!");const i=t.scene.three,s=document.createElement("div"),n=document.createElement("div");s.appendChild(n),n.style.backgroundColor=e,n.style.width="3rem",n.style.height="3px";const r=new Zt(this._world,s,i);return r.visible=!1,r}setMouseMarker(e,t,i,s){if(i===void 0||!this.mouseMarkers)return;this.mouseMarkers[s].visible=!0;const n=this.mouseMarkers[s].three;n.position.copy(e);const r=t,{startPoint:o,endPoint:a}=r.curve.getSegment(i),c=Math.atan2(a.y-o.y,a.x-o.x),u=n.element.children[0],d=90-c/Math.PI*180;u.style.transform=`rotate(${d}deg)`}updateMarker(e,t){const{point:i,index:s,object:n}=e,r=n,o=r.curve,a=r.curve.alignment,c=a.getPercentageAt(i,this.view),u=i.clone();this.setMouseMarker(u,r,s,t),c!==null&&this.onMarkerChange.trigger({alignment:a,percentage:c,type:t,curve:o})}getScaledBox(e,t){const i=new ut,s=new z,n=new z;return e.getCenter(n),e.getSize(s),s.multiplyScalar(t),i.setFromCenterAndSize(n,s),i}}class K0{constructor(e,t,i){S(this,"components"),S(this,"_scene"),S(this,"_world"),S(this,"offset",10),S(this,"markupLines",[]),S(this,"currentCurveMesh"),S(this,"markupMaterial",new rs({color:6842472})),this.components=e,this._scene=t,this._world=i}showCurveInfo(e){switch(this.disposeMarkups(),this.currentCurveMesh=e,e.curve.data.TYPE){case"LINE":this.showLineInfo(e,this.offset);break;case"CIRCULARARC":this.showCircularArcInfo(e,this.offset);break;case"CLOTHOID":this.showClothoidInfo(e,this.offset);break;default:console.log("Unknown curve type:",e.curve.data.TYPE);break}}updateOffset(e,t,i){const s=Math.max(e.height,e.width)/(t*150);s!==this.offset&&(this.offset=s,i&&this.currentCurveMesh&&this.showCurveInfo(this.currentCurveMesh))}dispose(){for(const e of this.markupLines)e.removeFromParent();this.disposeMarkups(),this.markupMaterial.dispose()}disposeMarkups(){for(const e of this.markupLines)e.geometry.dispose(),e.removeFromParent();this.markupLines=[]}unSelect(){this.disposeMarkups()}calculateTangent(e,t){const i=t*3,s=Math.max(0,i-3),n=Math.min(e.length-3,i+3),r=new z().fromArray(e,s);return new z().fromArray(e,n).clone().sub(r).normalize()}calculateParallelCurve(e,t,i){const s=[];for(let n=0;n<t;n++){const r=this.calculateTangent(e,n).clone().applyAxisAngle(new z(0,0,1),Math.PI/2);r.normalize();const o=r.clone().multiplyScalar(i),a=n*3,c=new z().fromArray(e,a).add(o);s.push(c)}return s}calculateDimensionLines(e,t){const i=[],s=e.geometry.attributes.position.array,n=t.geometry.attributes.position.array;if(s.length<6&&n.length<6)throw new Error("Line must have at least two vertices");const r=new z(s[0],s[1],s[2]),o=new z(n[0],n[1],n[2]),a=[],c=s.length-3,u=new z(s[c],s[c+1],s[c+2]),d=n.length-3,f=new z(n[d],n[d+1],n[d+2]);return i.push(r,o),a.push(u,f),{startDimensionPoints:i,endDimensionPoints:a}}offsetDimensionLine(e,t){const i=new z().copy(e[e.length-1]).sub(e[0]).normalize().clone().multiplyScalar(t);return e.map(s=>s.clone().add(i))}showLineInfo(e,t){const i=this.components.get(Zn);i.world=this._world,i.deleteByType(["Length","Radius"]);const s=e.geometry.attributes.position.array,n=this.calculateParallelCurve(s,s.length/3,t),r=new rt().setFromPoints(n),o=new Ct(r,this.markupMaterial);i.showLineLength(o,e.curve.getLength()),this._scene.add(o),this.markupLines.push(o);const{startDimensionPoints:a,endDimensionPoints:c}=this.calculateDimensionLines(e,o),u=this.offsetDimensionLine(a,t*.1),d=this.offsetDimensionLine(c,t*.1),f=new rt().setFromPoints(u),m=new rt().setFromPoints(d),E=new Ct(f,this.markupMaterial);this._scene.add(E),this.markupLines.push(E);const g=new Ct(m,this.markupMaterial);this._scene.add(g),this.markupLines.push(g)}showClothoidInfo(e,t){const i=this.components.get(Zn);i.world=this._world,i.deleteByType(["Length","Radius"]);const s=e.geometry.attributes.position.array,n=this.calculateParallelCurve(s,s.length/3,t),r=new rt().setFromPoints(n);i.showCurveLength(n,e.curve.getLength());const o=new Ct(r,this.markupMaterial);this._scene.add(o),this.markupLines.push(o);const{startDimensionPoints:a,endDimensionPoints:c}=this.calculateDimensionLines(e,o),u=this.offsetDimensionLine(a,t*.1),d=this.offsetDimensionLine(c,t*.1),f=new rt().setFromPoints(u),m=new rt().setFromPoints(d),E=new Ct(f,this.markupMaterial);this._scene.add(E),this.markupLines.push(E);const g=new Ct(m,this.markupMaterial);this._scene.add(g),this.markupLines.push(g)}showCircularArcInfo(e,t){const i=this.components.get(Zn);i.world=this._world,i.deleteByType(["Length","Radius"]);const s=e.curve.data.RADIUS,n=e.geometry.attributes.position.array,r=e.geometry.attributes.position.count,o=[],a=new z(n[0],n[1],n[2]),c=(r-1)*3,u=new z(n[c],n[c+1],n[c+2]),d=r/2*3,f=new z(n[d],n[d+1],n[d+2]),m=u.clone().sub(a).normalize(),E=new z(-m.y,m.x,0);E.multiplyScalar(s);const g=f.clone().add(E);o.push(f),o.push(g);const w=new rt().setFromPoints(o),y=new Ct(w,this.markupMaterial);i.showCurveRadius(y,Math.abs(s)),this._scene.add(y),this.markupLines.push(y);const I=[];for(let V=0;V<r;V++){const T=this.calculateTangent(n,V),J=e.curve.data.RADIUS,de=new z(T.y,-T.x,0);de.normalize(),J<0&&de.negate();const ie=de.clone().multiplyScalar(t),ve=V*3,ue=new z(n[ve]+ie.x,n[ve+1]+ie.y,n[ve+2]+ie.z);I.push(ue)}const _=new rt().setFromPoints(I);i.showCurveLength(I,e.curve.getLength());const C=new Ct(_,this.markupMaterial);this._scene.add(C),this.markupLines.push(C);const{startDimensionPoints:F,endDimensionPoints:M}=this.calculateDimensionLines(e,C),D=this.offsetDimensionLine(F,t*.1),B=this.offsetDimensionLine(M,t*.1),N=new rt().setFromPoints(D),G=new rt().setFromPoints(B),Q=new Ct(N,this.markupMaterial);this._scene.add(Q),this.markupLines.push(Q);const O=new Ct(G,this.markupMaterial);this._scene.add(O),this.markupLines.push(O)}}const Qu=class qu extends Xu{constructor(e){super(e),S(this,"view","horizontal"),S(this,"planHighlighter"),this.components.add(qu.uuid,this),this.onHighlight.add(({mesh:t})=>{!this._highlighter||!this.planHighlighter||this.planHighlighter.showCurveInfo(t)})}get world(){return super.world}set world(e){var t;super.world=e,e&&((t=this.planHighlighter)==null||t.dispose(),this.planHighlighter=new K0(this.components,e.scene.three,e))}};S(Qu,"uuid","3096dea0-5bc2-41c7-abce-9089b6c9431b");let r1=Qu;const Ju=class $u extends Xu{constructor(e){super(e),S(this,"enabled",!0),S(this,"view","vertical"),this.components.add($u.uuid,this)}get world(){return super.world}set world(e){this.world!==e&&(super.world=e,this._highlighter&&this._highlighter.onSelect.add(t=>{if(!this.world)throw new Error("A world is needed to work with this component!");const i=this.components.get(Zn);i.deleteByType(["Slope","Height","InitialKPV","FinalKPV"]);const{alignment:s}=t.curve,n=[];for(const c of s.vertical){const u=c.mesh.geometry.attributes.position.array;n.push(u)}const{defSegments:r,slope:o}=this.setDefSegments(n),a=this.world.scene.three;for(let c=0;c<s.vertical.length;c++){const u=s.vertical[c];i.addVerticalMarker(this.world,`S: ${o[c].slope}%`,u.mesh,"Slope",a),i.addVerticalMarker(this.world,`H: ${r[c].end.y.toFixed(2)}`,u.mesh,"Height",a)}i.addVerticalMarker(this.world,"KP: 0",s.vertical[0].mesh,"InitialKPV",a),i.addVerticalMarker(this.world,`KP: ${s.vertical.length}`,s.vertical[s.vertical.length-1].mesh,"FinalKPV",a)}))}};S(Ju,"uuid","097eea29-2d5a-431a-a247-204d44670621");let o1=Ju;const ed=class td extends Ke{constructor(e){super(e),S(this,"onHighlight",new le),S(this,"onMarkerChange",new le),S(this,"onMarkerHidden",new le),S(this,"enabled",!0),S(this,"mouseMarkers"),S(this,"_highlighter"),S(this,"_curves",[]),S(this,"_world",null),S(this,"updateLinesResolution",t=>{var i;(i=this.highlighter)==null||i.setResolution(t)}),S(this,"onClick",t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const i=this.world.renderer.three.domElement,s=this.world.camera.three,n=this._highlighter.castRay(t,s,i,this._curves);if(n){const r=n.object;this._highlighter.select(r),this.updateMarker(n,"select");const{point:o,index:a}=n;a!==void 0&&this.onHighlight.trigger({curve:r,point:o,index:a});return}this._highlighter.unSelect(),this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),this.onMarkerHidden.trigger({type:"hover"})}),S(this,"onMouseMove",async t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;const i=this.world.renderer.three.domElement,s=this.world.camera.three,n=this._highlighter.castRay(t,s,i,this._curves);if(n){this._highlighter.hover(n.object),this.updateMarker(n,"hover");return}this._highlighter.unHover()}),this.components.add(td.uuid,this)}get world(){return this._world}set world(e){var t,i,s;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(i=this.mouseMarkers)==null||i.hover.dispose(),(s=this.mouseMarkers)==null||s.select.dispose(),!e))return;const n=e.scene.three;this._highlighter=new Du(n,"absolute"),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}get highlighter(){if(!this._highlighter)throw new Error("Navigator not initialized!");return this._highlighter}draw(e){if(!e.civilData)throw new Error("Model must have civil data!");if(!this.world)throw new Error("A world must be given before drawing an alignment!");const t=this.world.scene.three;for(const[i,s]of e.civilData.alignments)for(const{mesh:n}of s.absolute)t.add(n),this._curves.push(n)}setMarker(e,t,i){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const s=e.getPointAt(t,"absolute");this.mouseMarkers[i].visible=!0,this.mouseMarkers[i].three.position.copy(s)}hideMarker(e){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");const t=this.mouseMarkers[e].three;t.visible=!1}newMouseMarker(e,t){const i=t.scene.three,s=document.createElement("div");s.style.backgroundColor=e,s.style.width="1rem",s.style.height="1rem",s.style.borderRadius="1rem";const n=new Zt(t,s,i);return n.visible=!1,n}setupEvents(e){var t,i;if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;const s=this.world.renderer.three.domElement;(t=this.world.renderer)==null||t.onResize.remove(this.updateLinesResolution),s.removeEventListener("click",this.onClick),s.removeEventListener("pointermove",this.onMouseMove),e&&(s.addEventListener("click",this.onClick),s.addEventListener("pointermove",this.onMouseMove),(i=this.world.renderer)==null||i.onResize.add(this.updateLinesResolution))}updateMarker(e,t){if(!this.mouseMarkers)return;const{point:i,object:s}=e,n=s,r=n.curve,o=n.curve.alignment,a=o.getPercentageAt(i,"absolute");this.mouseMarkers[t].visible=!0,this.mouseMarkers[t].three.position.copy(i),a!==null&&this.onMarkerChange.trigger({alignment:o,percentage:a,type:t,curve:r})}};S(ed,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");let a1=ed;const id=class sd extends Ke{constructor(e){super(e),S(this,"enabled",!0),S(this,"world",null),S(this,"plane"),S(this,"_world3D",null),this.components.add(sd.uuid,this)}get world3D(){return this._world3D}set world3D(e){var t;if(this._world3D=e,(t=this.plane)==null||t.dispose(),!e)return;const i=this.components.get(cn),s=i.Type;i.Type=Io,this.plane=i.createFromNormalAndCoplanarPoint(e,new z(1,0,0),new z),i.Type=s,this.plane.visible=!1,this.plane.enabled=!1}async set(e,t){if(!this.world||!this.plane)throw new Error("You must set a world before using this component");this.plane.enabled=!0;const i=e.curve.getPercentageAt(t);if(i===null)return;const{startPoint:s,endPoint:n}=e.curve.getSegmentAt(i);if(e.geometry.index===null)throw new Error("Geometry must be indexed!");const r=new z;r.subVectors(n,s),r.normalize(),this.plane.setFromNormalAndCoplanarPoint(r,t),this.plane.edges.update();const o=this.plane.helper.matrix.clone();o.invert();const a=this.world.scene.three,c=this.plane.edges.get();for(const u in c){const{mesh:d}=c[u];d.position.set(0,0,0),d.rotation.set(0,0,0),d.updateMatrix(),d.applyMatrix4(o),d.parent!==a&&a.add(d)}this.plane.enabled=!1}};S(id,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");let l1=id;function is(){const l=document.createElement("div");return l.style.backgroundColor="black",l.style.color="white",l.style.padding="8px",l.style.borderRadius="8px",l.style.fontFamily="sans-serif",l}const uo=class fo{constructor(e,t,i){S(this,"label"),S(this,"boundingBox",new Ae),S(this,"world"),S(this,"components"),S(this,"_length"),S(this,"_visible",!0),S(this,"_start"),S(this,"_end"),S(this,"_root",new Eo),S(this,"_endpoints",[]),S(this,"_line"),this.components=e,this.world=t,this._start=i.start,this._end=i.end,this._length=this.getLength(),this._line=this.createLine(i),this.newEndpointElement(i.endpointElement),this.newEndpointElement(i.endpointElement.cloneNode(!0)),this.label=this.newText(),this._root.renderOrder=2,this.world.scene.three.add(this._root)}get visible(){return this._visible}set visible(e){this._visible=e,this.label.visible=e,this._endpoints[0].visible=e,this._endpoints[1].visible=e;const[t,i]=this._endpoints,s=t.three,n=i.three,r=this.label.three;e?(this.world.scene.three.add(this._root),this._root.add(r,s,n)):(r.removeFromParent(),s.removeFromParent(),n.removeFromParent(),this._root.removeFromParent())}get endPoint(){return this._end}set endPoint(e){this._end=e;const t=this._line.geometry.attributes.position;t.setXYZ(1,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[1].three.position.copy(e),this.updateLabel()}get startPoint(){return this._start}set startPoint(e){this._start=e;const t=this._line.geometry.attributes.position;t.setXYZ(0,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[0].three.position.copy(e),this.updateLabel()}get _center(){let e=this._end.clone().sub(this._start);const t=e.length()*.5;return e=e.normalize().multiplyScalar(t),this._start.clone().add(e)}dispose(){const e=this.components.get(Ri);this.visible=!1,e.destroy(this._root),e.destroy(this._line);for(const t of this._endpoints)t.dispose();this._endpoints.length=0,this.label.dispose(),this.boundingBox&&e.destroy(this.boundingBox),this.components=null}createBoundingBox(){this.boundingBox.geometry=new Rt(1,1,this._length),this.boundingBox.position.copy(this._center),this.boundingBox.lookAt(this._end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}toggleLabel(){this.label.toggleVisibility()}newEndpointElement(e){const t=this._endpoints.length===0?this._start:this._end,i=new Zt(this.world,e);i.three.position.copy(t),this._endpoints.push(i),this._root.add(i.three)}updateLabel(){this._length=this.getLength(),this.label.three.element.textContent=this.getTextContent(),this.label.three.position.copy(this._center),this._line.computeLineDistances()}createLine(e){const t=new rt;t.setFromPoints([e.start,e.end]);const i=new Ct(t,e.lineMaterial);return this._root.add(i),i}newText(){const e=is();e.textContent=this.getTextContent();const t=new Zt(this.world,e);return t.three.position.copy(this._center),this._root.add(t.three),t}getTextContent(){return`${(this._length/fo.scale).toFixed(fo.rounding)} ${fo.units}`}getLength(){return this._start.distanceTo(this._end)}};S(uo,"scale",1),S(uo,"units","m"),S(uo,"rounding",2);let Ul=uo;class X0{constructor(e,t,i){S(this,"enabled",!0),S(this,"points",[]),S(this,"workingPlane",null),S(this,"labelMarker"),S(this,"world"),S(this,"components"),S(this,"onDisposed",new le),S(this,"onAreaComputed",new le),S(this,"onWorkingPlaneComputed",new le),S(this,"onPointAdded",new le),S(this,"onPointRemoved",new le),S(this,"_visible",!0),S(this,"_rotationMatrix",null),S(this,"_dimensionLines",[]),S(this,"_defaultLineMaterial",new rs({color:"red"})),this.world=t,this.components=e;const s=is();this.labelMarker=new Zt(t,s),this.labelMarker.visible=!1,this.onPointAdded.add(n=>{this.points.length===3&&!this._dimensionLines[2]&&(this.addDimensionLine(n,this.points[0]),this.labelMarker.visible=!0)}),i==null||i.forEach(n=>this.setPoint(n))}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this._dimensionLines)t.visible=e,t.label.visible=!1;this.labelMarker.visible=e}setPoint(e,t){let i;if(t?i=t:i=this.points.length===0?0:this.points.length,i===0){this.points[0]=e;return}if(i<0||i>this.points.length)return;const s=this.points.length>i;this.points[i]=e,this.onPointAdded.trigger(e),s||this.addDimensionLine(this.points[i-1],e);const{previousLine:n,nextLine:r}=this.getLinesBetweenIndex(i);n&&(n.endPoint=e),r&&(r.startPoint=e)}removePoint(e){if(this.points.length===3)return;this.points.splice(e,1);const{previousLine:t,nextLine:i}=this.getLinesBetweenIndex(e);i&&(t.endPoint=i.endPoint),i==null||i.dispose(),this._dimensionLines.splice(e,1),this.onPointRemoved.trigger()}toggleLabel(){this.labelMarker.toggleVisibility()}addDimensionLine(e,t){const i=new Ul(this.components,this.world,{start:e,end:t,lineMaterial:this._defaultLineMaterial,endpointElement:is()});return i.toggleLabel(),this._dimensionLines.length>1?this._dimensionLines.splice(this._dimensionLines.length-1,0,i):this._dimensionLines.push(i),i}getLinesBetweenIndex(e){const t=e===0?this._dimensionLines.length-1:e-1,i=this._dimensionLines[t],s=this._dimensionLines[e];return{previousLine:i,nextLine:s}}computeWorkingPlane(){this.workingPlane=new ns().setFromCoplanarPoints(this.points[0],this.points[1],this.points[2]);const e=new z(0,1,0),t=this.workingPlane.normal.angleTo(e),i=new z().crossVectors(this.workingPlane.normal,e).normalize();this._rotationMatrix=new Ne().makeRotationAxis(i,t),this.onWorkingPlaneComputed.trigger(this.workingPlane)}computeArea(){if(!(this._rotationMatrix&&this.workingPlane))return this.onAreaComputed.trigger(0),0;let e=0,t=0;const i=this._rotationMatrix,s=this.points.map(r=>{const o=r.clone().applyMatrix4(i),a=new ft(o.x,o.z);return e+=a.x,t+=a.y,a}),n=Math.abs(mf.area(s));return this.labelMarker.three.element.textContent=`${n.toFixed(2)} m²`,this.labelMarker.three.position.set(e/s.length,-this.workingPlane.constant,t/s.length).applyMatrix4(i.clone().invert()),this.onAreaComputed.trigger(n),n}dispose(){this.onAreaComputed.reset(),this.onWorkingPlaneComputed.reset(),this.onPointAdded.reset(),this.onPointRemoved.reset();for(const e of this._dimensionLines)e.dispose();this.labelMarker.dispose(),this._dimensionLines=[],this.points=[],this._rotationMatrix=null,this.workingPlane=null,this._defaultLineMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return{points:this.points,workingPlane:this.workingPlane,area:this.computeArea()}}}class Bl extends Wp{constructor(e,t){super(e,t),S(this,"onDisposed",new le),S(this,"marker",null),S(this,"_className","default-vertex-picker"),this.onEnabled.add(i=>{this.marker&&(this.marker.visible=i)})}get className(){return this._className}set className(e){this._className=e,this.marker&&(this.marker.three.element.className=e)}dispose(){this.marker&&this.marker.dispose(),super.dispose()}get(e){const t=super.get(e);return t?(this.marker||(this.marker=new Zt(e),this.marker.three.element.className=this._className),this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.marker.visible=!0,this.marker.three.position.copy(t)):this.marker&&(this.marker.visible=!1),t}}const nd=class nl extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"list",[]),S(this,"world"),S(this,"_enabled",!1),S(this,"_visible",!0),S(this,"_vertexPicker"),S(this,"_currentAreaElement",null),S(this,"_clickCount",0),S(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World not defined for the area measurement!");const t=this._vertexPicker.get(this.world);if(t){if(!this._currentAreaElement){const i=new X0(this.components,this.world);i.onPointAdded.add(()=>{this._clickCount===2&&!i.workingPlane&&(i.computeWorkingPlane(),this._vertexPicker.workingPlane=i.workingPlane)}),i.onPointRemoved.add(()=>this._clickCount--),this._currentAreaElement=i}this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea(),this._clickCount++}}),S(this,"onMouseMove",()=>{if(!this.world){console.log("No world given for the area measurement!");return}const t=this._vertexPicker.get(this.world);t&&this._currentAreaElement&&(this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea())}),S(this,"onKeydown",t=>{this.enabled&&(t.key==="z"&&t.ctrlKey&&this._currentAreaElement&&this._currentAreaElement.removePoint(this._clickCount-1),t.key==="Enter"&&this._currentAreaElement&&this.endCreation(),t.key==="Escape"&&(this._clickCount===0&&!this._currentAreaElement?this.enabled=!1:this.cancelCreation()))}),this.components.add(nl.uuid,this),this._vertexPicker=new Bl(e)}set enabled(e){this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}set workingPlane(e){this._vertexPicker.workingPlane=e}get workingPlane(){return this._vertexPicker.workingPlane}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}dispose(){this.setupEvents(!1),this._vertexPicker.dispose(),this._currentAreaElement&&this._currentAreaElement.dispose();for(const e of this.list)e.dispose();this.components=null,this.onDisposed.trigger(nl.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAreaElement&&(this._currentAreaElement.points.length<3||(this._currentAreaElement&&(this.list.push(this._currentAreaElement),this._currentAreaElement.removePoint(this._clickCount),this._currentAreaElement.computeWorkingPlane(),this._currentAreaElement.computeArea(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0))}cancelCreation(){this._currentAreaElement&&(this._currentAreaElement.dispose(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("The area measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the area measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}};S(nd,"uuid","c453a99e-f054-4781-9060-33df617db4a5");let c1=nd;class Q0{constructor(e,t){S(this,"enabled",!0),S(this,"visible",!0),S(this,"points",[]),S(this,"world"),S(this,"onDisposed",new le),S(this,"_lineMaterial",new tr({color:6629591,linewidth:2})),S(this,"_lineGeometry",new yo),S(this,"_line",new Su(this._lineGeometry,this._lineMaterial)),S(this,"_labelMarker"),S(this,"onAngleComputed",new le),S(this,"onPointAdded",new le),this.world=e;const i=is();this._labelMarker=new Zt(e,i),this.labelMarker.visible=!0,this.onPointAdded.add(()=>{this.points.length===1&&e.scene.three.add(this._line),this.points.length===3&&(this.labelMarker.visible=!0)}),this.onAngleComputed.add(s=>{this.labelMarker.three.element.textContent=`${s.toFixed(2)}°`,this.labelMarker.three.position.copy(this.points[1]??new z)}),t==null||t.forEach(s=>this.setPoint(s))}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._line.material=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get lineMaterial(){return this._lineMaterial}set labelMarker(e){this._labelMarker.dispose(),this._labelMarker=e}get labelMarker(){return this._labelMarker}get angle(){return{points:this.points,angle:this.computeAngle()}}setPoint(e,t){let i;if(t?i=t:i=this.points.length===0?0:this.points.length,![0,1,2].includes(i))return;this.points[i]=e,this.onPointAdded.trigger(e);const s=this.points.map(n=>[n.x,n.y,n.z]);this._lineGeometry.setPositions(s.flat())}toggleLabel(){this.labelMarker.toggleVisibility()}computeAngle(){const e=this.points[0],t=this.points[1],i=this.points[2];if(!(e&&t&&i))return 0;const s=new z().subVectors(t,e),n=new z().subVectors(t,i),r=er.radToDeg(s.angleTo(n));return this.onAngleComputed.trigger(r),r}dispose(){this.points=[],this.labelMarker.dispose(),this.onAngleComputed.reset(),this.onPointAdded.reset(),this.labelMarker.dispose(),this._line.removeFromParent(),this._lineMaterial.dispose(),this._lineGeometry.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}}const rd=class rl extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"world"),S(this,"list",[]),S(this,"_lineMaterial"),S(this,"_enabled",!1),S(this,"_vertexPicker"),S(this,"_currentAngleElement",null),S(this,"_clickCount",0),S(this,"create",()=>{if(!this.enabled)return;if(!this.world){console.log("No world selected for angle measurement!");return}const t=this._vertexPicker.get(this.world);if(t){if(!this._currentAngleElement){const i=new Q0(this.world);i.lineMaterial=this.lineMaterial,this._currentAngleElement=i}this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.setPoint(t,this._clickCount+1),this._currentAngleElement.setPoint(t,this._clickCount+2),this._currentAngleElement.computeAngle(),this._clickCount++,this._clickCount===3&&this.endCreation()}}),S(this,"onMouseMove",()=>{if(!this.world){console.log("No world selected for angle measurement!");return}const t=this._vertexPicker.get(this.world);t&&this._currentAngleElement&&(this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.computeAngle())}),S(this,"onKeyDown",t=>{this.enabled&&t.key==="Escape"&&this.cancelCreation()}),this.components.add(rl.uuid,this),this._vertexPicker=new Bl(e),this._lineMaterial=new tr({color:6629591,linewidth:2})}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.setupEvents(e),this._vertexPicker.enabled=e,e||this.cancelCreation()}get lineMaterial(){return this._lineMaterial}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get workingPlane(){return this._vertexPicker.workingPlane}set workingPlane(e){this._vertexPicker.workingPlane=e}dispose(){this.setupEvents(!1),this._lineMaterial.dispose(),this._vertexPicker.dispose();for(const e of this.list)e.dispose();this._currentAngleElement&&this._currentAngleElement.dispose(),this.components=null,this.onDisposed.trigger(rl.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAngleElement&&(this.list.push(this._currentAngleElement),this._currentAngleElement.computeAngle(),this._currentAngleElement=null),this._clickCount=0}cancelCreation(){this._currentAngleElement&&(this._currentAngleElement.dispose(),this._currentAngleElement=null),this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("No world selected for angle measurement!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeyDown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeyDown))}};S(rd,"uuid","622fb2c9-528c-4b0a-8a0e-6a1375f0a3aa");let h1=rd;const od=class ol extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"onBeforeUpdate",new le),S(this,"onAfterUpdate",new le),S(this,"snapDistance",.25),S(this,"list",[]),S(this,"world"),S(this,"_vertexPicker"),S(this,"_lineMaterial",new rs({color:"#DC2626",linewidth:2,depthTest:!1})),S(this,"_visible",!0),S(this,"_enabled",!1),S(this,"_temp",{isDragging:!1,start:new z,end:new z,dimension:void 0}),S(this,"create",t=>{const i=t instanceof an?t:void 0;if(this._enabled){if(!this._temp.isDragging){this.drawStart(i);return}this.endCreation()}}),S(this,"onMouseMove",()=>{this.world&&this._vertexPicker.get(this.world)}),this.components.add(ol.uuid,this),this._vertexPicker=new Bl(e,{previewElement:is(),snapDistance:this.snapDistance})}get enabled(){return this._enabled}set enabled(e){e||this.cancelCreation(),this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e)}get visible(){return this._visible}set visible(e){this._visible=e;for(const t of this.list)t.visible=e}get color(){return this._lineMaterial.color}set color(e){this._lineMaterial.color=e}dispose(){this.setupEvents(!1),this.enabled=!1;for(const e of this.list)e.dispose();this._lineMaterial.dispose(),this.list=[],this._vertexPicker.dispose(),this.onDisposed.trigger(ol.uuid),this.onDisposed.reset()}async update(e){this._enabled&&this._temp.isDragging&&this.drawInProcess()}createOnPoints(e,t){const i=this.drawDimension();i.startPoint=e,i.endPoint=t,i.createBoundingBox(),this.list.push(i)}delete(){if(!this.world)throw new Error("World is needed for Length Measurement!");if(!this._enabled||this.list.length===0)return;const e=this.getBoundingBoxes(),t=this.components.get(li).get(this.world).castRay(e);if(!t)return;const i=this.list.find(s=>s.boundingBox===t.object);if(i){const s=this.list.indexOf(i);this.list.splice(s,1),i.dispose()}}async deleteMeasurement(e){if(e){const t=this.list.indexOf(e);this.list.splice(t,1),e.dispose()}}deleteAll(){for(const e of this.list)e.dispose();this.list=[]}cancelCreation(){var e;this._temp.dimension&&(this._temp.isDragging=!1,(e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0)}endCreation(){this._temp.dimension&&(this._temp.dimension.createBoundingBox(),this.list.push(this._temp.dimension),this._temp.dimension=void 0,this._temp.isDragging=!1)}drawStart(e){if(!this.world)throw new Error("The length measurement needs a world to work!");const t=e?[e]:void 0,i=this.components.get(li).get(this.world).castRay(t),s=this._vertexPicker.get(this.world);i&&s&&(this._temp.isDragging=!0,this._temp.start=e?i.point:s)}drawInProcess(){if(!this.world)throw new Error("The length measurement needs a world to work!");if(!this.components.get(li).get(this.world).castRay())return;const e=this._vertexPicker.get(this.world);e&&(this._temp.end=e,this._temp.dimension||(this._temp.dimension=this.drawDimension()),this._temp.dimension.endPoint=this._temp.end)}drawDimension(){if(!this.world)throw new Error("The length measurement needs a world to work!");return new Ul(this.components,this.world,{start:this._temp.start,end:this._temp.end,lineMaterial:this._lineMaterial,endpointElement:is()})}getBoundingBoxes(){return this.list.map(e=>e.boundingBox).filter(e=>e!==void 0)}setupEvents(e){if(!this.world)throw new Error("The length measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the length measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t&&(t.removeEventListener("pointermove",this.onMouseMove),e&&t.addEventListener("pointermove",this.onMouseMove))}};S(od,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");let Yn=od;const ad=class ld extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"onVolumeFound",new le),S(this,"label",null),S(this,"world"),S(this,"_enabled",!1),S(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World is needed for Volume Measurement!");const t=this.components.get(li).get(this.world).castRay(),i=this.components.get(bs);if(!t||!t.object)return;const{object:s}=t;if(s instanceof Ae){const n=i.getVolumeFromMeshes([s]);this.onVolumeFound.trigger(n)}}),S(this,"onMouseMove",()=>{}),S(this,"onKeydown",t=>{}),this.components.add(ld.uuid,this)}set enabled(e){this._enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}async dispose(){var e;this.setupEvents(!1),(e=this.label)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){}async deleteAll(){}endCreation(){}cancelCreation(){}getVolumeFromFragments(e){const t=this.components.get(bs).getVolumeFromFragments(e),i=this.components.get(wo);i.reset(),i.addFragmentIdMap(e);const s=i.getSphere();return this.setLabel(s,t),t}getVolumeFromMeshes(e){const t=this.components.get(bs),i=this.components.get(wo);i.reset();for(const r of e)i.addMesh(r);const s=i.getSphere(),n=t.getVolumeFromMeshes(e);return this.setLabel(s,n),n}clear(){this.label&&(this.label.visible=!1)}newLabel(){if(!this.world)throw new Error("World is needed for Volume Measurement!");const e=is();return new Zt(this.world,e)}setupEvents(e){if(!this.world)throw new Error("The volume measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the volume measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}setLabel(e,t){if(!this.world)throw new Error("World is needed for Volume Measurement!");this.label||(this.label=this.newLabel(),this.label.three.removeFromParent()),this.label.visible=!0,this.world.scene.three.add(this.label.three),this.label.three.position.copy(e.center);const i=Math.trunc(t*100)/100;this.label.three.element.textContent=i.toString()}};S(ad,"uuid","811da532-7af3-4635-b592-1c06ae494af5");let u1=ad;const cd=class hd extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"selection",[]),S(this,"preview",new Ae(new rt,new ei({side:2,depthTest:!1,transparent:!0,opacity:.25,color:"#BCF124"}))),S(this,"selectionMaterial",new ei({side:2,depthTest:!1,transparent:!0,color:"#BCF124",opacity:.75})),S(this,"world"),S(this,"_enabled",!1),S(this,"_currentSelelection",null),S(this,"create",()=>{if(!this.world)throw new Error("No world given to the face measurement!");if(!this.enabled||!this._currentSelelection)return;const t=this.world.scene.three,i=new rt,s=new Ae(i,this.selectionMaterial);i.setAttribute("position",this.preview.geometry.attributes.position),t.add(s),i.computeBoundingSphere();const{area:n,perimeter:r}=this._currentSelelection,o=this.newLabel(i,n);s.add(o.three),this.selection.push({area:n,perimeter:r,mesh:s,label:o})}),S(this,"onMouseMove",()=>{if(!this.world)throw new Error("The face measurement needs a world to work!");if(!this.enabled){this.unselect();return}const t=this.components.get(li).get(this.world).castRay();if(!t||!t.object||t.faceIndex===void 0){this.unselect();return}const{object:i,faceIndex:s}=t;i instanceof Ae||i instanceof pi?this.updateSelection(i,s,t.instanceId):this.unselect()}),S(this,"onKeydown",t=>{}),this.components.add(hd.uuid,this),this.preview.frustumCulled=!1}set enabled(e){if(!this.world)throw new Error("No world given for the Face measurement!");this._enabled=e,this.setupEvents(e),e?this.world.scene.three.add(this.preview):(this.preview.removeFromParent(),this.cancelCreation()),this.setVisibility(e)}get enabled(){return this._enabled}dispose(){this.setupEvents(!1),this.deleteAll(),this.preview.removeFromParent(),this.preview.material.dispose(),this.preview.geometry.dispose(),this.selectionMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.world)throw new Error("No world given to the face measurement!");const e=this.selection.map(n=>n.mesh),t=this.components.get(li).get(this.world).castRay(e);if(!t||!t.object)return;const i=this.selection.find(n=>n.mesh===t.object);if(!i)return;i.mesh.removeFromParent(),i.mesh.geometry.dispose(),i.label.dispose();const s=this.selection.indexOf(i);this.selection.splice(s,1)}deleteAll(){for(const e of this.selection)e.mesh.removeFromParent(),e.mesh.geometry.dispose(),e.label.dispose();this.selection=[]}endCreation(){}cancelCreation(){}get(){const e=[];for(const t of this.selection){const i=t.mesh.geometry,{area:s,perimeter:n}=t,r=i.attributes.position.array;e.push({position:r,area:s,perimeter:n})}return e}set(e){if(!this.world)throw new Error("No world given to the face measurement!");const t=this.world.scene.three;for(const i of e){const s=new rt,n=new Ae(s,this.selectionMaterial);t.add(n);const r=new Kt(i.position,3);s.setAttribute("position",r),s.computeBoundingSphere();const{area:o,perimeter:a}=i,c=this.newLabel(s,o);n.add(c.three),this.selection.push({area:o,perimeter:a,mesh:n,label:c})}}setupEvents(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the face measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown),e&&(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown))}setVisibility(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(this.world.isDisposing)return;const t=this.world.scene.three;for(const i of this.selection){const s=i.label.three;e?(t.add(i.mesh),i.mesh.add(s)):(i.mesh.removeFromParent(),s.removeFromParent())}}unselect(){this.preview.removeFromParent(),this._currentSelelection=null}updateSelection(e,t,i){if(!this.world)throw new Error("The face measurement needs a world to work!");this.world.scene.three.add(this.preview);const s=this.components.get(bs).getFace(e,t,i);if(s===null)return;const n=this.regenerateHighlight(e,s.indices,i);let r=0;for(const{distance:o}of s.edges)r+=o;this._currentSelelection={perimeter:r,area:n}}newLabel(e,t){if(!e.boundingSphere)throw new Error("Error computing area geometry");if(!this.world)throw new Error("The face measurement needs a world to work!");const{center:i}=e.boundingSphere,s=is(),n=Math.trunc(t*100)/100;s.textContent=n.toString();const r=new Zt(this.world,s);return r.three.position.copy(i),r}regenerateHighlight(e,t,i){const s=[],n=[];let r=0,o=0;const a=new ws,c=this.components.get(bs);for(const f of t){const{p1:m,p2:E,p3:g}=c.getVerticesAndNormal(e,f,i);s.push(m.x,m.y,m.z),s.push(E.x,E.y,E.z),s.push(g.x,g.y,g.z),a.set(m,E,g),o+=a.getArea(),n.push(r,r+1,r+2),r+=3}this.preview.position.set(0,0,0),this.preview.rotation.set(0,0,0),this.preview.scale.set(1,1,1),this.preview.updateMatrix(),this.preview.applyMatrix4(e.matrixWorld);const u=new Float32Array(s),d=new Kt(u,3);return this.preview.geometry.setAttribute("position",d),this.preview.geometry.setIndex(n),o}};S(cd,"uuid","30279548-1309-44f6-aa97-ce26eed73522");let d1=cd;const ud=class dd extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"preview"),S(this,"tolerance",.3),S(this,"world"),S(this,"_enabled",!1),S(this,"_lineMaterial",new rs({color:"#DC2626",linewidth:2,depthTest:!1,transparent:!0})),S(this,"create",async()=>{if(!this.preview||!this.enabled||!this.preview.visible)return;const t=this.components.get(Yn);t.world=this.world;const i=this.preview.startPoint.clone(),s=this.preview.endPoint.clone();t.createOnPoints(i,s)}),S(this,"onMouseMove",()=>{if(!this.preview)return;if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.enabled){this.preview.visible=!1;return}const t=this.components.get(li).get(this.world).castRay();if(!t||!t.object){this.preview.visible=!1;return}const{object:i,faceIndex:s,point:n}=t;if(s===void 0){this.preview.visible=!1;return}i instanceof Ae||i instanceof pi?this.updateSelection(i,n,s,t.instanceId):this.preview.visible=!1}),S(this,"onKeydown",t=>{}),this.components.add(dd.uuid,this)}set enabled(e){if(this._enabled=e,this.setupEvents(e),e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.preview){const t=document.createElement("div");t.className="w-2 h-2 bg-red-600 rounded-full",this.preview=new Ul(this.components,this.world,{start:new z,end:new z,lineMaterial:this._lineMaterial,endpointElement:t}),this.preview.visible=!1}}else this.cancelCreation()}get enabled(){return this._enabled}dispose(){this.preview&&this.preview.dispose(),this._lineMaterial.dispose(),this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.enabled)return;const e=this.components.get(Yn),t=e.enabled;e.enabled=!0,e.delete(),e.enabled=t}deleteAll(){this.components.get(Yn).deleteAll()}endCreation(){}cancelCreation(){}get(){const e=this.components.get(Yn).list,t=[];for(const i of e){const s=i.startPoint,n=i.endPoint,r=[s.x,s.y,s.z,n.x,n.y,n.z];t.push(r)}return t}set(e){const t=this.components.get(Yn);t.world=this.world;for(const i of e){const[s,n,r,o,a,c]=i,u=new z(s,n,r),d=new z(o,a,c);t.createOnPoints(u,d)}}setupEvents(e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the edge measurement needs a renderer!");const t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}updateSelection(e,t,i,s){if(!this.preview||!e.geometry.index)return;const n=this.components.get(bs).getFace(e,i,s);if(!n)return;const{edges:r}=n;let o=Number.MAX_VALUE,a=[];for(const d of r){const[f,m]=d.points,E=bs.distanceFromPointToLine(t,f,m,!0);E<this.tolerance&&E<o&&(o=E,a=d.points)}if(!a.length){this.preview.visible=!1;return}const[c,u]=a;this.preview.startPoint=c,this.preview.endPoint=u,this.preview.visible=!0}};S(ud,"uuid","e7be5749-89df-4514-8d25-83aa38ce12d8");let f1=ud;class q0 extends Gh{constructor(e,t,i){super(e,t,i),S(this,"threshold",50),S(this,"bboxThreshold",200),S(this,"maxLostTime",3e4),S(this,"maxHiddenTime",5e3),S(this,"boxes",new Map),S(this,"_staticGeometries",{culled:{},unculled:{}}),S(this,"_geometry"),S(this,"_material",new ei({transparent:!0,side:2,opacity:1})),S(this,"onViewUpdated",new Wn),S(this,"_modelIDIndex",new Map),S(this,"_indexModelID",new Map),S(this,"_nextModelID",0),S(this,"_geometries",new Map),S(this,"_geometriesGroups",new Map),S(this,"_geometriesInMemory",new Set),S(this,"_intervalID",null),S(this,"codes",new Map),S(this,"handleWorkerMessage",async n=>{const r=n.data.colors,o={},a={},c={},u={},d=performance.now();let f=!1;const m=new Set(this._geometriesInMemory);for(const[E,g]of r){const w=this._geometries.get(E);if(!w||!(g>this.threshold))continue;m.delete(E);const{exists:y}=w,I=this._indexModelID.get(w.modelIndex);y?(w.time=d,u[I]||(u[I]=new Set),u[I].add(w.geometryID),this._geometriesInMemory.add(E),f=!0):(o[I]||(o[I]=new Map),w.time=d,w.exists=!0,o[I].has(g)||o[I].set(g,new Set),o[I].get(g).add(w.geometryID),this._geometriesInMemory.add(E),f=!0)}for(const E of m){const g=this._geometries.get(E);g&&(this.handleLostGeometries(d,E,g,a,c),f=!0)}f&&await this.onViewUpdated.trigger({toLoad:o,toRemove:a,toHide:c,toShow:u}),this._isWorkerBusy=!1}),this.updateInterval=500,this._geometry=new Rt(1,1,1),this._geometry.groups=[],this._geometry.deleteAttribute("uv");const s=this._geometry.attributes.position.array;for(let n=0;n<s.length;n++)s[n]+=.5;this._geometry.attributes.position.needsUpdate=!0,this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._intervalID=window.setInterval(this.updateVisibility,this.updateInterval))}dispose(){super.dispose(),this.onViewUpdated.reset(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null);for(const[e,t]of this._geometriesGroups){t.removeFromParent();const i=[...t.children];for(const s of i)s.removeFromParent()}this._geometriesGroups.clear();for(const[e,t]of this.boxes)t.dispose(!0);this.boxes.clear();for(const[e,t]of this._geometries)t.fragment&&(t.fragment.dispose(!0),t.fragment=void 0);this._geometries.clear(),this._staticGeometries={culled:{},unculled:{}},this._geometry.dispose(),this._material.dispose(),this._modelIDIndex.clear(),this._indexModelID.clear(),this.codes.clear()}add(e,t,i){const s=this.createModelIndex(e),n=Bi.enabled;Bi.enabled=!1;const r=new Map,o=new Ne,a=new go(this._geometry,this._material,10);this.boxes.set(s,a),this.scene.add(a.mesh);const c=new Eo;this.scene.add(c),this._geometriesGroups.set(s,c);const u=new Map;for(const f of t)for(const m of f.geometries){const{geometryID:E,transformation:g,color:w}=m,y=new Ht;y.setRGB(w[0],w[1],w[2],"srgb");const I=this.getInstanceID(f.id,E),_=i[E];if(!_){console.log(`Geometry not found: ${E}`);continue}const{boundingBox:C}=_;let F;r.has(E)?F=r.get(E):(F=this.getAvailableColor(),this.increaseColor(),r.set(E,F));const{r:M,g:D,b:B,code:N}=F,G=new Ht;G.setRGB(M/255,D/255,B/255,"srgb"),this.codes.has(s)||this.codes.set(s,new Map),this.codes.get(s).set(E,N);const Q=new Ne,O=Object.values(C);if(Q.fromArray(g),o.fromArray(O),Q.multiply(o),u.has(I)){const V=u.get(I);if(V===void 0||!V.colors)throw new Error("Malformed item!");V.colors.push(G),V.geometryColors.push(y),V.transforms.push(Q)}else u.set(I,{id:I,colors:[G],geometryColors:[y],transforms:[Q]});if(this._geometries.has(N))this._geometries.get(N).assetIDs.add(f.id);else{const V=new Set([f.id]);this._geometries.set(N,{modelIndex:s,geometryID:E,assetIDs:V,exists:!1,hidden:!1,time:0})}}const d=Array.from(u.values());a.add(d),Bi.enabled=n}remove(e){const t=this._modelIDIndex.get(e);if(t===void 0)throw new Error("Model doesn't exist!");const i=this._geometriesGroups.get(t);i.removeFromParent();const s=[...i.children];for(const r of s)r.removeFromParent();this._geometriesGroups.delete(t),this.boxes.get(t).dispose(!1),this.boxes.delete(t);const n=this.codes.get(t);this.codes.delete(t);for(const[r,o]of n){const a=this._geometries.get(o);a&&a.fragment&&(a.fragment.dispose(!1),a.fragment=void 0),this._geometries.delete(o)}this._modelIDIndex.delete(e),this._indexModelID.delete(t),this._geometriesInMemory.clear()}addFragment(e,t,i){const s=Bi.enabled;Bi.enabled=!1;const n=this._modelIDIndex.get(e),r=this.codes.get(n).get(t),o=this._geometries.get(r);if(this.setGeometryVisibility(o,!1,!1),!o.fragment){o.fragment=new go(i.mesh.geometry,this._material,i.capacity);const f=this._geometriesGroups.get(n);if(!f)throw new Error("Group not found!");f.add(o.fragment.mesh)}const[a,c,u]=r.split("-").map(f=>parseInt(f,10)),d=[];for(const f of i.ids){const m=i.get(f);if(!m.colors)throw new Error("Malformed fragments!");for(const E of m.colors)E.setRGB(a/255,c/255,u/255,"srgb");d.push(m)}o.fragment.add(d),Bi.enabled=s,this.needsUpdate=!0}removeFragment(e,t){const i=this._modelIDIndex.get(e),s=this.codes.get(i).get(t),n=this._geometries.get(s);if(n.hidden||this.setGeometryVisibility(n,!0,!1),n.fragment){const{fragment:r}=n;r.dispose(!1),n.fragment=void 0}}setModelTransformation(e,t){const i=this._modelIDIndex.get(e);if(i===void 0)throw new Error("Model not found!");const s=this.boxes.get(i);s&&(s.mesh.position.set(0,0,0),s.mesh.rotation.set(0,0,0),s.mesh.scale.set(1,1,1),s.mesh.applyMatrix4(t));const n=this._geometriesGroups.get(i);n&&(n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),n.applyMatrix4(t))}setVisibility(e,t,i){const s=this._modelIDIndex.get(t);if(s!==void 0)for(const[n,r]of i){const o=this.codes.get(s);if(o===void 0)throw new Error("Map not found!");const a=o.get(n),c=this._geometries.get(a);if(c===void 0)throw new Error("Geometry not found!");c.hidden=!e,this.setGeometryVisibility(c,e,!0,r)}}updateTransformations(e){const t=this._modelIDIndex.get(e);if(t===void 0)return;const i=this.components.get(Ze).groups.get(e);if(i){i.updateWorldMatrix(!0,!1),i.updateMatrix();const s=this.boxes.get(t);s&&(s.mesh.position.set(0,0,0),s.mesh.rotation.set(0,0,0),s.mesh.scale.set(1,1,1),s.mesh.updateMatrix(),s.mesh.applyMatrix4(i.matrixWorld),s.mesh.updateMatrix());const n=this._geometriesGroups.get(t);n&&(n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),n.updateMatrix(),n.applyMatrix4(i.matrixWorld),n.updateMatrix())}}async addStaticGeometries(e,t=!0){const i={data:{colors:new Map}},s=this.threshold+1e3;for(const n in e){const r=this._modelIDIndex.get(n);if(r===void 0)continue;const o=this.codes.get(r);if(!o)continue;const a=e[n];for(const c of a){const u=o.get(c);if(!u)continue;const d=this._geometries.get(u);if(!d)continue;d.exists=!0,t||(d.hidden=!1,d.time=performance.now(),i.data.colors.set(u,s)),this._geometriesInMemory.add(u);const f=t?this._staticGeometries.culled:this._staticGeometries.unculled;f[n]||(f[n]=new Set),f[n].add(c)}}t||await this.handleWorkerMessage(i)}removeStaticGeometries(e,t){const i=[];t===void 0?i.push("culled","unculled"):t===!0?i.push("culled"):i.push("unculled");for(const s in e){const n=e[s];for(const r of i){const o=this._staticGeometries[r][s];if(o)for(const a of n)o.delete(a)}}}setGeometryVisibility(e,t,i,s){const{modelIndex:n,geometryID:r,assetIDs:o}=e,a=this.boxes.get(n);if(a===void 0)throw new Error("Model not found!");const c=s||o;if(i&&e.fragment)e.fragment.setVisibility(t,c);else{const u=new Set;for(const d of c){const f=this.getInstanceID(d,r);u.add(f)}a.setVisibility(t,u)}}handleLostGeometries(e,t,i,s,n){var r,o,a;const c=this._indexModelID.get(i.modelIndex),u=e-i.time,{culled:d,unculled:f}=this._staticGeometries;if(u>this.maxLostTime){if((r=d[c])!=null&&r.has(i.geometryID)||(o=f[c])!=null&&o.has(i.geometryID))return;s[c]||(s[c]=new Set),i.exists=!1,s[c].add(i.geometryID),this._geometriesInMemory.delete(t)}else if(u>this.maxHiddenTime){if((a=f[c])!=null&&a.has(i.geometryID))return;n[c]||(n[c]=new Set),n[c].add(i.geometryID)}}createModelIndex(e){if(this._modelIDIndex.has(e))throw new Error("Can't load the same model twice!");const t=this._nextModelID;return this._nextModelID++,this._modelIDIndex.set(e,t),this._indexModelID.set(t,e),t}getInstanceID(e,t){const i=10**(Math.log(t)*Math.LOG10E+1|0);return e+t/i}}var fd={exports:{}};(function(l,e){(function(t,i){l.exports=i()})(gh,function(){var t=function(h,p){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,b){v.__proto__=b}||function(v,b){for(var A in b)Object.prototype.hasOwnProperty.call(b,A)&&(v[A]=b[A])})(h,p)},i=function(){return(i=Object.assign||function(h){for(var p,v=1,b=arguments.length;v<b;v++)for(var A in p=arguments[v])Object.prototype.hasOwnProperty.call(p,A)&&(h[A]=p[A]);return h}).apply(this,arguments)};function s(h,p,v){for(var b,A=0,P=p.length;A<P;A++)!b&&A in p||((b=b||Array.prototype.slice.call(p,0,A))[A]=p[A]);return h.concat(b||Array.prototype.slice.call(p))}var n=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:gh,r=Object.keys,o=Array.isArray;function a(h,p){return typeof p!="object"||r(p).forEach(function(v){h[v]=p[v]}),h}typeof Promise>"u"||n.Promise||(n.Promise=Promise);var c=Object.getPrototypeOf,u={}.hasOwnProperty;function d(h,p){return u.call(h,p)}function f(h,p){typeof p=="function"&&(p=p(c(h))),(typeof Reflect>"u"?r:Reflect.ownKeys)(p).forEach(function(v){E(h,v,p[v])})}var m=Object.defineProperty;function E(h,p,v,b){m(h,p,a(v&&d(v,"get")&&typeof v.get=="function"?{get:v.get,set:v.set,configurable:!0}:{value:v,configurable:!0,writable:!0},b))}function g(h){return{from:function(p){return h.prototype=Object.create(p.prototype),E(h.prototype,"constructor",h),{extend:f.bind(null,h.prototype)}}}}var w=Object.getOwnPropertyDescriptor,y=[].slice;function I(h,p,v){return y.call(h,p,v)}function _(h,p){return p(h)}function C(h){if(!h)throw new Error("Assertion Failed")}function F(h){n.setImmediate?setImmediate(h):setTimeout(h,0)}function M(h,p){if(typeof p=="string"&&d(h,p))return h[p];if(!p)return h;if(typeof p!="string"){for(var v=[],b=0,A=p.length;b<A;++b){var P=M(h,p[b]);v.push(P)}return v}var L=p.indexOf(".");if(L!==-1){var Y=h[p.substr(0,L)];return Y==null?void 0:M(Y,p.substr(L+1))}}function D(h,p,v){if(h&&p!==void 0&&!("isFrozen"in Object&&Object.isFrozen(h)))if(typeof p!="string"&&"length"in p){C(typeof v!="string"&&"length"in v);for(var b=0,A=p.length;b<A;++b)D(h,p[b],v[b])}else{var P,L,Y=p.indexOf(".");Y!==-1?(P=p.substr(0,Y),(L=p.substr(Y+1))===""?v===void 0?o(h)&&!isNaN(parseInt(P))?h.splice(P,1):delete h[P]:h[P]=v:D(Y=!(Y=h[P])||!d(h,P)?h[P]={}:Y,L,v)):v===void 0?o(h)&&!isNaN(parseInt(p))?h.splice(p,1):delete h[p]:h[p]=v}}function B(h){var p,v={};for(p in h)d(h,p)&&(v[p]=h[p]);return v}var N=[].concat;function G(h){return N.apply([],h)}var Oi="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(G([8,16,32,64].map(function(h){return["Int","Uint","Float"].map(function(p){return p+h+"Array"})}))).filter(function(h){return n[h]}),Q=new Set(Oi.map(function(h){return n[h]})),O=null;function V(h){return O=new WeakMap,h=function p(v){if(!v||typeof v!="object")return v;var b=O.get(v);if(b)return b;if(o(v)){b=[],O.set(v,b);for(var A=0,P=v.length;A<P;++A)b.push(p(v[A]))}else if(Q.has(v.constructor))b=v;else{var L,Y=c(v);for(L in b=Y===Object.prototype?{}:Object.create(Y),O.set(v,b),v)d(v,L)&&(b[L]=p(v[L]))}return b}(h),O=null,h}var T={}.toString;function J(h){return T.call(h).slice(8,-1)}var de=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ie=typeof de=="symbol"?function(h){var p;return h!=null&&(p=h[de])&&p.apply(h)}:function(){return null};function ve(h,p){return p=h.indexOf(p),0<=p&&h.splice(p,1),0<=p}var ue={};function De(h){var p,v,b,A;if(arguments.length===1){if(o(h))return h.slice();if(this===ue&&typeof h=="string")return[h];if(A=ie(h)){for(v=[];!(b=A.next()).done;)v.push(b.value);return v}if(h==null)return[h];if(typeof(p=h.length)!="number")return[h];for(v=new Array(p);p--;)v[p]=h[p];return v}for(p=arguments.length,v=new Array(p);p--;)v[p]=arguments[p];return v}var oe=typeof Symbol<"u"?function(h){return h[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Te=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ti=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Te),re={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Me(h,p){this.name=h,this.message=p}function Oe(h,p){return h+". Errors: "+Object.keys(p).map(function(v){return p[v].toString()}).filter(function(v,b,A){return A.indexOf(v)===b}).join(`
`)}function xe(h,p,v,b){this.failures=p,this.failedKeys=b,this.successCount=v,this.message=Oe(h,p)}function it(h,p){this.name="BulkError",this.failures=Object.keys(p).map(function(v){return p[v]}),this.failuresByPos=p,this.message=Oe(h,this.failures)}g(Me).from(Error).extend({toString:function(){return this.name+": "+this.message}}),g(xe).from(Me),g(it).from(Me);var at=ti.reduce(function(h,p){return h[p]=p+"Error",h},{}),Be=Me,ye=ti.reduce(function(h,p){var v=p+"Error";function b(A,P){this.name=v,A?typeof A=="string"?(this.message="".concat(A).concat(P?`
 `+P:""),this.inner=P||null):typeof A=="object"&&(this.message="".concat(A.name," ").concat(A.message),this.inner=A):(this.message=re[p]||v,this.inner=null)}return g(b).from(Be),h[p]=b,h},{});ye.Syntax=SyntaxError,ye.Type=TypeError,ye.Range=RangeError;var Ye=Te.reduce(function(h,p){return h[p+"Error"]=ye[p],h},{}),Je=ti.reduce(function(h,p){return["Syntax","Type","Range"].indexOf(p)===-1&&(h[p+"Error"]=ye[p]),h},{});function He(){}function vt(h){return h}function x(h,p){return h==null||h===vt?p:function(v){return p(h(v))}}function fe(h,p){return function(){h.apply(this,arguments),p.apply(this,arguments)}}function he(h,p){return h===He?p:function(){var v=h.apply(this,arguments);v!==void 0&&(arguments[0]=v);var b=this.onsuccess,A=this.onerror;this.onsuccess=null,this.onerror=null;var P=p.apply(this,arguments);return b&&(this.onsuccess=this.onsuccess?fe(b,this.onsuccess):b),A&&(this.onerror=this.onerror?fe(A,this.onerror):A),P!==void 0?P:v}}function k(h,p){return h===He?p:function(){h.apply(this,arguments);var v=this.onsuccess,b=this.onerror;this.onsuccess=this.onerror=null,p.apply(this,arguments),v&&(this.onsuccess=this.onsuccess?fe(v,this.onsuccess):v),b&&(this.onerror=this.onerror?fe(b,this.onerror):b)}}function U(h,p){return h===He?p:function(v){var b=h.apply(this,arguments);a(v,b);var A=this.onsuccess,P=this.onerror;return this.onsuccess=null,this.onerror=null,v=p.apply(this,arguments),A&&(this.onsuccess=this.onsuccess?fe(A,this.onsuccess):A),P&&(this.onerror=this.onerror?fe(P,this.onerror):P),b===void 0?v===void 0?void 0:v:a(b,v)}}function q(h,p){return h===He?p:function(){return p.apply(this,arguments)!==!1&&h.apply(this,arguments)}}function Ee(h,p){return h===He?p:function(){var v=h.apply(this,arguments);if(v&&typeof v.then=="function"){for(var b=this,A=arguments.length,P=new Array(A);A--;)P[A]=arguments[A];return v.then(function(){return p.apply(b,P)})}return p.apply(this,arguments)}}Je.ModifyError=xe,Je.DexieError=Me,Je.BulkError=it;var ge=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function se(h){ge=h}var Ie={},Pe=100,Oi=typeof Promise>"u"?[]:function(){var h=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[h,c(h),h];var p=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[p,c(p),h]}(),Te=Oi[0],ti=Oi[1],Oi=Oi[2],ti=ti&&ti.then,Ue=Te&&Te.constructor,st=!!Oi,We=function(h,p){Bt.push([h,p]),gi&&(queueMicrotask(wd),gi=!1)},Pt=!0,gi=!0,Tt=[],Ei=[],ct=vt,Xt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:He,pgp:!1,env:{},finalize:He},Le=Xt,Bt=[],vi=0,Ss=[];function Se(h){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var p=this._PSD=Le;if(typeof h!="function"){if(h!==Ie)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Fi(this,this._value))}this._state=null,this._value=null,++p.ref,function v(b,A){try{A(function(P){if(b._state===null){if(P===b)throw new TypeError("A promise cannot be resolved with itself.");var L=b._lib&&Os();P&&typeof P.then=="function"?v(b,function(Y,Z){P instanceof Se?P._then(Y,Z):P.then(Y,Z)}):(b._state=!0,b._value=P,as(b)),L&&Ps()}},Fi.bind(null,b))}catch(P){Fi(b,P)}}(this,h)}var pn={get:function(){var h=Le,p=or;function v(b,A){var P=this,L=!h.global&&(h!==Le||p!==or),Y=L&&!Hi(),Z=new Se(function(j,$){Do(P,new mn(zl(b,h,L,Y),zl(A,h,L,Y),j,$,h))});return this._consoleTask&&(Z._consoleTask=this._consoleTask),Z}return v.prototype=Ie,v},set:function(h){E(this,"then",h&&h.prototype===Ie?pn:{get:function(){return h},set:pn.set})}};function mn(h,p,v,b,A){this.onFulfilled=typeof h=="function"?h:null,this.onRejected=typeof p=="function"?p:null,this.resolve=v,this.reject=b,this.psd=A}function Fi(h,p){var v,b;Ei.push(p),h._state===null&&(v=h._lib&&Os(),p=ct(p),h._state=!1,h._value=p,b=h,Tt.some(function(A){return A._value===b._value})||Tt.push(b),as(h),v&&Ps())}function as(h){var p=h._listeners;h._listeners=[];for(var v=0,b=p.length;v<b;++v)Do(h,p[v]);var A=h._PSD;--A.ref||A.finalize(),vi===0&&(++vi,We(function(){--vi==0&&Mo()},[]))}function Do(h,p){if(h._state!==null){var v=h._state?p.onFulfilled:p.onRejected;if(v===null)return(h._state?p.resolve:p.reject)(h._value);++p.psd.ref,++vi,We(vd,[v,h,p])}else h._listeners.push(p)}function vd(h,p,v){try{var b,A=p._value;!p._state&&Ei.length&&(Ei=[]),b=ge&&p._consoleTask?p._consoleTask.run(function(){return h(A)}):h(A),p._state||Ei.indexOf(A)!==-1||function(P){for(var L=Tt.length;L;)if(Tt[--L]._value===P._value)return Tt.splice(L,1)}(p),v.resolve(b)}catch(P){v.reject(P)}finally{--vi==0&&Mo(),--v.psd.ref||v.psd.finalize()}}function wd(){ls(Xt,function(){Os()&&Ps()})}function Os(){var h=Pt;return gi=Pt=!1,h}function Ps(){var h,p,v;do for(;0<Bt.length;)for(h=Bt,Bt=[],v=h.length,p=0;p<v;++p){var b=h[p];b[0].apply(null,b[1])}while(0<Bt.length);gi=Pt=!0}function Mo(){var h=Tt;Tt=[],h.forEach(function(b){b._PSD.onunhandled.call(null,b._value,b)});for(var p=Ss.slice(0),v=p.length;v;)p[--v]()}function sr(h){return new Se(Ie,!1,h)}function pt(h,p){var v=Le;return function(){var b=Os(),A=Le;try{return ji(v,!0),h.apply(this,arguments)}catch(P){p&&p(P)}finally{ji(A,!1),b&&Ps()}}}f(Se.prototype,{then:pn,_then:function(h,p){Do(this,new mn(null,null,h,p,Le))},catch:function(h){if(arguments.length===1)return this.then(null,h);var p=h,v=arguments[1];return typeof p=="function"?this.then(null,function(b){return(b instanceof p?v:sr)(b)}):this.then(null,function(b){return(b&&b.name===p?v:sr)(b)})},finally:function(h){return this.then(function(p){return Se.resolve(h()).then(function(){return p})},function(p){return Se.resolve(h()).then(function(){return sr(p)})})},timeout:function(h,p){var v=this;return h<1/0?new Se(function(b,A){var P=setTimeout(function(){return A(new ye.Timeout(p))},h);v.then(b,A).finally(clearTimeout.bind(null,P))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&E(Se.prototype,Symbol.toStringTag,"Dexie.Promise"),Xt.env=kl(),f(Se,{all:function(){var h=De.apply(null,arguments).map(ar);return new Se(function(p,v){h.length===0&&p([]);var b=h.length;h.forEach(function(A,P){return Se.resolve(A).then(function(L){h[P]=L,--b||p(h)},v)})})},resolve:function(h){return h instanceof Se?h:h&&typeof h.then=="function"?new Se(function(p,v){h.then(p,v)}):new Se(Ie,!0,h)},reject:sr,race:function(){var h=De.apply(null,arguments).map(ar);return new Se(function(p,v){h.map(function(b){return Se.resolve(b).then(p,v)})})},PSD:{get:function(){return Le},set:function(h){return Le=h}},totalEchoes:{get:function(){return or}},newPSD:Gi,usePSD:ls,scheduler:{get:function(){return We},set:function(h){We=h}},rejectionMapper:{get:function(){return ct},set:function(h){ct=h}},follow:function(h,p){return new Se(function(v,b){return Gi(function(A,P){var L=Le;L.unhandleds=[],L.onunhandled=P,L.finalize=fe(function(){var Y,Z=this;Y=function(){Z.unhandleds.length===0?A():P(Z.unhandleds[0])},Ss.push(function j(){Y(),Ss.splice(Ss.indexOf(j),1)}),++vi,We(function(){--vi==0&&Mo()},[])},L.finalize),h()},p,v,b)})}}),Ue&&(Ue.allSettled&&E(Se,"allSettled",function(){var h=De.apply(null,arguments).map(ar);return new Se(function(p){h.length===0&&p([]);var v=h.length,b=new Array(v);h.forEach(function(A,P){return Se.resolve(A).then(function(L){return b[P]={status:"fulfilled",value:L}},function(L){return b[P]={status:"rejected",reason:L}}).then(function(){return--v||p(b)})})})}),Ue.any&&typeof AggregateError<"u"&&E(Se,"any",function(){var h=De.apply(null,arguments).map(ar);return new Se(function(p,v){h.length===0&&v(new AggregateError([]));var b=h.length,A=new Array(b);h.forEach(function(P,L){return Se.resolve(P).then(function(Y){return p(Y)},function(Y){A[L]=Y,--b||v(new AggregateError(A))})})})}));var xt={awaits:0,echoes:0,id:0},yd=0,nr=[],rr=0,or=0,Id=0;function Gi(h,p,v,b){var A=Le,P=Object.create(A);return P.parent=A,P.ref=0,P.global=!1,P.id=++Id,Xt.env,P.env=st?{Promise:Se,PromiseProp:{value:Se,configurable:!0,writable:!0},all:Se.all,race:Se.race,allSettled:Se.allSettled,any:Se.any,resolve:Se.resolve,reject:Se.reject}:{},p&&a(P,p),++A.ref,P.finalize=function(){--this.parent.ref||this.parent.finalize()},b=ls(P,h,v,b),P.ref===0&&P.finalize(),b}function Ds(){return xt.id||(xt.id=++yd),++xt.awaits,xt.echoes+=Pe,xt.id}function Hi(){return!!xt.awaits&&(--xt.awaits==0&&(xt.id=0),xt.echoes=xt.awaits*Pe,!0)}function ar(h){return xt.echoes&&h&&h.constructor===Ue?(Ds(),h.then(function(p){return Hi(),p},function(p){return Hi(),wt(p)})):h}function Cd(){var h=nr[nr.length-1];nr.pop(),ji(h,!1)}function ji(h,p){var v,b=Le;(p?!xt.echoes||rr++&&h===Le:!rr||--rr&&h===Le)||queueMicrotask(p?(function(A){++or,xt.echoes&&--xt.echoes!=0||(xt.echoes=xt.awaits=xt.id=0),nr.push(Le),ji(A,!0)}).bind(null,h):Cd),h!==Le&&(Le=h,b===Xt&&(Xt.env=kl()),st&&(v=Xt.env.Promise,p=h.env,(b.global||h.global)&&(Object.defineProperty(n,"Promise",p.PromiseProp),v.all=p.all,v.race=p.race,v.resolve=p.resolve,v.reject=p.reject,p.allSettled&&(v.allSettled=p.allSettled),p.any&&(v.any=p.any))))}function kl(){var h=n.Promise;return st?{Promise:h,PromiseProp:Object.getOwnPropertyDescriptor(n,"Promise"),all:h.all,race:h.race,allSettled:h.allSettled,any:h.any,resolve:h.resolve,reject:h.reject}:{}}function ls(h,p,v,b,A){var P=Le;try{return ji(h,!0),p(v,b,A)}finally{ji(P,!1)}}function zl(h,p,v,b){return typeof h!="function"?h:function(){var A=Le;v&&Ds(),ji(p,!0);try{return h.apply(this,arguments)}finally{ji(A,!1),b&&queueMicrotask(Hi)}}}function Lo(h){Promise===Ue&&xt.echoes===0?rr===0?h():enqueueNativeMicroTask(h):setTimeout(h,0)}(""+ti).indexOf("[native code]")===-1&&(Ds=Hi=He);var wt=Se.reject,cs="￿",Si="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Vl="String expected.",Ms=[],lr="__dbnames",No="readonly",Uo="readwrite";function hs(h,p){return h?p?function(){return h.apply(this,arguments)&&p.apply(this,arguments)}:h:p}var Yl={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function cr(h){return typeof h!="string"||/\./.test(h)?function(p){return p}:function(p){return p[h]===void 0&&h in p&&delete(p=V(p))[h],p}}function Gl(){throw ye.Type()}function $e(h,p){try{var v=Hl(h),b=Hl(p);if(v!==b)return v==="Array"?1:b==="Array"?-1:v==="binary"?1:b==="binary"?-1:v==="string"?1:b==="string"?-1:v==="Date"?1:b!=="Date"?NaN:-1;switch(v){case"number":case"Date":case"string":return p<h?1:h<p?-1:0;case"binary":return function(A,P){for(var L=A.length,Y=P.length,Z=L<Y?L:Y,j=0;j<Z;++j)if(A[j]!==P[j])return A[j]<P[j]?-1:1;return L===Y?0:L<Y?-1:1}(jl(h),jl(p));case"Array":return function(A,P){for(var L=A.length,Y=P.length,Z=L<Y?L:Y,j=0;j<Z;++j){var $=$e(A[j],P[j]);if($!==0)return $}return L===Y?0:L<Y?-1:1}(h,p)}}catch{}return NaN}function Hl(h){var p=typeof h;return p!="object"?p:ArrayBuffer.isView(h)?"binary":(h=J(h),h==="ArrayBuffer"?"binary":h)}function jl(h){return h instanceof Uint8Array?h:ArrayBuffer.isView(h)?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):new Uint8Array(h)}var Wl=(ht.prototype._trans=function(h,p,v){var b=this._tx||Le.trans,A=this.name,P=ge&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(h==="readonly"?"read":"write"," ").concat(this.name));function L(j,$,H){if(!H.schema[A])throw new ye.NotFound("Table "+A+" not part of transaction");return p(H.idbtrans,H)}var Y=Os();try{var Z=b&&b.db._novip===this.db._novip?b===Le.trans?b._promise(h,L,v):Gi(function(){return b._promise(h,L,v)},{trans:b,transless:Le.transless||Le}):function j($,H,ee,W){if($.idbdb&&($._state.openComplete||Le.letThrough||$._vip)){var K=$._createTransaction(H,ee,$._dbSchema);try{K.create(),$._state.PR1398_maxLoop=3}catch(te){return te.name===at.InvalidState&&$.isOpen()&&0<--$._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),$.close({disableAutoOpen:!1}),$.open().then(function(){return j($,H,ee,W)})):wt(te)}return K._promise(H,function(te,X){return Gi(function(){return Le.trans=K,W(te,X,K)})}).then(function(te){if(H==="readwrite")try{K.idbtrans.commit()}catch{}return H==="readonly"?te:K._completion.then(function(){return te})})}if($._state.openComplete)return wt(new ye.DatabaseClosed($._state.dbOpenError));if(!$._state.isBeingOpened){if(!$._state.autoOpen)return wt(new ye.DatabaseClosed);$.open().catch(He)}return $._state.dbReadyPromise.then(function(){return j($,H,ee,W)})}(this.db,h,[this.name],L);return P&&(Z._consoleTask=P,Z=Z.catch(function(j){return console.trace(j),wt(j)})),Z}finally{Y&&Ps()}},ht.prototype.get=function(h,p){var v=this;return h&&h.constructor===Object?this.where(h).first(p):h==null?wt(new ye.Type("Invalid argument to Table.get()")):this._trans("readonly",function(b){return v.core.get({trans:b,key:h}).then(function(A){return v.hook.reading.fire(A)})}).then(p)},ht.prototype.where=function(h){if(typeof h=="string")return new this.db.WhereClause(this,h);if(o(h))return new this.db.WhereClause(this,"[".concat(h.join("+"),"]"));var p=r(h);if(p.length===1)return this.where(p[0]).equals(h[p[0]]);var v=this.schema.indexes.concat(this.schema.primKey).filter(function(Z){if(Z.compound&&p.every(function($){return 0<=Z.keyPath.indexOf($)})){for(var j=0;j<p.length;++j)if(p.indexOf(Z.keyPath[j])===-1)return!1;return!0}return!1}).sort(function(Z,j){return Z.keyPath.length-j.keyPath.length})[0];if(v&&this.db._maxKey!==cs){var L=v.keyPath.slice(0,p.length);return this.where(L).equals(L.map(function(j){return h[j]}))}!v&&ge&&console.warn("The query ".concat(JSON.stringify(h)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(p.join("+"),"]"));var b=this.schema.idxByName,A=this.db._deps.indexedDB;function P(Z,j){return A.cmp(Z,j)===0}var Y=p.reduce(function(ee,j){var $=ee[0],H=ee[1],ee=b[j],W=h[j];return[$||ee,$||!ee?hs(H,ee&&ee.multi?function(K){return K=M(K,j),o(K)&&K.some(function(te){return P(W,te)})}:function(K){return P(W,M(K,j))}):H]},[null,null]),L=Y[0],Y=Y[1];return L?this.where(L.name).equals(h[L.keyPath]).filter(Y):v?this.filter(Y):this.where(p).equals("")},ht.prototype.filter=function(h){return this.toCollection().and(h)},ht.prototype.count=function(h){return this.toCollection().count(h)},ht.prototype.offset=function(h){return this.toCollection().offset(h)},ht.prototype.limit=function(h){return this.toCollection().limit(h)},ht.prototype.each=function(h){return this.toCollection().each(h)},ht.prototype.toArray=function(h){return this.toCollection().toArray(h)},ht.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},ht.prototype.orderBy=function(h){return new this.db.Collection(new this.db.WhereClause(this,o(h)?"[".concat(h.join("+"),"]"):h))},ht.prototype.reverse=function(){return this.toCollection().reverse()},ht.prototype.mapToClass=function(h){var p,v=this.db,b=this.name;function A(){return p!==null&&p.apply(this,arguments)||this}(this.schema.mappedClass=h).prototype instanceof Gl&&(function(Z,j){if(typeof j!="function"&&j!==null)throw new TypeError("Class extends value "+String(j)+" is not a constructor or null");function $(){this.constructor=Z}t(Z,j),Z.prototype=j===null?Object.create(j):($.prototype=j.prototype,new $)}(A,p=h),Object.defineProperty(A.prototype,"db",{get:function(){return v},enumerable:!1,configurable:!0}),A.prototype.table=function(){return b},h=A);for(var P=new Set,L=h.prototype;L;L=c(L))Object.getOwnPropertyNames(L).forEach(function(Z){return P.add(Z)});function Y(Z){if(!Z)return Z;var j,$=Object.create(h.prototype);for(j in Z)if(!P.has(j))try{$[j]=Z[j]}catch{}return $}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=Y,this.hook("reading",Y),h},ht.prototype.defineClass=function(){return this.mapToClass(function(h){a(this,h)})},ht.prototype.add=function(h,p){var v=this,b=this.schema.primKey,A=b.auto,P=b.keyPath,L=h;return P&&A&&(L=cr(P)(h)),this._trans("readwrite",function(Y){return v.core.mutate({trans:Y,type:"add",keys:p!=null?[p]:null,values:[L]})}).then(function(Y){return Y.numFailures?Se.reject(Y.failures[0]):Y.lastResult}).then(function(Y){if(P)try{D(h,P,Y)}catch{}return Y})},ht.prototype.update=function(h,p){return typeof h!="object"||o(h)?this.where(":id").equals(h).modify(p):(h=M(h,this.schema.primKey.keyPath),h===void 0?wt(new ye.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(h).modify(p))},ht.prototype.put=function(h,p){var v=this,b=this.schema.primKey,A=b.auto,P=b.keyPath,L=h;return P&&A&&(L=cr(P)(h)),this._trans("readwrite",function(Y){return v.core.mutate({trans:Y,type:"put",values:[L],keys:p!=null?[p]:null})}).then(function(Y){return Y.numFailures?Se.reject(Y.failures[0]):Y.lastResult}).then(function(Y){if(P)try{D(h,P,Y)}catch{}return Y})},ht.prototype.delete=function(h){var p=this;return this._trans("readwrite",function(v){return p.core.mutate({trans:v,type:"delete",keys:[h]})}).then(function(v){return v.numFailures?Se.reject(v.failures[0]):void 0})},ht.prototype.clear=function(){var h=this;return this._trans("readwrite",function(p){return h.core.mutate({trans:p,type:"deleteRange",range:Yl})}).then(function(p){return p.numFailures?Se.reject(p.failures[0]):void 0})},ht.prototype.bulkGet=function(h){var p=this;return this._trans("readonly",function(v){return p.core.getMany({keys:h,trans:v}).then(function(b){return b.map(function(A){return p.hook.reading.fire(A)})})})},ht.prototype.bulkAdd=function(h,p,v){var b=this,A=Array.isArray(p)?p:void 0,P=(v=v||(A?void 0:p))?v.allKeys:void 0;return this._trans("readwrite",function(L){var j=b.schema.primKey,Y=j.auto,j=j.keyPath;if(j&&A)throw new ye.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(A&&A.length!==h.length)throw new ye.InvalidArgument("Arguments objects and keys must have the same length");var Z=h.length,j=j&&Y?h.map(cr(j)):h;return b.core.mutate({trans:L,type:"add",keys:A,values:j,wantResults:P}).then(function(K){var H=K.numFailures,ee=K.results,W=K.lastResult,K=K.failures;if(H===0)return P?ee:W;throw new it("".concat(b.name,".bulkAdd(): ").concat(H," of ").concat(Z," operations failed"),K)})})},ht.prototype.bulkPut=function(h,p,v){var b=this,A=Array.isArray(p)?p:void 0,P=(v=v||(A?void 0:p))?v.allKeys:void 0;return this._trans("readwrite",function(L){var j=b.schema.primKey,Y=j.auto,j=j.keyPath;if(j&&A)throw new ye.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(A&&A.length!==h.length)throw new ye.InvalidArgument("Arguments objects and keys must have the same length");var Z=h.length,j=j&&Y?h.map(cr(j)):h;return b.core.mutate({trans:L,type:"put",keys:A,values:j,wantResults:P}).then(function(K){var H=K.numFailures,ee=K.results,W=K.lastResult,K=K.failures;if(H===0)return P?ee:W;throw new it("".concat(b.name,".bulkPut(): ").concat(H," of ").concat(Z," operations failed"),K)})})},ht.prototype.bulkUpdate=function(h){var p=this,v=this.core,b=h.map(function(L){return L.key}),A=h.map(function(L){return L.changes}),P=[];return this._trans("readwrite",function(L){return v.getMany({trans:L,keys:b,cache:"clone"}).then(function(Y){var Z=[],j=[];h.forEach(function(H,ee){var W=H.key,K=H.changes,te=Y[ee];if(te){for(var X=0,ne=Object.keys(K);X<ne.length;X++){var ae=ne[X],ce=K[ae];if(ae===p.schema.primKey.keyPath){if($e(ce,W)!==0)throw new ye.Constraint("Cannot update primary key in bulkUpdate()")}else D(te,ae,ce)}P.push(ee),Z.push(W),j.push(te)}});var $=Z.length;return v.mutate({trans:L,type:"put",keys:Z,values:j,updates:{keys:b,changeSpecs:A}}).then(function(H){var ee=H.numFailures,W=H.failures;if(ee===0)return $;for(var K=0,te=Object.keys(W);K<te.length;K++){var X,ne=te[K],ae=P[Number(ne)];ae!=null&&(X=W[ne],delete W[ne],W[ae]=X)}throw new it("".concat(p.name,".bulkUpdate(): ").concat(ee," of ").concat($," operations failed"),W)})})})},ht.prototype.bulkDelete=function(h){var p=this,v=h.length;return this._trans("readwrite",function(b){return p.core.mutate({trans:b,type:"delete",keys:h})}).then(function(L){var A=L.numFailures,P=L.lastResult,L=L.failures;if(A===0)return P;throw new it("".concat(p.name,".bulkDelete(): ").concat(A," of ").concat(v," operations failed"),L)})},ht);function ht(){}function gn(h){function p(L,Y){if(Y){for(var Z=arguments.length,j=new Array(Z-1);--Z;)j[Z-1]=arguments[Z];return v[L].subscribe.apply(null,j),h}if(typeof L=="string")return v[L]}var v={};p.addEventType=P;for(var b=1,A=arguments.length;b<A;++b)P(arguments[b]);return p;function P(L,Y,Z){if(typeof L!="object"){var j;Y=Y||q;var $={subscribers:[],fire:Z=Z||He,subscribe:function(H){$.subscribers.indexOf(H)===-1&&($.subscribers.push(H),$.fire=Y($.fire,H))},unsubscribe:function(H){$.subscribers=$.subscribers.filter(function(ee){return ee!==H}),$.fire=$.subscribers.reduce(Y,Z)}};return v[L]=p[L]=$}r(j=L).forEach(function(H){var ee=j[H];if(o(ee))P(H,j[H][0],j[H][1]);else{if(ee!=="asap")throw new ye.InvalidArgument("Invalid event config");var W=P(H,vt,function(){for(var K=arguments.length,te=new Array(K);K--;)te[K]=arguments[K];W.subscribers.forEach(function(X){F(function(){X.apply(null,te)})})})}})}}function En(h,p){return g(p).from({prototype:h}),p}function Ls(h,p){return!(h.filter||h.algorithm||h.or)&&(p?h.justLimit:!h.replayFilter)}function Bo(h,p){h.filter=hs(h.filter,p)}function ko(h,p,v){var b=h.replayFilter;h.replayFilter=b?function(){return hs(b(),p())}:p,h.justLimit=v&&!b}function hr(h,p){if(h.isPrimKey)return p.primaryKey;var v=p.getIndexByKeyPath(h.index);if(!v)throw new ye.Schema("KeyPath "+h.index+" on object store "+p.name+" is not indexed");return v}function Zl(h,p,v){var b=hr(h,p.schema);return p.openCursor({trans:v,values:!h.keysOnly,reverse:h.dir==="prev",unique:!!h.unique,query:{index:b,range:h.range}})}function ur(h,p,v,b){var A=h.replayFilter?hs(h.filter,h.replayFilter()):h.filter;if(h.or){var P={},L=function(Y,Z,j){var $,H;A&&!A(Z,j,function(ee){return Z.stop(ee)},function(ee){return Z.fail(ee)})||((H=""+($=Z.primaryKey))=="[object ArrayBuffer]"&&(H=""+new Uint8Array($)),d(P,H)||(P[H]=!0,p(Y,Z,j)))};return Promise.all([h.or._iterate(L,v),Kl(Zl(h,b,v),h.algorithm,L,!h.keysOnly&&h.valueMapper)])}return Kl(Zl(h,b,v),hs(h.algorithm,A),p,!h.keysOnly&&h.valueMapper)}function Kl(h,p,v,b){var A=pt(b?function(P,L,Y){return v(b(P),L,Y)}:v);return h.then(function(P){if(P)return P.start(function(){var L=function(){return P.continue()};p&&!p(P,function(Y){return L=Y},function(Y){P.stop(Y),L=He},function(Y){P.fail(Y),L=He})||A(P.value,P,function(Y){return L=Y}),L()})})}var Oi=Symbol(),vn=(Xl.prototype.execute=function(h){if(this.add!==void 0){var p=this.add;if(o(p))return s(s([],o(h)?h:[],!0),p).sort();if(typeof p=="number")return(Number(h)||0)+p;if(typeof p=="bigint")try{return BigInt(h)+p}catch{return BigInt(0)+p}throw new TypeError("Invalid term ".concat(p))}if(this.remove!==void 0){var v=this.remove;if(o(v))return o(h)?h.filter(function(b){return!v.includes(b)}).sort():[];if(typeof v=="number")return Number(h)-v;if(typeof v=="bigint")try{return BigInt(h)-v}catch{return BigInt(0)-v}throw new TypeError("Invalid subtrahend ".concat(v))}return p=(p=this.replacePrefix)===null||p===void 0?void 0:p[0],p&&typeof h=="string"&&h.startsWith(p)?this.replacePrefix[1]+h.substring(p.length):h},Xl);function Xl(h){Object.assign(this,h)}var bd=(et.prototype._read=function(h,p){var v=this._ctx;return v.error?v.table._trans(null,wt.bind(null,v.error)):v.table._trans("readonly",h).then(p)},et.prototype._write=function(h){var p=this._ctx;return p.error?p.table._trans(null,wt.bind(null,p.error)):p.table._trans("readwrite",h,"locked")},et.prototype._addAlgorithm=function(h){var p=this._ctx;p.algorithm=hs(p.algorithm,h)},et.prototype._iterate=function(h,p){return ur(this._ctx,h,p,this._ctx.table.core)},et.prototype.clone=function(h){var p=Object.create(this.constructor.prototype),v=Object.create(this._ctx);return h&&a(v,h),p._ctx=v,p},et.prototype.raw=function(){return this._ctx.valueMapper=null,this},et.prototype.each=function(h){var p=this._ctx;return this._read(function(v){return ur(p,h,v,p.table.core)})},et.prototype.count=function(h){var p=this;return this._read(function(v){var b=p._ctx,A=b.table.core;if(Ls(b,!0))return A.count({trans:v,query:{index:hr(b,A.schema),range:b.range}}).then(function(L){return Math.min(L,b.limit)});var P=0;return ur(b,function(){return++P,!1},v,A).then(function(){return P})}).then(h)},et.prototype.sortBy=function(h,p){var v=h.split(".").reverse(),b=v[0],A=v.length-1;function P(Z,j){return j?P(Z[v[j]],j-1):Z[b]}var L=this._ctx.dir==="next"?1:-1;function Y(Z,j){return Z=P(Z,A),j=P(j,A),Z<j?-L:j<Z?L:0}return this.toArray(function(Z){return Z.sort(Y)}).then(p)},et.prototype.toArray=function(h){var p=this;return this._read(function(v){var b=p._ctx;if(b.dir==="next"&&Ls(b,!0)&&0<b.limit){var A=b.valueMapper,P=hr(b,b.table.core.schema);return b.table.core.query({trans:v,limit:b.limit,values:!0,query:{index:P,range:b.range}}).then(function(Y){return Y=Y.result,A?Y.map(A):Y})}var L=[];return ur(b,function(Y){return L.push(Y)},v,b.table.core).then(function(){return L})},h)},et.prototype.offset=function(h){var p=this._ctx;return h<=0||(p.offset+=h,Ls(p)?ko(p,function(){var v=h;return function(b,A){return v===0||(v===1?--v:A(function(){b.advance(v),v=0}),!1)}}):ko(p,function(){var v=h;return function(){return--v<0}})),this},et.prototype.limit=function(h){return this._ctx.limit=Math.min(this._ctx.limit,h),ko(this._ctx,function(){var p=h;return function(v,b,A){return--p<=0&&b(A),0<=p}},!0),this},et.prototype.until=function(h,p){return Bo(this._ctx,function(v,b,A){return!h(v.value)||(b(A),p)}),this},et.prototype.first=function(h){return this.limit(1).toArray(function(p){return p[0]}).then(h)},et.prototype.last=function(h){return this.reverse().first(h)},et.prototype.filter=function(h){var p;return Bo(this._ctx,function(v){return h(v.value)}),(p=this._ctx).isMatch=hs(p.isMatch,h),this},et.prototype.and=function(h){return this.filter(h)},et.prototype.or=function(h){return new this.db.WhereClause(this._ctx.table,h,this)},et.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},et.prototype.desc=function(){return this.reverse()},et.prototype.eachKey=function(h){var p=this._ctx;return p.keysOnly=!p.isMatch,this.each(function(v,b){h(b.key,b)})},et.prototype.eachUniqueKey=function(h){return this._ctx.unique="unique",this.eachKey(h)},et.prototype.eachPrimaryKey=function(h){var p=this._ctx;return p.keysOnly=!p.isMatch,this.each(function(v,b){h(b.primaryKey,b)})},et.prototype.keys=function(h){var p=this._ctx;p.keysOnly=!p.isMatch;var v=[];return this.each(function(b,A){v.push(A.key)}).then(function(){return v}).then(h)},et.prototype.primaryKeys=function(h){var p=this._ctx;if(p.dir==="next"&&Ls(p,!0)&&0<p.limit)return this._read(function(b){var A=hr(p,p.table.core.schema);return p.table.core.query({trans:b,values:!1,limit:p.limit,query:{index:A,range:p.range}})}).then(function(b){return b.result}).then(h);p.keysOnly=!p.isMatch;var v=[];return this.each(function(b,A){v.push(A.primaryKey)}).then(function(){return v}).then(h)},et.prototype.uniqueKeys=function(h){return this._ctx.unique="unique",this.keys(h)},et.prototype.firstKey=function(h){return this.limit(1).keys(function(p){return p[0]}).then(h)},et.prototype.lastKey=function(h){return this.reverse().firstKey(h)},et.prototype.distinct=function(){var h=this._ctx,h=h.index&&h.table.schema.idxByName[h.index];if(!h||!h.multi)return this;var p={};return Bo(this._ctx,function(A){var b=A.primaryKey.toString(),A=d(p,b);return p[b]=!0,!A}),this},et.prototype.modify=function(h){var p=this,v=this._ctx;return this._write(function(b){var A,P,L;L=typeof h=="function"?h:(A=r(h),P=A.length,function(X){for(var ne=!1,ae=0;ae<P;++ae){var ce=A[ae],me=h[ce],Ce=M(X,ce);me instanceof vn?(D(X,ce,me.execute(Ce)),ne=!0):Ce!==me&&(D(X,ce,me),ne=!0)}return ne});function Y(X,ce){var ae=ce.failures,ce=ce.numFailures;K+=X-ce;for(var me=0,Ce=r(ae);me<Ce.length;me++){var Re=Ce[me];W.push(ae[Re])}}var Z=v.table.core,j=Z.schema.primaryKey,$=j.outbound,H=j.extractKey,ee=p.db._options.modifyChunkSize||200,W=[],K=0,te=[];return p.clone().primaryKeys().then(function(X){function ne(ce){var me=Math.min(ee,X.length-ce);return Z.getMany({trans:b,keys:X.slice(ce,ce+me),cache:"immutable"}).then(function(Ce){for(var Re=[],be=[],_e=$?[]:null,Fe=[],we=0;we<me;++we){var Ve=Ce[we],Ge={value:V(Ve),primKey:X[ce+we]};L.call(Ge,Ge.value,Ge)!==!1&&(Ge.value==null?Fe.push(X[ce+we]):$||$e(H(Ve),H(Ge.value))===0?(be.push(Ge.value),$&&_e.push(X[ce+we])):(Fe.push(X[ce+we]),Re.push(Ge.value)))}return Promise.resolve(0<Re.length&&Z.mutate({trans:b,type:"add",values:Re}).then(function(qe){for(var Xe in qe.failures)Fe.splice(parseInt(Xe),1);Y(Re.length,qe)})).then(function(){return(0<be.length||ae&&typeof h=="object")&&Z.mutate({trans:b,type:"put",keys:_e,values:be,criteria:ae,changeSpec:typeof h!="function"&&h,isAdditionalChunk:0<ce}).then(function(qe){return Y(be.length,qe)})}).then(function(){return(0<Fe.length||ae&&h===zo)&&Z.mutate({trans:b,type:"delete",keys:Fe,criteria:ae,isAdditionalChunk:0<ce}).then(function(qe){return Y(Fe.length,qe)})}).then(function(){return X.length>ce+me&&ne(ce+ee)})})}var ae=Ls(v)&&v.limit===1/0&&(typeof h!="function"||h===zo)&&{index:v.index,range:v.range};return ne(0).then(function(){if(0<W.length)throw new xe("Error modifying one or more objects",W,K,te);return X.length})})})},et.prototype.delete=function(){var h=this._ctx,p=h.range;return Ls(h)&&(h.isPrimKey||p.type===3)?this._write(function(v){var b=h.table.core.schema.primaryKey,A=p;return h.table.core.count({trans:v,query:{index:b,range:A}}).then(function(P){return h.table.core.mutate({trans:v,type:"deleteRange",range:A}).then(function(L){var Y=L.failures;if(L.lastResult,L.results,L=L.numFailures,L)throw new xe("Could not delete some values",Object.keys(Y).map(function(Z){return Y[Z]}),P-L);return P-L})})}):this.modify(zo)},et);function et(){}var zo=function(h,p){return p.value=null};function Td(h,p){return h<p?-1:h===p?0:1}function xd(h,p){return p<h?-1:h===p?0:1}function Qt(h,p,v){return h=h instanceof ql?new h.Collection(h):h,h._ctx.error=new(v||TypeError)(p),h}function Ns(h){return new h.Collection(h,function(){return Ql("")}).limit(0)}function dr(h,p,v,b){var A,P,L,Y,Z,j,$,H=v.length;if(!v.every(function(K){return typeof K=="string"}))return Qt(h,Vl);function ee(K){A=K==="next"?function(X){return X.toUpperCase()}:function(X){return X.toLowerCase()},P=K==="next"?function(X){return X.toLowerCase()}:function(X){return X.toUpperCase()},L=K==="next"?Td:xd;var te=v.map(function(X){return{lower:P(X),upper:A(X)}}).sort(function(X,ne){return L(X.lower,ne.lower)});Y=te.map(function(X){return X.upper}),Z=te.map(function(X){return X.lower}),$=(j=K)==="next"?"":b}ee("next"),h=new h.Collection(h,function(){return Wi(Y[0],Z[H-1]+b)}),h._ondirectionchange=function(K){ee(K)};var W=0;return h._addAlgorithm(function(K,te,X){var ne=K.key;if(typeof ne!="string")return!1;var ae=P(ne);if(p(ae,Z,W))return!0;for(var ce=null,me=W;me<H;++me){var Ce=function(Re,be,_e,Fe,we,Ve){for(var Ge=Math.min(Re.length,Fe.length),qe=-1,Xe=0;Xe<Ge;++Xe){var ci=be[Xe];if(ci!==Fe[Xe])return we(Re[Xe],_e[Xe])<0?Re.substr(0,Xe)+_e[Xe]+_e.substr(Xe+1):we(Re[Xe],Fe[Xe])<0?Re.substr(0,Xe)+Fe[Xe]+_e.substr(Xe+1):0<=qe?Re.substr(0,qe)+be[qe]+_e.substr(qe+1):null;we(Re[Xe],ci)<0&&(qe=Xe)}return Ge<Fe.length&&Ve==="next"?Re+_e.substr(Re.length):Ge<Re.length&&Ve==="prev"?Re.substr(0,_e.length):qe<0?null:Re.substr(0,qe)+Fe[qe]+_e.substr(qe+1)}(ne,ae,Y[me],Z[me],L,j);Ce===null&&ce===null?W=me+1:(ce===null||0<L(ce,Ce))&&(ce=Ce)}return te(ce!==null?function(){K.continue(ce+$)}:X),!1}),h}function Wi(h,p,v,b){return{type:2,lower:h,upper:p,lowerOpen:v,upperOpen:b}}function Ql(h){return{type:1,lower:h,upper:h}}var ql=(Object.defineProperty(At.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),At.prototype.between=function(h,p,v,b){v=v!==!1,b=b===!0;try{return 0<this._cmp(h,p)||this._cmp(h,p)===0&&(v||b)&&(!v||!b)?Ns(this):new this.Collection(this,function(){return Wi(h,p,!v,!b)})}catch{return Qt(this,Si)}},At.prototype.equals=function(h){return h==null?Qt(this,Si):new this.Collection(this,function(){return Ql(h)})},At.prototype.above=function(h){return h==null?Qt(this,Si):new this.Collection(this,function(){return Wi(h,void 0,!0)})},At.prototype.aboveOrEqual=function(h){return h==null?Qt(this,Si):new this.Collection(this,function(){return Wi(h,void 0,!1)})},At.prototype.below=function(h){return h==null?Qt(this,Si):new this.Collection(this,function(){return Wi(void 0,h,!1,!0)})},At.prototype.belowOrEqual=function(h){return h==null?Qt(this,Si):new this.Collection(this,function(){return Wi(void 0,h)})},At.prototype.startsWith=function(h){return typeof h!="string"?Qt(this,Vl):this.between(h,h+cs,!0,!0)},At.prototype.startsWithIgnoreCase=function(h){return h===""?this.startsWith(h):dr(this,function(p,v){return p.indexOf(v[0])===0},[h],cs)},At.prototype.equalsIgnoreCase=function(h){return dr(this,function(p,v){return p===v[0]},[h],"")},At.prototype.anyOfIgnoreCase=function(){var h=De.apply(ue,arguments);return h.length===0?Ns(this):dr(this,function(p,v){return v.indexOf(p)!==-1},h,"")},At.prototype.startsWithAnyOfIgnoreCase=function(){var h=De.apply(ue,arguments);return h.length===0?Ns(this):dr(this,function(p,v){return v.some(function(b){return p.indexOf(b)===0})},h,cs)},At.prototype.anyOf=function(){var h=this,p=De.apply(ue,arguments),v=this._cmp;try{p.sort(v)}catch{return Qt(this,Si)}if(p.length===0)return Ns(this);var b=new this.Collection(this,function(){return Wi(p[0],p[p.length-1])});b._ondirectionchange=function(P){v=P==="next"?h._ascending:h._descending,p.sort(v)};var A=0;return b._addAlgorithm(function(P,L,Y){for(var Z=P.key;0<v(Z,p[A]);)if(++A===p.length)return L(Y),!1;return v(Z,p[A])===0||(L(function(){P.continue(p[A])}),!1)}),b},At.prototype.notEqual=function(h){return this.inAnyRange([[-1/0,h],[h,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},At.prototype.noneOf=function(){var h=De.apply(ue,arguments);if(h.length===0)return new this.Collection(this);try{h.sort(this._ascending)}catch{return Qt(this,Si)}var p=h.reduce(function(v,b){return v?v.concat([[v[v.length-1][1],b]]):[[-1/0,b]]},null);return p.push([h[h.length-1],this.db._maxKey]),this.inAnyRange(p,{includeLowers:!1,includeUppers:!1})},At.prototype.inAnyRange=function(ne,p){var v=this,b=this._cmp,A=this._ascending,P=this._descending,L=this._min,Y=this._max;if(ne.length===0)return Ns(this);if(!ne.every(function(ae){return ae[0]!==void 0&&ae[1]!==void 0&&A(ae[0],ae[1])<=0}))return Qt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ye.InvalidArgument);var Z=!p||p.includeLowers!==!1,j=p&&p.includeUppers===!0,$,H=A;function ee(ae,ce){return H(ae[0],ce[0])}try{($=ne.reduce(function(ae,ce){for(var me=0,Ce=ae.length;me<Ce;++me){var Re=ae[me];if(b(ce[0],Re[1])<0&&0<b(ce[1],Re[0])){Re[0]=L(Re[0],ce[0]),Re[1]=Y(Re[1],ce[1]);break}}return me===Ce&&ae.push(ce),ae},[])).sort(ee)}catch{return Qt(this,Si)}var W=0,K=j?function(ae){return 0<A(ae,$[W][1])}:function(ae){return 0<=A(ae,$[W][1])},te=Z?function(ae){return 0<P(ae,$[W][0])}:function(ae){return 0<=P(ae,$[W][0])},X=K,ne=new this.Collection(this,function(){return Wi($[0][0],$[$.length-1][1],!Z,!j)});return ne._ondirectionchange=function(ae){H=ae==="next"?(X=K,A):(X=te,P),$.sort(ee)},ne._addAlgorithm(function(ae,ce,me){for(var Ce,Re=ae.key;X(Re);)if(++W===$.length)return ce(me),!1;return!K(Ce=Re)&&!te(Ce)||(v._cmp(Re,$[W][1])===0||v._cmp(Re,$[W][0])===0||ce(function(){H===A?ae.continue($[W][0]):ae.continue($[W][1])}),!1)}),ne},At.prototype.startsWithAnyOf=function(){var h=De.apply(ue,arguments);return h.every(function(p){return typeof p=="string"})?h.length===0?Ns(this):this.inAnyRange(h.map(function(p){return[p,p+cs]})):Qt(this,"startsWithAnyOf() only works with strings")},At);function At(){}function wi(h){return pt(function(p){return wn(p),h(p.target.error),!1})}function wn(h){h.stopPropagation&&h.stopPropagation(),h.preventDefault&&h.preventDefault()}var yn="storagemutated",Vo="x-storagemutated-1",Zi=gn(null,yn),Ad=(yi.prototype._lock=function(){return C(!Le.global),++this._reculock,this._reculock!==1||Le.global||(Le.lockOwnerFor=this),this},yi.prototype._unlock=function(){if(C(!Le.global),--this._reculock==0)for(Le.global||(Le.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var h=this._blockedFuncs.shift();try{ls(h[1],h[0])}catch{}}return this},yi.prototype._locked=function(){return this._reculock&&Le.lockOwnerFor!==this},yi.prototype.create=function(h){var p=this;if(!this.mode)return this;var v=this.db.idbdb,b=this.db._state.dbOpenError;if(C(!this.idbtrans),!h&&!v)switch(b&&b.name){case"DatabaseClosedError":throw new ye.DatabaseClosed(b);case"MissingAPIError":throw new ye.MissingAPI(b.message,b);default:throw new ye.OpenFailed(b)}if(!this.active)throw new ye.TransactionInactive;return C(this._completion._state===null),(h=this.idbtrans=h||(this.db.core||v).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=pt(function(A){wn(A),p._reject(h.error)}),h.onabort=pt(function(A){wn(A),p.active&&p._reject(new ye.Abort(h.error)),p.active=!1,p.on("abort").fire(A)}),h.oncomplete=pt(function(){p.active=!1,p._resolve(),"mutatedParts"in h&&Zi.storagemutated.fire(h.mutatedParts)}),this},yi.prototype._promise=function(h,p,v){var b=this;if(h==="readwrite"&&this.mode!=="readwrite")return wt(new ye.ReadOnly("Transaction is readonly"));if(!this.active)return wt(new ye.TransactionInactive);if(this._locked())return new Se(function(P,L){b._blockedFuncs.push([function(){b._promise(h,p,v).then(P,L)},Le])});if(v)return Gi(function(){var P=new Se(function(L,Y){b._lock();var Z=p(L,Y,b);Z&&Z.then&&Z.then(L,Y)});return P.finally(function(){return b._unlock()}),P._lib=!0,P});var A=new Se(function(P,L){var Y=p(P,L,b);Y&&Y.then&&Y.then(P,L)});return A._lib=!0,A},yi.prototype._root=function(){return this.parent?this.parent._root():this},yi.prototype.waitFor=function(h){var p,v=this._root(),b=Se.resolve(h);v._waitingFor?v._waitingFor=v._waitingFor.then(function(){return b}):(v._waitingFor=b,v._waitingQueue=[],p=v.idbtrans.objectStore(v.storeNames[0]),function P(){for(++v._spinCount;v._waitingQueue.length;)v._waitingQueue.shift()();v._waitingFor&&(p.get(-1/0).onsuccess=P)}());var A=v._waitingFor;return new Se(function(P,L){b.then(function(Y){return v._waitingQueue.push(pt(P.bind(null,Y)))},function(Y){return v._waitingQueue.push(pt(L.bind(null,Y)))}).finally(function(){v._waitingFor===A&&(v._waitingFor=null)})})},yi.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ye.Abort))},yi.prototype.table=function(h){var p=this._memoizedTables||(this._memoizedTables={});if(d(p,h))return p[h];var v=this.schema[h];if(!v)throw new ye.NotFound("Table "+h+" not part of transaction");return v=new this.db.Table(h,v,this),v.core=this.db.core.table(h),p[h]=v},yi);function yi(){}function Yo(h,p,v,b,A,P,L){return{name:h,keyPath:p,unique:v,multi:b,auto:A,compound:P,src:(v&&!L?"&":"")+(b?"*":"")+(A?"++":"")+Jl(p)}}function Jl(h){return typeof h=="string"?h:h?"["+[].join.call(h,"+")+"]":""}function Go(h,p,v){return{name:h,primKey:p,indexes:v,mappedClass:null,idxByName:(b=function(A){return[A.name,A]},v.reduce(function(A,P,L){return L=b(P,L),L&&(A[L[0]]=L[1]),A},{}))};var b}var In=function(h){try{return h.only([[]]),In=function(){return[[]]},[[]]}catch{return In=function(){return cs},cs}};function Ho(h){return h==null?function(){}:typeof h=="string"?(p=h).split(".").length===1?function(v){return v[p]}:function(v){return M(v,p)}:function(v){return M(v,h)};var p}function $l(h){return[].slice.call(h)}var _d=0;function Cn(h){return h==null?":id":typeof h=="string"?h:"[".concat(h.join("+"),"]")}function Rd(h,p,Z){function b(X){if(X.type===3)return null;if(X.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var W=X.lower,K=X.upper,te=X.lowerOpen,X=X.upperOpen;return W===void 0?K===void 0?null:p.upperBound(K,!!X):K===void 0?p.lowerBound(W,!!te):p.bound(W,K,!!te,!!X)}function A(ee){var W,K=ee.name;return{name:K,schema:ee,mutate:function(te){var X=te.trans,ne=te.type,ae=te.keys,ce=te.values,me=te.range;return new Promise(function(Ce,Re){Ce=pt(Ce);var be=X.objectStore(K),_e=be.keyPath==null,Fe=ne==="put"||ne==="add";if(!Fe&&ne!=="delete"&&ne!=="deleteRange")throw new Error("Invalid operation type: "+ne);var we,Ve=(ae||ce||{length:1}).length;if(ae&&ce&&ae.length!==ce.length)throw new Error("Given keys array must have same length as given values array.");if(Ve===0)return Ce({numFailures:0,failures:{},results:[],lastResult:void 0});function Ge(zt){++ci,wn(zt)}var qe=[],Xe=[],ci=0;if(ne==="deleteRange"){if(me.type===4)return Ce({numFailures:ci,failures:Xe,results:[],lastResult:void 0});me.type===3?qe.push(we=be.clear()):qe.push(we=be.delete(b(me)))}else{var _e=Fe?_e?[ce,ae]:[ce,null]:[ae,null],Qe=_e[0],Dt=_e[1];if(Fe)for(var Mt=0;Mt<Ve;++Mt)qe.push(we=Dt&&Dt[Mt]!==void 0?be[ne](Qe[Mt],Dt[Mt]):be[ne](Qe[Mt])),we.onerror=Ge;else for(Mt=0;Mt<Ve;++Mt)qe.push(we=be[ne](Qe[Mt])),we.onerror=Ge}function xr(zt){zt=zt.target.result,qe.forEach(function(fs,la){return fs.error!=null&&(Xe[la]=fs.error)}),Ce({numFailures:ci,failures:Xe,results:ne==="delete"?ae:qe.map(function(fs){return fs.result}),lastResult:zt})}we.onerror=function(zt){Ge(zt),xr(zt)},we.onsuccess=xr})},getMany:function(te){var X=te.trans,ne=te.keys;return new Promise(function(ae,ce){ae=pt(ae);for(var me,Ce=X.objectStore(K),Re=ne.length,be=new Array(Re),_e=0,Fe=0,we=function(qe){qe=qe.target,be[qe._pos]=qe.result,++Fe===_e&&ae(be)},Ve=wi(ce),Ge=0;Ge<Re;++Ge)ne[Ge]!=null&&((me=Ce.get(ne[Ge]))._pos=Ge,me.onsuccess=we,me.onerror=Ve,++_e);_e===0&&ae(be)})},get:function(te){var X=te.trans,ne=te.key;return new Promise(function(ae,ce){ae=pt(ae);var me=X.objectStore(K).get(ne);me.onsuccess=function(Ce){return ae(Ce.target.result)},me.onerror=wi(ce)})},query:(W=j,function(te){return new Promise(function(X,ne){X=pt(X);var ae,ce,me,_e=te.trans,Ce=te.values,Re=te.limit,we=te.query,be=Re===1/0?void 0:Re,Fe=we.index,we=we.range,_e=_e.objectStore(K),Fe=Fe.isPrimaryKey?_e:_e.index(Fe.name),we=b(we);if(Re===0)return X({result:[]});W?((be=Ce?Fe.getAll(we,be):Fe.getAllKeys(we,be)).onsuccess=function(Ve){return X({result:Ve.target.result})},be.onerror=wi(ne)):(ae=0,ce=!Ce&&"openKeyCursor"in Fe?Fe.openKeyCursor(we):Fe.openCursor(we),me=[],ce.onsuccess=function(Ve){var Ge=ce.result;return Ge?(me.push(Ce?Ge.value:Ge.primaryKey),++ae===Re?X({result:me}):void Ge.continue()):X({result:me})},ce.onerror=wi(ne))})}),openCursor:function(te){var X=te.trans,ne=te.values,ae=te.query,ce=te.reverse,me=te.unique;return new Promise(function(Ce,Re){Ce=pt(Ce);var Fe=ae.index,be=ae.range,_e=X.objectStore(K),_e=Fe.isPrimaryKey?_e:_e.index(Fe.name),Fe=ce?me?"prevunique":"prev":me?"nextunique":"next",we=!ne&&"openKeyCursor"in _e?_e.openKeyCursor(b(be),Fe):_e.openCursor(b(be),Fe);we.onerror=wi(Re),we.onsuccess=pt(function(Ve){var Ge,qe,Xe,ci,Qe=we.result;Qe?(Qe.___id=++_d,Qe.done=!1,Ge=Qe.continue.bind(Qe),qe=(qe=Qe.continuePrimaryKey)&&qe.bind(Qe),Xe=Qe.advance.bind(Qe),ci=function(){throw new Error("Cursor not stopped")},Qe.trans=X,Qe.stop=Qe.continue=Qe.continuePrimaryKey=Qe.advance=function(){throw new Error("Cursor not started")},Qe.fail=pt(Re),Qe.next=function(){var Dt=this,Mt=1;return this.start(function(){return Mt--?Dt.continue():Dt.stop()}).then(function(){return Dt})},Qe.start=function(Dt){function Mt(){if(we.result)try{Dt()}catch(zt){Qe.fail(zt)}else Qe.done=!0,Qe.start=function(){throw new Error("Cursor behind last entry")},Qe.stop()}var xr=new Promise(function(zt,fs){zt=pt(zt),we.onerror=wi(fs),Qe.fail=fs,Qe.stop=function(la){Qe.stop=Qe.continue=Qe.continuePrimaryKey=Qe.advance=ci,zt(la)}});return we.onsuccess=pt(function(zt){we.onsuccess=Mt,Mt()}),Qe.continue=Ge,Qe.continuePrimaryKey=qe,Qe.advance=Xe,Mt(),xr},Ce(Qe)):Ce(null)},Re)})},count:function(te){var X=te.query,ne=te.trans,ae=X.index,ce=X.range;return new Promise(function(me,Ce){var Re=ne.objectStore(K),be=ae.isPrimaryKey?Re:Re.index(ae.name),Re=b(ce),be=Re?be.count(Re):be.count();be.onsuccess=pt(function(_e){return me(_e.target.result)}),be.onerror=wi(Ce)})}}}var P,L,Y,$=(L=Z,Y=$l((P=h).objectStoreNames),{schema:{name:P.name,tables:Y.map(function(ee){return L.objectStore(ee)}).map(function(ee){var W=ee.keyPath,X=ee.autoIncrement,K=o(W),te={},X={name:ee.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:W==null,compound:K,keyPath:W,autoIncrement:X,unique:!0,extractKey:Ho(W)},indexes:$l(ee.indexNames).map(function(ne){return ee.index(ne)}).map(function(me){var ae=me.name,ce=me.unique,Ce=me.multiEntry,me=me.keyPath,Ce={name:ae,compound:o(me),keyPath:me,unique:ce,multiEntry:Ce,extractKey:Ho(me)};return te[Cn(me)]=Ce}),getIndexByKeyPath:function(ne){return te[Cn(ne)]}};return te[":id"]=X.primaryKey,W!=null&&(te[Cn(W)]=X.primaryKey),X})},hasGetAll:0<Y.length&&"getAll"in L.objectStore(Y[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),Z=$.schema,j=$.hasGetAll,$=Z.tables.map(A),H={};return $.forEach(function(ee){return H[ee.name]=ee}),{stack:"dbcore",transaction:h.transaction.bind(h),table:function(ee){if(!H[ee])throw new Error("Table '".concat(ee,"' not found"));return H[ee]},MIN_KEY:-1/0,MAX_KEY:In(p),schema:Z}}function Fd(h,p,v,b){var A=v.IDBKeyRange;return v.indexedDB,{dbcore:(b=Rd(p,A,b),h.dbcore.reduce(function(P,L){return L=L.create,i(i({},P),L(P))},b))}}function fr(h,b){var v=b.db,b=Fd(h._middlewares,v,h._deps,b);h.core=b.dbcore,h.tables.forEach(function(A){var P=A.name;h.core.schema.tables.some(function(L){return L.name===P})&&(A.core=h.core.table(P),h[P]instanceof h.Table&&(h[P].core=A.core))})}function pr(h,p,v,b){v.forEach(function(A){var P=b[A];p.forEach(function(L){var Y=function Z(j,$){return w(j,$)||(j=c(j))&&Z(j,$)}(L,A);(!Y||"value"in Y&&Y.value===void 0)&&(L===h.Transaction.prototype||L instanceof h.Transaction?E(L,A,{get:function(){return this.table(A)},set:function(Z){m(this,A,{value:Z,writable:!0,configurable:!0,enumerable:!0})}}):L[A]=new h.Table(A,P))})})}function jo(h,p){p.forEach(function(v){for(var b in v)v[b]instanceof h.Table&&delete v[b]})}function Sd(h,p){return h._cfg.version-p._cfg.version}function Od(h,p,v,b){var A=h._dbSchema;v.objectStoreNames.contains("$meta")&&!A.$meta&&(A.$meta=Go("$meta",tc("")[0],[]),h._storeNames.push("$meta"));var P=h._createTransaction("readwrite",h._storeNames,A);P.create(v),P._completion.catch(b);var L=P._reject.bind(P),Y=Le.transless||Le;Gi(function(){return Le.trans=P,Le.transless=Y,p!==0?(fr(h,v),j=p,((Z=P).storeNames.includes("$meta")?Z.table("$meta").get("version").then(function($){return $??j}):Se.resolve(j)).then(function($){return ee=$,W=P,K=v,te=[],$=(H=h)._versions,X=H._dbSchema=gr(0,H.idbdb,K),($=$.filter(function(ne){return ne._cfg.version>=ee})).length!==0?($.forEach(function(ne){te.push(function(){var ae=X,ce=ne._cfg.dbschema;Er(H,ae,K),Er(H,ce,K),X=H._dbSchema=ce;var me=Wo(ae,ce);me.add.forEach(function(Fe){Zo(K,Fe[0],Fe[1].primKey,Fe[1].indexes)}),me.change.forEach(function(Fe){if(Fe.recreate)throw new ye.Upgrade("Not yet support for changing primary key");var we=K.objectStore(Fe.name);Fe.add.forEach(function(Ve){return mr(we,Ve)}),Fe.change.forEach(function(Ve){we.deleteIndex(Ve.name),mr(we,Ve)}),Fe.del.forEach(function(Ve){return we.deleteIndex(Ve)})});var Ce=ne._cfg.contentUpgrade;if(Ce&&ne._cfg.version>ee){fr(H,K),W._memoizedTables={};var Re=B(ce);me.del.forEach(function(Fe){Re[Fe]=ae[Fe]}),jo(H,[H.Transaction.prototype]),pr(H,[H.Transaction.prototype],r(Re),Re),W.schema=Re;var be,_e=oe(Ce);return _e&&Ds(),me=Se.follow(function(){var Fe;(be=Ce(W))&&_e&&(Fe=Hi.bind(null,null),be.then(Fe,Fe))}),be&&typeof be.then=="function"?Se.resolve(be):me.then(function(){return be})}}),te.push(function(ae){var ce,me,Ce=ne._cfg.dbschema;ce=Ce,me=ae,[].slice.call(me.db.objectStoreNames).forEach(function(Re){return ce[Re]==null&&me.db.deleteObjectStore(Re)}),jo(H,[H.Transaction.prototype]),pr(H,[H.Transaction.prototype],H._storeNames,H._dbSchema),W.schema=H._dbSchema}),te.push(function(ae){H.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(H.idbdb.version/10)===ne._cfg.version?(H.idbdb.deleteObjectStore("$meta"),delete H._dbSchema.$meta,H._storeNames=H._storeNames.filter(function(ce){return ce!=="$meta"})):ae.objectStore("$meta").put(ne._cfg.version,"version"))})}),function ne(){return te.length?Se.resolve(te.shift()(W.idbtrans)).then(ne):Se.resolve()}().then(function(){ec(X,K)})):Se.resolve();var H,ee,W,K,te,X}).catch(L)):(r(A).forEach(function($){Zo(v,$,A[$].primKey,A[$].indexes)}),fr(h,v),void Se.follow(function(){return h.on.populate.fire(P)}).catch(L));var Z,j})}function Pd(h,p){ec(h._dbSchema,p),p.db.version%10!=0||p.objectStoreNames.contains("$meta")||p.db.createObjectStore("$meta").add(Math.ceil(p.db.version/10-1),"version");var v=gr(0,h.idbdb,p);Er(h,h._dbSchema,p);for(var b=0,A=Wo(v,h._dbSchema).change;b<A.length;b++){var P=function(L){if(L.change.length||L.recreate)return console.warn("Unable to patch indexes of table ".concat(L.name," because it has changes on the type of index or primary key.")),{value:void 0};var Y=p.objectStore(L.name);L.add.forEach(function(Z){ge&&console.debug("Dexie upgrade patch: Creating missing index ".concat(L.name,".").concat(Z.src)),mr(Y,Z)})}(A[b]);if(typeof P=="object")return P.value}}function Wo(h,p){var v,b={del:[],add:[],change:[]};for(v in h)p[v]||b.del.push(v);for(v in p){var A=h[v],P=p[v];if(A){var L={name:v,def:P,recreate:!1,del:[],add:[],change:[]};if(""+(A.primKey.keyPath||"")!=""+(P.primKey.keyPath||"")||A.primKey.auto!==P.primKey.auto)L.recreate=!0,b.change.push(L);else{var Y=A.idxByName,Z=P.idxByName,j=void 0;for(j in Y)Z[j]||L.del.push(j);for(j in Z){var $=Y[j],H=Z[j];$?$.src!==H.src&&L.change.push(H):L.add.push(H)}(0<L.del.length||0<L.add.length||0<L.change.length)&&b.change.push(L)}}else b.add.push([v,P])}return b}function Zo(h,p,v,b){var A=h.db.createObjectStore(p,v.keyPath?{keyPath:v.keyPath,autoIncrement:v.auto}:{autoIncrement:v.auto});return b.forEach(function(P){return mr(A,P)}),A}function ec(h,p){r(h).forEach(function(v){p.db.objectStoreNames.contains(v)||(ge&&console.debug("Dexie: Creating missing table",v),Zo(p,v,h[v].primKey,h[v].indexes))})}function mr(h,p){h.createIndex(p.name,p.keyPath,{unique:p.unique,multiEntry:p.multi})}function gr(h,p,v){var b={};return I(p.objectStoreNames,0).forEach(function(A){for(var P=v.objectStore(A),L=Yo(Jl(j=P.keyPath),j||"",!0,!1,!!P.autoIncrement,j&&typeof j!="string",!0),Y=[],Z=0;Z<P.indexNames.length;++Z){var $=P.index(P.indexNames[Z]),j=$.keyPath,$=Yo($.name,j,!!$.unique,!!$.multiEntry,!1,j&&typeof j!="string",!1);Y.push($)}b[A]=Go(A,L,Y)}),b}function Er(h,p,v){for(var b=v.db.objectStoreNames,A=0;A<b.length;++A){var P=b[A],L=v.objectStore(P);h._hasGetAll="getAll"in L;for(var Y=0;Y<L.indexNames.length;++Y){var Z=L.indexNames[Y],j=L.index(Z).keyPath,$=typeof j=="string"?j:"["+I(j).join("+")+"]";!p[P]||(j=p[P].idxByName[$])&&(j.name=Z,delete p[P].idxByName[$],p[P].idxByName[Z]=j)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&n.WorkerGlobalScope&&n instanceof n.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(h._hasGetAll=!1)}function tc(h){return h.split(",").map(function(p,v){var b=(p=p.trim()).replace(/([&*]|\+\+)/g,""),A=/^\[/.test(b)?b.match(/^\[(.*)\]$/)[1].split("+"):b;return Yo(b,A||null,/\&/.test(p),/\*/.test(p),/\+\+/.test(p),o(A),v===0)})}var Dd=(vr.prototype._parseStoresSpec=function(h,p){r(h).forEach(function(v){if(h[v]!==null){var b=tc(h[v]),A=b.shift();if(A.unique=!0,A.multi)throw new ye.Schema("Primary key cannot be multi-valued");b.forEach(function(P){if(P.auto)throw new ye.Schema("Only primary key can be marked as autoIncrement (++)");if(!P.keyPath)throw new ye.Schema("Index must have a name and cannot be an empty string")}),p[v]=Go(v,A,b)}})},vr.prototype.stores=function(v){var p=this.db;this._cfg.storesSource=this._cfg.storesSource?a(this._cfg.storesSource,v):v;var v=p._versions,b={},A={};return v.forEach(function(P){a(b,P._cfg.storesSource),A=P._cfg.dbschema={},P._parseStoresSpec(b,A)}),p._dbSchema=A,jo(p,[p._allTables,p,p.Transaction.prototype]),pr(p,[p._allTables,p,p.Transaction.prototype,this._cfg.tables],r(A),A),p._storeNames=r(A),this},vr.prototype.upgrade=function(h){return this._cfg.contentUpgrade=Ee(this._cfg.contentUpgrade||He,h),this},vr);function vr(){}function Ko(h,p){var v=h._dbNamesDB;return v||(v=h._dbNamesDB=new Pi(lr,{addons:[],indexedDB:h,IDBKeyRange:p})).version(1).stores({dbnames:"name"}),v.table("dbnames")}function Xo(h){return h&&typeof h.databases=="function"}function Qo(h){return Gi(function(){return Le.letThrough=!0,h()})}function qo(h){return!("from"in h)}var kt=function(h,p){if(!this){var v=new kt;return h&&"d"in h&&a(v,h),v}a(this,arguments.length?{d:1,from:h,to:1<arguments.length?p:h}:{d:0})};function bn(h,p,v){var b=$e(p,v);if(!isNaN(b)){if(0<b)throw RangeError();if(qo(h))return a(h,{from:p,to:v,d:1});var A=h.l,b=h.r;if($e(v,h.from)<0)return A?bn(A,p,v):h.l={from:p,to:v,d:1,l:null,r:null},sc(h);if(0<$e(p,h.to))return b?bn(b,p,v):h.r={from:p,to:v,d:1,l:null,r:null},sc(h);$e(p,h.from)<0&&(h.from=p,h.l=null,h.d=b?b.d+1:1),0<$e(v,h.to)&&(h.to=v,h.r=null,h.d=h.l?h.l.d+1:1),v=!h.r,A&&!h.l&&Tn(h,A),b&&v&&Tn(h,b)}}function Tn(h,p){qo(p)||function v(b,Z){var P=Z.from,L=Z.to,Y=Z.l,Z=Z.r;bn(b,P,L),Y&&v(b,Y),Z&&v(b,Z)}(h,p)}function ic(h,p){var v=wr(p),b=v.next();if(b.done)return!1;for(var A=b.value,P=wr(h),L=P.next(A.from),Y=L.value;!b.done&&!L.done;){if($e(Y.from,A.to)<=0&&0<=$e(Y.to,A.from))return!0;$e(A.from,Y.from)<0?A=(b=v.next(Y.from)).value:Y=(L=P.next(A.from)).value}return!1}function wr(h){var p=qo(h)?null:{s:0,n:h};return{next:function(v){for(var b=0<arguments.length;p;)switch(p.s){case 0:if(p.s=1,b)for(;p.n.l&&$e(v,p.n.from)<0;)p={up:p,n:p.n.l,s:1};else for(;p.n.l;)p={up:p,n:p.n.l,s:1};case 1:if(p.s=2,!b||$e(v,p.n.to)<=0)return{value:p.n,done:!1};case 2:if(p.n.r){p.s=3,p={up:p,n:p.n.r,s:0};continue}case 3:p=p.up}return{done:!0}}}}function sc(h){var p,v,b=(((p=h.r)===null||p===void 0?void 0:p.d)||0)-(((v=h.l)===null||v===void 0?void 0:v.d)||0),A=1<b?"r":b<-1?"l":"";A&&(p=A=="r"?"l":"r",v=i({},h),b=h[A],h.from=b.from,h.to=b.to,h[A]=b[A],v[A]=b[p],(h[p]=v).d=nc(v)),h.d=nc(h)}function nc(v){var p=v.r,v=v.l;return(p?v?Math.max(p.d,v.d):p.d:v?v.d:0)+1}function yr(h,p){return r(p).forEach(function(v){h[v]?Tn(h[v],p[v]):h[v]=function b(A){var P,L,Y={};for(P in A)d(A,P)&&(L=A[P],Y[P]=!L||typeof L!="object"||Q.has(L.constructor)?L:b(L));return Y}(p[v])}),h}function Jo(h,p){return h.all||p.all||Object.keys(h).some(function(v){return p[v]&&ic(p[v],h[v])})}f(kt.prototype,((ti={add:function(h){return Tn(this,h),this},addKey:function(h){return bn(this,h,h),this},addKeys:function(h){var p=this;return h.forEach(function(v){return bn(p,v,v)}),this},hasKey:function(h){var p=wr(this).next(h).value;return p&&$e(p.from,h)<=0&&0<=$e(p.to,h)}})[de]=function(){return wr(this)},ti));var us={},$o={},ea=!1;function Ir(h){yr($o,h),ea||(ea=!0,setTimeout(function(){ea=!1,ta($o,!($o={}))},0))}function ta(h,p){p===void 0&&(p=!1);var v=new Set;if(h.all)for(var b=0,A=Object.values(us);b<A.length;b++)rc(L=A[b],h,v,p);else for(var P in h){var L,Y=/^idb\:\/\/(.*)\/(.*)\//.exec(P);Y&&(P=Y[1],Y=Y[2],(L=us["idb://".concat(P,"/").concat(Y)])&&rc(L,h,v,p))}v.forEach(function(Z){return Z()})}function rc(h,p,v,b){for(var A=[],P=0,L=Object.entries(h.queries.query);P<L.length;P++){for(var Y=L[P],Z=Y[0],j=[],$=0,H=Y[1];$<H.length;$++){var ee=H[$];Jo(p,ee.obsSet)?ee.subscribers.forEach(function(X){return v.add(X)}):b&&j.push(ee)}b&&A.push([Z,j])}if(b)for(var W=0,K=A;W<K.length;W++){var te=K[W],Z=te[0],j=te[1];h.queries.query[Z]=j}}function Md(h){var p=h._state,v=h._deps.indexedDB;if(p.isBeingOpened||h.idbdb)return p.dbReadyPromise.then(function(){return p.dbOpenError?wt(p.dbOpenError):h});p.isBeingOpened=!0,p.dbOpenError=null,p.openComplete=!1;var b=p.openCanceller,A=Math.round(10*h.verno),P=!1;function L(){if(p.openCanceller!==b)throw new ye.DatabaseClosed("db.open() was cancelled")}function Y(){return new Se(function(ee,W){if(L(),!v)throw new ye.MissingAPI;var K=h.name,te=p.autoSchema||!A?v.open(K):v.open(K,A);if(!te)throw new ye.MissingAPI;te.onerror=wi(W),te.onblocked=pt(h._fireOnBlocked),te.onupgradeneeded=pt(function(X){var ne;$=te.transaction,p.autoSchema&&!h._options.allowEmptyDB?(te.onerror=wn,$.abort(),te.result.close(),(ne=v.deleteDatabase(K)).onsuccess=ne.onerror=pt(function(){W(new ye.NoSuchDatabase("Database ".concat(K," doesnt exist")))})):($.onerror=wi(W),X=X.oldVersion>Math.pow(2,62)?0:X.oldVersion,H=X<1,h.idbdb=te.result,P&&Pd(h,$),Od(h,X/10,$,W))},W),te.onsuccess=pt(function(){$=null;var X,ne,ae,ce,me,Ce=h.idbdb=te.result,Re=I(Ce.objectStoreNames);if(0<Re.length)try{var be=Ce.transaction((ce=Re).length===1?ce[0]:ce,"readonly");if(p.autoSchema)ne=Ce,ae=be,(X=h).verno=ne.version/10,ae=X._dbSchema=gr(0,ne,ae),X._storeNames=I(ne.objectStoreNames,0),pr(X,[X._allTables],r(ae),ae);else if(Er(h,h._dbSchema,be),((me=Wo(gr(0,(me=h).idbdb,be),me._dbSchema)).add.length||me.change.some(function(_e){return _e.add.length||_e.change.length}))&&!P)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Ce.close(),A=Ce.version+1,P=!0,ee(Y());fr(h,be)}catch{}Ms.push(h),Ce.onversionchange=pt(function(_e){p.vcFired=!0,h.on("versionchange").fire(_e)}),Ce.onclose=pt(function(_e){h.on("close").fire(_e)}),H&&(me=h._deps,be=K,Ce=me.indexedDB,me=me.IDBKeyRange,Xo(Ce)||be===lr||Ko(Ce,me).put({name:be}).catch(He)),ee()},W)}).catch(function(ee){switch(ee==null?void 0:ee.name){case"UnknownError":if(0<p.PR1398_maxLoop)return p.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),Y();break;case"VersionError":if(0<A)return A=0,Y()}return Se.reject(ee)})}var Z,j=p.dbReadyResolve,$=null,H=!1;return Se.race([b,(typeof navigator>"u"?Se.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(ee){function W(){return indexedDB.databases().finally(ee)}Z=setInterval(W,100),W()}).finally(function(){return clearInterval(Z)}):Promise.resolve()).then(Y)]).then(function(){return L(),p.onReadyBeingFired=[],Se.resolve(Qo(function(){return h.on.ready.fire(h.vip)})).then(function ee(){if(0<p.onReadyBeingFired.length){var W=p.onReadyBeingFired.reduce(Ee,He);return p.onReadyBeingFired=[],Se.resolve(Qo(function(){return W(h.vip)})).then(ee)}})}).finally(function(){p.openCanceller===b&&(p.onReadyBeingFired=null,p.isBeingOpened=!1)}).catch(function(ee){p.dbOpenError=ee;try{$&&$.abort()}catch{}return b===p.openCanceller&&h._close(),wt(ee)}).finally(function(){p.openComplete=!0,j()}).then(function(){var ee;return H&&(ee={},h.tables.forEach(function(W){W.schema.indexes.forEach(function(K){K.name&&(ee["idb://".concat(h.name,"/").concat(W.name,"/").concat(K.name)]=new kt(-1/0,[[[]]]))}),ee["idb://".concat(h.name,"/").concat(W.name,"/")]=ee["idb://".concat(h.name,"/").concat(W.name,"/:dels")]=new kt(-1/0,[[[]]])}),Zi(yn).fire(ee),ta(ee,!0)),h})}function ia(h){function p(P){return h.next(P)}var v=A(p),b=A(function(P){return h.throw(P)});function A(P){return function(Z){var Y=P(Z),Z=Y.value;return Y.done?Z:Z&&typeof Z.then=="function"?Z.then(v,b):o(Z)?Promise.all(Z).then(v,b):v(Z)}}return A(p)()}function Cr(h,p,v){for(var b=o(h)?h.slice():[h],A=0;A<v;++A)b.push(p);return b}var Ld={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(h){return i(i({},h),{table:function(p){var v=h.table(p),b=v.schema,A={},P=[];function L(H,ee,W){var K=Cn(H),te=A[K]=A[K]||[],X=H==null?0:typeof H=="string"?1:H.length,ne=0<ee,ne=i(i({},W),{name:ne?"".concat(K,"(virtual-from:").concat(W.name,")"):W.name,lowLevelIndex:W,isVirtual:ne,keyTail:ee,keyLength:X,extractKey:Ho(H),unique:!ne&&W.unique});return te.push(ne),ne.isPrimaryKey||P.push(ne),1<X&&L(X===2?H[0]:H.slice(0,X-1),ee+1,W),te.sort(function(ae,ce){return ae.keyTail-ce.keyTail}),ne}p=L(b.primaryKey.keyPath,0,b.primaryKey),A[":id"]=[p];for(var Y=0,Z=b.indexes;Y<Z.length;Y++){var j=Z[Y];L(j.keyPath,0,j)}function $(H){var ee,W=H.query.index;return W.isVirtual?i(i({},H),{query:{index:W.lowLevelIndex,range:(ee=H.query.range,W=W.keyTail,{type:ee.type===1?2:ee.type,lower:Cr(ee.lower,ee.lowerOpen?h.MAX_KEY:h.MIN_KEY,W),lowerOpen:!0,upper:Cr(ee.upper,ee.upperOpen?h.MIN_KEY:h.MAX_KEY,W),upperOpen:!0})}}):H}return i(i({},v),{schema:i(i({},b),{primaryKey:p,indexes:P,getIndexByKeyPath:function(H){return(H=A[Cn(H)])&&H[0]}}),count:function(H){return v.count($(H))},query:function(H){return v.query($(H))},openCursor:function(H){var ee=H.query.index,W=ee.keyTail,K=ee.isVirtual,te=ee.keyLength;return K?v.openCursor($(H)).then(function(ne){return ne&&X(ne)}):v.openCursor(H);function X(ne){return Object.create(ne,{continue:{value:function(ae){ae!=null?ne.continue(Cr(ae,H.reverse?h.MAX_KEY:h.MIN_KEY,W)):H.unique?ne.continue(ne.key.slice(0,te).concat(H.reverse?h.MIN_KEY:h.MAX_KEY,W)):ne.continue()}},continuePrimaryKey:{value:function(ae,ce){ne.continuePrimaryKey(Cr(ae,h.MAX_KEY,W),ce)}},primaryKey:{get:function(){return ne.primaryKey}},key:{get:function(){var ae=ne.key;return te===1?ae[0]:ae.slice(0,te)}},value:{get:function(){return ne.value}}})}}})}})}};function sa(h,p,v,b){return v=v||{},b=b||"",r(h).forEach(function(A){var P,L,Y;d(p,A)?(P=h[A],L=p[A],typeof P=="object"&&typeof L=="object"&&P&&L?(Y=J(P))!==J(L)?v[b+A]=p[A]:Y==="Object"?sa(P,L,v,b+A+"."):P!==L&&(v[b+A]=p[A]):P!==L&&(v[b+A]=p[A])):v[b+A]=void 0}),r(p).forEach(function(A){d(h,A)||(v[b+A]=p[A])}),v}function na(h,p){return p.type==="delete"?p.keys:p.keys||p.values.map(h.extractKey)}var Nd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(h){return i(i({},h),{table:function(p){var v=h.table(p),b=v.schema.primaryKey;return i(i({},v),{mutate:function(A){var P=Le.trans,L=P.table(p).hook,Y=L.deleting,Z=L.creating,j=L.updating;switch(A.type){case"add":if(Z.fire===He)break;return P._promise("readwrite",function(){return $(A)},!0);case"put":if(Z.fire===He&&j.fire===He)break;return P._promise("readwrite",function(){return $(A)},!0);case"delete":if(Y.fire===He)break;return P._promise("readwrite",function(){return $(A)},!0);case"deleteRange":if(Y.fire===He)break;return P._promise("readwrite",function(){return function H(ee,W,K){return v.query({trans:ee,values:!1,query:{index:b,range:W},limit:K}).then(function(te){var X=te.result;return $({type:"delete",keys:X,trans:ee}).then(function(ne){return 0<ne.numFailures?Promise.reject(ne.failures[0]):X.length<K?{failures:[],numFailures:0,lastResult:void 0}:H(ee,i(i({},W),{lower:X[X.length-1],lowerOpen:!0}),K)})})}(A.trans,A.range,1e4)},!0)}return v.mutate(A);function $(H){var ee,W,K,te=Le.trans,X=H.keys||na(b,H);if(!X)throw new Error("Keys missing");return(H=H.type==="add"||H.type==="put"?i(i({},H),{keys:X}):i({},H)).type!=="delete"&&(H.values=s([],H.values)),H.keys&&(H.keys=s([],H.keys)),ee=v,K=X,((W=H).type==="add"?Promise.resolve([]):ee.getMany({trans:W.trans,keys:K,cache:"immutable"})).then(function(ne){var ae=X.map(function(ce,me){var Ce,Re,be,_e=ne[me],Fe={onerror:null,onsuccess:null};return H.type==="delete"?Y.fire.call(Fe,ce,_e,te):H.type==="add"||_e===void 0?(Ce=Z.fire.call(Fe,ce,H.values[me],te),ce==null&&Ce!=null&&(H.keys[me]=ce=Ce,b.outbound||D(H.values[me],b.keyPath,ce))):(Ce=sa(_e,H.values[me]),(Re=j.fire.call(Fe,Ce,ce,_e,te))&&(be=H.values[me],Object.keys(Re).forEach(function(we){d(be,we)?be[we]=Re[we]:D(be,we,Re[we])}))),Fe});return v.mutate(H).then(function(ce){for(var me=ce.failures,Ce=ce.results,Re=ce.numFailures,ce=ce.lastResult,be=0;be<X.length;++be){var _e=(Ce||X)[be],Fe=ae[be];_e==null?Fe.onerror&&Fe.onerror(me[be]):Fe.onsuccess&&Fe.onsuccess(H.type==="put"&&ne[be]?H.values[be]:_e)}return{failures:me,results:Ce,numFailures:Re,lastResult:ce}}).catch(function(ce){return ae.forEach(function(me){return me.onerror&&me.onerror(ce)}),Promise.reject(ce)})})}}})}})}};function oc(h,p,v){try{if(!p||p.keys.length<h.length)return null;for(var b=[],A=0,P=0;A<p.keys.length&&P<h.length;++A)$e(p.keys[A],h[P])===0&&(b.push(v?V(p.values[A]):p.values[A]),++P);return b.length===h.length?b:null}catch{return null}}var Ud={stack:"dbcore",level:-1,create:function(h){return{table:function(p){var v=h.table(p);return i(i({},v),{getMany:function(b){if(!b.cache)return v.getMany(b);var A=oc(b.keys,b.trans._cache,b.cache==="clone");return A?Se.resolve(A):v.getMany(b).then(function(P){return b.trans._cache={keys:b.keys,values:b.cache==="clone"?V(P):P},P})},mutate:function(b){return b.type!=="add"&&(b.trans._cache=null),v.mutate(b)}})}}}};function ac(h,p){return h.trans.mode==="readonly"&&!!h.subscr&&!h.trans.explicit&&h.trans.db._options.cache!=="disabled"&&!p.schema.primaryKey.outbound}function lc(h,p){switch(h){case"query":return p.values&&!p.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Bd={stack:"dbcore",level:0,name:"Observability",create:function(h){var p=h.schema.name,v=new kt(h.MIN_KEY,h.MAX_KEY);return i(i({},h),{transaction:function(b,A,P){if(Le.subscr&&A!=="readonly")throw new ye.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Le.querier));return h.transaction(b,A,P)},table:function(b){var A=h.table(b),P=A.schema,L=P.primaryKey,H=P.indexes,Y=L.extractKey,Z=L.outbound,j=L.autoIncrement&&H.filter(function(W){return W.compound&&W.keyPath.includes(L.keyPath)}),$=i(i({},A),{mutate:function(W){function K(we){return we="idb://".concat(p,"/").concat(b,"/").concat(we),ce[we]||(ce[we]=new kt)}var te,X,ne,ae=W.trans,ce=W.mutatedParts||(W.mutatedParts={}),me=K(""),Ce=K(":dels"),Re=W.type,Fe=W.type==="deleteRange"?[W.range]:W.type==="delete"?[W.keys]:W.values.length<50?[na(L,W).filter(function(we){return we}),W.values]:[],be=Fe[0],_e=Fe[1],Fe=W.trans._cache;return o(be)?(me.addKeys(be),(Fe=Re==="delete"||be.length===_e.length?oc(be,Fe):null)||Ce.addKeys(be),(Fe||_e)&&(te=K,X=Fe,ne=_e,P.indexes.forEach(function(we){var Ve=te(we.name||"");function Ge(Xe){return Xe!=null?we.extractKey(Xe):null}function qe(Xe){return we.multiEntry&&o(Xe)?Xe.forEach(function(ci){return Ve.addKey(ci)}):Ve.addKey(Xe)}(X||ne).forEach(function(Xe,Dt){var Qe=X&&Ge(X[Dt]),Dt=ne&&Ge(ne[Dt]);$e(Qe,Dt)!==0&&(Qe!=null&&qe(Qe),Dt!=null&&qe(Dt))})}))):be?(_e={from:be.lower,to:be.upper},Ce.add(_e),me.add(_e)):(me.add(v),Ce.add(v),P.indexes.forEach(function(we){return K(we.name).add(v)})),A.mutate(W).then(function(we){return!be||W.type!=="add"&&W.type!=="put"||(me.addKeys(we.results),j&&j.forEach(function(Ve){var Ge=W.values.map(function(Xe){return Ve.extractKey(Xe)}),qe=Ve.keyPath.findIndex(function(Xe){return Xe===L.keyPath});we.results.forEach(function(Xe){return Ge[qe]=Xe}),K(Ve.name).addKeys(Ge)})),ae.mutatedParts=yr(ae.mutatedParts||{},ce),we})}}),H=function(K){var te=K.query,K=te.index,te=te.range;return[K,new kt((K=te.lower)!==null&&K!==void 0?K:h.MIN_KEY,(te=te.upper)!==null&&te!==void 0?te:h.MAX_KEY)]},ee={get:function(W){return[L,new kt(W.key)]},getMany:function(W){return[L,new kt().addKeys(W.keys)]},count:H,query:H,openCursor:H};return r(ee).forEach(function(W){$[W]=function(K){var te=Le.subscr,X=!!te,ne=ac(Le,A)&&lc(W,K)?K.obsSet={}:te;if(X){var ae=function(_e){return _e="idb://".concat(p,"/").concat(b,"/").concat(_e),ne[_e]||(ne[_e]=new kt)},ce=ae(""),me=ae(":dels"),te=ee[W](K),X=te[0],te=te[1];if((W==="query"&&X.isPrimaryKey&&!K.values?me:ae(X.name||"")).add(te),!X.isPrimaryKey){if(W!=="count"){var Ce=W==="query"&&Z&&K.values&&A.query(i(i({},K),{values:!1}));return A[W].apply(this,arguments).then(function(_e){if(W==="query"){if(Z&&K.values)return Ce.then(function(Ge){return Ge=Ge.result,ce.addKeys(Ge),_e});var Fe=K.values?_e.result.map(Y):_e.result;(K.values?ce:me).addKeys(Fe)}else if(W==="openCursor"){var we=_e,Ve=K.values;return we&&Object.create(we,{key:{get:function(){return me.addKey(we.primaryKey),we.key}},primaryKey:{get:function(){var Ge=we.primaryKey;return me.addKey(Ge),Ge}},value:{get:function(){return Ve&&ce.addKey(we.primaryKey),we.value}}})}return _e})}me.add(v)}}return A[W].apply(this,arguments)}}),$}})}};function cc(h,p,v){if(v.numFailures===0)return p;if(p.type==="deleteRange")return null;var b=p.keys?p.keys.length:"values"in p&&p.values?p.values.length:1;return v.numFailures===b?null:(p=i({},p),o(p.keys)&&(p.keys=p.keys.filter(function(A,P){return!(P in v.failures)})),"values"in p&&o(p.values)&&(p.values=p.values.filter(function(A,P){return!(P in v.failures)})),p)}function ra(h,p){return v=h,((b=p).lower===void 0||(b.lowerOpen?0<$e(v,b.lower):0<=$e(v,b.lower)))&&(h=h,(p=p).upper===void 0||(p.upperOpen?$e(h,p.upper)<0:$e(h,p.upper)<=0));var v,b}function hc(h,p,ee,b,A,P){if(!ee||ee.length===0)return h;var L=p.query.index,Y=L.multiEntry,Z=p.query.range,j=b.schema.primaryKey.extractKey,$=L.extractKey,H=(L.lowLevelIndex||L).extractKey,ee=ee.reduce(function(W,K){var te=W,X=[];if(K.type==="add"||K.type==="put")for(var ne=new kt,ae=K.values.length-1;0<=ae;--ae){var ce,me=K.values[ae],Ce=j(me);ne.hasKey(Ce)||(ce=$(me),(Y&&o(ce)?ce.some(function(Fe){return ra(Fe,Z)}):ra(ce,Z))&&(ne.addKey(Ce),X.push(me)))}switch(K.type){case"add":te=W.concat(p.values?X:X.map(function(we){return j(we)}));break;case"put":var Re=new kt().addKeys(K.values.map(function(we){return j(we)})),te=W.filter(function(we){return!Re.hasKey(p.values?j(we):we)}).concat(p.values?X:X.map(function(we){return j(we)}));break;case"delete":var be=new kt().addKeys(K.keys);te=W.filter(function(we){return!be.hasKey(p.values?j(we):we)});break;case"deleteRange":var _e=K.range;te=W.filter(function(we){return!ra(j(we),_e)})}return te},h);return ee===h?h:(ee.sort(function(W,K){return $e(H(W),H(K))||$e(j(W),j(K))}),p.limit&&p.limit<1/0&&(ee.length>p.limit?ee.length=p.limit:h.length===p.limit&&ee.length<p.limit&&(A.dirty=!0)),P?Object.freeze(ee):ee)}function uc(h,p){return $e(h.lower,p.lower)===0&&$e(h.upper,p.upper)===0&&!!h.lowerOpen==!!p.lowerOpen&&!!h.upperOpen==!!p.upperOpen}function kd(h,p){return function(v,b,A,P){if(v===void 0)return b!==void 0?-1:0;if(b===void 0)return 1;if((b=$e(v,b))===0){if(A&&P)return 0;if(A)return 1;if(P)return-1}return b}(h.lower,p.lower,h.lowerOpen,p.lowerOpen)<=0&&0<=function(v,b,A,P){if(v===void 0)return b!==void 0?1:0;if(b===void 0)return-1;if((b=$e(v,b))===0){if(A&&P)return 0;if(A)return-1;if(P)return 1}return b}(h.upper,p.upper,h.upperOpen,p.upperOpen)}function zd(h,p,v,b){h.subscribers.add(v),b.addEventListener("abort",function(){var A,P;h.subscribers.delete(v),h.subscribers.size===0&&(A=h,P=p,setTimeout(function(){A.subscribers.size===0&&ve(P,A)},3e3))})}var Vd={stack:"dbcore",level:0,name:"Cache",create:function(h){var p=h.schema.name;return i(i({},h),{transaction:function(v,b,A){var P,L,Y=h.transaction(v,b,A);return b==="readwrite"&&(L=(P=new AbortController).signal,A=function(Z){return function(){if(P.abort(),b==="readwrite"){for(var j=new Set,$=0,H=v;$<H.length;$++){var ee=H[$],W=us["idb://".concat(p,"/").concat(ee)];if(W){var K=h.table(ee),te=W.optimisticOps.filter(function(Ve){return Ve.trans===Y});if(Y._explicit&&Z&&Y.mutatedParts)for(var X=0,ne=Object.values(W.queries.query);X<ne.length;X++)for(var ae=0,ce=(Re=ne[X]).slice();ae<ce.length;ae++)Jo((be=ce[ae]).obsSet,Y.mutatedParts)&&(ve(Re,be),be.subscribers.forEach(function(Ve){return j.add(Ve)}));else if(0<te.length){W.optimisticOps=W.optimisticOps.filter(function(Ve){return Ve.trans!==Y});for(var me=0,Ce=Object.values(W.queries.query);me<Ce.length;me++)for(var Re,be,_e,Fe=0,we=(Re=Ce[me]).slice();Fe<we.length;Fe++)(be=we[Fe]).res!=null&&Y.mutatedParts&&(Z&&!be.dirty?(_e=Object.isFrozen(be.res),_e=hc(be.res,be.req,te,K,be,_e),be.dirty?(ve(Re,be),be.subscribers.forEach(function(Ve){return j.add(Ve)})):_e!==be.res&&(be.res=_e,be.promise=Se.resolve({result:_e}))):(be.dirty&&ve(Re,be),be.subscribers.forEach(function(Ve){return j.add(Ve)})))}}}j.forEach(function(Ve){return Ve()})}}},Y.addEventListener("abort",A(!1),{signal:L}),Y.addEventListener("error",A(!1),{signal:L}),Y.addEventListener("complete",A(!0),{signal:L})),Y},table:function(v){var b=h.table(v),A=b.schema.primaryKey;return i(i({},b),{mutate:function(P){var L=Le.trans;if(A.outbound||L.db._options.cache==="disabled"||L.explicit)return b.mutate(P);var Y=us["idb://".concat(p,"/").concat(v)];return Y?(L=b.mutate(P),P.type!=="add"&&P.type!=="put"||!(50<=P.values.length||na(A,P).some(function(Z){return Z==null}))?(Y.optimisticOps.push(P),P.mutatedParts&&Ir(P.mutatedParts),L.then(function(Z){0<Z.numFailures&&(ve(Y.optimisticOps,P),(Z=cc(0,P,Z))&&Y.optimisticOps.push(Z),P.mutatedParts&&Ir(P.mutatedParts))}),L.catch(function(){ve(Y.optimisticOps,P),P.mutatedParts&&Ir(P.mutatedParts)})):L.then(function(Z){var j=cc(0,i(i({},P),{values:P.values.map(function(W,H){var ee,W=(ee=A.keyPath)!==null&&ee!==void 0&&ee.includes(".")?V(W):i({},W);return D(W,A.keyPath,Z.results[H]),W})}),Z);Y.optimisticOps.push(j),queueMicrotask(function(){return P.mutatedParts&&Ir(P.mutatedParts)})}),L):b.mutate(P)},query:function(P){if(!ac(Le,b)||!lc("query",P))return b.query(P);var L=((j=Le.trans)===null||j===void 0?void 0:j.db._options.cache)==="immutable",H=Le,Y=H.requery,Z=H.signal,j=function(K,te,X,ne){var ae=us["idb://".concat(K,"/").concat(te)];if(!ae)return[];if(!(te=ae.queries[X]))return[null,!1,ae,null];var ce=te[(ne.query?ne.query.index.name:null)||""];if(!ce)return[null,!1,ae,null];switch(X){case"query":var me=ce.find(function(Ce){return Ce.req.limit===ne.limit&&Ce.req.values===ne.values&&uc(Ce.req.query.range,ne.query.range)});return me?[me,!0,ae,ce]:[ce.find(function(Ce){return("limit"in Ce.req?Ce.req.limit:1/0)>=ne.limit&&(!ne.values||Ce.req.values)&&kd(Ce.req.query.range,ne.query.range)}),!1,ae,ce];case"count":return me=ce.find(function(Ce){return uc(Ce.req.query.range,ne.query.range)}),[me,!!me,ae,ce]}}(p,v,"query",P),$=j[0],H=j[1],ee=j[2],W=j[3];return $&&H?$.obsSet=P.obsSet:(H=b.query(P).then(function(K){var te=K.result;if($&&($.res=te),L){for(var X=0,ne=te.length;X<ne;++X)Object.freeze(te[X]);Object.freeze(te)}else K.result=V(te);return K}).catch(function(K){return W&&$&&ve(W,$),Promise.reject(K)}),$={obsSet:P.obsSet,promise:H,subscribers:new Set,type:"query",req:P,dirty:!1},W?W.push($):(W=[$],(ee=ee||(us["idb://".concat(p,"/").concat(v)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[P.query.index.name||""]=W)),zd($,W,Y,Z),$.promise.then(function(K){return{result:hc(K.result,P,ee==null?void 0:ee.optimisticOps,b,$,L)}})}})}})}};function br(h,p){return new Proxy(h,{get:function(v,b,A){return b==="db"?p:Reflect.get(v,b,A)}})}var Pi=(yt.prototype.version=function(h){if(isNaN(h)||h<.1)throw new ye.Type("Given version is not a positive number");if(h=Math.round(10*h)/10,this.idbdb||this._state.isBeingOpened)throw new ye.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,h);var p=this._versions,v=p.filter(function(b){return b._cfg.version===h})[0];return v||(v=new this.Version(h),p.push(v),p.sort(Sd),v.stores({}),this._state.autoSchema=!1,v)},yt.prototype._whenReady=function(h){var p=this;return this.idbdb&&(this._state.openComplete||Le.letThrough||this._vip)?h():new Se(function(v,b){if(p._state.openComplete)return b(new ye.DatabaseClosed(p._state.dbOpenError));if(!p._state.isBeingOpened){if(!p._state.autoOpen)return void b(new ye.DatabaseClosed);p.open().catch(He)}p._state.dbReadyPromise.then(v,b)}).then(h)},yt.prototype.use=function(h){var p=h.stack,v=h.create,b=h.level,A=h.name;return A&&this.unuse({stack:p,name:A}),h=this._middlewares[p]||(this._middlewares[p]=[]),h.push({stack:p,create:v,level:b??10,name:A}),h.sort(function(P,L){return P.level-L.level}),this},yt.prototype.unuse=function(h){var p=h.stack,v=h.name,b=h.create;return p&&this._middlewares[p]&&(this._middlewares[p]=this._middlewares[p].filter(function(A){return b?A.create!==b:!!v&&A.name!==v})),this},yt.prototype.open=function(){var h=this;return ls(Xt,function(){return Md(h)})},yt.prototype._close=function(){var h=this._state,p=Ms.indexOf(this);if(0<=p&&Ms.splice(p,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}h.isBeingOpened||(h.dbReadyPromise=new Se(function(v){h.dbReadyResolve=v}),h.openCanceller=new Se(function(v,b){h.cancelOpen=b}))},yt.prototype.close=function(v){var p=(v===void 0?{disableAutoOpen:!0}:v).disableAutoOpen,v=this._state;p?(v.isBeingOpened&&v.cancelOpen(new ye.DatabaseClosed),this._close(),v.autoOpen=!1,v.dbOpenError=new ye.DatabaseClosed):(this._close(),v.autoOpen=this._options.autoOpen||v.isBeingOpened,v.openComplete=!1,v.dbOpenError=null)},yt.prototype.delete=function(h){var p=this;h===void 0&&(h={disableAutoOpen:!0});var v=0<arguments.length&&typeof arguments[0]!="object",b=this._state;return new Se(function(A,P){function L(){p.close(h);var Y=p._deps.indexedDB.deleteDatabase(p.name);Y.onsuccess=pt(function(){var Z,j,$;Z=p._deps,j=p.name,$=Z.indexedDB,Z=Z.IDBKeyRange,Xo($)||j===lr||Ko($,Z).delete(j).catch(He),A()}),Y.onerror=wi(P),Y.onblocked=p._fireOnBlocked}if(v)throw new ye.InvalidArgument("Invalid closeOptions argument to db.delete()");b.isBeingOpened?b.dbReadyPromise.then(L):L()})},yt.prototype.backendDB=function(){return this.idbdb},yt.prototype.isOpen=function(){return this.idbdb!==null},yt.prototype.hasBeenClosed=function(){var h=this._state.dbOpenError;return h&&h.name==="DatabaseClosed"},yt.prototype.hasFailed=function(){return this._state.dbOpenError!==null},yt.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(yt.prototype,"tables",{get:function(){var h=this;return r(this._allTables).map(function(p){return h._allTables[p]})},enumerable:!1,configurable:!0}),yt.prototype.transaction=function(){var h=(function(p,v,b){var A=arguments.length;if(A<2)throw new ye.InvalidArgument("Too few arguments");for(var P=new Array(A-1);--A;)P[A-1]=arguments[A];return b=P.pop(),[p,G(P),b]}).apply(this,arguments);return this._transaction.apply(this,h)},yt.prototype._transaction=function(h,p,v){var b=this,A=Le.trans;A&&A.db===this&&h.indexOf("!")===-1||(A=null);var P,L,Y=h.indexOf("?")!==-1;h=h.replace("!","").replace("?","");try{if(L=p.map(function(j){if(j=j instanceof b.Table?j.name:j,typeof j!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return j}),h=="r"||h===No)P=No;else{if(h!="rw"&&h!=Uo)throw new ye.InvalidArgument("Invalid transaction mode: "+h);P=Uo}if(A){if(A.mode===No&&P===Uo){if(!Y)throw new ye.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");A=null}A&&L.forEach(function(j){if(A&&A.storeNames.indexOf(j)===-1){if(!Y)throw new ye.SubTransaction("Table "+j+" not included in parent transaction.");A=null}}),Y&&A&&!A.active&&(A=null)}}catch(j){return A?A._promise(null,function($,H){H(j)}):wt(j)}var Z=(function j($,H,ee,W,K){return Se.resolve().then(function(){var te=Le.transless||Le,X=$._createTransaction(H,ee,$._dbSchema,W);if(X.explicit=!0,te={trans:X,transless:te},W)X.idbtrans=W.idbtrans;else try{X.create(),X.idbtrans._explicit=!0,$._state.PR1398_maxLoop=3}catch(ce){return ce.name===at.InvalidState&&$.isOpen()&&0<--$._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),$.close({disableAutoOpen:!1}),$.open().then(function(){return j($,H,ee,null,K)})):wt(ce)}var ne,ae=oe(K);return ae&&Ds(),te=Se.follow(function(){var ce;(ne=K.call(X,X))&&(ae?(ce=Hi.bind(null,null),ne.then(ce,ce)):typeof ne.next=="function"&&typeof ne.throw=="function"&&(ne=ia(ne)))},te),(ne&&typeof ne.then=="function"?Se.resolve(ne).then(function(ce){return X.active?ce:wt(new ye.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):te.then(function(){return ne})).then(function(ce){return W&&X._resolve(),X._completion.then(function(){return ce})}).catch(function(ce){return X._reject(ce),wt(ce)})})}).bind(null,this,P,L,A,v);return A?A._promise(P,Z,"lock"):Le.trans?ls(Le.transless,function(){return b._whenReady(Z)}):this._whenReady(Z)},yt.prototype.table=function(h){if(!d(this._allTables,h))throw new ye.InvalidTable("Table ".concat(h," does not exist"));return this._allTables[h]},yt);function yt(h,p){var v=this;this._middlewares={},this.verno=0;var b=yt.dependencies;this._options=p=i({addons:yt.addons,autoOpen:!0,indexedDB:b.indexedDB,IDBKeyRange:b.IDBKeyRange,cache:"cloned"},p),this._deps={indexedDB:p.indexedDB,IDBKeyRange:p.IDBKeyRange},b=p.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var A,P,L,Y,Z,j={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:He,dbReadyPromise:null,cancelOpen:He,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:p.autoOpen};j.dbReadyPromise=new Se(function(H){j.dbReadyResolve=H}),j.openCanceller=new Se(function(H,ee){j.cancelOpen=ee}),this._state=j,this.name=h,this.on=gn(this,"populate","blocked","versionchange","close",{ready:[Ee,He]}),this.on.ready.subscribe=_(this.on.ready.subscribe,function(H){return function(ee,W){yt.vip(function(){var K,te=v._state;te.openComplete?(te.dbOpenError||Se.resolve().then(ee),W&&H(ee)):te.onReadyBeingFired?(te.onReadyBeingFired.push(ee),W&&H(ee)):(H(ee),K=v,W||H(function X(){K.on.ready.unsubscribe(ee),K.on.ready.unsubscribe(X)}))})}}),this.Collection=(A=this,En(bd.prototype,function(ne,X){this.db=A;var W=Yl,K=null;if(X)try{W=X()}catch(ae){K=ae}var te=ne._ctx,X=te.table,ne=X.hook.reading.fire;this._ctx={table:X,index:te.index,isPrimKey:!te.index||X.schema.primKey.keyPath&&te.index===X.schema.primKey.name,range:W,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:K,or:te.or,valueMapper:ne!==vt?ne:null}})),this.Table=(P=this,En(Wl.prototype,function(H,ee,W){this.db=P,this._tx=W,this.name=H,this.schema=ee,this.hook=P._allTables[H]?P._allTables[H].hook:gn(null,{creating:[he,He],reading:[x,vt],updating:[U,He],deleting:[k,He]})})),this.Transaction=(L=this,En(Ad.prototype,function(H,ee,W,K,te){var X=this;this.db=L,this.mode=H,this.storeNames=ee,this.schema=W,this.chromeTransactionDurability=K,this.idbtrans=null,this.on=gn(this,"complete","error","abort"),this.parent=te||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Se(function(ne,ae){X._resolve=ne,X._reject=ae}),this._completion.then(function(){X.active=!1,X.on.complete.fire()},function(ne){var ae=X.active;return X.active=!1,X.on.error.fire(ne),X.parent?X.parent._reject(ne):ae&&X.idbtrans&&X.idbtrans.abort(),wt(ne)})})),this.Version=(Y=this,En(Dd.prototype,function(H){this.db=Y,this._cfg={version:H,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(Z=this,En(ql.prototype,function(H,ee,W){if(this.db=Z,this._ctx={table:H,index:ee===":id"?null:ee,or:W},this._cmp=this._ascending=$e,this._descending=function(K,te){return $e(te,K)},this._max=function(K,te){return 0<$e(K,te)?K:te},this._min=function(K,te){return $e(K,te)<0?K:te},this._IDBKeyRange=Z._deps.IDBKeyRange,!this._IDBKeyRange)throw new ye.MissingAPI})),this.on("versionchange",function(H){0<H.newVersion?console.warn("Another connection wants to upgrade database '".concat(v.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(v.name,"'. Closing db now to resume the delete request.")),v.close({disableAutoOpen:!1})}),this.on("blocked",function(H){!H.newVersion||H.newVersion<H.oldVersion?console.warn("Dexie.delete('".concat(v.name,"') was blocked")):console.warn("Upgrade '".concat(v.name,"' blocked by other connection holding version ").concat(H.oldVersion/10))}),this._maxKey=In(p.IDBKeyRange),this._createTransaction=function(H,ee,W,K){return new v.Transaction(H,ee,W,v._options.chromeTransactionDurability,K)},this._fireOnBlocked=function(H){v.on("blocked").fire(H),Ms.filter(function(ee){return ee.name===v.name&&ee!==v&&!ee._state.vcFired}).map(function(ee){return ee.on("versionchange").fire(H)})},this.use(Ud),this.use(Vd),this.use(Bd),this.use(Ld),this.use(Nd);var $=new Proxy(this,{get:function(H,ee,W){if(ee==="_vip")return!0;if(ee==="table")return function(te){return br(v.table(te),$)};var K=Reflect.get(H,ee,W);return K instanceof Wl?br(K,$):ee==="tables"?K.map(function(te){return br(te,$)}):ee==="_createTransaction"?function(){return br(K.apply(this,arguments),$)}:K}});this.vip=$,b.forEach(function(H){return H(v)})}var Tr,ti=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Yd=(oa.prototype.subscribe=function(h,p,v){return this._subscribe(h&&typeof h!="function"?h:{next:h,error:p,complete:v})},oa.prototype[ti]=function(){return this},oa);function oa(h){this._subscribe=h}try{Tr={indexedDB:n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB,IDBKeyRange:n.IDBKeyRange||n.webkitIDBKeyRange}}catch{Tr={indexedDB:null,IDBKeyRange:null}}function dc(h){var p,v=!1,b=new Yd(function(A){var P=oe(h),L,Y=!1,Z={},j={},$={get closed(){return Y},unsubscribe:function(){Y||(Y=!0,L&&L.abort(),H&&Zi.storagemutated.unsubscribe(W))}};A.start&&A.start($);var H=!1,ee=function(){return Lo(K)},W=function(te){yr(Z,te),Jo(j,Z)&&ee()},K=function(){var te,X,ne;!Y&&Tr.indexedDB&&(Z={},te={},L&&L.abort(),L=new AbortController,ne=function(ae){var ce=Os();try{P&&Ds();var me=Gi(h,ae);return me=P?me.finally(Hi):me}finally{ce&&Ps()}}(X={subscr:te,signal:L.signal,requery:ee,querier:h,trans:null}),Promise.resolve(ne).then(function(ae){v=!0,p=ae,Y||X.signal.aborted||(Z={},function(ce){for(var me in ce)if(d(ce,me))return;return 1}(j=te)||H||(Zi(yn,W),H=!0),Lo(function(){return!Y&&A.next&&A.next(ae)}))},function(ae){v=!1,["DatabaseClosedError","AbortError"].includes(ae==null?void 0:ae.name)||Y||Lo(function(){Y||A.error&&A.error(ae)})}))};return setTimeout(ee,0),$});return b.hasValue=function(){return v},b.getValue=function(){return p},b}var ds=Pi;function aa(h){var p=Ki;try{Ki=!0,Zi.storagemutated.fire(h),ta(h,!0)}finally{Ki=p}}f(ds,i(i({},Je),{delete:function(h){return new ds(h,{addons:[]}).delete()},exists:function(h){return new ds(h,{addons:[]}).open().then(function(p){return p.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(h){try{return p=ds.dependencies,v=p.indexedDB,p=p.IDBKeyRange,(Xo(v)?Promise.resolve(v.databases()).then(function(b){return b.map(function(A){return A.name}).filter(function(A){return A!==lr})}):Ko(v,p).toCollection().primaryKeys()).then(h)}catch{return wt(new ye.MissingAPI)}var p,v},defineClass:function(){return function(h){a(this,h)}},ignoreTransaction:function(h){return Le.trans?ls(Le.transless,h):h()},vip:Qo,async:function(h){return function(){try{var p=ia(h.apply(this,arguments));return p&&typeof p.then=="function"?p:Se.resolve(p)}catch(v){return wt(v)}}},spawn:function(h,p,v){try{var b=ia(h.apply(v,p||[]));return b&&typeof b.then=="function"?b:Se.resolve(b)}catch(A){return wt(A)}},currentTransaction:{get:function(){return Le.trans||null}},waitFor:function(h,p){return p=Se.resolve(typeof h=="function"?ds.ignoreTransaction(h):h).timeout(p||6e4),Le.trans?Le.trans.waitFor(p):p},Promise:Se,debug:{get:function(){return ge},set:function(h){se(h)}},derive:g,extend:a,props:f,override:_,Events:gn,on:Zi,liveQuery:dc,extendObservabilitySet:yr,getByKeyPath:M,setByKeyPath:D,delByKeyPath:function(h,p){typeof p=="string"?D(h,p,void 0):"length"in p&&[].map.call(p,function(v){D(h,v,void 0)})},shallowClone:B,deepClone:V,getObjectDiff:sa,cmp:$e,asap:F,minKey:-1/0,addons:[],connections:Ms,errnames:at,dependencies:Tr,cache:us,semVer:"4.0.8",version:"4.0.8".split(".").map(function(h){return parseInt(h)}).reduce(function(h,p,v){return h+p/Math.pow(10,2*v)})})),ds.maxKey=In(ds.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Zi(yn,function(h){Ki||(h=new CustomEvent(Vo,{detail:h}),Ki=!0,dispatchEvent(h),Ki=!1)}),addEventListener(Vo,function(h){h=h.detail,Ki||aa(h)}));var Us,Ki=!1,fc=function(){};return typeof BroadcastChannel<"u"&&((fc=function(){(Us=new BroadcastChannel(Vo)).onmessage=function(h){return h.data&&aa(h.data)}})(),typeof Us.unref=="function"&&Us.unref(),Zi(yn,function(h){Ki||Us.postMessage(h)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(h){if(!Pi.disableBfCache&&h.persisted){ge&&console.debug("Dexie: handling persisted pagehide"),Us!=null&&Us.close();for(var p=0,v=Ms;p<v.length;p++)v[p].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(h){!Pi.disableBfCache&&h.persisted&&(ge&&console.debug("Dexie: handling persisted pageshow"),fc(),aa({all:new kt(-1/0,[[]])}))})),Se.rejectionMapper=function(h,p){return!h||h instanceof Me||h instanceof TypeError||h instanceof SyntaxError||!h.name||!Ye[h.name]?h:(p=new Ye[h.name](p||h.message,h),"stack"in h&&E(p,"stack",{get:function(){return this.inner.stack}}),p)},se(ge),i(Pi,Object.freeze({__proto__:null,Dexie:Pi,liveQuery:dc,Entity:Gl,cmp:$e,PropModSymbol:Oi,PropModification:vn,replacePrefix:function(h,p){return new vn({replacePrefix:[h,p]})},add:function(h){return new vn({add:h})},remove:function(h){return new vn({remove:h})},default:Pi,RangeSet:kt,mergeRanges:Tn,rangesOverlap:ic}),{default:Pi}),Pi})})(fd);var J0=fd.exports;const al=Nu(J0),wh=Symbol.for("Dexie"),ll=globalThis[wh]||(globalThis[wh]=al);if(al.semVer!==ll.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${al.semVer} and ${ll.semVer}`);class $0 extends ll{constructor(){super("MyAppDatabase"),S(this,"files"),this.version(1).stores({files:"id, file"})}}class e1{constructor(e){S(this,"interval",1e4),S(this,"maxTime",6e4),S(this,"list",new Map),S(this,"_enabled",!1),S(this,"_intervalId",null),S(this,"_fileCache"),this._fileCache=e}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e){if(this._enabled=e,!e){this._intervalId!==null&&clearInterval(this._intervalId),this._intervalId=null;return}this._intervalId=window.setInterval(()=>{const t=new Date().getTime();for(const[i,s]of this.list)t-s>this.maxTime&&this.clean(i)},this.interval)}}update(e){this.enabled&&this.list.set(e,new Date().getTime())}async clear(){for(const[e]of this.list)this.clean(e)}clean(e){try{this._fileCache.files.delete(e)}catch{console.log(`File not found in indexedDB: ${e}`)}this.list.delete(e)}}const pd=class cl extends Ke{constructor(e){super(e),S(this,"enabled",!0),S(this,"onFragmentsDeleted",new le),S(this,"onFragmentsLoaded",new le),S(this,"onDisposed",new le),S(this,"models",{}),S(this,"serializer",new _h),S(this,"maxRamTime",5e3),S(this,"useCache",!0),S(this,"dbCleaner"),S(this,"fetch",async t=>fetch(t)),S(this,"_culler",null),S(this,"_world",null),S(this,"_ramCache",new Map),S(this,"_fileCache",new $0),S(this,"_url",null),S(this,"_isDisposing",!1),S(this,"_geometryInstances",{}),S(this,"_loadedFragments",{}),S(this,"fragIDData",new Map),S(this,"_baseMaterial",new mo),S(this,"_baseMaterialT",new mo({transparent:!0,opacity:.5})),S(this,"disposeStreamedGroup",t=>{this._isDisposing=!0;const{groupID:i,fragmentIDs:s}=t;if(this.models[i]){delete this.models[i],delete this._geometryInstances[i],delete this._loadedFragments[i];for(const n of s)this.fragIDData.delete(n);this.culler.remove(i),this._isDisposing=!1}}),this.components.add(cl.uuid,this),this.dbCleaner=new e1(this._fileCache),this.components.get(Ze).onFragmentsDisposed.add(this.disposeStreamedGroup)}get url(){if(!this._url)throw new Error("url must be set before using the streaming service!");return this._url}set url(e){this._url=e}get world(){if(!this._world)throw new Error("You must set a world before using the streamer!");return this._world}set world(e){var t;this._world=e,(t=this._culler)==null||t.dispose(),this._culler=new q0(this.components,e),this._culler.onViewUpdated.add(async({toLoad:i,toRemove:s,toShow:n,toHide:r})=>{await this.loadFoundGeometries(i),await this.unloadLostGeometries(s),this.setMeshVisibility(n,!0),this.setMeshVisibility(r,!1)})}get culler(){if(!this._culler)throw new Error("You must set a world before using the streamer!");return this._culler}dispose(){var e;this._isDisposing=!0,this.onFragmentsLoaded.reset(),this.onFragmentsDeleted.reset(),this._ramCache.clear(),this.components.get(Ze).onFragmentsDisposed.remove(this.disposeStreamedGroup),this.models={},this._geometryInstances={},this._loadedFragments={},this.fragIDData.clear(),this._baseMaterial.dispose(),this._baseMaterialT.dispose(),(e=this._culler)==null||e.dispose(),this.onDisposed.trigger(cl.uuid),this.onDisposed.reset(),this._isDisposing=!1}async load(e,t,i){const{assets:s,geometries:n,globalDataFileId:r}=e,o=this.url+r,a=await(await this.fetch(o)).arrayBuffer(),c=new Uint8Array(a),u=this.components.get(Ze).load(c,{coordinate:t,isStreamed:!0});u.name=r.replace("-processed-global",""),this.world.scene.three.add(u);const{opaque:d,transparent:f}=u.geometryIDs;for(const[E,g]of d){const w=u.keyFragments.get(g);if(w===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(w,[u,E,new Set])}for(const[E,g]of f){const w=u.keyFragments.get(g);if(w===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(w,[u,Math.abs(E),new Set])}this.culler.add(u.uuid,s,n),this.models[u.uuid]={assets:s,geometries:n};const m=new Map;for(const E of s){const g=E.id;for(const{transformation:w,geometryID:y,color:I}of E.geometries){m.has(y)||m.set(y,[]);const _=m.get(y);if(!_)throw new Error("Malformed instances");_.push({id:g,transformation:w,color:I})}}if(this._geometryInstances[u.uuid]=m,i){const E=new Map,g=new Map;for(const F in i.ids){const M=i.ids[F],D=parseInt(F,10);E.set(D,M)}for(const F in i.types){const M=i.types[F],D=parseInt(F,10);g.set(D,M)}const w=r.replace("-global","-properties");u.streamSettings={baseUrl:this.url,baseFileName:w,ids:E,types:g};const{indexesFile:y}=i,I=this.url+y,_=await(await this.fetch(I)).text(),C=this.components.get(hn);C.setRelationMap(u,C.getRelationsMapFromJSON(_))}return this.culler.updateTransformations(u.uuid),this.culler.needsUpdate=!0,u}remove(e){const t=this.components.get(Ze),i=t.groups.get(e);i&&t.disposeGroup(i)}setVisibility(e,t){const i=new Map;for(const s in t){const n=this.fragIDData.get(s);if(n===void 0)throw new Error("Geometry not found!");const[r,o,a]=n,c=r.uuid;i.has(c)||i.set(c,new Map);const u=i.get(c),d=t[s];for(const m of d)e?a.delete(m):a.add(m);u.get(o)||u.set(o,new Set);const f=u.get(o);for(const m of d)f.add(m)}for(const[s,n]of i){this.culler.setVisibility(e,s,n);for(const[r]of n){const o=this._loadedFragments[s];if(!o)continue;const a=o[r];if(a)for(const c of a){const u=t[c.id];u&&c.setVisibility(e,u)}}}this.culler.needsUpdate=!0}async clearCache(){await this._fileCache.delete()}async setStatic(e,t,i){const s={};for(const n of e){const r=this.fragIDData.get(n);if(!r){console.log(`Item not found: ${n}.`);continue}const[o,a]=r,c=o.uuid;s[c]||(s[c]=new Set),s[c].add(a)}if(t){const n={};for(const r in s){const o=new Map;o.set(1,s[r]),n[r]=o}await this.loadFoundGeometries(n,!1),await this.culler.addStaticGeometries(s,i)}else this.culler.removeStaticGeometries(s,i)}async loadFoundGeometries(e,t=!0){for(const i in e){if(this._isDisposing)return;const s=this.components.get(Ze).groups.get(i);if(!s)return;const{geometries:n}=this.models[i],r=new Map,o=new Set;for(const[d,f]of e[i])for(const m of f){o.add(m);const E=n[m];if(!E)throw new Error("Geometry not found");if(E.geometryFile){const g=E.geometryFile,w=r.get(g)||0;r.set(g,w+d)}}const a=Array.from(r).sort((d,f)=>f[1]-d[1]);for(const[d]of a){const f=this.url+d;if(!this._ramCache.has(f)){let g=new Uint8Array;if(this.useCache){this.dbCleaner.update(f);const y=await this._fileCache.files.get(f);if(y)g=y.file;else{const I=await(await this.fetch(f)).arrayBuffer();g=new Uint8Array(I),this._fileCache.files.add({file:g,id:f})}}else{const y=await(await this.fetch(f)).arrayBuffer();g=new Uint8Array(y)}const w=this.serializer.import(g);this._ramCache.set(f,{data:w,time:performance.now()})}const m=this._ramCache.get(f);if(!m)continue;m.time=performance.now();const E=[];if(m)for(const[g,{position:w,index:y,normal:I}]of m.data){if(this._isDisposing)return;if(!o.has(g)||!this._geometryInstances[i]||!this._geometryInstances[i].has(g))continue;const _=this._geometryInstances[i].get(g);if(!_)throw new Error("Instances not found!");const C=new rt,F=new Kt(w,3),M=new Kt(I,3);C.setAttribute("position",F),C.setAttribute("normal",M),C.setIndex(Array.from(y));const D=[],B=[];for(const N of _)N.color[3]===1?B.push(N):D.push(N);this.newFragment(s,g,C,D,!0,E,t),this.newFragment(s,g,C,B,!1,E,t)}E.length&&!this._isDisposing&&this.onFragmentsLoaded.trigger(E)}const c=new Set,u=performance.now();for(const[d,{time:f}]of this._ramCache)u-f>this.maxRamTime&&c.add(d);for(const d of c)this._ramCache.delete(d)}}async unloadLostGeometries(e){if(this._isDisposing)return;const t=[],i=this.components.get(Ze);for(const s in e){const n=i.groups.get(s);if(!n)throw new Error("Fragment group not found!");if(!this._loadedFragments[s])continue;const r=this._loadedFragments[s],o=e[s];for(const a of o){if(this.culler.removeFragment(n.uuid,a),!r[a])continue;const c=r[a];for(const u of c)n.items.splice(n.items.indexOf(u),1),t.push(u);delete r[a]}}t.length&&this.onFragmentsDeleted.trigger(t);for(const s of t)i.list.delete(s.id),this.world.meshes.delete(s.mesh),s.mesh.material=[],s.dispose(!0)}setMeshVisibility(e,t){for(const i in e)for(const s of e[i]){const n=this._loadedFragments[i];if(!n)continue;const r=n[s];if(r)for(const o of r)o.mesh.visible=t}}newFragment(e,t,i,s,n,r,o){if(s.length===0||this._isDisposing)return;const a=e.geometryIDs,c=n?a.transparent:a.opaque,u=t*(n?-1:1),d=c.get(u);if(d===void 0)return;const f=e.keyFragments.get(d);if(f===void 0)return;const m=this.components.get(Ze);if(m.list.has(f))return;const E=n?this._baseMaterialT:this._baseMaterial,g=new go(i,E,s.length);g.mesh.visible=o,g.id=f,g.mesh.uuid=f,g.group=e,e.add(g.mesh),e.items.push(g),m.list.set(g.id,g),this.world.meshes.add(g.mesh),this._loadedFragments[e.uuid]||(this._loadedFragments[e.uuid]={});const w=this._loadedFragments[e.uuid];w[t]||(w[t]=[]),w[t].push(g);const y=new Map;for(let F=0;F<s.length;F++){const M=new Ne,D=new Ht,{id:B,transformation:N,color:G}=s[F];M.fromArray(N);const[Q,O,V]=G;if(D.setRGB(Q,O,V,"srgb"),y.has(B)){const T=y.get(B);if(!T)continue;T.transforms.push(M),T.colors&&T.colors.push(D)}else y.set(B,{id:B,colors:[D],transforms:[M]})}const I=Array.from(y.values());g.add(I);const _=this.fragIDData.get(g.id);if(!_)throw new Error("Fragment data not found!");const C=_[2];C.size&&g.setVisibility(!1,C),this.culler.addFragment(e.uuid,t,g),r.push(g)}};S(pd,"uuid","22437e8d-9dbc-4b99-a04f-d2da280d50c8");let p1=pd;class t1{constructor(){S(this,"_meshes",new Map)}highlight(e,t,i,s){if(!t.userData.indexFragmentMap||!t.geometry.index)return;const{userData:n}=t,r=n.indexFragmentMap,o=[],a=t.geometry.index.array;for(const[d,f]of r)for(const m in f)if(s[m]){for(const E of f[m])if(s[m].has(E)){const g=a[d*3],w=a[d*3+1],y=a[d*3+2];o.push(g,w,y)}}this._meshes.has(e)||this._meshes.set(e,new Map);const c=this._meshes.get(e);if(!c.has(t.uuid)){const d=new ei({depthTest:!1,side:2,color:i}),f=new rt;f.attributes=t.geometry.attributes;const m=new Ae(f,d);m.frustumCulled=!1,c.set(t.uuid,m)}const u=c.get(t.uuid);u.position.copy(t.position),t.parent&&t.parent!==u.parent&&t.parent.add(u),u.geometry.setIndex(o),u.material.color.copy(i)}clear(e){for(const[t,i]of this._meshes)if(!(e&&e!==t))for(const[s,n]of i)n.removeFromParent()}dispose(){for(const[e,t]of this._meshes)for(const[i,s]of t)s.removeFromParent(),s.geometry.attributes={},s.geometry.dispose(),s.material.dispose();this._meshes.clear()}}const md=class hl extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"onBeforeUpdate",new le),S(this,"onAfterUpdate",new le),S(this,"onSetup",new le),S(this,"isSetup",!1),S(this,"enabled",!0),S(this,"events",{}),S(this,"multiple","ctrlKey"),S(this,"zoomFactor",1.5),S(this,"zoomToSelection",!1),S(this,"backupColor",null),S(this,"selection",{}),S(this,"config",{selectName:"select",hoverName:"hover",selectionColor:new Ht("#BCF124"),hoverColor:new Ht("#6528D7"),autoHighlightOnClick:!0,world:null,selectEnabled:!0,hoverEnabled:!0}),S(this,"colors",new Map),S(this,"autoToggle",new Set),S(this,"selectable",{}),S(this,"_fills",new t1),S(this,"_mouseState",{down:!1,moved:!1}),S(this,"_colorsBeforeSelect",{}),S(this,"saveHighlightersBeforeSelect",t=>{var i;const s=this.components.get(Ze);for(const n in t){const r=s.list.get(n);if(!r)continue;const o=(i=r.group)==null?void 0:i.uuid;if(o)for(const a in this.selection){if(a===this.config.selectName||a===this.config.hoverName)continue;const c=this.selection[a][n];if(c){a in this._colorsBeforeSelect||(this._colorsBeforeSelect[a]={}),o in this._colorsBeforeSelect[a]||(this._colorsBeforeSelect[a]={[o]:new Set});for(const u of c)this._colorsBeforeSelect[a][o].add(u)}}}}),S(this,"restoreHighlightersAfterDeselect",()=>{const t=this.components.get(Ze);for(const i in this._colorsBeforeSelect){let s={};const n=this._colorsBeforeSelect[i];for(const r in n){const o=t.groups.get(r);if(!o)continue;const a=o.getFragmentMap(n[r]);s={...s,...a}}this.highlightByID(i,s,!1,!1)}this._colorsBeforeSelect={}}),S(this,"clearHover",()=>{this.selection[this.config.hoverName]={}}),S(this,"onMouseDown",()=>{this.enabled&&(this._mouseState.down=!0)}),S(this,"onMouseUp",async t=>{if(!this.enabled)return;const{world:i,autoHighlightOnClick:s,selectEnabled:n}=this.config;if(!i)throw new Error("No world found!");if(!i.renderer)throw new Error("This world doesn't have a renderer!");if(t.target===i.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||t.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,s&&n){const r=this.multiple==="none"?!0:!t[this.multiple];await this.highlight(this.config.selectName,r,this.zoomToSelection)}}}),S(this,"onMouseMove",async()=>{if(!this.enabled)return;const{hoverName:t,hoverEnabled:i}=this.config;if(this._mouseState.moved){this.clear(t);return}this._mouseState.moved=this._mouseState.down;const s={};for(const n in this.selection){if(n===t)continue;const r=this.selection[n];for(const o in r){o in s||(s[o]=new Set);const a=r[o];for(const c of a)s[o].add(c)}}i&&await this.highlight(this.config.hoverName,!0,!1,s)}),this.components.add(hl.uuid,this)}async dispose(){this.setupEvents(!1),this._fills.dispose(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={};for(const e in this.events)this.events[e].onClear.reset(),this.events[e].onHighlight.reset();this.onSetup.reset(),this.events={},this.onDisposed.trigger(hl.uuid),this.onDisposed.reset()}add(e,t){if(this.selection[e]||this.colors.has(e))throw new Error("A selection with that name already exists!");this.colors.set(e,t),this.selection[e]={},this.events[e]={onHighlight:new le,onClear:new le}}async highlight(e,t=!0,i=this.zoomToSelection,s={}){if(!this.enabled)return null;if(!this.config.world)throw new Error("No world found in config!");const n=this.config.world;if(!this.selection[e])throw new Error(`Selection ${e} does not exist.`);const r=[],o=this.components.get(Ze).meshes;for(const w of o)r.push(w);const a=this.components.get(cn);for(const w of a.list){const y=w;if(y.edges){const I=y.edges.fillMeshes;for(const _ of I)r.push(_)}}const c=this.components.get(li).get(n).castRay(r);if(!c||!c.face)return this.clear(e),null;const u=c.object;if(!u.fragment&&u.userData.indexFragmentMap){if(c.faceIndex===void 0||!u.geometry.index)return null;const{userData:w}=u,y=w.indexFragmentMap.get(c.faceIndex);if(y){await this.highlightByID(e,y,t,i,s,u,!0);const I=Object.keys(y)[0];return{id:Array.from(y[I])[0],fragments:y}}return null}const d=u.geometry,f=c.instanceId;if(!d||f===void 0)return null;const m=u.fragment.getItemID(f);if(m===null)throw new Error("Item ID not found!");const E=u.fragment.group;if(!E)throw new Error("Fragment must belong to a FragmentsGroup!");const g=E.getFragmentMap([m]);return await this.highlightByID(e,g,t,i,s,void 0,!0),{id:m,fragments:g}}async highlightByID(e,t,i=!0,s=this.zoomToSelection,n={},r=void 0,o=!1){if(!this.enabled)return;i&&this.clear(e);const a=this.components.get(Ze),c=this.colors.get(e);if(!c)throw new Error("Color for selection not found!");const u={};for(const d in t){const f=t[d],m=n[d];for(const E of f)if(!(m&&m.has(E))){if(this.selectable[e]){const g=this.selectable[e];if(!g[d]||!g[d].has(E))continue}u[d]||(u[d]=new Set),u[d].add(E)}}for(const d in u){this.selection[e][d]||(this.selection[e][d]=new Set);const f=u[d],m=new Set,E=new Set;for(const w of f){const y=this.selection[e][d];o&&this.autoToggle.has(e)&&y.has(w)?(m.add(w),y.delete(w)):(y.add(w),E.add(w))}const g=a.list.get(d);if(g&&(m.size&&(this.backupColor?g.setColor(this.backupColor,m):g.resetColor(m)),E.size&&g.setColor(c,E),g.mesh.userData.fills))for(const w of g.mesh.userData.fills)this._fills.highlight(e,w,c,t)}this.events[e].onHighlight.trigger(this.selection[e]),r&&this._fills.highlight(e,r,c,t),s&&await this.zoomSelection(e)}clear(e){const t=e?[e]:Object.keys(this.selection);for(const i of t){this._fills.clear(i);const s=this.components.get(Ze),n=this.selection[i];for(const r in this.selection[i]){const o=s.list.get(r);if(!o)continue;const a=n[r];a&&(this.backupColor?o.setColor(this.backupColor,a):o.resetColor(a))}this.events[i].onClear.trigger(null),this.selection[i]={}}}setup(e){this.config={...this.config,...e},this.add(this.config.selectName,this.config.selectionColor),this.autoToggle.add(this.config.selectName),this.add(this.config.hoverName,this.config.hoverColor),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}updateFragments(e){for(const t of e)for(const i in this.selection){const s=this.selection[i][t.id],n=this.colors.get(i);s&&n&&t.setColor(n,s)}}async zoomSelection(e){if(!this.config.world)throw new Error("No world found in config!");const t=this.config.world;if(!t.camera.hasCameraControls())return;const i=this.components.get(wo),s=this.components.get(Ze);i.reset();const n=this.selection[e];if(!Object.keys(n).length)return;for(const g in n){const w=s.list.get(g);if(!w)continue;const y=n[g];i.addMesh(w.mesh,y)}const r=i.getSphere(),o=1/0,a=-1/0,{x:c,y:u,z:d}=r.center,f=r.radius===o||c===o||u===o||d===o,m=r.radius===a||c===a||u===a||d===a,E=r.radius===0;f||m||E||(r.radius*=this.zoomFactor,await t.camera.controls.fitToSphere(r,!0))}setupEvents(e){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");const t=this.config.world.renderer.three.domElement,i=this.events[this.config.selectName].onHighlight;i.remove(this.clearHover),i.remove(this.saveHighlightersBeforeSelect);const s=this.events[this.config.selectName].onClear;s.remove(this.restoreHighlightersAfterDeselect),t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(i.add(this.clearHover),i.add(this.saveHighlightersBeforeSelect),s.add(this.restoreHighlightersAfterDeselect),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("pointermove",this.onMouseMove))}};S(md,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");let m1=md;class i1 extends Ke{constructor(){super(...arguments),S(this,"onDisposed",new le),S(this,"world")}get enabled(){return this.world?this.getRenderer().postproduction.customEffects.outlineEnabled:!1}set enabled(e){if(!this.world)throw new Error("Before enabling the outliner, provide a world!");const t=this.getRenderer();t.postproduction.customEffects.outlineEnabled=e}create(e,t){const i=this.getRenderer();if(i.postproduction.customEffects.outlinedMeshes[e]!==void 0)throw new Error(`There's already a style with the name ${e}.`);i.postproduction.customEffects.outlinedMeshes[e]={material:t,meshes:new Set}}add(e,t){const i=this.getRenderer(),s=this.getStyles()[e];if(!s)throw new Error(`The style ${e} does not exist`);const n=i.postproduction.customEffects.outlineScene,r=this.components.get(Ze);for(const o in t){const a=r.list.get(o);if(!a)continue;const c=t[o],u=a.clone(c);u.mesh.instanceColor=null,u.mesh.material=[s.material],s.meshes.add(u.mesh),n.add(u.mesh)}}clear(e){if(e){this.clearStyle(e,!1);return}const t=this.getStyles(),i=Object.keys(t);for(const s of i)this.clearStyle(s,!1);this.world=void 0}dispose(){const e=this.getStyles(),t=Object.keys(e);for(const i of t)this.clearStyle(i,!0);this.onDisposed.trigger(),this.onDisposed.reset()}clearStyle(e,t){const i=this.getStyles(),s=i[e];if(!s)return;const n=this.components.get(Ri);for(const r of s.meshes){const o=r;o.fragment&&o.fragment.dispose(!1),n.destroy(r)}s.meshes.clear(),t&&(s.material.dispose(),delete i[e])}getStyles(){return this.getRenderer().postproduction.customEffects.outlinedMeshes}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");const e=this.world.renderer;if(!e.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return e}}S(i1,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");class Li extends Ke{constructor(){super(...arguments),S(this,"enabled",!1),S(this,"onDisposed",new le),S(this,"onNavigated",new le),S(this,"onExited",new le),S(this,"planeType","section"),S(this,"offset",100),S(this,"list",new Map),S(this,"world"),S(this,"current",null),S(this,"cached3DCamera",{position:new z,target:new z,projection:"Perspective",zoom:1,top:10,bottom:-10,right:10,left:-10})}create(e){const t=this.getWorld(),{id:i,point:s,normal:n,type:r}=e;let{name:o,offset:a}=e;const c=this.components.get(cn),u=c.Type;c.Type=Io;const d=c.createFromNormalAndCoplanarPoint(t,n,s);d.visible=!1,d.edges.visible=!1,d.enabled=!1,o=o||i,a=a||this.offset,d.type=r||this.planeType,d.updateFill();const f=n.clone().multiplyScalar(-a).add(s),m=s.clone(),E={id:i,name:o,plane:d,offset:a,cached:{position:f,target:m,zoom:1,size:10}};return this.list.set(i,E),c.Type=u,E}delete(e){const t=this.list.get(e);t&&(t.plane.dispose(),this.list.delete(e))}async goTo(e,t=!1){var i;const s=this.getCamera();if(((i=this.current)==null?void 0:i.id)===e)return;const n=this.list.get(e);if(!n)throw new Error(`There's no section with the ID: ${e}.`);this.cacheCameraPosition(),await this.hidePreviousClippingPlane(),await s.projection.set("Orthographic"),this.current=n;const r=new z,o=new z,{cached:a}=n,{position:c,target:u}=a;r.copy(u),o.copy(c),await s.controls.setLookAt(o.x,o.y,o.z,r.x,r.y,r.z,t);const d=n.cached.size,f=s.threePersp.aspect;s.threeOrtho.top=d,s.threeOrtho.bottom=-d,s.threeOrtho.left=-d*f,s.threeOrtho.right=d*f,s.threeOrtho.updateProjectionMatrix(),await s.controls.zoomTo(a.zoom,!1),s.set("Plan"),this.current.plane&&(this.current.plane.enabled=!0,this.current.plane.edges.fillNeedsUpdate=!0,this.current.plane.edges.visible=!0),this.enabled=!0,this.onNavigated.trigger({id:e})}async exit(e=!1){if(!this.enabled||!this.world)return;this.cacheCameraPosition();const t=this.getCamera();t.set("Orbit");const{position:i,target:s,projection:n}=this.cached3DCamera;await t.projection.set(n),this.current&&(this.current.plane.enabled=!1,this.current.plane.edges.enabled=!1,this.current.plane.edges.visible=!1),this.current=null;const{x:r,y:o,z:a}=i,{x:c,y:u,z:d}=s;await t.controls.setLookAt(r,o,a,c,u,d,e),t.projection.current==="Orthographic"&&(await t.controls.zoomTo(this.cached3DCamera.zoom,!1),t.threeOrtho.left=this.cached3DCamera.left,t.threeOrtho.right=this.cached3DCamera.right,t.threeOrtho.top=this.cached3DCamera.top,t.threeOrtho.bottom=this.cached3DCamera.bottom),this.enabled=!1,this.onExited.trigger()}dispose(){for(const[,{plane:e}]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}getWorld(){if(!this.world)throw new Error("World is needed to create sections!");return this.world}getCamera(){const e=this.getWorld().camera;if(!e.hasCameraControls()||!e.projection)throw new Error("The world given to sections must have an OrthoPerspective camera.");return e}cacheCameraPosition(){if(!this.world)throw new Error("World is needed to create clipping planes!");const e=this.getCamera();if(this.enabled){if(!this.current)throw new Error("Current section not found!");const{cached:t}=this.current,{position:i,target:s}=t;e.controls.getPosition(i),e.controls.getTarget(s),t.zoom=e.threeOrtho.zoom,t.size=e.threeOrtho.top}else{e.three.getWorldPosition(this.cached3DCamera.position),e.controls.getTarget(this.cached3DCamera.target),this.cached3DCamera.projection=e.projection.current,this.cached3DCamera.zoom=e.threeOrtho.zoom;const{top:t,bottom:i,left:s,right:n}=e.threeOrtho;this.cached3DCamera.top=t,this.cached3DCamera.bottom=i,this.cached3DCamera.left=s,this.cached3DCamera.right=n}}async hidePreviousClippingPlane(){if(this.current){const e=this.current.plane;e&&(e.enabled=!1),this.current.plane.edges.visible=!1}}}S(Li,"uuid","45b41ba3-7bb8-4e08-909f-e0fa87973965");const gd=class Ed extends Ke{constructor(e){super(e),S(this,"onDisposed",new le),S(this,"planeType","floorplan"),S(this,"onNavigated",new le),S(this,"onExited",new le),S(this,"enabled",!1),S(this,"currentPlan",null),S(this,"offset",1.5),S(this,"list",[]),S(this,"_cachedPlanCamera",null),this.components.add(Ed.uuid,this)}get world(){return this.components.get(Li).world}set world(e){const t=this.components.get(Li);t.world=e}get defaultCameraOffset(){return this.components.get(Li).offset}set defaultCameraOffset(e){const t=this.components.get(Li);t.offset=e}dispose(){this.onExited.reset(),this.onNavigated.reset();const e=this.components.get(Li);for(const t of this.list)e.delete(t.id);this.list=[],this.onDisposed.trigger(),this.onDisposed.reset()}async generate(e){if(!e.hasProperties)throw new Error("Properties are needed to compute plan views!");const t=await e.getAllPropertiesOfType(Ao);if(!t)throw new Error("Floorplans not found!");const i=e.coordinationMatrix.elements[13],s=await Cs.getUnits(e);for(const n of Object.values(t)){const r={value:0};this.getAbsoluteFloorHeight(n.ObjectPlacement,r);const o=r.value*s+i+this.offset;this.create({name:n.Name.value,id:n.GlobalId.value,normal:new z(0,-1,0),point:new z(0,o,0)})}}create(e){const t=this.components.get(Li);e.type=e.type||this.planeType;const i={...t.create(e),planOffset:this.offset};this.list.push(i)}async goTo(e,t=!1){this.enabled&&this.cachePlanCamera(),await this.components.get(Li).goTo(e,t),await this.applyCachedPlanCamera();const i=this.list.find(s=>s.id===e);i&&(this.currentPlan=i),this.enabled=!0}async exitPlanView(e=!1){this.enabled&&(this.cachePlanCamera(),await this.components.get(Li).exit(e),this.currentPlan=null,this.enabled=!1,this.onExited.trigger())}cachePlanCamera(){var e;const t=(e=this.world)==null?void 0:e.camera,i=new z,s=new z;t.controls.getTarget(i),t.controls.getPosition(s),this._cachedPlanCamera={target:i,position:s,zoom:t.threeOrtho.zoom,top:t.threeOrtho.top,right:t.threeOrtho.right,bottom:t.threeOrtho.bottom,left:t.threeOrtho.left}}async applyCachedPlanCamera(){var e;if(!this._cachedPlanCamera)return;const t=(e=this.world)==null?void 0:e.camera,{position:i,target:s}=this._cachedPlanCamera,n=new z,r=new z;t.controls.getPosition(n),t.controls.getTarget(r);const o=n.y,a=r.y;await t.controls.setLookAt(i.x,o,i.z,s.x,a,s.z),await t.controls.zoomTo(this._cachedPlanCamera.zoom),t.threeOrtho.top=this._cachedPlanCamera.top,t.threeOrtho.bottom=this._cachedPlanCamera.bottom,t.threeOrtho.left=this._cachedPlanCamera.left,t.threeOrtho.right=this._cachedPlanCamera.right,t.threeOrtho.updateProjectionMatrix()}getAbsoluteFloorHeight(e,t){const i=e.RelativePlacement.Location.Coordinates;t.value+=i[2].value,e.PlacementRelTo&&this.getAbsoluteFloorHeight(e.PlacementRelTo,t)}};S(gd,"uuid","a80874aa-1c93-43a4-80f2-df346da086b1");let g1=gd;export{sl as $,r0 as J,Li as M,Es as O,o1 as Q,no as X,n1 as Z,c1 as a,g1 as b,i1 as c,Io as d,h1 as e,Yn as f,r1 as g,l1 as h,f1 as i,d1 as n,m1 as o,a1 as q,p1 as r,u1 as t};

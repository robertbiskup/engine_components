var io=Object.defineProperty;var no=(c,e,t)=>e in c?io(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var y=(c,e,t)=>(no(c,typeof e!="symbol"?e+"":e,t),t);import{d as Fs,V as W,h as Ae,y as pn,s as ue,T as ms,S as Ti,c as Ft,t as Nt,bb as ro,Q as _i,b0 as Yn,a as et,b1 as oo,J as ao,e as Ss,x as En,P as Lr,ax as co,w as lo,ay as Jt,az as ho,u as In,an as uo,z as fo,W as po,aq as Eo,b as $e,r as oi,aA as wi,C as mn,O as ai,E as Io,L as Mr,K as xt,B as Lt,H as Vn,aB as Ms,av as Ee,aC as mo,aD as es,N as vr,X as Co,a6 as Ai,a7 as Cn,a8 as gn,a9 as Tn,a4 as Ns,aa as _n,ab as An,ac as Ri,ad as Rn,ae as yn,af as On,ag as Fn,ah as Sn,ai as wn,aj as Nn,j as go,i as $i,a2 as jt,b2 as To,a0 as bs,aE as _o,aF as Ao,aG as Ro,aH as yo,aI as Oo,aJ as Fo,I as xr,aK as Dr,aL as Ur,aw as Br,b3 as So,b4 as wo,b5 as No,b6 as bo,Y as Gn,Z as Hn,_ as Po,$ as Lo,a1 as Mo,a3 as he,a5 as vo,ak as xo,al as Do}from"./web-ifc-api-ub-SNF9_.js";import{c as vs,g as Uo}from"./_commonjsHelpers-Cpj98o6Y.js";const kr=0,Bo=1,ko=2,Wn=2,Ni=1.25,Xn=1,ni=6*4+4+4,yi=65535,zo=Math.pow(2,-24),bi=Symbol("SKIP_GENERATION");function Yo(c){return c.index?c.index.count:c.attributes.position.count}function qe(c){return Yo(c)/3}function Vo(c,e=ArrayBuffer){return c>65535?new Uint32Array(new e(4*c)):new Uint16Array(new e(2*c))}function Go(c,e){if(!c.index){const t=c.attributes.position.count,s=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=Vo(t,s);c.setIndex(new Fs(i,1));for(let n=0;n<t;n++)i[n]=n}}function zr(c){const e=qe(c),t=c.drawRange,s=t.start/3,i=(t.start+t.count)/3,n=Math.max(0,s),r=Math.min(e,i)-n;return[{offset:Math.floor(n),count:Math.floor(r)}]}function Yr(c){if(!c.groups||!c.groups.length)return zr(c);const e=[],t=new Set,s=c.drawRange,i=s.start/3,n=(s.start+s.count)/3;for(const o of c.groups){const a=o.start/3,l=(o.start+o.count)/3;t.add(Math.max(i,a)),t.add(Math.min(n,l))}const r=Array.from(t.values()).sort((o,a)=>o-a);for(let o=0;o<r.length-1;o++){const a=r[o],l=r[o+1];e.push({offset:Math.floor(a),count:Math.floor(l-a)})}return e}function Ho(c){if(c.groups.length===0)return!1;const e=qe(c),t=Yr(c).sort((n,r)=>n.offset-r.offset),s=t[t.length-1];s.count=Math.min(e-s.offset,s.count);let i=0;return t.forEach(({count:n})=>i+=n),e!==i}function Tt(c,e,t){return t.min.x=e[c],t.min.y=e[c+1],t.min.z=e[c+2],t.max.x=e[c+3],t.max.y=e[c+4],t.max.z=e[c+5],t}function Wo(c){c[0]=c[1]=c[2]=1/0,c[3]=c[4]=c[5]=-1/0}function Zn(c){let e=-1,t=-1/0;for(let s=0;s<3;s++){const i=c[s+3]-c[s];i>t&&(t=i,e=s)}return e}function $n(c,e){e.set(c)}function jn(c,e,t){let s,i;for(let n=0;n<3;n++){const r=n+3;s=c[n],i=e[n],t[n]=s<i?s:i,s=c[r],i=e[r],t[r]=s>i?s:i}}function xs(c,e,t){for(let s=0;s<3;s++){const i=e[c+2*s],n=e[c+2*s+1],r=i-n,o=i+n;r<t[s]&&(t[s]=r),o>t[s+3]&&(t[s+3]=o)}}function ss(c){const e=c[3]-c[0],t=c[4]-c[1],s=c[5]-c[2];return 2*(e*t+t*s+s*e)}function Pi(c,e,t,s,i=null){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,h=-1/0,u=1/0,d=1/0,f=1/0,I=-1/0,p=-1/0,m=-1/0;const E=i!==null;for(let _=e*6,A=(e+t)*6;_<A;_+=6){const T=c[_+0],R=c[_+1],F=T-R,w=T+R;F<n&&(n=F),w>a&&(a=w),E&&T<u&&(u=T),E&&T>I&&(I=T);const L=c[_+2],N=c[_+3],M=L-N,z=L+N;M<r&&(r=M),z>l&&(l=z),E&&L<d&&(d=L),E&&L>p&&(p=L);const O=c[_+4],P=c[_+5],C=O-P,v=O+P;C<o&&(o=C),v>h&&(h=v),E&&O<f&&(f=O),E&&O>m&&(m=O)}s[0]=n,s[1]=r,s[2]=o,s[3]=a,s[4]=l,s[5]=h,E&&(i[0]=u,i[1]=d,i[2]=f,i[3]=I,i[4]=p,i[5]=m)}function Xo(c,e,t,s){let i=1/0,n=1/0,r=1/0,o=-1/0,a=-1/0,l=-1/0;for(let h=e*6,u=(e+t)*6;h<u;h+=6){const d=c[h+0];d<i&&(i=d),d>o&&(o=d);const f=c[h+2];f<n&&(n=f),f>a&&(a=f);const I=c[h+4];I<r&&(r=I),I>l&&(l=I)}s[0]=i,s[1]=n,s[2]=r,s[3]=o,s[4]=a,s[5]=l}function Zo(c,e){Wo(e);const t=c.attributes.position,s=c.index?c.index.array:null,i=qe(c),n=new Float32Array(i*6),r=t.normalized,o=t.array,a=t.offset||0;let l=3;t.isInterleavedBufferAttribute&&(l=t.data.stride);const h=["getX","getY","getZ"];for(let u=0;u<i;u++){const d=u*3,f=u*6;let I=d+0,p=d+1,m=d+2;s&&(I=s[I],p=s[p],m=s[m]),r||(I=I*l+a,p=p*l+a,m=m*l+a);for(let E=0;E<3;E++){let _,A,T;r?(_=t[h[E]](I),A=t[h[E]](p),T=t[h[E]](m)):(_=o[I+E],A=o[p+E],T=o[m+E]);let R=_;A<R&&(R=A),T<R&&(R=T);let F=_;A>F&&(F=A),T>F&&(F=T);const w=(F-R)/2,L=E*2;n[f+L+0]=R+w,n[f+L+1]=w+(Math.abs(R)+w)*zo,R<e[E]&&(e[E]=R),F>e[E+3]&&(e[E+3]=F)}}return n}const le=32,$o=(c,e)=>c.candidate-e.candidate,Ie=new Array(le).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Ds=new Float32Array(6);function jo(c,e,t,s,i,n){let r=-1,o=0;if(n===kr)r=Zn(e),r!==-1&&(o=(e[r]+e[r+3])/2);else if(n===Bo)r=Zn(c),r!==-1&&(o=Qo(t,s,i,r));else if(n===ko){const a=ss(c);let l=Ni*i;const h=s*6,u=(s+i)*6;for(let d=0;d<3;d++){const f=e[d],m=(e[d+3]-f)/le;if(i<le/4){const E=[...Ie];E.length=i;let _=0;for(let T=h;T<u;T+=6,_++){const R=E[_];R.candidate=t[T+2*d],R.count=0;const{bounds:F,leftCacheBounds:w,rightCacheBounds:L}=R;for(let N=0;N<3;N++)L[N]=1/0,L[N+3]=-1/0,w[N]=1/0,w[N+3]=-1/0,F[N]=1/0,F[N+3]=-1/0;xs(T,t,F)}E.sort($o);let A=i;for(let T=0;T<A;T++){const R=E[T];for(;T+1<A&&E[T+1].candidate===R.candidate;)E.splice(T+1,1),A--}for(let T=h;T<u;T+=6){const R=t[T+2*d];for(let F=0;F<A;F++){const w=E[F];R>=w.candidate?xs(T,t,w.rightCacheBounds):(xs(T,t,w.leftCacheBounds),w.count++)}}for(let T=0;T<A;T++){const R=E[T],F=R.count,w=i-R.count,L=R.leftCacheBounds,N=R.rightCacheBounds;let M=0;F!==0&&(M=ss(L)/a);let z=0;w!==0&&(z=ss(N)/a);const O=Xn+Ni*(M*F+z*w);O<l&&(r=d,l=O,o=R.candidate)}}else{for(let A=0;A<le;A++){const T=Ie[A];T.count=0,T.candidate=f+m+A*m;const R=T.bounds;for(let F=0;F<3;F++)R[F]=1/0,R[F+3]=-1/0}for(let A=h;A<u;A+=6){let F=~~((t[A+2*d]-f)/m);F>=le&&(F=le-1);const w=Ie[F];w.count++,xs(A,t,w.bounds)}const E=Ie[le-1];$n(E.bounds,E.rightCacheBounds);for(let A=le-2;A>=0;A--){const T=Ie[A],R=Ie[A+1];jn(T.bounds,R.rightCacheBounds,T.rightCacheBounds)}let _=0;for(let A=0;A<le-1;A++){const T=Ie[A],R=T.count,F=T.bounds,L=Ie[A+1].rightCacheBounds;R!==0&&(_===0?$n(F,Ds):jn(F,Ds,Ds)),_+=R;let N=0,M=0;_!==0&&(N=ss(Ds)/a);const z=i-_;z!==0&&(M=ss(L)/a);const O=Xn+Ni*(N*_+M*z);O<l&&(r=d,l=O,o=T.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:r,pos:o}}function Qo(c,e,t,s){let i=0;for(let n=e,r=e+t;n<r;n++)i+=c[n*6+s*2];return i/t}class Us{constructor(){}}function qo(c,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,l=n.axis*2;for(;;){for(;r<=o&&t[r*6+l]<a;)r++;for(;r<=o&&t[o*6+l]>=a;)o--;if(r<o){for(let h=0;h<3;h++){let u=e[r*3+h];e[r*3+h]=e[o*3+h],e[o*3+h]=u}for(let h=0;h<6;h++){let u=t[r*6+h];t[r*6+h]=t[o*6+h],t[o*6+h]=u}r++,o--}else return r}}function Ko(c,e,t,s,i,n){let r=s,o=s+i-1;const a=n.pos,l=n.axis*2;for(;;){for(;r<=o&&t[r*6+l]<a;)r++;for(;r<=o&&t[o*6+l]>=a;)o--;if(r<o){let h=c[r];c[r]=c[o],c[o]=h;for(let u=0;u<6;u++){let d=t[r*6+u];t[r*6+u]=t[o*6+u],t[o*6+u]=d}r++,o--}else return r}}function Jo(c,e){const t=(c.index?c.index.count:c.attributes.position.count)/3,s=t>2**16,i=s?4:2,n=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=s?new Uint32Array(n):new Uint16Array(n);for(let o=0,a=r.length;o<a;o++)r[o]=o;return r}function ta(c,e){const t=c.geometry,s=t.index?t.index.array:null,i=e.maxDepth,n=e.verbose,r=e.maxLeafTris,o=e.strategy,a=e.onProgress,l=qe(t),h=c._indirectBuffer;let u=!1;const d=new Float32Array(6),f=new Float32Array(6),I=Zo(t,d),p=e.indirect?Ko:qo,m=[],E=e.indirect?zr(t):Yr(t);if(E.length===1){const T=E[0],R=new Us;R.boundingData=d,Xo(I,T.offset,T.count,f),A(R,T.offset,T.count,f),m.push(R)}else for(let T of E){const R=new Us;R.boundingData=new Float32Array(6),Pi(I,T.offset,T.count,R.boundingData,f),A(R,T.offset,T.count,f),m.push(R)}return m;function _(T){a&&a(T/l)}function A(T,R,F,w=null,L=0){if(!u&&L>=i&&(u=!0,n&&(console.warn(`MeshBVH: Max depth of ${i} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),F<=r||L>=i)return _(R+F),T.offset=R,T.count=F,T;const N=jo(T.boundingData,w,I,R,F,o);if(N.axis===-1)return _(R+F),T.offset=R,T.count=F,T;const M=p(h,s,I,R,F,N);if(M===R||M===R+F)_(R+F),T.offset=R,T.count=F;else{T.splitAxis=N.axis;const z=new Us,O=R,P=M-R;T.left=z,z.boundingData=new Float32Array(6),Pi(I,O,P,z.boundingData,f),A(z,O,P,f,L+1);const C=new Us,v=M,$=F-P;T.right=C,C.boundingData=new Float32Array(6),Pi(I,v,$,C.boundingData,f),A(C,v,$,f,L+1)}return T}}function ea(c,e){const t=c.geometry;e.indirect&&(c._indirectBuffer=Jo(t,e.useSharedArrayBuffer),Ho(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),c._indirectBuffer||Go(t,e);const s=ta(c,e);let i,n,r;const o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<s.length;u++){const d=s[u];let f=l(d);const I=new a(ni*f);i=new Float32Array(I),n=new Uint32Array(I),r=new Uint16Array(I),h(0,d),o.push(I)}c._roots=o;return;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function h(u,d){const f=u/4,I=u/2,p=!!d.count,m=d.boundingData;for(let E=0;E<6;E++)i[f+E]=m[E];if(p){const E=d.offset,_=d.count;return n[f+6]=E,r[I+14]=_,r[I+15]=yi,u+ni}else{const E=d.left,_=d.right,A=d.splitAxis;let T;if(T=h(u+ni,E),T/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[f+6]=T/4,T=h(T,_),n[f+7]=A,T}}}class de{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let s=1/0,i=-1/0;for(let n=0,r=e.length;n<r;n++){const a=e[n][t];s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}setFromPoints(e,t){let s=1/0,i=-1/0;for(let n=0,r=t.length;n<r;n++){const o=t[n],a=e.dot(o);s=a<s?a:s,i=a>i?a:i}this.min=s,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}de.prototype.setFromBox=function(){const c=new W;return function(t,s){const i=s.min,n=s.max;let r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){c.x=i.x*a+n.x*(1-a),c.y=i.y*l+n.y*(1-l),c.z=i.z*h+n.z*(1-h);const u=t.dot(c);r=Math.min(u,r),o=Math.max(u,o)}this.min=r,this.max=o}}();const sa=function(){const c=new W,e=new W,t=new W;return function(i,n,r){const o=i.start,a=c,l=n.start,h=e;t.subVectors(o,l),c.subVectors(i.end,i.start),e.subVectors(n.end,n.start);const u=t.dot(h),d=h.dot(a),f=h.dot(h),I=t.dot(a),m=a.dot(a)*f-d*d;let E,_;m!==0?E=(u*d-I*f)/m:E=0,_=(u+E*d)/f,r.x=E,r.y=_}}(),bn=function(){const c=new Ae,e=new W,t=new W;return function(i,n,r,o){sa(i,n,c);let a=c.x,l=c.y;if(a>=0&&a<=1&&l>=0&&l<=1){i.at(a,r),n.at(l,o);return}else if(a>=0&&a<=1){l<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,r);return}else if(l>=0&&l<=1){a<0?i.at(0,r):i.at(1,r),n.closestPointToPoint(r,!0,o);return}else{let h;a<0?h=i.start:h=i.end;let u;l<0?u=n.start:u=n.end;const d=e,f=t;if(i.closestPointToPoint(u,!0,e),n.closestPointToPoint(h,!0,t),d.distanceToSquared(u)<=f.distanceToSquared(h)){r.copy(d),o.copy(u);return}else{r.copy(h),o.copy(f);return}}}}(),ia=function(){const c=new W,e=new W,t=new pn,s=new ue;return function(n,r){const{radius:o,center:a}=n,{a:l,b:h,c:u}=r;if(s.start=l,s.end=h,s.closestPointToPoint(a,!0,c).distanceTo(a)<=o||(s.start=l,s.end=u,s.closestPointToPoint(a,!0,c).distanceTo(a)<=o)||(s.start=h,s.end=u,s.closestPointToPoint(a,!0,c).distanceTo(a)<=o))return!0;const p=r.getPlane(t);if(Math.abs(p.distanceToPoint(a))<=o){const E=p.projectPoint(a,e);if(r.containsPoint(E))return!0}return!1}}(),na=1e-15;function Li(c){return Math.abs(c)<na}class ee extends ms{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new W),this.satBounds=new Array(4).fill().map(()=>new de),this.points=[this.a,this.b,this.c],this.sphere=new Ti,this.plane=new pn,this.needsUpdate=!0}intersectsSphere(e){return ia(e,this)}update(){const e=this.a,t=this.b,s=this.c,i=this.points,n=this.satAxes,r=this.satBounds,o=n[0],a=r[0];this.getNormal(o),a.setFromPoints(o,i);const l=n[1],h=r[1];l.subVectors(e,t),h.setFromPoints(l,i);const u=n[2],d=r[2];u.subVectors(t,s),d.setFromPoints(u,i);const f=n[3],I=r[3];f.subVectors(s,e),I.setFromPoints(f,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}ee.prototype.closestPointToSegment=function(){const c=new W,e=new W,t=new ue;return function(i,n=null,r=null){const{start:o,end:a}=i,l=this.points;let h,u=1/0;for(let d=0;d<3;d++){const f=(d+1)%3;t.start.copy(l[d]),t.end.copy(l[f]),bn(t,i,c,e),h=c.distanceToSquared(e),h<u&&(u=h,n&&n.copy(c),r&&r.copy(e))}return this.closestPointToPoint(o,c),h=o.distanceToSquared(c),h<u&&(u=h,n&&n.copy(c),r&&r.copy(o)),this.closestPointToPoint(a,c),h=a.distanceToSquared(c),h<u&&(u=h,n&&n.copy(c),r&&r.copy(a)),Math.sqrt(u)}}();ee.prototype.intersectsTriangle=function(){const c=new ee,e=new Array(3),t=new Array(3),s=new de,i=new de,n=new W,r=new W,o=new W,a=new W,l=new W,h=new ue,u=new ue,d=new ue,f=new W;function I(p,m,E){const _=p.points;let A=0,T=-1;for(let R=0;R<3;R++){const{start:F,end:w}=h;F.copy(_[R]),w.copy(_[(R+1)%3]),h.delta(r);const L=Li(m.distanceToPoint(F));if(Li(m.normal.dot(r))&&L){E.copy(h),A=2;break}const N=m.intersectLine(h,f);if(!N&&L&&f.copy(F),(N||L)&&!Li(f.distanceTo(w))){if(A<=1)(A===1?E.start:E.end).copy(f),L&&(T=A);else if(A>=2){(T===1?E.start:E.end).copy(f),A=2;break}if(A++,A===2&&T===-1)break}}return A}return function(m,E=null,_=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(c.copy(m),c.update(),m=c);const A=this.plane,T=m.plane;if(Math.abs(A.normal.dot(T.normal))>1-1e-10){const R=this.satBounds,F=this.satAxes;t[0]=m.a,t[1]=m.b,t[2]=m.c;for(let N=0;N<4;N++){const M=R[N],z=F[N];if(s.setFromPoints(z,t),M.isSeparated(s))return!1}const w=m.satBounds,L=m.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let N=0;N<4;N++){const M=w[N],z=L[N];if(s.setFromPoints(z,e),M.isSeparated(s))return!1}for(let N=0;N<4;N++){const M=F[N];for(let z=0;z<4;z++){const O=L[z];if(n.crossVectors(M,O),s.setFromPoints(n,e),i.setFromPoints(n,t),s.isSeparated(i))return!1}}return E&&(_||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),E.start.set(0,0,0),E.end.set(0,0,0)),!0}else{const R=I(this,T,u);if(R===1&&m.containsPoint(u.end))return E&&(E.start.copy(u.end),E.end.copy(u.end)),!0;if(R!==2)return!1;const F=I(m,A,d);if(F===1&&this.containsPoint(d.end))return E&&(E.start.copy(d.end),E.end.copy(d.end)),!0;if(F!==2)return!1;if(u.delta(o),d.delta(a),o.dot(a)<0){let P=d.start;d.start=d.end,d.end=P}const w=u.start.dot(o),L=u.end.dot(o),N=d.start.dot(o),M=d.end.dot(o),z=L<N,O=w<M;return w!==M&&N!==L&&z===O?!1:(E&&(l.subVectors(u.start,d.start),l.dot(o)>0?E.start.copy(u.start):E.start.copy(d.start),l.subVectors(u.end,d.end),l.dot(o)<0?E.end.copy(u.end):E.end.copy(d.end)),!0)}}}();ee.prototype.distanceToPoint=function(){const c=new W;return function(t){return this.closestPointToPoint(t,c),t.distanceTo(c)}}();ee.prototype.distanceToTriangle=function(){const c=new W,e=new W,t=["a","b","c"],s=new ue,i=new ue;return function(r,o=null,a=null){const l=o||a?s:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let h=1/0;for(let u=0;u<3;u++){let d;const f=t[u],I=r[f];this.closestPointToPoint(I,c),d=I.distanceToSquared(c),d<h&&(h=d,o&&o.copy(c),a&&a.copy(I));const p=this[f];r.closestPointToPoint(p,c),d=p.distanceToSquared(c),d<h&&(h=d,o&&o.copy(p),a&&a.copy(c))}for(let u=0;u<3;u++){const d=t[u],f=t[(u+1)%3];s.set(this[d],this[f]);for(let I=0;I<3;I++){const p=t[I],m=t[(I+1)%3];i.set(r[p],r[m]),bn(s,i,c,e);const E=c.distanceToSquared(e);E<h&&(h=E,o&&o.copy(c),a&&a.copy(e))}}return Math.sqrt(h)}}();class Ut{constructor(e,t,s){this.isOrientedBox=!0,this.min=new W,this.max=new W,this.matrix=new Ft,this.invMatrix=new Ft,this.points=new Array(8).fill().map(()=>new W),this.satAxes=new Array(3).fill().map(()=>new W),this.satBounds=new Array(3).fill().map(()=>new de),this.alignedSatBounds=new Array(3).fill().map(()=>new de),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),s&&this.matrix.copy(s)}set(e,t,s){this.min.copy(e),this.max.copy(t),this.matrix.copy(s),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}Ut.prototype.update=function(){return function(){const e=this.matrix,t=this.min,s=this.max,i=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let u=0;u<=1;u++){const d=1*l|2*h|4*u,f=i[d];f.x=l?s.x:t.x,f.y=h?s.y:t.y,f.z=u?s.z:t.z,f.applyMatrix4(e)}const n=this.satBounds,r=this.satAxes,o=i[0];for(let l=0;l<3;l++){const h=r[l],u=n[l],d=1<<l,f=i[d];h.subVectors(o,f),u.setFromPoints(h,i)}const a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();Ut.prototype.intersectsBox=function(){const c=new de;return function(t){this.needsUpdate&&this.update();const s=t.min,i=t.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(c.min=s.x,c.max=i.x,o[0].isSeparated(c)||(c.min=s.y,c.max=i.y,o[1].isSeparated(c))||(c.min=s.z,c.max=i.z,o[2].isSeparated(c)))return!1;for(let a=0;a<3;a++){const l=r[a],h=n[a];if(c.setFromBox(l,t),h.isSeparated(c))return!1}return!0}}();Ut.prototype.intersectsTriangle=function(){const c=new ee,e=new Array(3),t=new de,s=new de,i=new W;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(c.copy(r),c.update(),r=c);const o=this.satBounds,a=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let d=0;d<3;d++){const f=o[d],I=a[d];if(t.setFromPoints(I,e),f.isSeparated(t))return!1}const l=r.satBounds,h=r.satAxes,u=this.points;for(let d=0;d<3;d++){const f=l[d],I=h[d];if(t.setFromPoints(I,u),f.isSeparated(t))return!1}for(let d=0;d<3;d++){const f=a[d];for(let I=0;I<4;I++){const p=h[I];if(i.crossVectors(f,p),t.setFromPoints(i,e),s.setFromPoints(i,u),t.isSeparated(s))return!1}}return!0}}();Ut.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();Ut.prototype.distanceToPoint=function(){const c=new W;return function(t){return this.closestPointToPoint(t,c),t.distanceTo(c)}}();Ut.prototype.distanceToBox=function(){const c=["x","y","z"],e=new Array(12).fill().map(()=>new ue),t=new Array(12).fill().map(()=>new ue),s=new W,i=new W;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(i),this.closestPointToPoint(i,s),r.closestPointToPoint(s,i),a&&a.copy(s),l&&l.copy(i)),0;const h=o*o,u=r.min,d=r.max,f=this.points;let I=1/0;for(let m=0;m<8;m++){const E=f[m];i.copy(E).clamp(u,d);const _=E.distanceToSquared(i);if(_<I&&(I=_,a&&a.copy(E),l&&l.copy(i),_<h))return Math.sqrt(_)}let p=0;for(let m=0;m<3;m++)for(let E=0;E<=1;E++)for(let _=0;_<=1;_++){const A=(m+1)%3,T=(m+2)%3,R=E<<A|_<<T,F=1<<m|E<<A|_<<T,w=f[R],L=f[F];e[p].set(w,L);const M=c[m],z=c[A],O=c[T],P=t[p],C=P.start,v=P.end;C[M]=u[M],C[z]=E?u[z]:d[z],C[O]=_?u[O]:d[z],v[M]=d[M],v[z]=E?u[z]:d[z],v[O]=_?u[O]:d[z],p++}for(let m=0;m<=1;m++)for(let E=0;E<=1;E++)for(let _=0;_<=1;_++){i.x=m?d.x:u.x,i.y=E?d.y:u.y,i.z=_?d.z:u.z,this.closestPointToPoint(i,s);const A=i.distanceToSquared(s);if(A<I&&(I=A,a&&a.copy(s),l&&l.copy(i),A<h))return Math.sqrt(A)}for(let m=0;m<12;m++){const E=e[m];for(let _=0;_<12;_++){const A=t[_];bn(E,A,s,i);const T=s.distanceToSquared(i);if(T<I&&(I=T,a&&a.copy(s),l&&l.copy(i),T<h))return Math.sqrt(T)}}return Math.sqrt(I)}}();class Pn{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class ra extends Pn{constructor(){super(()=>new ee)}}const Ht=new ra;function zt(c,e){return e[c+15]===65535}function Yt(c,e){return e[c+6]}function Wt(c,e){return e[c+14]}function Xt(c){return c+8}function Zt(c,e){return e[c+6]}function Vr(c,e){return e[c+7]}class oa{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=s=>{t&&e.push(t),t=s,this.float32Array=new Float32Array(s),this.uint16Array=new Uint16Array(s),this.uint32Array=new Uint32Array(s)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const mt=new oa;let _e,We;const Pe=[],Bs=new Pn(()=>new Nt);function aa(c,e,t,s,i,n){_e=Bs.getPrimitive(),We=Bs.getPrimitive(),Pe.push(_e,We),mt.setBuffer(c._roots[e]);const r=ji(0,c.geometry,t,s,i,n);mt.clearBuffer(),Bs.releasePrimitive(_e),Bs.releasePrimitive(We),Pe.pop(),Pe.pop();const o=Pe.length;return o>0&&(We=Pe[o-1],_e=Pe[o-2]),r}function ji(c,e,t,s,i=null,n=0,r=0){const{float32Array:o,uint16Array:a,uint32Array:l}=mt;let h=c*2;if(zt(h,a)){const d=Yt(c,l),f=Wt(h,a);return Tt(c,o,_e),s(d,f,!1,r,n+c,_e)}else{let M=function(O){const{uint16Array:P,uint32Array:C}=mt;let v=O*2;for(;!zt(v,P);)O=Xt(O),v=O*2;return Yt(O,C)},z=function(O){const{uint16Array:P,uint32Array:C}=mt;let v=O*2;for(;!zt(v,P);)O=Zt(O,C),v=O*2;return Yt(O,C)+Wt(v,P)};const d=Xt(c),f=Zt(c,l);let I=d,p=f,m,E,_,A;if(i&&(_=_e,A=We,Tt(I,o,_),Tt(p,o,A),m=i(_),E=i(A),E<m)){I=f,p=d;const O=m;m=E,E=O,_=A}_||(_=_e,Tt(I,o,_));const T=zt(I*2,a),R=t(_,T,m,r+1,n+I);let F;if(R===Wn){const O=M(I),C=z(I)-O;F=s(O,C,!0,r+1,n+I,_)}else F=R&&ji(I,e,t,s,i,n,r+1);if(F)return!0;A=We,Tt(p,o,A);const w=zt(p*2,a),L=t(A,w,E,r+1,n+p);let N;if(L===Wn){const O=M(p),C=z(p)-O;N=s(O,C,!0,r+1,n+p,A)}else N=L&&ji(p,e,t,s,i,n,r+1);return!!N}}const is=new W,Mi=new W;function ca(c,e,t={},s=0,i=1/0){const n=s*s,r=i*i;let o=1/0,a=null;if(c.shapecast({boundsTraverseOrder:h=>(is.copy(e).clamp(h.min,h.max),is.distanceToSquared(e)),intersectsBounds:(h,u,d)=>d<o&&d<r,intersectsTriangle:(h,u)=>{h.closestPointToPoint(e,is);const d=e.distanceToSquared(is);return d<o&&(Mi.copy(is),o=d,a=u),d<n}}),o===1/0)return null;const l=Math.sqrt(o);return t.point?t.point.copy(Mi):t.point=Mi.clone(),t.distance=l,t.faceIndex=a,t}const Le=new W,Me=new W,ve=new W,ks=new Ae,zs=new Ae,Ys=new Ae,Qn=new W,qn=new W,Kn=new W,Vs=new W;function la(c,e,t,s,i,n){let r;return n===ro?r=c.intersectTriangle(s,t,e,!0,i):r=c.intersectTriangle(e,t,s,n!==_i,i),r===null?null:{distance:c.origin.distanceTo(i),point:i.clone()}}function ha(c,e,t,s,i,n,r,o,a){Le.fromBufferAttribute(e,n),Me.fromBufferAttribute(e,r),ve.fromBufferAttribute(e,o);const l=la(c,Le,Me,ve,Vs,a);if(l){s&&(ks.fromBufferAttribute(s,n),zs.fromBufferAttribute(s,r),Ys.fromBufferAttribute(s,o),l.uv=ms.getInterpolation(Vs,Le,Me,ve,ks,zs,Ys,new Ae)),i&&(ks.fromBufferAttribute(i,n),zs.fromBufferAttribute(i,r),Ys.fromBufferAttribute(i,o),l.uv1=ms.getInterpolation(Vs,Le,Me,ve,ks,zs,Ys,new Ae)),t&&(Qn.fromBufferAttribute(t,n),qn.fromBufferAttribute(t,r),Kn.fromBufferAttribute(t,o),l.normal=ms.getInterpolation(Vs,Le,Me,ve,Qn,qn,Kn,new W),l.normal.dot(c.direction)>0&&l.normal.multiplyScalar(-1));const h={a:n,b:r,c:o,normal:new W,materialIndex:0};ms.getNormal(Le,Me,ve,h.normal),l.face=h,l.faceIndex=n}return l}function Oi(c,e,t,s,i){const n=s*3;let r=n+0,o=n+1,a=n+2;const l=c.index;c.index&&(r=l.getX(r),o=l.getX(o),a=l.getX(a));const{position:h,normal:u,uv:d,uv1:f}=c.attributes,I=ha(t,h,u,d,f,r,o,a,e);return I?(I.faceIndex=s,i&&i.push(I),I):null}function St(c,e,t,s){const i=c.a,n=c.b,r=c.c;let o=e,a=e+1,l=e+2;t&&(o=t.getX(o),a=t.getX(a),l=t.getX(l)),i.x=s.getX(o),i.y=s.getY(o),i.z=s.getZ(o),n.x=s.getX(a),n.y=s.getY(a),n.z=s.getZ(a),r.x=s.getX(l),r.y=s.getY(l),r.z=s.getZ(l)}function ua(c,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=c;for(let a=s,l=s+i;a<l;a++)Oi(r,e,t,a,n)}function da(c,e,t,s,i){const{geometry:n,_indirectBuffer:r}=c;let o=1/0,a=null;for(let l=s,h=s+i;l<h;l++){let u;u=Oi(n,e,t,l),u&&u.distance<o&&(a=u,o=u.distance)}return a}function fa(c,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,l=o.attributes.position;for(let h=c,u=e+c;h<u;h++){let d;if(d=h,St(r,d*3,a,l),r.needsUpdate=!0,s(r,d,i,n))return!0}return!1}function pa(c,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=c.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,l=0;const h=c._roots;for(let d=0,f=h.length;d<f;d++)n=h[d],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),u(0,l),l+=n.byteLength;function u(d,f,I=!1){const p=d*2;if(o[p+15]===yi){const E=r[d+6],_=o[p+14];let A=1/0,T=1/0,R=1/0,F=-1/0,w=-1/0,L=-1/0;for(let N=3*E,M=3*(E+_);N<M;N++){let z=s[N];const O=i.getX(z),P=i.getY(z),C=i.getZ(z);O<A&&(A=O),O>F&&(F=O),P<T&&(T=P),P>w&&(w=P),C<R&&(R=C),C>L&&(L=C)}return a[d+0]!==A||a[d+1]!==T||a[d+2]!==R||a[d+3]!==F||a[d+4]!==w||a[d+5]!==L?(a[d+0]=A,a[d+1]=T,a[d+2]=R,a[d+3]=F,a[d+4]=w,a[d+5]=L,!0):!1}else{const E=d+8,_=r[d+6],A=E+f,T=_+f;let R=I,F=!1,w=!1;e?R||(F=e.has(A),w=e.has(T),R=!F&&!w):(F=!0,w=!0);const L=R||F,N=R||w;let M=!1;L&&(M=u(E,f,R));let z=!1;N&&(z=u(_,f,R));const O=M||z;if(O)for(let P=0;P<3;P++){const C=E+P,v=_+P,$=a[C],Y=a[C+3],K=a[v],G=a[v+3];a[d+P]=$<K?$:K,a[d+P+3]=Y>G?Y:G}return O}}}const Jn=new Nt;function Re(c,e,t,s){return Tt(c,e,Jn),t.intersectBox(Jn,s)}function Ea(c,e,t,s,i,n){const{geometry:r,_indirectBuffer:o}=c;for(let a=s,l=s+i;a<l;a++){let h=o?o[a]:a;Oi(r,e,t,h,n)}}function Ia(c,e,t,s,i){const{geometry:n,_indirectBuffer:r}=c;let o=1/0,a=null;for(let l=s,h=s+i;l<h;l++){let u;u=Oi(n,e,t,r?r[l]:l),u&&u.distance<o&&(a=u,o=u.distance)}return a}function ma(c,e,t,s,i,n,r){const{geometry:o}=t,{index:a}=o,l=o.attributes.position;for(let h=c,u=e+c;h<u;h++){let d;if(d=t.resolveTriangleIndex(h),St(r,d*3,a,l),r.needsUpdate=!0,s(r,d,i,n))return!0}return!1}const tr=new W;function Ca(c,e,t,s,i){mt.setBuffer(c._roots[e]),Qi(0,c,t,s,i),mt.clearBuffer()}function Qi(c,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=mt,a=c*2;if(zt(a,r)){const h=Yt(c,o),u=Wt(a,r);ua(e,t,s,h,u,i)}else{const h=Xt(c);Re(h,n,s,tr)&&Qi(h,e,t,s,i);const u=Zt(c,o);Re(u,n,s,tr)&&Qi(u,e,t,s,i)}}const er=new W,ga=["x","y","z"];function Ta(c,e,t,s){mt.setBuffer(c._roots[e]);const i=qi(0,c,t,s);return mt.clearBuffer(),i}function qi(c,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=mt;let o=c*2;if(zt(o,n)){const l=Yt(c,r),h=Wt(o,n);return da(e,t,s,l,h)}else{const l=Vr(c,r),h=ga[l],d=s.direction[h]>=0;let f,I;d?(f=Xt(c),I=Zt(c,r)):(f=Zt(c,r),I=Xt(c));const m=Re(f,i,s,er)?qi(f,e,t,s):null;if(m){const A=m.point[h];if(d?A<=i[I+l]:A>=i[I+l+3])return m}const _=Re(I,i,s,er)?qi(I,e,t,s):null;return m&&_?m.distance<=_.distance?m:_:m||_||null}}const Gs=new Nt,xe=new ee,De=new ee,ns=new Ft,sr=new Ut,Hs=new Ut;function _a(c,e,t,s){mt.setBuffer(c._roots[e]);const i=Ki(0,c,t,s);return mt.clearBuffer(),i}function Ki(c,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=mt;let a=c*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),sr.set(t.boundingBox.min,t.boundingBox.max,s),i=sr),zt(a,r)){const h=e.geometry,u=h.index,d=h.attributes.position,f=t.index,I=t.attributes.position,p=Yt(c,o),m=Wt(a,r);if(ns.copy(s).invert(),t.boundsTree)return Tt(c,n,Hs),Hs.matrix.copy(ns),Hs.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:_=>Hs.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(s),_.b.applyMatrix4(s),_.c.applyMatrix4(s),_.needsUpdate=!0;for(let A=p*3,T=(m+p)*3;A<T;A+=3)if(St(De,A,u,d),De.needsUpdate=!0,_.intersectsTriangle(De))return!0;return!1}});for(let E=p*3,_=(m+p)*3;E<_;E+=3){St(xe,E,u,d),xe.a.applyMatrix4(ns),xe.b.applyMatrix4(ns),xe.c.applyMatrix4(ns),xe.needsUpdate=!0;for(let A=0,T=f.count;A<T;A+=3)if(St(De,A,f,I),De.needsUpdate=!0,xe.intersectsTriangle(De))return!0}}else{const h=c+8,u=o[c+6];return Tt(h,n,Gs),!!(i.intersectsBox(Gs)&&Ki(h,e,t,s,i)||(Tt(u,n,Gs),i.intersectsBox(Gs)&&Ki(u,e,t,s,i)))}}const Ws=new Ft,vi=new Ut,rs=new Ut,Aa=new W,Ra=new W,ya=new W,Oa=new W;function Fa(c,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),vi.set(e.boundingBox.min,e.boundingBox.max,t),vi.needsUpdate=!0;const o=c.geometry,a=o.attributes.position,l=o.index,h=e.attributes.position,u=e.index,d=Ht.getPrimitive(),f=Ht.getPrimitive();let I=Aa,p=Ra,m=null,E=null;i&&(m=ya,E=Oa);let _=1/0,A=null,T=null;return Ws.copy(t).invert(),rs.matrix.copy(Ws),c.shapecast({boundsTraverseOrder:R=>vi.distanceToBox(R),intersectsBounds:(R,F,w)=>w<_&&w<r?(F&&(rs.min.copy(R.min),rs.max.copy(R.max),rs.needsUpdate=!0),!0):!1,intersectsRange:(R,F)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:L=>rs.distanceToBox(L),intersectsBounds:(L,N,M)=>M<_&&M<r,intersectsRange:(L,N)=>{for(let M=L,z=L+N;M<z;M++){St(f,3*M,u,h),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let O=R,P=R+F;O<P;O++){St(d,3*O,l,a),d.needsUpdate=!0;const C=d.distanceToTriangle(f,I,m);if(C<_&&(p.copy(I),E&&E.copy(m),_=C,A=O,T=M),C<n)return!0}}}});{const w=qe(e);for(let L=0,N=w;L<N;L++){St(f,3*L,u,h),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let M=R,z=R+F;M<z;M++){St(d,3*M,l,a),d.needsUpdate=!0;const O=d.distanceToTriangle(f,I,m);if(O<_&&(p.copy(I),E&&E.copy(m),_=O,A=M,T=L),O<n)return!0}}}}}),Ht.releasePrimitive(d),Ht.releasePrimitive(f),_===1/0?null:(s.point?s.point.copy(p):s.point=p.clone(),s.distance=_,s.faceIndex=A,i&&(i.point?i.point.copy(E):i.point=E.clone(),i.point.applyMatrix4(Ws),p.applyMatrix4(Ws),i.distance=p.sub(i.point).length(),i.faceIndex=T),s)}function Sa(c,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=c.geometry,s=t.index?t.index.array:null,i=t.attributes.position;let n,r,o,a,l=0;const h=c._roots;for(let d=0,f=h.length;d<f;d++)n=h[d],r=new Uint32Array(n),o=new Uint16Array(n),a=new Float32Array(n),u(0,l),l+=n.byteLength;function u(d,f,I=!1){const p=d*2;if(o[p+15]===yi){const E=r[d+6],_=o[p+14];let A=1/0,T=1/0,R=1/0,F=-1/0,w=-1/0,L=-1/0;for(let N=E,M=E+_;N<M;N++){const z=3*c.resolveTriangleIndex(N);for(let O=0;O<3;O++){let P=z+O;P=s?s[P]:P;const C=i.getX(P),v=i.getY(P),$=i.getZ(P);C<A&&(A=C),C>F&&(F=C),v<T&&(T=v),v>w&&(w=v),$<R&&(R=$),$>L&&(L=$)}}return a[d+0]!==A||a[d+1]!==T||a[d+2]!==R||a[d+3]!==F||a[d+4]!==w||a[d+5]!==L?(a[d+0]=A,a[d+1]=T,a[d+2]=R,a[d+3]=F,a[d+4]=w,a[d+5]=L,!0):!1}else{const E=d+8,_=r[d+6],A=E+f,T=_+f;let R=I,F=!1,w=!1;e?R||(F=e.has(A),w=e.has(T),R=!F&&!w):(F=!0,w=!0);const L=R||F,N=R||w;let M=!1;L&&(M=u(E,f,R));let z=!1;N&&(z=u(_,f,R));const O=M||z;if(O)for(let P=0;P<3;P++){const C=E+P,v=_+P,$=a[C],Y=a[C+3],K=a[v],G=a[v+3];a[d+P]=$<K?$:K,a[d+P+3]=Y>G?Y:G}return O}}}const ir=new W;function wa(c,e,t,s,i){mt.setBuffer(c._roots[e]),Ji(0,c,t,s,i),mt.clearBuffer()}function Ji(c,e,t,s,i){const{float32Array:n,uint16Array:r,uint32Array:o}=mt,a=c*2;if(zt(a,r)){const h=Yt(c,o),u=Wt(a,r);Ea(e,t,s,h,u,i)}else{const h=Xt(c);Re(h,n,s,ir)&&Ji(h,e,t,s,i);const u=Zt(c,o);Re(u,n,s,ir)&&Ji(u,e,t,s,i)}}const nr=new W,Na=["x","y","z"];function ba(c,e,t,s){mt.setBuffer(c._roots[e]);const i=tn(0,c,t,s);return mt.clearBuffer(),i}function tn(c,e,t,s){const{float32Array:i,uint16Array:n,uint32Array:r}=mt;let o=c*2;if(zt(o,n)){const l=Yt(c,r),h=Wt(o,n);return Ia(e,t,s,l,h)}else{const l=Vr(c,r),h=Na[l],d=s.direction[h]>=0;let f,I;d?(f=Xt(c),I=Zt(c,r)):(f=Zt(c,r),I=Xt(c));const m=Re(f,i,s,nr)?tn(f,e,t,s):null;if(m){const A=m.point[h];if(d?A<=i[I+l]:A>=i[I+l+3])return m}const _=Re(I,i,s,nr)?tn(I,e,t,s):null;return m&&_?m.distance<=_.distance?m:_:m||_||null}}const Xs=new Nt,Ue=new ee,Be=new ee,os=new Ft,rr=new Ut,Zs=new Ut;function Pa(c,e,t,s){mt.setBuffer(c._roots[e]);const i=en(0,c,t,s);return mt.clearBuffer(),i}function en(c,e,t,s,i=null){const{float32Array:n,uint16Array:r,uint32Array:o}=mt;let a=c*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),rr.set(t.boundingBox.min,t.boundingBox.max,s),i=rr),zt(a,r)){const h=e.geometry,u=h.index,d=h.attributes.position,f=t.index,I=t.attributes.position,p=Yt(c,o),m=Wt(a,r);if(os.copy(s).invert(),t.boundsTree)return Tt(c,n,Zs),Zs.matrix.copy(os),Zs.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:_=>Zs.intersectsBox(_),intersectsTriangle:_=>{_.a.applyMatrix4(s),_.b.applyMatrix4(s),_.c.applyMatrix4(s),_.needsUpdate=!0;for(let A=p,T=m+p;A<T;A++)if(St(Be,3*e.resolveTriangleIndex(A),u,d),Be.needsUpdate=!0,_.intersectsTriangle(Be))return!0;return!1}});for(let E=p,_=m+p;E<_;E++){const A=e.resolveTriangleIndex(E);St(Ue,3*A,u,d),Ue.a.applyMatrix4(os),Ue.b.applyMatrix4(os),Ue.c.applyMatrix4(os),Ue.needsUpdate=!0;for(let T=0,R=f.count;T<R;T+=3)if(St(Be,T,f,I),Be.needsUpdate=!0,Ue.intersectsTriangle(Be))return!0}}else{const h=c+8,u=o[c+6];return Tt(h,n,Xs),!!(i.intersectsBox(Xs)&&en(h,e,t,s,i)||(Tt(u,n,Xs),i.intersectsBox(Xs)&&en(u,e,t,s,i)))}}const $s=new Ft,xi=new Ut,as=new Ut,La=new W,Ma=new W,va=new W,xa=new W;function Da(c,e,t,s={},i={},n=0,r=1/0){e.boundingBox||e.computeBoundingBox(),xi.set(e.boundingBox.min,e.boundingBox.max,t),xi.needsUpdate=!0;const o=c.geometry,a=o.attributes.position,l=o.index,h=e.attributes.position,u=e.index,d=Ht.getPrimitive(),f=Ht.getPrimitive();let I=La,p=Ma,m=null,E=null;i&&(m=va,E=xa);let _=1/0,A=null,T=null;return $s.copy(t).invert(),as.matrix.copy($s),c.shapecast({boundsTraverseOrder:R=>xi.distanceToBox(R),intersectsBounds:(R,F,w)=>w<_&&w<r?(F&&(as.min.copy(R.min),as.max.copy(R.max),as.needsUpdate=!0),!0):!1,intersectsRange:(R,F)=>{if(e.boundsTree){const w=e.boundsTree;return w.shapecast({boundsTraverseOrder:L=>as.distanceToBox(L),intersectsBounds:(L,N,M)=>M<_&&M<r,intersectsRange:(L,N)=>{for(let M=L,z=L+N;M<z;M++){const O=w.resolveTriangleIndex(M);St(f,3*O,u,h),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let P=R,C=R+F;P<C;P++){const v=c.resolveTriangleIndex(P);St(d,3*v,l,a),d.needsUpdate=!0;const $=d.distanceToTriangle(f,I,m);if($<_&&(p.copy(I),E&&E.copy(m),_=$,A=P,T=M),$<n)return!0}}}})}else{const w=qe(e);for(let L=0,N=w;L<N;L++){St(f,3*L,u,h),f.a.applyMatrix4(t),f.b.applyMatrix4(t),f.c.applyMatrix4(t),f.needsUpdate=!0;for(let M=R,z=R+F;M<z;M++){const O=c.resolveTriangleIndex(M);St(d,3*O,l,a),d.needsUpdate=!0;const P=d.distanceToTriangle(f,I,m);if(P<_&&(p.copy(I),E&&E.copy(m),_=P,A=M,T=L),P<n)return!0}}}}}),Ht.releasePrimitive(d),Ht.releasePrimitive(f),_===1/0?null:(s.point?s.point.copy(p):s.point=p.clone(),s.distance=_,s.faceIndex=A,i&&(i.point?i.point.copy(E):i.point=E.clone(),i.point.applyMatrix4($s),p.applyMatrix4($s),i.distance=p.sub(i.point).length(),i.faceIndex=T),s)}function Ua(){return typeof SharedArrayBuffer<"u"}const Ts=new mt.constructor,ci=new mt.constructor,ge=new Pn(()=>new Nt),ke=new Nt,ze=new Nt,Di=new Nt,Ui=new Nt;let Bi=!1;function Ba(c,e,t,s){if(Bi)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Bi=!0;const i=c._roots,n=e._roots;let r,o=0,a=0;const l=new Ft().copy(t).invert();for(let h=0,u=i.length;h<u;h++){Ts.setBuffer(i[h]),a=0;const d=ge.getPrimitive();Tt(0,Ts.float32Array,d),d.applyMatrix4(l);for(let f=0,I=n.length;f<I&&(ci.setBuffer(n[h]),r=Qt(0,0,t,l,s,o,a,0,0,d),ci.clearBuffer(),a+=n[f].length,!r);f++);if(ge.releasePrimitive(d),Ts.clearBuffer(),o+=i[h].length,r)break}return Bi=!1,r}function Qt(c,e,t,s,i,n=0,r=0,o=0,a=0,l=null,h=!1){let u,d;h?(u=ci,d=Ts):(u=Ts,d=ci);const f=u.float32Array,I=u.uint32Array,p=u.uint16Array,m=d.float32Array,E=d.uint32Array,_=d.uint16Array,A=c*2,T=e*2,R=zt(A,p),F=zt(T,_);let w=!1;if(F&&R)h?w=i(Yt(e,E),Wt(e*2,_),Yt(c,I),Wt(c*2,p),a,r+e,o,n+c):w=i(Yt(c,I),Wt(c*2,p),Yt(e,E),Wt(e*2,_),o,n+c,a,r+e);else if(F){const L=ge.getPrimitive();Tt(e,m,L),L.applyMatrix4(t);const N=Xt(c),M=Zt(c,I);Tt(N,f,ke),Tt(M,f,ze);const z=L.intersectsBox(ke),O=L.intersectsBox(ze);w=z&&Qt(e,N,s,t,i,r,n,a,o+1,L,!h)||O&&Qt(e,M,s,t,i,r,n,a,o+1,L,!h),ge.releasePrimitive(L)}else{const L=Xt(e),N=Zt(e,E);Tt(L,m,Di),Tt(N,m,Ui);const M=l.intersectsBox(Di),z=l.intersectsBox(Ui);if(M&&z)w=Qt(c,L,t,s,i,n,r,o,a+1,l,h)||Qt(c,N,t,s,i,n,r,o,a+1,l,h);else if(M)if(R)w=Qt(c,L,t,s,i,n,r,o,a+1,l,h);else{const O=ge.getPrimitive();O.copy(Di).applyMatrix4(t);const P=Xt(c),C=Zt(c,I);Tt(P,f,ke),Tt(C,f,ze);const v=O.intersectsBox(ke),$=O.intersectsBox(ze);w=v&&Qt(L,P,s,t,i,r,n,a,o+1,O,!h)||$&&Qt(L,C,s,t,i,r,n,a,o+1,O,!h),ge.releasePrimitive(O)}else if(z)if(R)w=Qt(c,N,t,s,i,n,r,o,a+1,l,h);else{const O=ge.getPrimitive();O.copy(Ui).applyMatrix4(t);const P=Xt(c),C=Zt(c,I);Tt(P,f,ke),Tt(C,f,ze);const v=O.intersectsBox(ke),$=O.intersectsBox(ze);w=v&&Qt(N,P,s,t,i,r,n,a,o+1,O,!h)||$&&Qt(N,C,s,t,i,r,n,a,o+1,O,!h),ge.releasePrimitive(O)}}return w}const js=new Ut,or=new Nt;class Ln{static serialize(e,t={}){t={cloneBuffers:!0,...t};const s=e.geometry,i=e._roots,n=e._indirectBuffer,r=s.getIndex();let o;return t.cloneBuffers?o={roots:i.map(a=>a.slice()),index:r.array.slice(),indirectBuffer:n?n.slice():null}:o={roots:i,index:r.array,indirectBuffer:n},o}static deserialize(e,t,s={}){s={setIndex:!0,indirect:!!e.indirectBuffer,...s};const{index:i,roots:n,indirectBuffer:r}=e,o=new Ln(t,{...s,[bi]:!0});if(o._roots=n,o._indirectBuffer=r||null,s.setIndex){const a=t.getIndex();if(a===null){const l=new Fs(e.index,1,!1);t.setIndex(l)}else a.array!==i&&(a.array.set(i),a.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:kr,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[bi]:!1},t),t.useSharedArrayBuffer&&!Ua())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[bi]||(ea(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Nt)));const{_indirectBuffer:s}=this;this.resolveTriangleIndex=t.indirect?i=>s[i]:i=>i}refit(e=null){return(this.indirect?Sa:pa)(this,e)}traverse(e,t=0){const s=this._roots[t],i=new Uint32Array(s),n=new Uint16Array(s);r(0);function r(o,a=0){const l=o*2,h=n[l+15]===yi;if(h){const u=i[o+6],d=n[l+14];e(a,h,new Float32Array(s,o*4,6),u,d)}else{const u=o+ni/4,d=i[o+6],f=i[o+7];e(a,h,new Float32Array(s,o*4,6),f)||(r(u,a+1),r(d,a+1))}}}raycast(e,t=Yn){const s=this._roots,i=this.geometry,n=[],r=t.isMaterial,o=Array.isArray(t),a=i.groups,l=r?t.side:t,h=this.indirect?wa:Ca;for(let u=0,d=s.length;u<d;u++){const f=o?t[a[u].materialIndex].side:l,I=n.length;if(h(this,u,f,e,n),o){const p=a[u].materialIndex;for(let m=I,E=n.length;m<E;m++)n[m].face.materialIndex=p}}return n}raycastFirst(e,t=Yn){const s=this._roots,i=this.geometry,n=t.isMaterial,r=Array.isArray(t);let o=null;const a=i.groups,l=n?t.side:t,h=this.indirect?ba:Ta;for(let u=0,d=s.length;u<d;u++){const f=r?t[a[u].materialIndex].side:l,I=h(this,u,f,e);I!=null&&(o==null||I.distance<o.distance)&&(o=I,r&&(I.face.materialIndex=a[u].materialIndex))}return o}intersectsGeometry(e,t){let s=!1;const i=this._roots,n=this.indirect?Pa:_a;for(let r=0,o=i.length;r<o&&(s=n(this,r,e,t),!s);r++);return s}shapecast(e){const t=Ht.getPrimitive(),s=this.indirect?ma:fa;let{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:r,intersectsTriangle:o}=e;if(r&&o){const u=r;r=(d,f,I,p,m)=>u(d,f,I,p,m)?!0:s(d,f,this,o,I,p,t)}else r||(o?r=(u,d,f,I)=>s(u,d,this,o,f,I,t):r=(u,d,f)=>f);let a=!1,l=0;const h=this._roots;for(let u=0,d=h.length;u<d;u++){const f=h[u];if(a=aa(this,u,n,r,i,l),a)break;l+=f.byteLength}return Ht.releasePrimitive(t),a}bvhcast(e,t,s){let{intersectsRanges:i,intersectsTriangles:n}=s;const r=Ht.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,l=this.indirect?I=>{const p=this.resolveTriangleIndex(I);St(r,p*3,o,a)}:I=>{St(r,I*3,o,a)},h=Ht.getPrimitive(),u=e.geometry.index,d=e.geometry.attributes.position,f=e.indirect?I=>{const p=e.resolveTriangleIndex(I);St(h,p*3,u,d)}:I=>{St(h,I*3,u,d)};if(n){const I=(p,m,E,_,A,T,R,F)=>{for(let w=E,L=E+_;w<L;w++){f(w),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let N=p,M=p+m;N<M;N++)if(l(N),r.needsUpdate=!0,n(r,h,N,w,A,T,R,F))return!0}return!1};if(i){const p=i;i=function(m,E,_,A,T,R,F,w){return p(m,E,_,A,T,R,F,w)?!0:I(m,E,_,A,T,R,F,w)}}else i=I}return Ba(this,e,t,i)}intersectsBox(e,t){return js.set(e.min,e.max,t),js.needsUpdate=!0,this.shapecast({intersectsBounds:s=>js.intersectsBox(s),intersectsTriangle:s=>js.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,s={},i={},n=0,r=1/0){return(this.indirect?Da:Fa)(this,e,t,s,i,n,r)}closestPointToPoint(e,t={},s=0,i=1/0){return ca(this,e,t,s,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(s=>{Tt(0,new Float32Array(s),or),e.union(or)}),e}}function ar(c,e,t){return c===null||(c.point.applyMatrix4(e.matrixWorld),c.distance=c.point.distanceTo(t.ray.origin),c.object=e,c.distance<t.near||c.distance>t.far)?null:c}const ki=new oo,cr=new Ft,ka=et.prototype.raycast;function za(c,e){if(this.geometry.boundsTree){if(this.material===void 0)return;cr.copy(this.matrixWorld).invert(),ki.copy(c.ray).applyMatrix4(cr);const t=this.geometry.boundsTree;if(c.firstHitOnly===!0){const s=ar(t.raycastFirst(ki,this.material),this,c);s&&e.push(s)}else{const s=t.raycast(ki,this.material);for(let i=0,n=s.length;i<n;i++){const r=ar(s[i],this,c);r&&e.push(r)}}}else ka.call(this,c,e)}function Ya(c){return this.boundsTree=new Ln(this,c),this.boundsTree}function Va(){this.boundsTree=null}class st{constructor(){y(this,"trigger",e=>{const t=this.handlers.slice(0);for(const s of t)s(e)});y(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class Ga{constructor(){y(this,"trigger",async e=>{const t=this.handlers.slice(0);for(const s of t)await s(e)});y(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}}class Mn{constructor(e){y(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this);y(this,"isResizeable",()=>"resize"in this&&"getSize"in this);y(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this);y(this,"isHideable",()=>"visible"in this);y(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this);this.components=e}}class Bt extends Mn{}class Ha extends Mn{constructor(t){super(t);y(this,"worlds",new Map);y(this,"onWorldChanged",new st);y(this,"currentWorld",null);this.onWorldChanged.add(({world:s,action:i})=>{i==="removed"&&this.worlds.delete(s.uuid)})}}class Wa extends Ha{constructor(){super(...arguments);y(this,"hasCameraControls",()=>"controls"in this)}}const _s=class _s extends Bt{constructor(t){super(t);y(this,"_disposedComponents",new Set);y(this,"enabled",!0);t.add(_s.uuid,this)}get(){return this._disposedComponents}destroy(t,s=!0,i=!0){t.removeFromParent();const n=t;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(t,s),i&&n.children&&n.children.length&&this.disposeChildren(n),t.children.length=0}disposeGeometry(t){t.boundsTree&&t.disposeBoundsTree&&t.disposeBoundsTree(),t.dispose()}disposeGeometryAndMaterials(t,s){const i=t;i.geometry&&this.disposeGeometry(i.geometry),s&&i.material&&_s.disposeMaterial(i),i.material=[],i.geometry=null}disposeChildren(t){for(const s of t.children)this.destroy(s)}static disposeMaterial(t){if(t.material)if(Array.isArray(t.material))for(const s of t.material)s.dispose();else t.material.dispose()}};y(_s,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");let je=_s;class Xe extends Set{constructor(t){super(t);y(this,"onItemAdded",new st);y(this,"onItemDeleted",new st);y(this,"onCleared",new st);y(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...t){for(const s of t)this.has(s)||!this.guard(s)||(super.add(s),this.onItemAdded||(this.onItemAdded=new st),this.onItemAdded.trigger(s));return this}delete(t){const s=super.delete(t);return s&&this.onItemDeleted.trigger(),s}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class fe extends Map{constructor(t){super(t);y(this,"onItemSet",new st);y(this,"onItemUpdated",new st);y(this,"onItemDeleted",new st);y(this,"onCleared",new st);y(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(t,s){const i=this.has(t);if(!(this.guard??(()=>!0))(t,s))return this;const o=super.set(t,s);return i?(this.onItemUpdated||(this.onItemUpdated=new st),this.onItemUpdated.trigger({key:t,value:s})):(this.onItemSet||(this.onItemSet=new st),this.onItemSet.trigger({key:t,value:s})),o}delete(t){const s=super.delete(t);return s&&this.onItemDeleted.trigger(t),s}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}}class lr{static isTransparent(e){return e.transparent&&e.opacity<1}}const yt=class yt{static create(){const e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,s=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return`${yt._lut[e&255]+yt._lut[e>>8&255]+yt._lut[e>>16&255]+yt._lut[e>>24&255]}-${yt._lut[t&255]}${yt._lut[t>>8&255]}-${yt._lut[t>>16&15|64]}${yt._lut[t>>24&255]}-${yt._lut[s&63|128]}${yt._lut[s>>8&255]}-${yt._lut[s>>16&255]}${yt._lut[s>>24&255]}${yt._lut[i&255]}${yt._lut[i>>8&255]}${yt._lut[i>>16&255]}${yt._lut[i>>24&255]}`.toLowerCase()}static validate(e){if(!yt._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};y(yt,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),y(yt,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);let pe=yt;const di=class di{constructor(){y(this,"onDisposed",new st);y(this,"list",new Map);y(this,"enabled",!1);y(this,"_clock");y(this,"update",()=>{if(!this.enabled)return;const e=this._clock.getDelta();for(const[t,s]of this.list)s.enabled&&s.isUpdateable()&&s.update(e);requestAnimationFrame(this.update)});this._clock=new ao,di.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");pe.validate(e),this.list.set(e,t)}get(e){const t=e.uuid;if(!this.list.has(t)){const s=new e(this);return this.list.has(t)||this.add(t,s),s}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(const[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){Ss.prototype.computeBoundsTree=Ya,Ss.prototype.disposeBoundsTree=Va,et.prototype.raycast=za}};y(di,"release","2.2.11");let sn=di;class Xa extends Mn{constructor(){super(...arguments);y(this,"meshes",new Set);y(this,"onAfterUpdate",new st);y(this,"onBeforeUpdate",new st);y(this,"onDisposed",new st);y(this,"isDisposing",!1);y(this,"enabled",!0);y(this,"uuid",pe.create());y(this,"name");y(this,"_scene");y(this,"_camera");y(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(t){this._scene=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(t){this._camera=t,t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(t){this._renderer=t,t&&(t.worlds.set(this.uuid,this),t.currentWorld=this,t.onWorldChanged.trigger({world:this,action:"added"}))}update(t){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(t),this.camera.isUpdateable()&&this.camera.update(t),this.renderer&&this.renderer.update(t),this.onAfterUpdate.trigger()))}dispose(t=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),t){const i=this.components.get(je);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(const n of this.meshes)i.destroy(n);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.components.get(li).list.delete(this.uuid),this.onDisposed.trigger(),this.onDisposed.reset()}}/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */const at={LEFT:1,RIGHT:2,MIDDLE:4},V=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Ye={NONE:0,IN:1,OUT:-1};function Oe(c){return c.isPerspectiveCamera}function Ce(c){return c.isOrthographicCamera}const Ve=Math.PI*2,hr=Math.PI/2,Gr=1e-5,cs=Math.PI/180;function qt(c,e,t){return Math.max(e,Math.min(t,c))}function It(c,e=Gr){return Math.abs(c)<e}function ft(c,e,t=Gr){return It(c-e,t)}function ur(c,e){return Math.round(c/e)*e}function ls(c){return isFinite(c)?c:c<0?-Number.MAX_VALUE:Number.MAX_VALUE}function hs(c){return Math.abs(c)<Number.MAX_VALUE?c:c*(1/0)}function Qs(c,e,t,s,i=1/0,n){s=Math.max(1e-4,s);const r=2/s,o=r*n,a=1/(1+o+.48*o*o+.235*o*o*o);let l=c-e;const h=e,u=i*s;l=qt(l,-u,u),e=c-l;const d=(t.value+r*l)*n;t.value=(t.value-r*d)*a;let f=e+(l+d)*a;return h-c>0==f>h&&(f=h,t.value=(f-h)/n),f}function dr(c,e,t,s,i=1/0,n,r){s=Math.max(1e-4,s);const o=2/s,a=o*n,l=1/(1+a+.48*a*a+.235*a*a*a);let h=e.x,u=e.y,d=e.z,f=c.x-h,I=c.y-u,p=c.z-d;const m=h,E=u,_=d,A=i*s,T=A*A,R=f*f+I*I+p*p;if(R>T){const v=Math.sqrt(R);f=f/v*A,I=I/v*A,p=p/v*A}h=c.x-f,u=c.y-I,d=c.z-p;const F=(t.x+o*f)*n,w=(t.y+o*I)*n,L=(t.z+o*p)*n;t.x=(t.x-o*F)*l,t.y=(t.y-o*w)*l,t.z=(t.z-o*L)*l,r.x=h+(f+F)*l,r.y=u+(I+w)*l,r.z=d+(p+L)*l;const N=m-c.x,M=E-c.y,z=_-c.z,O=r.x-m,P=r.y-E,C=r.z-_;return N*O+M*P+z*C>0&&(r.x=m,r.y=E,r.z=_,t.x=(r.x-m)/n,t.y=(r.y-E)/n,t.z=(r.z-_)/n),r}function zi(c,e){e.set(0,0),c.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=c.length,e.y/=c.length}function Yi(c,e){return Ce(c)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}class Za{constructor(){this._listeners={}}addEventListener(e,t){const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(t)===-1&&s[e].push(t)}hasEventListener(e,t){const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners[e];if(i!==void 0){const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){const s=this._listeners[e.type];if(s!==void 0){e.target=this;const i=s.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,e)}}}const $a="2.7.3",qs=1/8,Hr=typeof window<"u",ja=Hr&&/Mac/.test(navigator.platform),Qa=!(Hr&&"PointerEvent"in window);let ot,fr,Ks,Vi,kt,ct,ut,Ge,us,ne,re,Fe,pr,Er,Gt,ds,He,Ir,Gi,mr,Hi,Wi,Js;class vt extends Za{static install(e){ot=e.THREE,fr=Object.freeze(new ot.Vector3(0,0,0)),Ks=Object.freeze(new ot.Vector3(0,1,0)),Vi=Object.freeze(new ot.Vector3(0,0,1)),kt=new ot.Vector2,ct=new ot.Vector3,ut=new ot.Vector3,Ge=new ot.Vector3,us=new ot.Vector3,ne=new ot.Vector3,re=new ot.Vector3,Fe=new ot.Vector3,pr=new ot.Vector3,Er=new ot.Vector3,Gt=new ot.Spherical,ds=new ot.Spherical,He=new ot.Box3,Ir=new ot.Box3,Gi=new ot.Sphere,mr=new ot.Quaternion,Hi=new ot.Quaternion,Wi=new ot.Matrix4,Js=new ot.Raycaster}static get ACTION(){return V}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=V.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Ye.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new ot.Vector3,this._focalOffsetVelocity=new ot.Vector3,this._zoomVelocity={value:0},this._truckInternal=(T,R,F)=>{let w,L;if(Oe(this._camera)){const N=ct.copy(this._camera.position).sub(this._target),M=this._camera.getEffectiveFOV()*cs,z=N.length()*Math.tan(M*.5);w=this.truckSpeed*T*z/this._elementRect.height,L=this.truckSpeed*R*z/this._elementRect.height}else if(Ce(this._camera)){const N=this._camera;w=T*(N.right-N.left)/N.zoom/this._elementRect.width,L=R*(N.top-N.bottom)/N.zoom/this._elementRect.height}else return;this.verticalDragToForward?(F?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(w,0,!0),this.forward(-L,!0)):F?this.setFocalOffset(this._focalOffsetEnd.x+w,this._focalOffsetEnd.y+L,this._focalOffsetEnd.z,!0):this.truck(w,L,!0)},this._rotateInternal=(T,R)=>{const F=Ve*this.azimuthRotateSpeed*T/this._elementRect.height,w=Ve*this.polarRotateSpeed*R/this._elementRect.height;this.rotate(F,w,!0)},this._dollyInternal=(T,R,F)=>{const w=Math.pow(.95,-T*this.dollySpeed),L=this._sphericalEnd.radius,N=this._sphericalEnd.radius*w,M=qt(N,this.minDistance,this.maxDistance),z=M-N;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(N,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(z,!0),this._dollyToNoClamp(M,!0)):this._dollyToNoClamp(M,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?N:M)-L,this._dollyControlCoord.set(R,F)),this._lastDollyDirection=Math.sign(-T)},this._zoomInternal=(T,R,F)=>{const w=Math.pow(.95,T*this.dollySpeed),L=this._zoom,N=this._zoom*w;this.zoomTo(N,!0),this.dollyToCursor&&(this._changedZoom+=N-L,this._dollyControlCoord.set(R,F))},typeof ot>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new ot.Quaternion().setFromUnitVectors(this._camera.up,Ks),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=V.NONE,this._target=new ot.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new ot.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new ot.Spherical().setFromVector3(ct.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new ot.Vector3,new ot.Vector3,new ot.Vector3,new ot.Vector3],this._updateNearPlaneCorners(),this._boundary=new ot.Box3(new ot.Vector3(-1/0,-1/0,-1/0),new ot.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new ot.Vector2,this.mouseButtons={left:V.ROTATE,middle:V.DOLLY,right:V.TRUCK,wheel:Oe(this._camera)?V.DOLLY:Ce(this._camera)?V.ZOOM:V.NONE},this.touches={one:V.TOUCH_ROTATE,two:Oe(this._camera)?V.TOUCH_DOLLY_TRUCK:Ce(this._camera)?V.TOUCH_ZOOM_TRUCK:V.NONE,three:V.TOUCH_TRUCK};const s=new ot.Vector2,i=new ot.Vector2,n=new ot.Vector2,r=T=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const w=this._domElement.getBoundingClientRect(),L=T.clientX/w.width,N=T.clientY/w.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||N<this._interactiveArea.top||N>this._interactiveArea.bottom)return}const R=T.pointerType!=="mouse"?null:(T.buttons&at.LEFT)===at.LEFT?at.LEFT:(T.buttons&at.MIDDLE)===at.MIDDLE?at.MIDDLE:(T.buttons&at.RIGHT)===at.RIGHT?at.RIGHT:null;if(R!==null){const w=this._findPointerByMouseButton(R);w&&this._disposePointer(w)}if((T.buttons&at.LEFT)===at.LEFT&&this._lockedPointer)return;const F={pointerId:T.pointerId,clientX:T.clientX,clientY:T.clientY,deltaX:0,deltaY:0,mouseButton:R};this._activePointers.push(F),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",h),this._isDragging=!0,p(T)},o=T=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const w=this._domElement.getBoundingClientRect(),L=T.clientX/w.width,N=T.clientY/w.height;if(L<this._interactiveArea.left||L>this._interactiveArea.right||N<this._interactiveArea.top||N>this._interactiveArea.bottom)return}const R=(T.buttons&at.LEFT)===at.LEFT?at.LEFT:(T.buttons&at.MIDDLE)===at.MIDDLE?at.MIDDLE:(T.buttons&at.RIGHT)===at.RIGHT?at.RIGHT:null;if(R!==null){const w=this._findPointerByMouseButton(R);w&&this._disposePointer(w)}const F={pointerId:1,clientX:T.clientX,clientY:T.clientY,deltaX:0,deltaY:0,mouseButton:(T.buttons&at.LEFT)===at.LEFT?at.LEFT:(T.buttons&at.MIDDLE)===at.LEFT?at.MIDDLE:(T.buttons&at.RIGHT)===at.LEFT?at.RIGHT:null};this._activePointers.push(F),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",u),this._domElement.ownerDocument.addEventListener("mousemove",l),this._domElement.ownerDocument.addEventListener("mouseup",u),this._isDragging=!0,p(T)},a=T=>{T.cancelable&&T.preventDefault();const R=T.pointerId,F=this._lockedPointer||this._findPointerById(R);if(F){if(F.clientX=T.clientX,F.clientY=T.clientY,F.deltaX=T.movementX,F.deltaY=T.movementY,this._state=0,T.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(T.buttons&at.LEFT)===at.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(T.buttons&at.MIDDLE)===at.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(T.buttons&at.RIGHT)===at.RIGHT&&(this._state=this._state|this.mouseButtons.right);m()}},l=T=>{const R=this._lockedPointer||this._findPointerById(1);R&&(R.clientX=T.clientX,R.clientY=T.clientY,R.deltaX=T.movementX,R.deltaY=T.movementY,this._state=0,(this._lockedPointer||(T.buttons&at.LEFT)===at.LEFT)&&(this._state=this._state|this.mouseButtons.left),(T.buttons&at.MIDDLE)===at.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(T.buttons&at.RIGHT)===at.RIGHT&&(this._state=this._state|this.mouseButtons.right),m())},h=T=>{const R=this._findPointerById(T.pointerId);if(!(R&&R===this._lockedPointer)){if(R&&this._disposePointer(R),T.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=V.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=V.NONE;E()}},u=()=>{const T=this._findPointerById(1);T&&T===this._lockedPointer||(T&&this._disposePointer(T),this._state=V.NONE,E())};let d=-1;const f=T=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===V.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){const N=this._domElement.getBoundingClientRect(),M=T.clientX/N.width,z=T.clientY/N.height;if(M<this._interactiveArea.left||M>this._interactiveArea.right||z<this._interactiveArea.top||z>this._interactiveArea.bottom)return}if(T.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===V.ROTATE||this.mouseButtons.wheel===V.TRUCK){const N=performance.now();d-N<1e3&&this._getClientRect(this._elementRect),d=N}const R=ja?-1:-3,F=T.deltaMode===1?T.deltaY/R:T.deltaY/(R*10),w=this.dollyToCursor?(T.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,L=this.dollyToCursor?(T.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case V.ROTATE:{this._rotateInternal(T.deltaX,T.deltaY),this._isUserControllingRotate=!0;break}case V.TRUCK:{this._truckInternal(T.deltaX,T.deltaY,!1),this._isUserControllingTruck=!0;break}case V.OFFSET:{this._truckInternal(T.deltaX,T.deltaY,!0),this._isUserControllingOffset=!0;break}case V.DOLLY:{this._dollyInternal(-F,w,L),this._isUserControllingDolly=!0;break}case V.ZOOM:{this._zoomInternal(-F,w,L),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},I=T=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===vt.ACTION.NONE){const R=T instanceof PointerEvent?T.pointerId:(T instanceof MouseEvent,0),F=this._findPointerById(R);F&&this._disposePointer(F),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("mouseup",u);return}T.preventDefault()}},p=T=>{if(!this._enabled)return;if(zi(this._activePointers,kt),this._getClientRect(this._elementRect),s.copy(kt),i.copy(kt),this._activePointers.length>=2){const F=kt.x-this._activePointers[1].clientX,w=kt.y-this._activePointers[1].clientY,L=Math.sqrt(F*F+w*w);n.set(0,L);const N=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,M=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;i.set(N,M)}if(this._state=0,!T)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in T&&T.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(T.buttons&at.LEFT)===at.LEFT&&(this._state=this._state|this.mouseButtons.left),(T.buttons&at.MIDDLE)===at.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(T.buttons&at.RIGHT)===at.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&V.ROTATE)===V.ROTATE||(this._state&V.TOUCH_ROTATE)===V.TOUCH_ROTATE||(this._state&V.TOUCH_DOLLY_ROTATE)===V.TOUCH_DOLLY_ROTATE||(this._state&V.TOUCH_ZOOM_ROTATE)===V.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&V.TRUCK)===V.TRUCK||(this._state&V.TOUCH_TRUCK)===V.TOUCH_TRUCK||(this._state&V.TOUCH_DOLLY_TRUCK)===V.TOUCH_DOLLY_TRUCK||(this._state&V.TOUCH_ZOOM_TRUCK)===V.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&V.DOLLY)===V.DOLLY||(this._state&V.TOUCH_DOLLY)===V.TOUCH_DOLLY||(this._state&V.TOUCH_DOLLY_TRUCK)===V.TOUCH_DOLLY_TRUCK||(this._state&V.TOUCH_DOLLY_OFFSET)===V.TOUCH_DOLLY_OFFSET||(this._state&V.TOUCH_DOLLY_ROTATE)===V.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&V.ZOOM)===V.ZOOM||(this._state&V.TOUCH_ZOOM)===V.TOUCH_ZOOM||(this._state&V.TOUCH_ZOOM_TRUCK)===V.TOUCH_ZOOM_TRUCK||(this._state&V.TOUCH_ZOOM_OFFSET)===V.TOUCH_ZOOM_OFFSET||(this._state&V.TOUCH_ZOOM_ROTATE)===V.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&V.OFFSET)===V.OFFSET||(this._state&V.TOUCH_OFFSET)===V.TOUCH_OFFSET||(this._state&V.TOUCH_DOLLY_OFFSET)===V.TOUCH_DOLLY_OFFSET||(this._state&V.TOUCH_ZOOM_OFFSET)===V.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})},m=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,zi(this._activePointers,kt);const R=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,F=R?-R.deltaX:i.x-kt.x,w=R?-R.deltaY:i.y-kt.y;if(i.copy(kt),((this._state&V.ROTATE)===V.ROTATE||(this._state&V.TOUCH_ROTATE)===V.TOUCH_ROTATE||(this._state&V.TOUCH_DOLLY_ROTATE)===V.TOUCH_DOLLY_ROTATE||(this._state&V.TOUCH_ZOOM_ROTATE)===V.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(F,w),this._isUserControllingRotate=!0),(this._state&V.DOLLY)===V.DOLLY||(this._state&V.ZOOM)===V.ZOOM){const L=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,N=this.dollyToCursor?(s.y-this._elementRect.y)/this._elementRect.height*-2+1:0,M=this.dollyDragInverted?-1:1;(this._state&V.DOLLY)===V.DOLLY?(this._dollyInternal(M*w*qs,L,N),this._isUserControllingDolly=!0):(this._zoomInternal(M*w*qs,L,N),this._isUserControllingZoom=!0)}if((this._state&V.TOUCH_DOLLY)===V.TOUCH_DOLLY||(this._state&V.TOUCH_ZOOM)===V.TOUCH_ZOOM||(this._state&V.TOUCH_DOLLY_TRUCK)===V.TOUCH_DOLLY_TRUCK||(this._state&V.TOUCH_ZOOM_TRUCK)===V.TOUCH_ZOOM_TRUCK||(this._state&V.TOUCH_DOLLY_OFFSET)===V.TOUCH_DOLLY_OFFSET||(this._state&V.TOUCH_ZOOM_OFFSET)===V.TOUCH_ZOOM_OFFSET||(this._state&V.TOUCH_DOLLY_ROTATE)===V.TOUCH_DOLLY_ROTATE||(this._state&V.TOUCH_ZOOM_ROTATE)===V.TOUCH_ZOOM_ROTATE){const L=kt.x-this._activePointers[1].clientX,N=kt.y-this._activePointers[1].clientY,M=Math.sqrt(L*L+N*N),z=n.y-M;n.set(0,M);const O=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,P=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&V.TOUCH_DOLLY)===V.TOUCH_DOLLY||(this._state&V.TOUCH_DOLLY_ROTATE)===V.TOUCH_DOLLY_ROTATE||(this._state&V.TOUCH_DOLLY_TRUCK)===V.TOUCH_DOLLY_TRUCK||(this._state&V.TOUCH_DOLLY_OFFSET)===V.TOUCH_DOLLY_OFFSET?(this._dollyInternal(z*qs,O,P),this._isUserControllingDolly=!0):(this._zoomInternal(z*qs,O,P),this._isUserControllingZoom=!0)}((this._state&V.TRUCK)===V.TRUCK||(this._state&V.TOUCH_TRUCK)===V.TOUCH_TRUCK||(this._state&V.TOUCH_DOLLY_TRUCK)===V.TOUCH_DOLLY_TRUCK||(this._state&V.TOUCH_ZOOM_TRUCK)===V.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(F,w,!1),this._isUserControllingTruck=!0),((this._state&V.OFFSET)===V.OFFSET||(this._state&V.TOUCH_OFFSET)===V.TOUCH_OFFSET||(this._state&V.TOUCH_DOLLY_OFFSET)===V.TOUCH_DOLLY_OFFSET||(this._state&V.TOUCH_ZOOM_OFFSET)===V.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(F,w,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},E=()=>{zi(this._activePointers,kt),i.copy(kt),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.removeEventListener("mouseup",u),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",_),this._domElement.ownerDocument.addEventListener("pointerlockerror",A),this._domElement.ownerDocument.addEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",h),p())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",_),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))};const _=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},A=()=>{this.unlockPointer()};this._addAllEventListeners=T=>{this._domElement=T,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",r),Qa&&this._domElement.addEventListener("mousedown",o),this._domElement.addEventListener("pointercancel",h),this._domElement.addEventListener("wheel",f,{passive:!1}),this._domElement.addEventListener("contextmenu",I)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",r),this._domElement.removeEventListener("mousedown",o),this._domElement.removeEventListener("pointercancel",h),this._domElement.removeEventListener("wheel",f,{passive:!1}),this._domElement.removeEventListener("contextmenu",I),this._domElement.ownerDocument.removeEventListener("pointermove",a,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",l),this._domElement.ownerDocument.removeEventListener("pointerup",h),this._domElement.ownerDocument.removeEventListener("mouseup",u),this._domElement.ownerDocument.removeEventListener("pointerlockchange",_),this._domElement.ownerDocument.removeEventListener("pointerlockerror",A))},this.cancel=()=>{this._state!==V.NONE&&(this._state=V.NONE,this._activePointers.length=0,E())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=qt(e.width,0,1),this._interactiveArea.height=qt(e.height,0,1),this._interactiveArea.x=qt(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=qt(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,s=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,s)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,s=!1){this._isUserControllingRotate=!1;const i=qt(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=qt(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,s||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);const r=!s||ft(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ft(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(r)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Ye.NONE,this._changedDolly=0,this._dollyToNoClamp(qt(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){const s=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){const r=this._collisionTest(),o=ft(r,this._spherical.radius);if(!(s>e)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,r)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);const n=!t||ft(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(us).multiplyScalar(e)),t||this._target.copy(this._targetEnd);const s=!t||ft(this._target.x,this._targetEnd.x,this.restThreshold)&&ft(this._target.y,this._targetEnd.y,this.restThreshold)&&ft(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=qt(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);const s=!t||ft(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(s)}pan(e,t,s=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,s)}truck(e,t,s=!1){this._camera.updateMatrix(),ne.setFromMatrixColumn(this._camera.matrix,0),re.setFromMatrixColumn(this._camera.matrix,1),ne.multiplyScalar(e),re.multiplyScalar(-t);const i=ct.copy(ne).add(re),n=ut.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,s)}forward(e,t=!1){ct.setFromMatrixColumn(this._camera.matrix,0),ct.crossVectors(this._camera.up,ct),ct.multiplyScalar(e);const s=ut.copy(this._targetEnd).add(ct);return this.moveTo(s.x,s.y,s.z,t)}elevate(e,t=!1){return ct.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+ct.x,this._targetEnd.y+ct.y,this._targetEnd.z+ct.z,t)}moveTo(e,t,s,i=!1){this._isUserControllingTruck=!1;const n=ct.set(e,t,s).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);const r=!i||ft(this._target.x,this._targetEnd.x,this.restThreshold)&&ft(this._target.y,this._targetEnd.y,this.restThreshold)&&ft(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}lookInDirectionOf(e,t,s,i=!1){const o=ct.set(e,t,s).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(o.x,o.y,o.z,i)}fitToBox(e,t,{cover:s=!1,paddingLeft:i=0,paddingRight:n=0,paddingBottom:r=0,paddingTop:o=0}={}){const a=[],l=e.isBox3?He.copy(e):He.setFromObject(e);l.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());const h=ur(this._sphericalEnd.theta,hr),u=ur(this._sphericalEnd.phi,hr);a.push(this.rotateTo(h,u,t));const d=ct.setFromSpherical(this._sphericalEnd).normalize(),f=mr.setFromUnitVectors(d,Vi),I=ft(Math.abs(d.y),1);I&&f.multiply(Hi.setFromAxisAngle(Ks,h)),f.multiply(this._yAxisUpSpaceInverse);const p=Ir.makeEmpty();ut.copy(l.min).applyQuaternion(f),p.expandByPoint(ut),ut.copy(l.min).setX(l.max.x).applyQuaternion(f),p.expandByPoint(ut),ut.copy(l.min).setY(l.max.y).applyQuaternion(f),p.expandByPoint(ut),ut.copy(l.max).setZ(l.min.z).applyQuaternion(f),p.expandByPoint(ut),ut.copy(l.min).setZ(l.max.z).applyQuaternion(f),p.expandByPoint(ut),ut.copy(l.max).setY(l.min.y).applyQuaternion(f),p.expandByPoint(ut),ut.copy(l.max).setX(l.min.x).applyQuaternion(f),p.expandByPoint(ut),ut.copy(l.max).applyQuaternion(f),p.expandByPoint(ut),p.min.x-=i,p.min.y-=r,p.max.x+=n,p.max.y+=o,f.setFromUnitVectors(Vi,d),I&&f.premultiply(Hi.invert()),f.premultiply(this._yAxisUpSpace);const m=p.getSize(ct),E=p.getCenter(ut).applyQuaternion(f);if(Oe(this._camera)){const _=this.getDistanceToFitBox(m.x,m.y,m.z,s);a.push(this.moveTo(E.x,E.y,E.z,t)),a.push(this.dollyTo(_,t)),a.push(this.setFocalOffset(0,0,0,t))}else if(Ce(this._camera)){const _=this._camera,A=_.right-_.left,T=_.top-_.bottom,R=s?Math.max(A/m.x,T/m.y):Math.min(A/m.x,T/m.y);a.push(this.moveTo(E.x,E.y,E.z,t)),a.push(this.zoomTo(R,t)),a.push(this.setFocalOffset(0,0,0,t))}return Promise.all(a)}fitToSphere(e,t){const s=[],n=e instanceof ot.Sphere?Gi.copy(e):vt.createBoundingSphere(e,Gi);if(s.push(this.moveTo(n.center.x,n.center.y,n.center.z,t)),Oe(this._camera)){const r=this.getDistanceToFitSphere(n.radius);s.push(this.dollyTo(r,t))}else if(Ce(this._camera)){const r=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,a=2*n.radius,l=Math.min(r/a,o/a);s.push(this.zoomTo(l,t))}return s.push(this.setFocalOffset(0,0,0,t)),Promise.all(s)}setLookAt(e,t,s,i,n,r,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ye.NONE,this._changedDolly=0;const a=ut.set(i,n,r),l=ct.set(e,t,s);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(l.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const h=!o||ft(this._target.x,this._targetEnd.x,this.restThreshold)&&ft(this._target.y,this._targetEnd.y,this.restThreshold)&&ft(this._target.z,this._targetEnd.z,this.restThreshold)&&ft(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ft(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ft(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(h)}lerpLookAt(e,t,s,i,n,r,o,a,l,h,u,d,f,I=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Ye.NONE,this._changedDolly=0;const p=ct.set(i,n,r),m=ut.set(e,t,s);Gt.setFromVector3(m.sub(p).applyQuaternion(this._yAxisUpSpace));const E=Ge.set(h,u,d),_=ut.set(o,a,l);ds.setFromVector3(_.sub(E).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(p.lerp(E,f));const A=ds.theta-Gt.theta,T=ds.phi-Gt.phi,R=ds.radius-Gt.radius;this._sphericalEnd.set(Gt.radius+R*f,Gt.phi+T*f,Gt.theta+A*f),this.normalizeRotations(),this._needsUpdate=!0,I||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));const F=!I||ft(this._target.x,this._targetEnd.x,this.restThreshold)&&ft(this._target.y,this._targetEnd.y,this.restThreshold)&&ft(this._target.z,this._targetEnd.z,this.restThreshold)&&ft(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&ft(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&ft(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(F)}setPosition(e,t,s,i=!1){return this.setLookAt(e,t,s,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,s,i=!1){const n=this.getPosition(ct),r=this.setLookAt(n.x,n.y,n.z,e,t,s,i);return this._sphericalEnd.phi=qt(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),r}setFocalOffset(e,t,s,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,s),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);const n=!i||ft(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&ft(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&ft(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,s){this._camera.updateMatrixWorld(),ne.setFromMatrixColumn(this._camera.matrixWorldInverse,0),re.setFromMatrixColumn(this._camera.matrixWorldInverse,1),Fe.setFromMatrixColumn(this._camera.matrixWorldInverse,2);const i=ct.set(e,t,s),n=i.distanceTo(this._camera.position),r=i.sub(this._camera.position);ne.multiplyScalar(r.x),re.multiplyScalar(r.y),Fe.multiplyScalar(r.z),ct.copy(ne).add(re).add(Fe),ct.z=ct.z+n,this.dollyTo(n,!1),this.setFocalOffset(-ct.x,ct.y,-ct.z,!1),this.moveTo(e,t,s,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,s,i){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new ot.Vector4,typeof e=="number"?this._viewport.set(e,t,s,i):this._viewport.copy(e)}getDistanceToFitBox(e,t,s,i=!1){if(Yi(this._camera,"getDistanceToFitBox"))return this._spherical.radius;const n=e/t,r=this._camera.getEffectiveFOV()*cs,o=this._camera.aspect;return((i?n>o:n<o)?t:e/o)*.5/Math.tan(r*.5)+s*.5}getDistanceToFitSphere(e){if(Yi(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;const t=this._camera.getEffectiveFOV()*cs,s=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,i=1<this._camera.aspect?t:s;return e/Math.sin(i*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new ot.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new ot.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof ot.Spherical?e:new ot.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new ot.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Ve,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Ve),this._spherical.theta+=Ve*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Ve)}reset(e=!1){if(!ft(this._camera.up.x,this._cameraUp0.x)||!ft(this._camera.up.y,this._cameraUp0.y)||!ft(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);const s=this.getPosition(ct);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}const t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,Ks),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){const e=ct.subVectors(this._target,this._camera.position).normalize(),t=ut.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();const s=this.getPosition(ct);this.updateCameraUp(),this.setPosition(s.x,s.y,s.z)}update(e){const t=this._sphericalEnd.theta-this._spherical.theta,s=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=pr.subVectors(this._targetEnd,this._target),r=Er.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(It(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{const u=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=Qs(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,u,1/0,e),this._needsUpdate=!0}if(It(s))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{const u=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=Qs(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,u,1/0,e),this._needsUpdate=!0}if(It(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{const u=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=Qs(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,u,this.maxSpeed,e),this._needsUpdate=!0}if(It(n.x)&&It(n.y)&&It(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{const u=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;dr(this._target,this._targetEnd,this._targetVelocity,u,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(It(r.x)&&It(r.y)&&It(r.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{const u=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;dr(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,u,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(It(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{const u=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=Qs(this._zoom,this._zoomEnd,this._zoomVelocity,u,1/0,e)}if(this.dollyToCursor){if(Oe(this._camera)&&this._changedDolly!==0){const u=this._spherical.radius-this._lastDistance,d=this._camera,f=this._getCameraDirection(us),I=ct.copy(f).cross(d.up).normalize();I.lengthSq()===0&&(I.x=1);const p=ut.crossVectors(I,f),m=this._sphericalEnd.radius*Math.tan(d.getEffectiveFOV()*cs*.5),_=(this._sphericalEnd.radius-u-this._sphericalEnd.radius)/this._sphericalEnd.radius,A=Ge.copy(this._targetEnd).add(I.multiplyScalar(this._dollyControlCoord.x*m*d.aspect)).add(p.multiplyScalar(this._dollyControlCoord.y*m)),T=ct.copy(this._targetEnd).lerp(A,_),R=this._lastDollyDirection===Ye.IN&&this._spherical.radius<=this.minDistance,F=this._lastDollyDirection===Ye.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(R||F)){this._sphericalEnd.radius-=u,this._spherical.radius-=u;const L=ut.copy(f).multiplyScalar(-u);T.add(L)}this._boundary.clampPoint(T,T);const w=ut.subVectors(T,this._targetEnd);this._targetEnd.copy(T),this._target.add(w),this._changedDolly-=u,It(this._changedDolly)&&(this._changedDolly=0)}else if(Ce(this._camera)&&this._changedZoom!==0){const u=this._zoom-this._lastZoom,d=this._camera,f=ct.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(d.near+d.far)/(d.near-d.far)).unproject(d),I=ut.set(0,0,-1).applyQuaternion(d.quaternion),p=Ge.copy(f).add(I.multiplyScalar(-f.dot(d.up))),E=-(this._zoom-u-this._zoom)/this._zoom,_=this._getCameraDirection(us),A=this._targetEnd.dot(_),T=ct.copy(this._targetEnd).lerp(p,E),R=T.dot(_),F=_.multiplyScalar(R-A);T.sub(F),this._boundary.clampPoint(T,T);const w=ut.subVectors(T,this._targetEnd);this._targetEnd.copy(T),this._target.add(w),this._changedZoom-=u,It(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;const a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!It(this._focalOffset.x)||!It(this._focalOffset.y)||!It(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),ne.setFromMatrixColumn(this._camera.matrix,0),re.setFromMatrixColumn(this._camera.matrix,1),Fe.setFromMatrixColumn(this._camera.matrix,2),ne.multiplyScalar(this._focalOffset.x),re.multiplyScalar(-this._focalOffset.y),Fe.multiplyScalar(this._focalOffset.z),ct.copy(ne).add(re).add(Fe),this._camera.position.add(ct)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),ct.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);const h=this._needsUpdate;return h&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):h?(this.dispatchEvent({type:"update"}),It(t,this.restThreshold)&&It(s,this.restThreshold)&&It(i,this.restThreshold)&&It(n.x,this.restThreshold)&&It(n.y,this.restThreshold)&&It(n.z,this.restThreshold)&&It(r.x,this.restThreshold)&&It(r.y,this.restThreshold)&&It(r.z,this.restThreshold)&&It(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!h&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=h,this._needsUpdate=!1,h}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:ls(this.maxDistance),minZoom:this.minZoom,maxZoom:ls(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:ls(this.maxPolarAngle),minAzimuthAngle:ls(this.minAzimuthAngle),maxAzimuthAngle:ls(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:ct.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){const s=JSON.parse(e);this.enabled=s.enabled,this.minDistance=s.minDistance,this.maxDistance=hs(s.maxDistance),this.minZoom=s.minZoom,this.maxZoom=hs(s.maxZoom),this.minPolarAngle=s.minPolarAngle,this.maxPolarAngle=hs(s.maxPolarAngle),this.minAzimuthAngle=hs(s.minAzimuthAngle),this.maxAzimuthAngle=hs(s.maxAzimuthAngle),this.smoothTime=s.smoothTime,this.draggingSmoothTime=s.draggingSmoothTime,this.dollySpeed=s.dollySpeed,this.truckSpeed=s.truckSpeed,this.dollyToCursor=s.dollyToCursor,this.verticalDragToForward=s.verticalDragToForward,this._target0.fromArray(s.target0),this._position0.fromArray(s.position0),this._zoom0=s.zoom0,this._focalOffset0.fromArray(s.focalOffset0),this.moveTo(s.target[0],s.target[1],s.target[2],t),Gt.setFromVector3(ct.fromArray(s.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(Gt.theta,Gt.phi,t),this.dollyTo(Gt.radius,t),this.zoomTo(s.zoom,t),this.setFocalOffset(s.focalOffset[0],s.focalOffset[1],s.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",$a),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,s){const i=t.lengthSq();if(i===0)return e;const n=ut.copy(t).add(e),o=this._boundary.clampPoint(n,Ge).sub(n),a=o.lengthSq();if(a===0)return e.add(t);if(a===i)return e;if(s===0)return e.add(t).add(o);{const l=1+s*a/t.dot(o);return e.add(ut.copy(t).multiplyScalar(l)).add(o.multiplyScalar(1-s))}}_updateNearPlaneCorners(){if(Oe(this._camera)){const e=this._camera,t=e.near,s=e.getEffectiveFOV()*cs,i=Math.tan(s*.5)*t,n=i*e.aspect;this._nearPlaneCorners[0].set(-n,-i,0),this._nearPlaneCorners[1].set(n,-i,0),this._nearPlaneCorners[2].set(n,i,0),this._nearPlaneCorners[3].set(-n,i,0)}else if(Ce(this._camera)){const e=this._camera,t=1/e.zoom,s=e.left*t,i=e.right*t,n=e.top*t,r=e.bottom*t;this._nearPlaneCorners[0].set(s,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(s,r,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Yi(this._camera,"_collisionTest"))return e;const s=this._getTargetDirection(us);Wi.lookAt(fr,s,this._camera.up);for(let i=0;i<4;i++){const n=ut.copy(this._nearPlaneCorners[i]);n.applyMatrix4(Wi);const r=Ge.addVectors(this._target,n);Js.set(r,s),Js.far=this._spherical.radius+1;const o=Js.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<e&&(e=o[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;const t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{const s=()=>{this.removeEventListener("rest",s),t()};this.addEventListener("rest",s)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new ot.Sphere){const s=t,i=s.center;He.makeEmpty(),e.traverseVisible(r=>{r.isMesh&&He.expandByObject(r)}),He.getCenter(i);let n=0;return e.traverseVisible(r=>{if(!r.isMesh)return;const o=r,a=o.geometry.clone();a.applyMatrix4(o.matrixWorld);const h=a.attributes.position;for(let u=0,d=h.count;u<d;u++)ct.fromBufferAttribute(h,u),n=Math.max(n,i.distanceToSquared(ct))}),s.radius=Math.sqrt(n),s}}class vn extends Wa{constructor(t){super(t);y(this,"onBeforeUpdate",new st);y(this,"onAfterUpdate",new st);y(this,"onAspectUpdated",new st);y(this,"onDisposed",new st);y(this,"three");y(this,"_allControls",new Map);y(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof En){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){const s=this.currentWorld.renderer.getSize();this.three.aspect=s.width/s.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}});this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:s,world:i})=>{if(s==="added"){const n=this.newCameraControls();this._allControls.set(i.uuid,n)}if(s==="removed"){const n=this._allControls.get(i.uuid);n&&(n.dispose(),this._allControls.delete(i.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");const t=this._allControls.get(this.currentWorld.uuid);if(!t)throw new Error("Controls not found!");return t}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(t){this.currentWorld!==null&&(this.controls.enabled=t)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(const[t,s]of this._allControls)s.dispose()}update(t){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(t),this.onAfterUpdate.trigger(this))}setupCamera(){const t=window.innerWidth/window.innerHeight,s=new Lr(60,t,1,1e3);return s.position.set(50,50,50),s.lookAt(new W(0,0,0)),s}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");vt.install({THREE:vn.getSubsetOfThree()});const{domElement:t}=this.currentWorld.renderer.three,s=new vt(this.three,t);return s.smoothTime=.2,s.dollyToCursor=!0,s.infinityDolly=!0,s.minDistance=6,s}setupEvents(t){t?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:co,Vector2:Ae,Vector3:W,Vector4:lo,Quaternion:Jt,Matrix4:Ft,Spherical:ho,Box3:Nt,Sphere:Ti,Raycaster:In,MathUtils:uo}}}const fi=class fi extends Bt{constructor(t){super(t);y(this,"onAfterUpdate",new st);y(this,"onBeforeUpdate",new st);y(this,"onDisposed",new st);y(this,"list",new fe);y(this,"enabled",!0);t.add(fi.uuid,this)}create(){const t=new Xa(this.components),s=t.uuid;if(this.list.has(s))throw new Error("There is already a world with this name!");return this.list.set(s,t),t}delete(t){if(!this.list.has(t.uuid))throw new Error("The provided world is not found in the list!");this.list.delete(t.uuid),t.dispose()}dispose(){this.enabled=!1;for(const[t,s]of this.list)s.dispose();this.list.clear(),this.onDisposed.trigger()}update(t){if(this.enabled)for(const[s,i]of this.list)i.update(t)}};y(fi,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");let li=fi;function qa(c,e,t,s){return new Promise((i,n)=>{function r(){const o=c.clientWaitSync(e,t,0);if(o===c.WAIT_FAILED){n();return}if(o===c.TIMEOUT_EXPIRED){setTimeout(r,s);return}i()}r()})}async function Ka(c,e,t,s,i,n,r){const o=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),await qa(c,o,0,10),c.deleteSync(o),c.bindBuffer(e,t),c.getBufferSubData(e,s,i,n,r),c.bindBuffer(e,null)}async function Ja(c,e,t,s,i,n,r,o){const a=c.createBuffer();return c.bindBuffer(c.PIXEL_PACK_BUFFER,a),c.bufferData(c.PIXEL_PACK_BUFFER,o.byteLength,c.STREAM_READ),c.readPixels(e,t,s,i,n,r,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await Ka(c,c.PIXEL_PACK_BUFFER,a,0,o),c.deleteBuffer(a),o}class tc{constructor(e,t,s){y(this,"onDisposed",new st);y(this,"onViewUpdated",new Ga);y(this,"enabled",!0);y(this,"needsUpdate",!1);y(this,"renderDebugFrame",!1);y(this,"components");y(this,"world");y(this,"renderer");y(this,"autoUpdate",!0);y(this,"updateInterval",1e3);y(this,"worker");y(this,"scene",new fo);y(this,"_width",512);y(this,"_height",512);y(this,"_availableColor",1);y(this,"renderTarget");y(this,"bufferSize");y(this,"_buffer");y(this,"_isWorkerBusy",!1);y(this,"updateVisibility",async e=>{if(!this.enabled||!this.needsUpdate&&!e||this._isWorkerBusy)return;this._isWorkerBusy=!0;const t=this.world.camera.three;t.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,t);const s=this.renderer.getContext();try{await Ja(s,0,0,this._width,this._height,s.RGBA,s.UNSIGNED_BYTE,this._buffer)}catch{this.needsUpdate=!1,this._isWorkerBusy=!1,this.renderer.setRenderTarget(null);return}this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,t),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1});if(!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.applySettings(s),this.world=t,this.renderer=new po,this.renderTarget=new Eo(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=t.renderer.clippingPlanes;const i=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,n=new Blob([i],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(n))}dispose(){this.enabled=!1;for(const e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let e=BigInt(this._availableColor.toString());const t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);const[s,i,n]=t,r=`${s}-${i}-${n}`;return{r:s,g:i,b:n,code:r}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(e){e&&(e.updateInterval!==void 0&&(this.updateInterval=e.updateInterval),e.height!==void 0&&(this._height=e.height),e.width!==void 0&&(this._width=e.width),e.autoUpdate!==void 0&&(this.autoUpdate=e.autoUpdate))}}class ec extends tc{constructor(t,s,i){super(t,s,i);y(this,"onViewUpdated",new st);y(this,"threshold",100);y(this,"colorMeshes",new Map);y(this,"isProcessing",!1);y(this,"_interval",null);y(this,"_colorCodeMeshMap",new Map);y(this,"_meshIDColorCodeMap",new Map);y(this,"_currentVisibleMeshes",new Set);y(this,"_recentlyHiddenMeshes",new Set);y(this,"_intervalID",null);y(this,"_transparentMat",new $e({transparent:!0,opacity:0}));y(this,"handleWorkerMessage",async t=>{if(this.isProcessing)return;const s=t.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(const[i,n]of s){if(n<this.threshold)continue;const r=this._colorCodeMeshMap.get(i);r&&(this._currentVisibleMeshes.add(r),this._recentlyHiddenMeshes.delete(r))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1});this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._interval=window.setInterval(async()=>{this.isProcessing||await this.updateVisibility()},this.updateInterval)),this.onViewUpdated.add(({seen:n,unseen:r})=>{for(const o of n)o.visible=!0;for(const o of r)o.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._interval!==null&&(window.clearInterval(this._interval),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();const t=this.components.get(je);for(const s in this.colorMeshes){const i=this.colorMeshes.get(s);i&&t.destroy(i,!0)}this.colorMeshes.clear()}add(t){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const s=t instanceof oi,{geometry:i,material:n}=t,{colorMaterial:r,code:o}=this.getAvailableMaterial();let a;if(Array.isArray(n)){let u=!0;const d=[];for(const f of n)lr.isTransparent(f)?d.push(this._transparentMat):(u=!1,d.push(r));if(u){r.dispose(),this.isProcessing=!1;return}a=d}else if(lr.isTransparent(n)){r.dispose(),this.isProcessing=!1;return}else a=r;this._colorCodeMeshMap.set(o,t),this._meshIDColorCodeMap.set(t.uuid,o);const l=s?t.count:1,h=new oi(i,a,l);s?h.instanceMatrix=t.instanceMatrix:h.setMatrixAt(0,new Ft),t.visible=!1,t.updateWorldMatrix(!0,!1),h.applyMatrix4(t.matrixWorld),h.updateMatrix(),this.scene.add(h),this.colorMeshes.set(t.uuid,h),this.increaseColor(),this.isProcessing=!1}remove(t){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;const s=this.components.get(je);this._currentVisibleMeshes.delete(t),this._recentlyHiddenMeshes.delete(t);const i=this.colorMeshes.get(t.uuid),n=this._meshIDColorCodeMap.get(t.uuid);if(!i||!n){this.isProcessing=!1;return}this._colorCodeMeshMap.delete(n),this._meshIDColorCodeMap.delete(t.uuid),this.colorMeshes.delete(t.uuid),i.geometry=void 0,i.material=[],s.destroy(i,!0),this._recentlyHiddenMeshes.delete(t),this._currentVisibleMeshes.delete(t),this.isProcessing=!1}updateInstanced(t){for(const s of t){const i=this.colorMeshes.get(s.uuid);i&&(i.count=s.count)}}getAvailableMaterial(){const{r:t,g:s,b:i,code:n}=this.getAvailableColor(),r=wi.enabled;wi.enabled=!1;const o=new mn(`rgb(${t}, ${s}, ${i})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");const a=this.world.renderer.clippingPlanes,l=new $e({color:o,clippingPlanes:a,side:_i});return wi.enabled=r,{colorMaterial:l,code:n}}}const As=class As extends Bt{constructor(t){super(t);y(this,"onDisposed",new st);y(this,"_enabled",!0);y(this,"list",new Map);t.add(As.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const[s,i]of this.list)i.enabled=t}create(t,s){if(this.list.has(t.uuid))return this.list.get(t.uuid);const i=new ec(this.components,t,s);return this.list.set(t.uuid,i),i}delete(t){const s=this.list.get(t.uuid);s&&s.dispose(),this.list.delete(t.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(As.uuid),this.onDisposed.reset();for(const[t,s]of this.list)s.dispose();this.list.clear()}updateInstanced(t){for(const[,s]of this.list)s.updateInstanced(t)}};y(As,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");let nn=As;class sc{constructor(e){y(this,"_event");y(this,"_position",new Ae);y(this,"onDisposed",new st);y(this,"updateMouseInfo",e=>{this._event=e});this.dom=e,this.setupEvents(!0)}get position(){if(this._event){const e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((t.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(t.clientX-e.left)/(e.right-e.left)*2-1}setupEvents(e){e?this.dom.addEventListener("pointermove",this.updateMouseInfo):this.dom.removeEventListener("pointermove",this.updateMouseInfo)}}class ic{constructor(e,t){y(this,"enabled",!0);y(this,"components");y(this,"onDisposed",new st);y(this,"mouse");y(this,"three",new In);y(this,"world");const s=t.renderer;if(!s)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new sc(s.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");const t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,s=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(s)}intersect(e=Array.from(this.world.meshes)){const t=this.three.intersectObjects(e),s=this.filterClippingPlanes(t);return s.length>0?s[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");const t=this.world.renderer.three;if(!t.clippingPlanes)return e;const s=t.clippingPlanes;return e.length<=0||!s||(s==null?void 0:s.length)<=0?e:e.filter(i=>s.every(n=>n.distanceToPoint(i.point)>0))}}const pi=class pi extends Bt{constructor(t){super(t);y(this,"enabled",!0);y(this,"list",new Map);y(this,"onDisposed",new st);t.add(pi.uuid,this)}get(t){if(this.list.has(t.uuid))return this.list.get(t.uuid);const s=new ic(this.components,t);return this.list.set(t.uuid,s),t.onDisposed.add(()=>{this.delete(t)}),s}delete(t){const s=this.list.get(t.uuid);s&&s.dispose(),this.list.delete(t.uuid)}dispose(){for(const[t,s]of this.list)s.dispose();this.list.clear(),this.onDisposed.trigger()}};y(pi,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");let ws=pi;const Se=new In,Mt=new W,me=new W,Ct=new Jt,Cr={X:new W(1,0,0),Y:new W(0,1,0),Z:new W(0,0,1)},Xi={type:"change"},gr={type:"mouseDown"},Tr={type:"mouseUp",mode:null},_r={type:"objectChange"};class nc extends ai{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const s=new hc;this._gizmo=s,this.add(s);const i=new uc;this._plane=i,this.add(i);const n=this;function r(_,A){let T=A;Object.defineProperty(n,_,{get:function(){return T!==void 0?T:A},set:function(R){T!==R&&(T=R,i[_]=R,s[_]=R,n.dispatchEvent({type:_+"-changed",value:R}),n.dispatchEvent(Xi))}}),n[_]=A,i[_]=A,s[_]=A}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const o=new W,a=new W,l=new Jt,h=new Jt,u=new W,d=new Jt,f=new W,I=new W,p=new W,m=0,E=new W;r("worldPosition",o),r("worldPositionStart",a),r("worldQuaternion",l),r("worldQuaternionStart",h),r("cameraPosition",u),r("cameraQuaternion",d),r("pointStart",f),r("pointEnd",I),r("rotationAxis",p),r("rotationAngle",m),r("eye",E),this._offset=new W,this._startNorm=new W,this._endNorm=new W,this._cameraScale=new W,this._parentPosition=new W,this._parentQuaternion=new Jt,this._parentQuaternionInv=new Jt,this._parentScale=new W,this._worldScaleStart=new W,this._worldQuaternionInv=new Jt,this._worldScale=new W,this._positionStart=new W,this._quaternionStart=new Jt,this._scaleStart=new W,this._getPointer=rc.bind(this),this._onPointerDown=ac.bind(this),this._onPointerHover=oc.bind(this),this._onPointerMove=cc.bind(this),this._onPointerUp=lc.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Se.setFromCamera(e,this.camera);const t=Zi(this._gizmo.picker[this.mode],Se);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){Se.setFromCamera(e,this.camera);const t=Zi(this._plane,Se,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,gr.mode=this.mode,this.dispatchEvent(gr)}}pointerMove(e){const t=this.axis,s=this.mode,i=this.object;let n=this.space;if(s==="scale"?n="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(n="world"),i===void 0||t===null||this.dragging===!1||e.button!==-1)return;Se.setFromCamera(e,this.camera);const r=Zi(this._plane,Se,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),n==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),n==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(n==="local"&&(i.position.applyQuaternion(Ct.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),n==="world"&&(i.parent&&i.position.add(Mt.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(Mt.setFromMatrixPosition(i.parent.matrixWorld))));else if(s==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),me.set(o,o,o)}else Mt.copy(this.pointStart),me.copy(this.pointEnd),Mt.applyQuaternion(this._worldQuaternionInv),me.applyQuaternion(this._worldQuaternionInv),me.divide(Mt),t.search("X")===-1&&(me.x=1),t.search("Y")===-1&&(me.y=1),t.search("Z")===-1&&(me.z=1);i.scale.copy(this._scaleStart).multiply(me),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Mt.setFromMatrixPosition(this.camera.matrixWorld));let a=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Mt.copy(this.rotationAxis).cross(this.eye))*o):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(Cr[t]),Mt.copy(Cr[t]),n==="local"&&Mt.applyQuaternion(this.worldQuaternion),Mt.cross(this.eye),Mt.length()===0?a=!0:this.rotationAngle=this._offset.dot(Mt.normalize())*o),(t==="E"||a)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),n==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Ct.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Ct.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Xi),this.dispatchEvent(_r)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(Tr.mode=this.mode,this.dispatchEvent(Tr)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Xi),this.dispatchEvent(_r),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Se}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function rc(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const e=this.domElement.getBoundingClientRect();return{x:(c.clientX-e.left)/e.width*2-1,y:-(c.clientY-e.top)/e.height*2+1,button:c.button}}}function oc(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c));break}}function ac(c){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function cc(c){this.enabled&&this.pointerMove(this._getPointer(c))}function lc(c){this.enabled&&(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function Zi(c,e,t){const s=e.intersectObject(c,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||t)return s[i];return!1}const ti=new Io,pt=new W(0,1,0),Ar=new W(0,0,0),Rr=new Ft,ei=new Jt,ri=new Jt,oe=new W,yr=new Ft,Cs=new W(1,0,0),we=new W(0,1,0),gs=new W(0,0,1),si=new W,fs=new W,ps=new W;class hc extends ai{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new $e({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Mr({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const i=t.clone();i.opacity=.5;const n=e.clone();n.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const o=e.clone();o.color.setHex(255);const a=e.clone();a.color.setHex(16711680),a.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const u=e.clone();u.opacity=.25;const d=e.clone();d.color.setHex(16776960),d.opacity=.25,e.clone().color.setHex(16776960);const I=e.clone();I.color.setHex(7895160);const p=new xt(0,.04,.1,12);p.translate(0,.05,0);const m=new Lt(.08,.08,.08);m.translate(0,.04,0);const E=new Ss;E.setAttribute("position",new Vn([0,0,0,1,0,0],3));const _=new xt(.0075,.0075,.5,3);_.translate(0,.25,0);function A(v,$){const Y=new es(v,.0075,3,64,$*Math.PI*2);return Y.rotateY(Math.PI/2),Y.rotateX(Math.PI/2),Y}function T(){const v=new Ss;return v.setAttribute("position",new Vn([0,0,0,1,1,1],3)),v}const R={X:[[new et(p,n),[.5,0,0],[0,0,-Math.PI/2]],[new et(p,n),[-.5,0,0],[0,0,Math.PI/2]],[new et(_,n),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new et(p,r),[0,.5,0]],[new et(p,r),[0,-.5,0],[Math.PI,0,0]],[new et(_,r)]],Z:[[new et(p,o),[0,0,.5],[Math.PI/2,0,0]],[new et(p,o),[0,0,-.5],[-Math.PI/2,0,0]],[new et(_,o),null,[Math.PI/2,0,0]]],XYZ:[[new et(new Ms(.1,0),u.clone()),[0,0,0]]],XY:[[new et(new Lt(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new et(new Lt(.15,.15,.01),a.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new et(new Lt(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},F={X:[[new et(new xt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new et(new xt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new et(new xt(.2,0,.6,4),s),[0,.3,0]],[new et(new xt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new et(new xt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new et(new xt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new et(new Ms(.2,0),s)]],XY:[[new et(new Lt(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new et(new Lt(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new et(new Lt(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},w={START:[[new et(new Ms(.01,2),i),null,null,null,"helper"]],END:[[new et(new Ms(.01,2),i),null,null,null,"helper"]],DELTA:[[new Ee(T(),i),null,null,null,"helper"]],X:[[new Ee(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ee(E,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ee(E,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},L={XYZE:[[new et(A(.5,1),I),null,[0,Math.PI/2,0]]],X:[[new et(A(.5,.5),n)]],Y:[[new et(A(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new et(A(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new et(A(.75,1),d),null,[0,Math.PI/2,0]]]},N={AXIS:[[new Ee(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},M={XYZE:[[new et(new mo(.25,10,8),s)]],X:[[new et(new es(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new et(new es(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new et(new es(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new et(new es(.75,.1,2,24),s)]]},z={X:[[new et(m,n),[.5,0,0],[0,0,-Math.PI/2]],[new et(_,n),[0,0,0],[0,0,-Math.PI/2]],[new et(m,n),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new et(m,r),[0,.5,0]],[new et(_,r)],[new et(m,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new et(m,o),[0,0,.5],[Math.PI/2,0,0]],[new et(_,o),[0,0,0],[Math.PI/2,0,0]],[new et(m,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new et(new Lt(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new et(new Lt(.15,.15,.01),a),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new et(new Lt(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new et(new Lt(.1,.1,.1),u.clone())]]},O={X:[[new et(new xt(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new et(new xt(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new et(new xt(.2,0,.6,4),s),[0,.3,0]],[new et(new xt(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new et(new xt(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new et(new xt(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new et(new Lt(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new et(new Lt(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new et(new Lt(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new et(new Lt(.2,.2,.2),s),[0,0,0]]]},P={X:[[new Ee(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Ee(E,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Ee(E,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function C(v){const $=new ai;for(const Y in v)for(let K=v[Y].length;K--;){const G=v[Y][K][0].clone(),it=v[Y][K][1],B=v[Y][K][2],U=v[Y][K][3],nt=v[Y][K][4];G.name=Y,G.tag=nt,it&&G.position.set(it[0],it[1],it[2]),B&&G.rotation.set(B[0],B[1],B[2]),U&&G.scale.set(U[0],U[1],U[2]),G.updateMatrix();const J=G.geometry.clone();J.applyMatrix4(G.matrix),G.geometry=J,G.renderOrder=1/0,G.position.set(0,0,0),G.rotation.set(0,0,0),G.scale.set(1,1,1),$.add(G)}return $}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(R)),this.add(this.gizmo.rotate=C(L)),this.add(this.gizmo.scale=C(z)),this.add(this.picker.translate=C(F)),this.add(this.picker.rotate=C(M)),this.add(this.picker.scale=C(O)),this.add(this.helper.translate=C(w)),this.add(this.helper.rotate=C(N)),this.add(this.helper.scale=C(P)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const s=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ri;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let n=0;n<i.length;n++){const r=i[n];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(Ct.setFromEuler(ti.set(0,0,0)),r.quaternion.copy(s).multiply(Ct),Math.abs(pt.copy(Cs).applyQuaternion(s).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(Ct.setFromEuler(ti.set(0,0,Math.PI/2)),r.quaternion.copy(s).multiply(Ct),Math.abs(pt.copy(we).applyQuaternion(s).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(Ct.setFromEuler(ti.set(0,Math.PI/2,0)),r.quaternion.copy(s).multiply(Ct),Math.abs(pt.copy(gs).applyQuaternion(s).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(Ct.setFromEuler(ti.set(0,Math.PI/2,0)),pt.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(Rr.lookAt(Ar,pt,we)),r.quaternion.multiply(Ct),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),Mt.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Mt.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(Mt),r.visible=this.dragging):(r.quaternion.copy(s),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(s),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(pt.copy(Cs).applyQuaternion(s).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(pt.copy(we).applyQuaternion(s).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(pt.copy(gs).applyQuaternion(s).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(pt.copy(gs).applyQuaternion(s).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(pt.copy(Cs).applyQuaternion(s).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(pt.copy(we).applyQuaternion(s).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(ei.copy(s),pt.copy(this.eye).applyQuaternion(Ct.copy(s).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(Rr.lookAt(this.eye,Ar,we)),r.name==="X"&&(Ct.setFromAxisAngle(Cs,Math.atan2(-pt.y,pt.z)),Ct.multiplyQuaternions(ei,Ct),r.quaternion.copy(Ct)),r.name==="Y"&&(Ct.setFromAxisAngle(we,Math.atan2(pt.x,pt.z)),Ct.multiplyQuaternions(ei,Ct),r.quaternion.copy(Ct)),r.name==="Z"&&(Ct.setFromAxisAngle(gs,Math.atan2(pt.y,pt.x)),Ct.multiplyQuaternions(ei,Ct),r.quaternion.copy(Ct))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(e)}}class uc extends et{constructor(){super(new vr(1e5,1e5,2,2),new $e({visible:!1,wireframe:!0,side:_i,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),si.copy(Cs).applyQuaternion(t==="local"?this.worldQuaternion:ri),fs.copy(we).applyQuaternion(t==="local"?this.worldQuaternion:ri),ps.copy(gs).applyQuaternion(t==="local"?this.worldQuaternion:ri),pt.copy(fs),this.mode){case"translate":case"scale":switch(this.axis){case"X":pt.copy(this.eye).cross(si),oe.copy(si).cross(pt);break;case"Y":pt.copy(this.eye).cross(fs),oe.copy(fs).cross(pt);break;case"Z":pt.copy(this.eye).cross(ps),oe.copy(ps).cross(pt);break;case"XY":oe.copy(ps);break;case"YZ":oe.copy(si);break;case"XZ":pt.copy(ps),oe.copy(fs);break;case"XYZ":case"E":oe.set(0,0,0);break}break;case"rotate":default:oe.set(0,0,0)}oe.length()===0?this.quaternion.copy(this.cameraQuaternion):(yr.lookAt(Mt.set(0,0,0),oe,pt),this.quaternion.setFromRotationMatrix(yr)),super.updateMatrixWorld(e)}}class xn{constructor(e,t,s,i,n,r=5,o=!0){y(this,"onDraggingStarted",new st);y(this,"onDraggingEnded",new st);y(this,"onDisposed",new st);y(this,"normal");y(this,"origin");y(this,"three",new pn);y(this,"components");y(this,"world");y(this,"type","default");y(this,"_helper");y(this,"_visible",!0);y(this,"_enabled",!0);y(this,"_controlsActive",!1);y(this,"_arrowBoundBox",new et);y(this,"_planeMesh");y(this,"_controls");y(this,"_hiddenMaterial",new $e({visible:!1}));y(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)});y(this,"changeDrag",e=>{this._visible=!e.value,this.preventCameraMovement(),this.notifyDraggingChanged(e)});if(this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=i,this.origin=s,t.renderer.setPlane(!0,this.three),this._planeMesh=xn.newPlaneMesh(r,n),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(i,s),o&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){const e=new W(1,0,0),t=new W;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");const e=this.world.camera.three,t=this.world.renderer.three.domElement,s=new nc(e,t);return this.initializeControls(s),this.world.scene.three.add(s),s}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new xt(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){const e=new ai;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){const s=new vr(1),i=new et(s,t);return i.scale.set(e,e,e),i}}const Rs=class Rs extends Bt{constructor(t){super(t);y(this,"onBeforeDrag",new st);y(this,"onAfterDrag",new st);y(this,"onBeforeCreate",new st);y(this,"onBeforeCancel",new st);y(this,"onAfterCancel",new st);y(this,"onBeforeDelete",new st);y(this,"onAfterCreate",new st);y(this,"onAfterDelete",new st);y(this,"onDisposed",new st);y(this,"orthogonalY",!1);y(this,"toleranceOrthogonalY",.7);y(this,"Type",xn);y(this,"list",[]);y(this,"_material",new $e({color:12255487,side:_i,transparent:!0,opacity:.2}));y(this,"_size",5);y(this,"_enabled",!1);y(this,"_visible",!0);y(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()});y(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()});this.components.add(Rs.uuid,this)}get enabled(){return this._enabled}set enabled(t){this._enabled=t;for(const s of this.list)s.enabled=t;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(t){this._visible=t;for(const s of this.list)s.visible=t}get material(){return this._material}set material(t){this._material=t;for(const s of this.list)s.planeMaterial=t}get size(){return this._size}set size(t){this._size=t;for(const s of this.list)s.size=t}dispose(){this._enabled=!1;for(const t of this.list)t.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(Rs.uuid),this.onDisposed.reset()}create(t){const n=this.components.get(ws).get(t).castRay();return n?this.createPlaneFromIntersection(t,n):null}createFromNormalAndCoplanarPoint(t,s,i){const n=this.newPlane(t,i,s);return this.updateMaterialsAndPlanes(),n}delete(t,s){s||(s=this.pickPlane(t)),s&&this.deletePlane(s)}deleteAll(t){const s=[...this.list];for(const i of s)if(!t||t.has(i.type)){this.delete(i.world,i);const n=this.list.indexOf(i);n!==-1&&this.list.splice(n,1)}}deletePlane(t){const s=this.list.indexOf(t);if(s!==-1){if(this.list.splice(s,1),!t.world.renderer)throw new Error("Renderer not found for this plane's world!");t.world.renderer.setPlane(!1,t.three),t.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(t)}}pickPlane(t){const i=this.components.get(ws).get(t),n=this.getAllPlaneMeshes(),r=i.castRay(n);if(r){const o=r.object;return this.list.find(a=>a.meshes.includes(o))}}getAllPlaneMeshes(){const t=[];for(const s of this.list)t.push(...s.meshes);return t}createPlaneFromIntersection(t,s){var a;if(!t.renderer)throw new Error("The given world must have a renderer!");const i=s.point.distanceTo(new W(0,0,0)),n=(a=s.face)==null?void 0:a.normal;if(!i||!n)return null;const r=this.getWorldNormal(s,n),o=this.newPlane(t,s.point,r.negate());return o.visible=this._visible,o.size=this._size,t.renderer.setPlane(!0,o.three),this.updateMaterialsAndPlanes(),o}getWorldNormal(t,s){const i=t.object;let n=t.object.matrixWorld.clone();if(i instanceof oi&&t.instanceId!==void 0){const l=new Ft;i.getMatrixAt(t.instanceId,l),n=l.multiply(n)}const o=new Co().getNormalMatrix(n),a=s.clone().applyMatrix3(o).normalize();return this.normalizePlaneDirectionY(a),a}normalizePlaneDirectionY(t){this.orthogonalY&&(t.y>this.toleranceOrthogonalY&&(t.x=0,t.y=1,t.z=0),t.y<-this.toleranceOrthogonalY&&(t.x=0,t.y=-1,t.z=0))}newPlane(t,s,i){const n=new this.Type(this.components,t,s,i,this._material);return n.onDraggingStarted.add(this._onStartDragging),n.onDraggingEnded.add(this._onEndDragging),this.list.push(n),this.onAfterCreate.trigger(n),n}updateMaterialsAndPlanes(){const t=this.components.get(li);for(const[s,i]of t.list){if(!i.renderer)continue;i.renderer.updateClippingPlanes();const{clippingPlanes:n}=i.renderer;for(const r of i.meshes)if(r.material)if(Array.isArray(r.material))for(const o of r.material)o.clippingPlanes=n;else r.material.clippingPlanes=n}}};y(Rs,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");let rn=Rs;class dc{constructor(e){y(this,"enabled",!1);y(this,"id","FirstPerson");this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){const e=this.camera.controls,t=new W;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=vt.ACTION.DOLLY,e.touches.two=vt.ACTION.TOUCH_ZOOM_TRUCK}}class fc{constructor(e){y(this,"enabled",!0);y(this,"id","Orbit");this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){const e=this.camera.controls;e.minDistance=1,e.maxDistance=300;const t=new W;e.getPosition(t);const s=t.length();e.distance=s,e.truckSpeed=2;const{rotation:i}=this.camera.three,n=new W(0,0,-1).applyEuler(i),r=t.addScaledVector(n,s);e.moveTo(r.x,r.y,r.z)}}class pc{constructor(e){y(this,"enabled",!1);y(this,"id","Plan");y(this,"mouseAction1");y(this,"mouseAction2");y(this,"mouseInitialized",!1);y(this,"defaultAzimuthSpeed");y(this,"defaultPolarSpeed");this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;const t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=vt.ACTION.TRUCK,t.touches.one=vt.ACTION.TOUCH_TRUCK,t.touches.two=vt.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=vt.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}}class Ec{constructor(e){y(this,"onChanged",new st);y(this,"current","Perspective");y(this,"camera");y(this,"matchOrthoDistanceEnabled",!1);y(this,"_component");y(this,"_previousDistance",-1);this._component=e,this.camera=e.three}async set(e){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():await this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))}async toggle(){const t=this.current==="Perspective"?"Orthographic":"Perspective";await this.set(t)}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;const e=this.getPerspectiveDims();if(!e)return;const{width:t,height:s}=e;this.setupOrthoCamera(s,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){const e=this._component.currentWorld;if(!e||!e.renderer)return null;const t=new W;this._component.threePersp.getWorldDirection(t);const s=new W;this._component.controls.getTarget(s);const n=s.clone().sub(this._component.threePersp.position).dot(t),r=e.renderer.getSize(),o=r.x/r.y,a=this._component.threePersp,l=n*2*Math.atan(a.fov*(Math.PI/180)/2);return{width:l*o,height:l}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=vt.ACTION.ZOOM,this._component.controls.mouseButtons.middle=vt.ACTION.ZOOM;const s=this._component.threePersp,i=this._component.threeOrtho;i.zoom=1,i.left=t/-2,i.right=t/2,i.top=e/2,i.bottom=e/-2,i.updateProjectionMatrix(),i.position.copy(s.position),i.quaternion.copy(s.quaternion),this._component.controls.camera=i}getDistance(){const e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}async setPerspectiveCamera(){this._component.controls.mouseButtons.wheel=vt.ACTION.DOLLY,this._component.controls.mouseButtons.middle=vt.ACTION.DOLLY;const e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=vt.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,await this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"}}class Ic extends vn{constructor(t){super(t);y(this,"projection");y(this,"threeOrtho");y(this,"threePersp");y(this,"_userInputButtons",{});y(this,"_frustumSize",50);y(this,"_navigationModes",new Map);y(this,"_mode",null);y(this,"previousSize",null);this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new Ec(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(s=>{this.three=s,this.updateAspect()}),this.onWorldChanged.add(({action:s})=>{s==="added"&&(this._navigationModes.clear(),this._navigationModes.set("Orbit",new fc(this)),this._navigationModes.set("FirstPerson",new dc(this)),this._navigationModes.set("Plan",new pc(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone()))})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(t){if(this.mode!==null&&this.mode.id!==t){if(this.mode.set(!1),!this._navigationModes.has(t))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(t),this.mode.set(!0)}}async fit(t,s=1.5){if(!this.enabled)return;const i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=new W(i,i,i),o=new W(n,n,n);for(const f of t){const I=new Nt().setFromObject(f);I.min.x<r.x&&(r.x=I.min.x),I.min.y<r.y&&(r.y=I.min.y),I.min.z<r.z&&(r.z=I.min.z),I.max.x>o.x&&(o.x=I.max.x),I.max.y>o.y&&(o.y=I.max.y),I.max.z>o.z&&(o.z=I.max.z)}const a=new Nt(r,o),l=new W;a.getSize(l);const h=new W;a.getCenter(h);const u=Math.max(l.x,l.y,l.z)*s,d=new Ti(h,u);await this.controls.fitToSphere(d,!0)}setUserInput(t){t?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){const t=window.innerWidth/window.innerHeight;return new En(this._frustumSize*t/-2,this._frustumSize*t/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;const t=this.currentWorld.renderer.getSize(),s=this.threeOrtho.top,i=this.threeOrtho.right,n=t.y/this.previousSize.y,r=t.x/this.previousSize.x,o=s*n,a=i*r;this.threeOrtho.left=-a,this.threeOrtho.right=a,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(t)}}const Or=new Map([[Ai,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[Cn,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[gn,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[Tn,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[Ns,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[_n,{forRelated:"IsTypedBy",forRelating:"Types"}],[An,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[Ri,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[Rn,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[yn,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[On,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[Fn,{forRelated:"HasContext",forRelating:"Declares"}],[Sn,{forRelated:"HasAssignments",forRelating:"Controls"}],[wn,{forRelated:"Nests",forRelating:"IsNestedBy"}],[Nn,{forRelated:"HasAssociations",forRelating:"DocumentRefForObjects"}]]),Wr={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"};class Ze{static async getUnits(e){var r,o,a;const{IFCUNITASSIGNMENT:t}=jt,s=await e.getAllPropertiesOfType(t);if(!s)return 1;const i=Object.keys(s),n=s[parseInt(i[0],10)];for(const l of n.Units){if(l.value===void 0||l.value===null)continue;const h=await e.getProperties(l.value);if(!h||!h.UnitType||!h.UnitType.value||h.UnitType.value!=="LENGTHUNIT")continue;let d=1,f=1;return h.Name.value==="METRE"&&(f=1),h.Name.value==="FOOT"&&(f=.3048),((r=h.Prefix)==null?void 0:r.value)==="MILLI"?d=.001:((o=h.Prefix)==null?void 0:o.value)==="CENTI"?d=.01:((a=h.Prefix)==null?void 0:a.value)==="DECI"&&(d=.1),f*d}return 1}static async findItemByGuid(e,t){var i;const s=e.getAllPropertiesIDs();for(const n of s){const r=await e.getProperties(n);if(r&&((i=r.GlobalId)==null?void 0:i.value)===t)return r}return null}static async getRelationMap(e,t,s){var a;const n=s??(async()=>{}),r={},o=e.getAllPropertiesIDs();for(const l of o){const h=await e.getProperties(l);if(!h)continue;const u=h.type===t,d=Object.keys(h).find(E=>E.startsWith("Relating")),f=Object.keys(h).find(E=>E.startsWith("Related"));if(!(u&&d&&f))continue;const I=await e.getProperties((a=h[d])==null?void 0:a.value),p=h[f];if(!I||!p||!(p&&Array.isArray(p)))continue;const m=p.map(E=>E.value);await n(I.expressID,m),r[I.expressID]=m}return r}static async getQsetQuantities(e,t,s){const n=s??(()=>{}),r=await e.getProperties(t);return!r||r.type!==go?null:(r.Quantities??[{}]).map(l=>(l.value&&n(l.value),l.value)).filter(l=>l!==null)}static async getPsetProps(e,t,s){const n=s??(()=>{}),r=await e.getProperties(t);return!r||r.type!==$i?null:(r.HasProperties??[{}]).map(l=>(l.value&&n(l.value),l.value)).filter(l=>l!==null)}static async getPsetRel(e,t){var o;if(!await e.getProperties(t))return null;const i=await e.getAllPropertiesOfType(Ns);if(!i)return null;const n=Object.values(i);let r=null;for(const a of n)((o=a.RelatingPropertyDefinition)==null?void 0:o.value)===t&&(r=a.expressID);return r}static async getQsetRel(e,t){return Ze.getPsetRel(e,t)}static async getEntityName(e,t){var r;const s=await e.getProperties(t);if(!s)return{key:null,name:null};const i=Object.keys(s).find(o=>o.endsWith("Name"))??null,n=i?(r=s[i])==null?void 0:r.value:null;return{key:i,name:n}}static async getQuantityValue(e,t){const s=await e.getProperties(t);if(!s)return{key:null,value:null};const i=Object.keys(s).find(r=>r.endsWith("Value"))??null;let n;return i===null||s[i]===void 0||s[i]===null?n=null:n=s[i].value,{key:i,value:n}}static isRel(e){return Wr[e].startsWith("IFCREL")}static async attributeExists(e,t,s){const i=await e.getProperties(t);return i?Object.keys(i).includes(s):!1}static async groupEntitiesByType(e,t){var i;const s=new Map;for(const n of t){const r=await e.getProperties(n);if(!r)continue;const o=r.type;s.get(o)||s.set(o,new Set),(i=s.get(o))==null||i.add(n)}return s}}class mc{constructor(){y(this,"factor",1);y(this,"complement",1)}apply(e){const s=this.getScaleMatrix().multiply(e);e.copy(s)}setUp(e){var n,r,o;this.factor=1;const t=this.getLengthUnits(e);if(!t)return;const s=t==null,i=t.Name===void 0||t.Name===null;s||i||(t.Name.value==="FOOT"&&(this.factor=.3048),((n=t.Prefix)==null?void 0:n.value)==="MILLI"?this.complement=.001:((r=t.Prefix)==null?void 0:r.value)==="CENTI"?this.complement=.01:((o=t.Prefix)==null?void 0:o.value)==="DECI"&&(this.complement=.01))}getLengthUnits(e){try{const s=e.GetLineIDsWithType(0,To).get(0),i=e.GetLine(0,s);for(const n of i.Units){if(!n||n.value===null||n.value===void 0)continue;const r=e.GetLine(0,n.value);if(r.UnitType&&r.UnitType.value==="LENGTHUNIT")return r}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){const e=this.factor;return new Ft().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}}class Cc{constructor(){y(this,"itemsByFloor",{});y(this,"_units",new mc)}setUp(e){this._units.setUp(e),this.cleanUp();try{const t=e.GetLineIDsWithType(0,Ri),s=new Set,i=e.GetLineIDsWithType(0,bs);for(let l=0;l<i.size();l++)s.add(i.get(l));const n=e.GetLineIDsWithType(0,Ai),r=n.size();for(let l=0;l<r;l++){const h=n.get(l),u=e.GetLine(0,h);if(!u||!u.RelatingObject||!u.RelatedObjects)continue;const d=u.RelatingObject.value,f=u.RelatedObjects;for(const I of f){const p=I.value;s.has(p)&&(this.itemsByFloor[p]=d)}}const o={},a=t.size();for(let l=0;l<a;l++){const h=t.get(l),u=e.GetLine(0,h);if(!u||!u.RelatingStructure||!u.RelatedElements)continue;const d=u.RelatingStructure.value,f=u.RelatedElements;if(s.has(d))for(const I of f){o[d]||(o[d]=[]);const p=I.value;o[d].push(p)}else for(const I of f){const p=I.value;this.itemsByFloor[p]=d}}for(const l in o){const h=this.itemsByFloor[l];if(h!==void 0){const u=o[l];for(const d of u)this.itemsByFloor[d]=h}}for(let l=0;l<r;l++){const h=n.get(l),u=e.GetLine(0,h);if(!u||!u.RelatingObject||!u.RelatedObjects)continue;const d=u.RelatingObject.value,f=u.RelatedObjects;for(const I of f){const p=I.value,m=this.itemsByFloor[d];m!==void 0&&(this.itemsByFloor[p]=m)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}}class gc{constructor(){y(this,"includeProperties",!0);y(this,"optionalCategories",[bs]);y(this,"coordinate",!0);y(this,"wasm",{path:"",absolute:!1,logLevel:_o.LOG_LEVEL_OFF});y(this,"excludedCategories",new Set);y(this,"includedCategories",new Set);y(this,"saveLocations",!1);y(this,"webIfc",{COORDINATE_TO_ORIGIN:!0});y(this,"autoSetWasm",!0);y(this,"customLocateFileHandler",null)}}class Tc{constructor(){y(this,"defLineMat",new Mr({color:16777215}))}read(e){const t=e.GetAllAlignments(0),s=e.GetAllCrossSections2D(0),i=e.GetAllCrossSections3D(0),n={IfcAlignment:t,IfcCrossSection2D:s,IfcCrossSection3D:i};return this.get(n)}get(e){if(e.IfcAlignment){const t=new Map;for(const s of e.IfcAlignment){const i=new Ao;i.absolute=this.getCurves(s.curve3D,i),i.horizontal=this.getCurves(s.horizontal,i),i.vertical=this.getCurves(s.vertical,i),t.set(t.size,i)}return{alignments:t,coordinationMatrix:new Ft}}}getCurves(e,t){const s=[];let i=0;for(const n of e){const r={};if(n.data)for(const d of n.data){const[f,I]=d.split(": "),p=parseFloat(I);r[f]=p||I}const{points:o}=n,a=new Float32Array(o.length*3);for(let d=0;d<o.length;d++){const{x:f,y:I,z:p}=o[d];a[d*3]=f,a[d*3+1]=I,a[d*3+2]=p||0}const l=new Fs(a,3),h=new Ro;h.setAttribute("position",l);const u=new yo(i,r,t,h,this.defLineMat);s.push(u.curve),i++}return s}}class _c{getNameInfo(e){var u;const t={},{arguments:s}=e.GetHeaderLine(0,Oo)||{};if(!s)return t;const[i,n,r,o,a,l,h]=s;if(i!=null&&i.value&&(t.name=i.value),n!=null&&n.value&&(t.creationDate=new Date(n.value)),r){t.author={};const[d,f]=r;d!=null&&d.value&&(t.author.name=d.value),f!=null&&f.value&&(t.author.email=f.value)}return(u=o[0])!=null&&u.value&&(t.organization=o[0].value),a!=null&&a.value&&(t.preprocessorVersion=a==null?void 0:a.value),l!=null&&l.value&&(t.originatingSystem=l==null?void 0:l.value),h!=null&&h.value&&(t.authorization=h==null?void 0:h.value),t}getDescriptionInfo(e){var r;const t={},{arguments:s}=e.GetHeaderLine(0,Fo)||{};if(!s)return t;const[i,n]=s;if((r=i[0])!=null&&r.value){const o=i[0].value.match(/\[([^\]]+)\]/);o&&o[1]&&(t.viewDefinition=o[1])}return n!=null&&n.value&&(t.implementationLevel=n.value),t}}class Ac{static get(e,t){const s=[xr,Dr,Ur,Br,bs,So,wo,No,bo],i=e.data;for(const n of s){const r=t.GetLineIDsWithType(0,n),o=r.size();for(let a=0;a<o;a++){const l=r.get(a);i.has(l)||i.set(l,[[],[0,n]])}}}}const Rc=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),Ei=class Ei extends Bt{constructor(t){super(t);y(this,"enabled",!0);t.add(Ei.uuid,this)}async export(t,s,i=!1,n=!0){const r={},o=new Set(t.GetIfcEntityList(s)),a=new Set([xr,Dr,Ur,Br,bs]);for(const l of a)o.add(l);for(const l of o){if(Rc.has(l))continue;const h=a.has(l)&&n,u=t.GetLineIDsWithType(s,l);for(const d of u){const f=t.GetLine(0,d,h,i);r[f.expressID]=f}}return r}};y(Ei,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");let on=Ei;const ys=class ys extends Bt{constructor(t){super(t);y(this,"onDisposed",new st);y(this,"onIfcStartedLoading",new st);y(this,"onSetup",new st);y(this,"settings",new gc);y(this,"webIfc",new Gn);y(this,"enabled",!0);y(this,"_material",new Hn);y(this,"_spatialTree",new Cc);y(this,"_metaData",new _c);y(this,"_fragmentInstances",new Map);y(this,"_civil",new Tc);y(this,"_visitedFragments",new Map);y(this,"_materialT",new Hn({transparent:!0,opacity:.5}));this.components.add(ys.uuid,this),this.settings.excludedCategories.add(Po)}dispose(){this.webIfc=null,this.onDisposed.trigger(ys.uuid),this.onDisposed.reset()}async setup(t){this.settings={...this.settings,...t},this.settings.autoSetWasm&&await this.autoSetWasm(),this.onSetup.trigger()}async load(t,s=!0,i=""){const n=performance.now();this.onIfcStartedLoading.trigger(),await this.readIfcFile(t);const r=await this.getAllGeometries();r.name=i;const a=await this.components.get(on).export(this.webIfc,0);r.setLocalProperties(a);const l=this.components.get(gt);l.groups.set(r.uuid,r);for(const h of r.items)l.list.set(h.id,h),h.mesh.uuid=h.id,h.group=r;l.onFragmentsLoaded.trigger(r),s&&l.coordinate([r]);for(const[h]of r.data){const u=a[h];if(!u||!u.GlobalId)continue;const d=u.GlobalId.value||u.GlobalId;r.globalToExpressIDs.set(d,h)}return Ac.get(r,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-n} ms!`),r}async readIfcFile(t){const{path:s,absolute:i,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(s,i),await this.webIfc.Init(this.settings.customLocateFileHandler||void 0),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(t,this.settings.webIfc)}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new Gn,this._visitedFragments.clear(),this._fragmentInstances.clear()}async getAllGeometries(){this._spatialTree.setUp(this.webIfc);const t=this.webIfc.GetIfcEntityList(0),s=new Lo;s.ifcMetadata={name:"",description:"",...this._metaData.getNameInfo(this.webIfc),...this._metaData.getDescriptionInfo(this.webIfc),schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)};const i=[];for(const r of t){if(!this.webIfc.IsIfcElement(r)&&r!==bs)continue;const o=this.settings.includedCategories;if(o.size>0&&!o.has(r))continue;if(this.settings.excludedCategories.has(r))continue;const a=this.webIfc.GetLineIDsWithType(0,r),l=a.size();for(let h=0;h<l;h++){const u=a.get(h);i.push(u);const d=this._spatialTree.itemsByFloor[u]||0;s.data.set(u,[[],[d,r]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,i,r=>{this.getMesh(r,s)});for(const r of this._visitedFragments){const{index:o,fragment:a}=r[1];s.keyFragments.set(o,a.id)}for(const r of s.items){const o=this._fragmentInstances.get(r.id);if(!o)throw new Error("Fragment not found!");const a=[];for(const[l,h]of o)a.push(h);r.add(a)}const n=this.webIfc.GetCoordinationMatrix(0);return s.coordinationMatrix.fromArray(n),s.civilData=this._civil.read(this.webIfc),s}getMesh(t,s){const i=t.geometries.size(),n=t.expressID;for(let r=0;r<i;r++){const o=t.geometries.get(r),{x:a,y:l,z:h,w:u}=o.color,d=u!==1,{geometryExpressID:f}=o,I=`${f}-${d}`;if(!this._visitedFragments.has(I)){const R=this.getGeometry(this.webIfc,f),F=d?this._materialT:this._material,w=new Mo(R,F,1);s.add(w.mesh),s.items.push(w);const L=this._visitedFragments.size;this._visitedFragments.set(I,{index:L,fragment:w})}const p=new mn().setRGB(a,l,h,"srgb"),m=new Ft;m.fromArray(o.flatTransformation);const E=this._visitedFragments.get(I);if(E===void 0)throw new Error("Error getting geometry data for streaming!");const _=s.data.get(n);if(!_)throw new Error("Data not found!");_[0].push(E.index);const{fragment:A}=E;this._fragmentInstances.has(A.id)||this._fragmentInstances.set(A.id,new Map);const T=this._fragmentInstances.get(A.id);if(!T)throw new Error("Instances not found!");if(T.has(n)){const R=T.get(n);if(!R)throw new Error("Instance not found!");R.transforms.push(m),R.colors&&R.colors.push(p)}else T.set(n,{id:n,transforms:[m],colors:[p]})}}getGeometry(t,s){const i=t.GetGeometry(0,s),n=t.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),r=t.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize()),o=new Float32Array(r.length/2),a=new Float32Array(r.length/2);for(let d=0;d<r.length;d+=6)o[d/2]=r[d],o[d/2+1]=r[d+1],o[d/2+2]=r[d+2],a[d/2]=r[d+3],a[d/2+1]=r[d+4],a[d/2+2]=r[d+5];const l=new Ss,h=new Fs(o,3),u=new Fs(a,3);return l.setAttribute("position",h),l.setAttribute("normal",u),l.setIndex(Array.from(n)),i.delete(),l}async autoSetWasm(){const t=await fetch(`https://unpkg.com/@thatopen/components@${sn.release}/package.json`);if(!t.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}const s=await t.json();if(!("web-ifc"in s.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{const i=s.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}}};y(ys,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");let an=ys;const yc={IfcRelAssignsToControl:{related:5,relating:7},IfcRelAssignsToGroup:{related:5,relating:7},IfcRelAssignsToProduct:{related:5,relating:7},IfcRelAssociatesClassification:{related:5,relating:6},IfcRelAssociatesMaterial:{related:5,relating:6},IfcRelAssociatesDocument:{related:5,relating:6},IfcRelContainedInSpatialStructure:{related:5,relating:6},IfcRelFlowControlElements:{related:5,relating:6},IfcRelConnectsElements:{related:7,relating:6},IfcRelDeclares:{related:6,relating:5},IfcRelAggregates:{related:6,relating:5},IfcRelNests:{related:6,relating:5},IfcRelDefinesByProperties:{related:5,relating:6},IfcRelDefinesByType:{related:5,relating:6},IfcRelDefinesByTemplate:{related:5,relating:6}},Oc={[Sn]:"IfcRelAssignsToControl",[Tn]:"IfcRelAssignsToGroup",[On]:"IfcRelAssignsToProduct",[gn]:"IfcRelAssociatesClassification",[Cn]:"IfcRelAssociatesMaterial",[Nn]:"IfcRelAssociatesDocument",[Ri]:"IfcRelContainedInSpatialStructure",[yn]:"IfcRelConnectsElements",[Rn]:"IfcRelFlowControlElements",[Fn]:"IfcRelDeclares",[Ai]:"IfcRelAggregates",[wn]:"IfcRelNests",[Ns]:"IfcRelDefinesByProperties",[_n]:"IfcRelDefinesByType",[An]:"IfcRelDefinesByTemplate"},Te=class Te extends Bt{constructor(t){super(t);y(this,"onDisposed",new st);y(this,"onRequestFile",new st);y(this,"ifcToExport",null);y(this,"onElementToPset",new st);y(this,"onPropToPset",new st);y(this,"onPsetRemoved",new st);y(this,"onDataChanged",new st);y(this,"wasm",{path:"/",absolute:!1});y(this,"enabled",!0);y(this,"attributeListeners",{});y(this,"selectedModel");y(this,"changeMap",{});this.components.add(Te.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(Te.uuid),this.onDisposed.reset()}static getIFCSchema(t){const s=t.ifcMetadata.schema;if(!s)throw new Error("IFC Schema not found");return s.startsWith("IFC2X3")?"IFC2X3":s.startsWith("IFC4")&&s.replace("IFC4","")===""?"IFC4":s.startsWith("IFC4X3")?"IFC4X3":s}async setData(t,...s){for(const i of s){const{expressID:n}=i;(!n||n===-1)&&(i.expressID=this.getNewExpressID(t)),await t.setProperties(i.expressID,i),this.registerChange(t,i.expressID)}}async newPset(t,s,i){const n=Te.getIFCSchema(t),{ownerHistoryHandle:r}=await this.getOwnerHistory(t),o=this.newGUID(t),a=new jt[n].IfcLabel(s),l=i?new jt[n].IfcText(i):null,h=new jt[n].IfcPropertySet(o,r,a,l,[]);h.expressID=this.getNewExpressID(t);const u=this.newGUID(t),d=new jt[n].IfcRelDefinesByProperties(u,r,null,null,[],new he(h.expressID));return d.expressID=this.getNewExpressID(t),await this.setData(t,h,d),{pset:h,rel:d}}async removePset(t,...s){for(const i of s){const n=await t.getProperties(i);if((n==null?void 0:n.type)!==$i)continue;const r=await Ze.getPsetRel(t,i);if(r&&(await t.setProperties(r,null),this.registerChange(t,r)),n){for(const o of n.HasProperties)await t.setProperties(o.value,null);await t.setProperties(i,null),this.onPsetRemoved.trigger({model:t,psetID:i}),this.registerChange(t,i)}}}newSingleStringProperty(t,s,i,n){return this.newSingleProperty(t,s,i,n)}newSingleNumericProperty(t,s,i,n){return this.newSingleProperty(t,s,i,n)}newSingleBooleanProperty(t,s,i,n){return this.newSingleProperty(t,s,i,n)}async removePsetProp(t,s,i){const n=await t.getProperties(s),r=await t.getProperties(i);!n||!r||n.type===$i&&r&&(n.HasProperties=n.HasProperties.filter(o=>o.value!==i),await t.setProperties(i,null),this.registerChange(t,s,i))}addElementToPset(t,s,...i){this.components.get(Qe).addEntitiesRelation(t,s,{type:Ns,inv:"IsDefinedBy"},...i)}async addPropToPset(t,s,...i){const n=await t.getProperties(s);if(n){for(const r of i){if(n.HasProperties.includes(r))continue;const o=new he(r);n.HasProperties.push(o),this.onPropToPset.trigger({model:t,psetID:s,propID:r})}this.registerChange(t,s)}}async createIfcRel(t,s,i,n){const r=Oc[s];if(!r)throw new Error(`IfcPropertiesManager: ${r} is unsoported.`);const o=t.ifcMetadata.schema,a=yc[r],l=jt[o][r];if(!(a&&l))throw new Error(`IfcPropertiesManager: ${r} is unsoported.`);const h=[new jt[o].IfcGloballyUniqueId(pe.create())],{related:u,relating:d}=a,I=[...new Set(n)].map(E=>new he(E)),p=(E,_)=>{for(let A=E;A<_-1;A++)h.push(null)};u<d?(p(1,u),h.push(I),p(u,d),h.push(new he(i))):(p(1,d),p(d,u),h.push(new he(i)),h.push(I));const m=new l(...h);return await this.setData(t,m),m}async saveToIfc(t,s){const i=this.components.get(an),n=i.webIfc,r=await i.readIfcFile(s);await this.components.get(Qe).applyRelationChanges();const a=this.changeMap[t.uuid]??[];for(const h of a){const u=await t.getProperties(h);u?n.WriteLine(r,u):n.DeleteLine(r,h)}const l=n.SaveModel(r);return i.webIfc.CloseModel(r),i.cleanUp(),l}async getEntityRef(t,s){const i=await t.getAllPropertiesOfType(s);if(!i)return null;const n=[];for(const r in i){const o=new he(Number(r));n.push(o)}return n}async setAttributeListener(t,s,i){this.attributeListeners[t.uuid]||(this.attributeListeners[t.uuid]={});const n=this.attributeListeners[t.uuid][s]?this.attributeListeners[t.uuid][s][i]:null;if(n)return n;const r=await t.getProperties(s);if(!r)throw new Error(`Entity with expressID ${s} doesn't exists.`);const o=r[i];if(Array.isArray(o)||!o)throw new Error(`Attribute ${i} is array or null, and it can't have a listener.`);const a=o.value;if(a===void 0||a==null)throw new Error(`Attribute ${i} has a badly defined handle.`);const l=new st;return Object.defineProperty(r[i],"value",{get(){return this._value},async set(h){this._value=h,l.trigger(h)}}),r[i].value=a,this.attributeListeners[t.uuid][s]||(this.attributeListeners[t.uuid][s]={}),this.attributeListeners[t.uuid][s][i]=l,l}getNewExpressID(t){return t.ifcMetadata.maxExpressID++,t.ifcMetadata.maxExpressID}newGUID(t){const s=Te.getIFCSchema(t);return new jt[s].IfcGloballyUniqueId(pe.create())}async getOwnerHistory(t){const s=await t.getAllPropertiesOfType(vo);if(!s)throw new Error("No OwnerHistory was found.");const i=Object.keys(s).map(o=>parseInt(o,10)),n=s[i[0]],r=new he(n.expressID);return{ownerHistory:n,ownerHistoryHandle:r}}registerChange(t,...s){this.changeMap[t.uuid]||(this.changeMap[t.uuid]=new Set);for(const i of s)this.changeMap[t.uuid].add(i),this.onDataChanged.trigger({model:t,expressID:i})}async newSingleProperty(t,s,i,n){const r=Te.getIFCSchema(t),o=new jt[r].IfcIdentifier(i),a=new jt[r][s](n),l=new jt[r].IfcPropertySingleValue(o,null,a,null);return l.expressID=this.getNewExpressID(t),await this.setData(t,l),l}};y(Te,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");let cn=Te;const Os=class Os extends Bt{constructor(t){super(t);y(this,"onDisposed",new st);y(this,"onRelationsIndexed",new st);y(this,"relationMaps",{});y(this,"enabled",!0);y(this,"_relToAttributesMap",Or);y(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests","DocumentRefForObjects"]);y(this,"_ifcRels",[Ai,Cn,gn,Tn,Ns,_n,An,Ri,Rn,yn,On,Fn,Sn,wn,Nn]);y(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]});y(this,"_changeMap",{});y(this,"onEntitiesRelated",new st);this.components.add(Os.uuid,this),t.get(gt).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(t,s,i,n){const r=Object.keys(s).find(u=>u.startsWith("Relating")),o=Object.keys(s).find(u=>u.startsWith("Related"));if(!(r&&o))return;const a=s[r].value,l=s[o].map(u=>u.value),h=this.getAttributeIndex(n);if(h!==null){let u=t.get(a);u||(u=new Map,t.set(a,u));let d=u.get(h);d||(d=[],u.set(h,d)),d.push(...l)}for(const u of l){const d=this.getAttributeIndex(i);if(d===null)continue;let f=t.get(u);f||(f=new Map,t.set(u,f));let I=f.get(d);I||(I=[],f.set(d,I)),I.push(a)}}getAttributeIndex(t){const s=this._inverseAttributes.indexOf(t);return s===-1?null:s}setRelationMap(t,s){this.relationMaps[t.uuid]=s,this.onRelationsIndexed.trigger({modelID:t.uuid,relationsMap:s})}async process(t){if(!t.hasProperties)throw new Error("FragmentsGroup properties not found");let s=this.relationMaps[t.uuid];if(s)return s;s=new Map;for(const i of this._ifcRels){const n=await t.getAllPropertiesOfType(i);if(!n)continue;const r=this._relToAttributesMap.get(i);if(!r)continue;const{forRelated:o,forRelating:a}=r;for(const l in n){const h=n[l];this.indexRelations(s,h,o,a)}}return this.setRelationMap(t,s),s}async processFromWebIfc(t,s){const i=new Map;for(const n of this._ifcRels){const r=this._relToAttributesMap.get(n);if(!r)continue;const{forRelated:o,forRelating:a}=r,l=t.GetLineIDsWithType(s,n);for(let h=0;h<l.size();h++){const u=await t.properties.getItemProperties(s,l.get(h));this.indexRelations(i,u,o,a)}}return this.onRelationsIndexed.trigger({modelID:s.toString(),relationsMap:i}),i}getEntityRelations(t,s,i){const n=this.relationMaps[t.uuid];if(!n)throw new Error(`IfcRelationsIndexer: model ${t.uuid} has no relations indexed.`);const r=n.get(s),o=this.getAttributeIndex(i);if(r===void 0||o===null)return null;const a=r.get(o);return a||null}serializeRelations(t){const s={};for(const[i,n]of t.entries()){s[i]||(s[i]={});for(const[r,o]of n.entries())s[i][r]=o}return JSON.stringify(s)}serializeModelRelations(t){const s=this.relationMaps[t.uuid];return s?this.serializeRelations(s):null}serializeAllRelations(){const t={};for(const s in this.relationMaps){const i=this.relationMaps[s],n={};for(const[r,o]of i.entries()){n[r]||(n[r]={});for(const[a,l]of o.entries())n[r][a]=l}t[s]=n}return JSON.stringify(t)}getRelationsMapFromJSON(t){const s=JSON.parse(t),i=new Map;for(const n in s){const r=s[n],o=new Map;for(const a in r)o.set(Number(a),r[a]);i.set(Number(n),o)}return i}dispose(){this.relationMaps={},this.components.get(gt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(Os.uuid),this.onDisposed.reset()}getEntitiesWithRelation(t,s,i){const n=this.relationMaps[t.uuid];if(!n)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");const r=new Set;for(const[o,a]of n){const l=this.getAttributeIndex(s);if(l===null)throw new Error("IfcRelationsIndexer: invalid inverse attribute name");const h=a.get(l);h&&h.includes(i)&&r.add(o)}return r}addEntityRelations(t,s,i,...n){const r=this.getEntityRelations(t,s,i);if(r)r.push(...n);else{const o=this.getAttributeIndex(i);if(!o)throw new Error(`IfcRelationsIndexer: ${i} is not a valid relation name.`);const a=this.relationMaps[t.uuid].get(s);a==null||a.set(o,n)}}async applyRelationChanges(){const t=this.components.get(gt),s=this.components.get(cn);for(const i in this._changeMap){const n=t.groups.get(i);if(!n)continue;const r=this._changeMap[i];for(const[o,a]of r)for(const[l,h]of a){const{related:u,relID:d}=h;if(d){const f=await n.getProperties(d);if(!f)continue;const I=Object.keys(f),p=I.find(E=>E.startsWith("Related")),m=I.find(E=>E.startsWith("Relating"));if(!(p&&m))continue;f[p]=[...u].map(E=>new he(E)),f[m]=new he(l),await s.setData(n,f)}else{const f=await s.createIfcRel(n,o,l,[...u]);if(!f)continue;h.relID=f.expressID}}}}addEntitiesRelation(t,s,i,...n){const{type:r,inv:o}=i,a=this.relationMaps[t.uuid];if(!a||!this._ifcRels.includes(r))return;const l=Or.get(r);if(!l)return;const{forRelated:h,forRelating:u}=l;if(!(h===o||u===o))return;let d=this._changeMap[t.uuid];d||(d=new fe,this._changeMap[t.uuid]=d);const f=u===o?[s]:n,I=h===o?[s]:n;let p=d.get(r);p||(p=new fe,p.onItemSet.add(()=>this.onEntitiesRelated.trigger({invAttribute:o,relType:r,relatingIDs:f,relatedIDs:I})),p.onItemUpdated.add(()=>this.onEntitiesRelated.trigger({invAttribute:o,relType:r,relatingIDs:f,relatedIDs:I})),d.set(r,p));for(const m of f){let E=p.get(m);E||(E={related:new Xe},p.set(m,E)),E.related.add(...I)}for(const m of f){let E=a.get(m);E||(E=new Map,a.set(m,E));const _=this.getAttributeIndex(u);if(_!==null){let A=E.get(_);A||(A=[],E.set(_,A)),A.push(...I)}}for(const m of I){let E=a.get(m);E||(E=new Map,a.set(m,E));const _=this.getAttributeIndex(h);if(_===null)continue;let A=E.get(_);A||(A=[],E.set(_,A)),A.push(...f)}}getEntityChildren(t,s,i=new Set){if(i.add(s),this.relationMaps[t.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");const r=this.getEntityRelations(t,s,"IsDecomposedBy");if(r)for(const a of r)this.getEntityChildren(t,a,i);const o=this.getEntityRelations(t,s,"ContainsElements");if(o)for(const a of o)this.getEntityChildren(t,a,i);return i}};y(Os,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");let Qe=Os;const Ii=class Ii extends Bt{constructor(t){super(t);y(this,"onDisposed",new st);y(this,"onFragmentsLoaded",new st);y(this,"onFragmentsDisposed",new st);y(this,"list",new fe);y(this,"groups",new fe);y(this,"baseCoordinationModel","");y(this,"baseCoordinationMatrix",new Ft);y(this,"enabled",!0);y(this,"_loader",new xo);this.components.add(Ii.uuid,this)}get meshes(){const t=[];for(const[s,i]of this.list)t.push(i.mesh);return t}dispose(){for(const[t,s]of this.groups)s.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(t){const{uuid:s}=t,i=[];for(const n of t.items)i.push(n.id),this.list.delete(n.id);t.dispose(!0),this.groups.delete(t.uuid),this.groups.size===0&&(this.baseCoordinationModel="",this.baseCoordinationMatrix=new Ft),this.onFragmentsDisposed.trigger({groupID:s,fragmentIDs:i})}load(t,s){const n={...{coordinate:!0},...s},{coordinate:r,name:o,properties:a,relationsMap:l}=n,h=this._loader.import(t);s&&(h.isStreamed=s.isStreamed||!1),o&&(h.name=o);for(const u of h.items)u.group=h,this.list.set(u.id,u);return r&&this.coordinate([h]),this.groups.set(h.uuid,h),a&&h.setLocalProperties(a),l&&this.components.get(Qe).setRelationMap(h,l),this.onFragmentsLoaded.trigger(h),h}export(t){return this._loader.export(t)}getModelIdMap(t){const s={};for(const i in t){const n=this.list.get(i);if(!(n&&n.group))continue;const r=n.group;r.uuid in s||(s[r.uuid]=new Set);const o=t[i];for(const a of o)s[r.uuid].add(a)}return s}modelIdToFragmentIdMap(t){let s={};for(const i in t){const n=this.groups.get(i);if(!n)continue;const r=t[i],o=n.getFragmentMap(r);s={...s,...o}}return s}guidToFragmentIdMap(t){const s={};for(const[n,r]of this.groups){n in s||(s[n]=new Set);for(const o of t){const a=r.globalToExpressIDs.get(o);a&&s[n].add(a)}}return this.modelIdToFragmentIdMap(s)}fragmentIdMapToGuids(t){const s=[],i=this.getModelIdMap(t);for(const n in i){const r=this.groups.get(n);if(!r)continue;const o=i[n];for(const a of o)for(const[l,h]of r.globalToExpressIDs.entries())if(h===a){s.push(l);break}}return s}coordinate(t=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){const i=t.pop();if(!i)return;this.baseCoordinationModel=i.uuid,this.baseCoordinationMatrix=i.coordinationMatrix.clone()}if(t.length)for(const i of t)i.coordinationMatrix.equals(this.baseCoordinationMatrix)||(i.position.set(0,0,0),i.rotation.set(0,0,0),i.scale.set(1,1,1),i.updateMatrix(),this.applyBaseCoordinateSystem(i,i.coordinationMatrix))}applyBaseCoordinateSystem(t,s){s&&t.applyMatrix4(s.clone().invert()),t.applyMatrix4(this.baseCoordinationMatrix)}clone(t,s){const i=t.cloneGroup(s);this.groups.set(i.uuid,i);for(const n of i.items)this.list.set(n.id,n);return i}};y(Ii,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");let gt=Ii;function ii(c){throw new Error('Could not dynamically require "'+c+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Xr={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(c,e){(function(t){c.exports=t()})(function(){return function t(s,i,n){function r(l,h){if(!i[l]){if(!s[l]){var u=typeof ii=="function"&&ii;if(!h&&u)return u(l,!0);if(o)return o(l,!0);var d=new Error("Cannot find module '"+l+"'");throw d.code="MODULE_NOT_FOUND",d}var f=i[l]={exports:{}};s[l][0].call(f.exports,function(I){var p=s[l][1][I];return r(p||I)},f,f.exports,t,s,i,n)}return i[l].exports}for(var o=typeof ii=="function"&&ii,a=0;a<n.length;a++)r(n[a]);return r}({1:[function(t,s,i){var n=t("./utils"),r=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(a){for(var l,h,u,d,f,I,p,m=[],E=0,_=a.length,A=_,T=n.getTypeOf(a)!=="string";E<a.length;)A=_-E,u=T?(l=a[E++],h=E<_?a[E++]:0,E<_?a[E++]:0):(l=a.charCodeAt(E++),h=E<_?a.charCodeAt(E++):0,E<_?a.charCodeAt(E++):0),d=l>>2,f=(3&l)<<4|h>>4,I=1<A?(15&h)<<2|u>>6:64,p=2<A?63&u:64,m.push(o.charAt(d)+o.charAt(f)+o.charAt(I)+o.charAt(p));return m.join("")},i.decode=function(a){var l,h,u,d,f,I,p=0,m=0,E="data:";if(a.substr(0,E.length)===E)throw new Error("Invalid base64 input, it looks like a data url.");var _,A=3*(a=a.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(a.charAt(a.length-1)===o.charAt(64)&&A--,a.charAt(a.length-2)===o.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=r.uint8array?new Uint8Array(0|A):new Array(0|A);p<a.length;)l=o.indexOf(a.charAt(p++))<<2|(d=o.indexOf(a.charAt(p++)))>>4,h=(15&d)<<4|(f=o.indexOf(a.charAt(p++)))>>2,u=(3&f)<<6|(I=o.indexOf(a.charAt(p++))),_[m++]=l,f!==64&&(_[m++]=h),I!==64&&(_[m++]=u);return _}},{"./support":30,"./utils":32}],2:[function(t,s,i){var n=t("./external"),r=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function l(h,u,d,f,I){this.compressedSize=h,this.uncompressedSize=u,this.crc32=d,this.compression=f,this.compressedContent=I}l.prototype={getContentWorker:function(){var h=new r(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),u=this;return h.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new r(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},l.createWorkerFrom=function(h,u,d){return h.pipe(new o).pipe(new a("uncompressedSize")).pipe(u.compressWorker(d)).pipe(new a("compressedSize")).withStreamInfo("compression",u)},s.exports=l},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,i){var n=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,i){var n=t("./utils"),r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();s.exports=function(o,a){return o!==void 0&&o.length?n.getTypeOf(o)!=="string"?function(l,h,u,d){var f=r,I=d+u;l^=-1;for(var p=d;p<I;p++)l=l>>>8^f[255&(l^h[p])];return-1^l}(0|a,o,o.length,0):function(l,h,u,d){var f=r,I=d+u;l^=-1;for(var p=d;p<I;p++)l=l>>>8^f[255&(l^h.charCodeAt(p))];return-1^l}(0|a,o,o.length,0):0}},{"./utils":32}],5:[function(t,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,s,i){var n=null;n=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:n}},{lie:37}],7:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),o=t("./utils"),a=t("./stream/GenericWorker"),l=n?"uint8array":"array";function h(u,d){a.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=d,this.meta={}}i.magic="\b\0",o.inherits(h,a),h.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(l,u.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(d){u.push({data:d,meta:u.meta})}},i.compressWorker=function(u){return new h("Deflate",u)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,i){function n(f,I){var p,m="";for(p=0;p<I;p++)m+=String.fromCharCode(255&f),f>>>=8;return m}function r(f,I,p,m,E,_){var A,T,R=f.file,F=f.compression,w=_!==l.utf8encode,L=o.transformTo("string",_(R.name)),N=o.transformTo("string",l.utf8encode(R.name)),M=R.comment,z=o.transformTo("string",_(M)),O=o.transformTo("string",l.utf8encode(M)),P=N.length!==R.name.length,C=O.length!==M.length,v="",$="",Y="",K=R.dir,G=R.date,it={crc32:0,compressedSize:0,uncompressedSize:0};I&&!p||(it.crc32=f.crc32,it.compressedSize=f.compressedSize,it.uncompressedSize=f.uncompressedSize);var B=0;I&&(B|=8),w||!P&&!C||(B|=2048);var U=0,nt=0;K&&(U|=16),E==="UNIX"?(nt=798,U|=function(q,_t){var Pt=q;return q||(Pt=_t?16893:33204),(65535&Pt)<<16}(R.unixPermissions,K)):(nt=20,U|=function(q){return 63&(q||0)}(R.dosPermissions)),A=G.getUTCHours(),A<<=6,A|=G.getUTCMinutes(),A<<=5,A|=G.getUTCSeconds()/2,T=G.getUTCFullYear()-1980,T<<=4,T|=G.getUTCMonth()+1,T<<=5,T|=G.getUTCDate(),P&&($=n(1,1)+n(h(L),4)+N,v+="up"+n($.length,2)+$),C&&(Y=n(1,1)+n(h(z),4)+O,v+="uc"+n(Y.length,2)+Y);var J="";return J+=`
\0`,J+=n(B,2),J+=F.magic,J+=n(A,2),J+=n(T,2),J+=n(it.crc32,4),J+=n(it.compressedSize,4),J+=n(it.uncompressedSize,4),J+=n(L.length,2),J+=n(v.length,2),{fileRecord:u.LOCAL_FILE_HEADER+J+L+v,dirRecord:u.CENTRAL_FILE_HEADER+n(nt,2)+J+n(z.length,2)+"\0\0\0\0"+n(U,4)+n(m,4)+L+v+z}}var o=t("../utils"),a=t("../stream/GenericWorker"),l=t("../utf8"),h=t("../crc32"),u=t("../signature");function d(f,I,p,m){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=I,this.zipPlatform=p,this.encodeFileName=m,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,a),d.prototype.push=function(f){var I=f.meta.percent||0,p=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,a.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:p?(I+100*(p-m-1))/p:100}}))},d.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var I=this.streamFiles&&!f.file.dir;if(I){var p=r(f,I,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:p.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(f){this.accumulate=!1;var I=this.streamFiles&&!f.file.dir,p=r(f,I,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(p.dirRecord),I)this.push({data:function(m){return u.DATA_DESCRIPTOR+n(m.crc32,4)+n(m.compressedSize,4)+n(m.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:p.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var f=this.bytesWritten,I=0;I<this.dirRecords.length;I++)this.push({data:this.dirRecords[I],meta:{percent:100}});var p=this.bytesWritten-f,m=function(E,_,A,T,R){var F=o.transformTo("string",R(T));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(E,2)+n(E,2)+n(_,4)+n(A,4)+n(F.length,2)+F}(this.dirRecords.length,p,f,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(f){this._sources.push(f);var I=this;return f.on("data",function(p){I.processChunk(p)}),f.on("end",function(){I.closedSource(I.previous.streamInfo),I._sources.length?I.prepareNextSource():I.end()}),f.on("error",function(p){I.error(p)}),this},d.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(f){var I=this._sources;if(!a.prototype.error.call(this,f))return!1;for(var p=0;p<I.length;p++)try{I[p].error(f)}catch{}return!0},d.prototype.lock=function(){a.prototype.lock.call(this);for(var f=this._sources,I=0;I<f.length;I++)f[I].lock()},s.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,i){var n=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(o,a,l){var h=new r(a.streamFiles,l,a.platform,a.encodeFileName),u=0;try{o.forEach(function(d,f){u++;var I=function(_,A){var T=_||A,R=n[T];if(!R)throw new Error(T+" is not a valid compression method !");return R}(f.options.compression,a.compression),p=f.options.compressionOptions||a.compressionOptions||{},m=f.dir,E=f.date;f._compressWorker(I,p).withStreamInfo("file",{name:d,dir:m,date:E,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(h)}),h.entriesCount=u}catch(d){h.error(d)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,i){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new n;for(var o in this)typeof this[o]!="function"&&(r[o]=this[o]);return r}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(r,o){return new n().loadAsync(r,o)},n.external=t("./external"),s.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,i){var n=t("./utils"),r=t("./external"),o=t("./utf8"),a=t("./zipEntries"),l=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function u(d){return new r.Promise(function(f,I){var p=d.decompressed.getContentWorker().pipe(new l);p.on("error",function(m){I(m)}).on("end",function(){p.streamInfo.crc32!==d.decompressed.crc32?I(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}s.exports=function(d,f){var I=this;return f=n.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(d)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",d,!0,f.optimizedBinaryString,f.base64).then(function(p){var m=new a(f);return m.load(p),m}).then(function(p){var m=[r.Promise.resolve(p)],E=p.files;if(f.checkCRC32)for(var _=0;_<E.length;_++)m.push(u(E[_]));return r.Promise.all(m)}).then(function(p){for(var m=p.shift(),E=m.files,_=0;_<E.length;_++){var A=E[_],T=A.fileNameStr,R=n.resolve(A.fileNameStr);I.file(R,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:f.createFolders}),A.dir||(I.file(R).unsafeOriginalName=T)}return m.zipComment.length&&(I.comment=m.zipComment),I})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,i){var n=t("../utils"),r=t("../stream/GenericWorker");function o(a,l){r.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(l)}n.inherits(o,r),o.prototype._bindStream=function(a){var l=this;(this._stream=a).pause(),a.on("data",function(h){l.push({data:h,meta:{percent:0}})}).on("error",function(h){l.isPaused?this.generatedError=h:l.error(h)}).on("end",function(){l.isPaused?l._upstreamEnded=!0:l.end()})},o.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,i){var n=t("readable-stream").Readable;function r(o,a,l){n.call(this,a),this._helper=o;var h=this;o.on("data",function(u,d){h.push(u)||h._helper.pause(),l&&l(d)}).on("error",function(u){h.emit("error",u)}).on("end",function(){h.push(null)})}t("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},s.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,r);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,r)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var r=new Buffer(n);return r.fill(0),r},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,s,i){function n(R,F,w){var L,N=o.getTypeOf(F),M=o.extend(w||{},h);M.date=M.date||new Date,M.compression!==null&&(M.compression=M.compression.toUpperCase()),typeof M.unixPermissions=="string"&&(M.unixPermissions=parseInt(M.unixPermissions,8)),M.unixPermissions&&16384&M.unixPermissions&&(M.dir=!0),M.dosPermissions&&16&M.dosPermissions&&(M.dir=!0),M.dir&&(R=E(R)),M.createFolders&&(L=m(R))&&_.call(this,L,!0);var z=N==="string"&&M.binary===!1&&M.base64===!1;w&&w.binary!==void 0||(M.binary=!z),(F instanceof u&&F.uncompressedSize===0||M.dir||!F||F.length===0)&&(M.base64=!1,M.binary=!0,F="",M.compression="STORE",N="string");var O=null;O=F instanceof u||F instanceof a?F:I.isNode&&I.isStream(F)?new p(R,F):o.prepareContent(R,F,M.binary,M.optimizedBinaryString,M.base64);var P=new d(R,O,M);this.files[R]=P}var r=t("./utf8"),o=t("./utils"),a=t("./stream/GenericWorker"),l=t("./stream/StreamHelper"),h=t("./defaults"),u=t("./compressedObject"),d=t("./zipObject"),f=t("./generate"),I=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),m=function(R){R.slice(-1)==="/"&&(R=R.substring(0,R.length-1));var F=R.lastIndexOf("/");return 0<F?R.substring(0,F):""},E=function(R){return R.slice(-1)!=="/"&&(R+="/"),R},_=function(R,F){return F=F!==void 0?F:h.createFolders,R=E(R),this.files[R]||n.call(this,R,null,{dir:!0,createFolders:F}),this.files[R]};function A(R){return Object.prototype.toString.call(R)==="[object RegExp]"}var T={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(R){var F,w,L;for(F in this.files)L=this.files[F],(w=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&R(w,L)},filter:function(R){var F=[];return this.forEach(function(w,L){R(w,L)&&F.push(L)}),F},file:function(R,F,w){if(arguments.length!==1)return R=this.root+R,n.call(this,R,F,w),this;if(A(R)){var L=R;return this.filter(function(M,z){return!z.dir&&L.test(M)})}var N=this.files[this.root+R];return N&&!N.dir?N:null},folder:function(R){if(!R)return this;if(A(R))return this.filter(function(N,M){return M.dir&&R.test(N)});var F=this.root+R,w=_.call(this,F),L=this.clone();return L.root=w.name,L},remove:function(R){R=this.root+R;var F=this.files[R];if(F||(R.slice(-1)!=="/"&&(R+="/"),F=this.files[R]),F&&!F.dir)delete this.files[R];else for(var w=this.filter(function(N,M){return M.name.slice(0,R.length)===R}),L=0;L<w.length;L++)delete this.files[w[L].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(R){var F,w={};try{if((w=o.extend(R||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=w.type.toLowerCase(),w.compression=w.compression.toUpperCase(),w.type==="binarystring"&&(w.type="string"),!w.type)throw new Error("No output type specified.");o.checkSupport(w.type),w.platform!=="darwin"&&w.platform!=="freebsd"&&w.platform!=="linux"&&w.platform!=="sunos"||(w.platform="UNIX"),w.platform==="win32"&&(w.platform="DOS");var L=w.comment||this.comment||"";F=f.generateWorker(this,w,L)}catch(N){(F=new a("error")).error(N)}return new l(F,w.type||"string",w.mimeType)},generateAsync:function(R,F){return this.generateInternalStream(R).accumulate(F)},generateNodeStream:function(R,F){return(R=R||{}).type||(R.type="nodebuffer"),this.generateInternalStream(R).toNodejsStream(F)}};s.exports=T},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,i){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o);for(var a=0;a<this.data.length;a++)o[a]=255&o[a]}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data[this.zero+o]},r.prototype.lastIndexOfSignature=function(o){for(var a=o.charCodeAt(0),l=o.charCodeAt(1),h=o.charCodeAt(2),u=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===a&&this.data[d+1]===l&&this.data[d+2]===h&&this.data[d+3]===u)return d-this.zero;return-1},r.prototype.readAndCheckSignature=function(o){var a=o.charCodeAt(0),l=o.charCodeAt(1),h=o.charCodeAt(2),u=o.charCodeAt(3),d=this.readData(4);return a===d[0]&&l===d[1]&&h===d[2]&&u===d[3]},r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,s,i){var n=t("../utils");function r(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var a,l=0;for(this.checkOffset(o),a=this.index+o-1;a>=this.index;a--)l=(l<<8)+this.byteAt(a);return this.index+=o,l},readString:function(o){return n.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=r},{"../utils":32}],19:[function(t,s,i){var n=t("./Uint8ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,i){var n=t("./DataReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},r.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},r.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},r.prototype.readData=function(o){this.checkOffset(o);var a=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,s,i){var n=t("./ArrayReader");function r(o){n.call(this,o)}t("../utils").inherits(r,n),r.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,a},s.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,i){var n=t("../utils"),r=t("../support"),o=t("./ArrayReader"),a=t("./StringReader"),l=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");s.exports=function(u){var d=n.getTypeOf(u);return n.checkSupport(d),d!=="string"||r.uint8array?d==="nodebuffer"?new l(u):r.uint8array?new h(n.transformTo("uint8array",u)):new o(n.transformTo("array",u)):new a(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,i){var n=t("./GenericWorker"),r=t("../utils");function o(a){n.call(this,"ConvertWorker to "+a),this.destType=a}r.inherits(o,n),o.prototype.processChunk=function(a){this.push({data:r.transformTo(this.destType,a.data),meta:a.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,i){var n=t("./GenericWorker"),r=t("../crc32");function o(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,n),o.prototype.processChunk=function(a){this.streamInfo.crc32=r(a.data,this.streamInfo.crc32||0),this.push(a)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}n.inherits(o,r),o.prototype.processChunk=function(a){if(a){var l=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=l+a.data.length}r.prototype.processChunk.call(this,a)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,i){var n=t("../utils"),r=t("./GenericWorker");function o(a){r.call(this,"DataWorker");var l=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(h){l.dataIsReady=!0,l.data=h,l.max=h&&h.length||0,l.type=n.getTypeOf(h),l.isPaused||l._tickAndRepeat()},function(h){l.error(h)})}n.inherits(o,r),o.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,l=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,l);break;case"uint8array":a=this.data.subarray(this.index,l);break;case"array":case"nodebuffer":a=this.data.slice(this.index,l)}return this.index=l,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,i){function n(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,o){return this._listeners[r].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,o){if(this._listeners[r])for(var a=0;a<this._listeners[r].length;a++)this._listeners[r][a].call(this,o)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var o=this;return r.on("data",function(a){o.processChunk(a)}),r.on("end",function(){o.end()}),r.on("error",function(a){o.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,o){return this.extraStreamInfo[r]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},s.exports=n},{}],29:[function(t,s,i){var n=t("../utils"),r=t("./ConvertWorker"),o=t("./GenericWorker"),a=t("../base64"),l=t("../support"),h=t("../external"),u=null;if(l.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(I,p){return new h.Promise(function(m,E){var _=[],A=I._internalType,T=I._outputType,R=I._mimeType;I.on("data",function(F,w){_.push(F),p&&p(w)}).on("error",function(F){_=[],E(F)}).on("end",function(){try{var F=function(w,L,N){switch(w){case"blob":return n.newBlob(n.transformTo("arraybuffer",L),N);case"base64":return a.encode(L);default:return n.transformTo(w,L)}}(T,function(w,L){var N,M=0,z=null,O=0;for(N=0;N<L.length;N++)O+=L[N].length;switch(w){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(z=new Uint8Array(O),N=0;N<L.length;N++)z.set(L[N],M),M+=L[N].length;return z;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+w+"'")}}(A,_),R);m(F)}catch(w){E(w)}_=[]}).resume()})}function f(I,p,m){var E=p;switch(p){case"blob":case"arraybuffer":E="uint8array";break;case"base64":E="string"}try{this._internalType=E,this._outputType=p,this._mimeType=m,n.checkSupport(E),this._worker=I.pipe(new r(E)),I.lock()}catch(_){this._worker=new o("error"),this._worker.error(_)}}f.prototype={accumulate:function(I){return d(this,I)},on:function(I,p){var m=this;return I==="data"?this._worker.on(I,function(E){p.call(m,E.data,E.meta)}):this._worker.on(I,function(){n.delay(p,arguments,m)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(I){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},I)}},s.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var n=new ArrayBuffer(0);try{i.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(n),i.blob=r.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,i){for(var n=t("./utils"),r=t("./support"),o=t("./nodejsUtils"),a=t("./stream/GenericWorker"),l=new Array(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;l[254]=l[254]=1;function u(){a.call(this,"utf-8 decode"),this.leftOver=null}function d(){a.call(this,"utf-8 encode")}i.utf8encode=function(f){return r.nodebuffer?o.newBufferFrom(f,"utf-8"):function(I){var p,m,E,_,A,T=I.length,R=0;for(_=0;_<T;_++)(64512&(m=I.charCodeAt(_)))==55296&&_+1<T&&(64512&(E=I.charCodeAt(_+1)))==56320&&(m=65536+(m-55296<<10)+(E-56320),_++),R+=m<128?1:m<2048?2:m<65536?3:4;for(p=r.uint8array?new Uint8Array(R):new Array(R),_=A=0;A<R;_++)(64512&(m=I.charCodeAt(_)))==55296&&_+1<T&&(64512&(E=I.charCodeAt(_+1)))==56320&&(m=65536+(m-55296<<10)+(E-56320),_++),m<128?p[A++]=m:(m<2048?p[A++]=192|m>>>6:(m<65536?p[A++]=224|m>>>12:(p[A++]=240|m>>>18,p[A++]=128|m>>>12&63),p[A++]=128|m>>>6&63),p[A++]=128|63&m);return p}(f)},i.utf8decode=function(f){return r.nodebuffer?n.transformTo("nodebuffer",f).toString("utf-8"):function(I){var p,m,E,_,A=I.length,T=new Array(2*A);for(p=m=0;p<A;)if((E=I[p++])<128)T[m++]=E;else if(4<(_=l[E]))T[m++]=65533,p+=_-1;else{for(E&=_===2?31:_===3?15:7;1<_&&p<A;)E=E<<6|63&I[p++],_--;1<_?T[m++]=65533:E<65536?T[m++]=E:(E-=65536,T[m++]=55296|E>>10&1023,T[m++]=56320|1023&E)}return T.length!==m&&(T.subarray?T=T.subarray(0,m):T.length=m),n.applyFromCharCode(T)}(f=n.transformTo(r.uint8array?"uint8array":"array",f))},n.inherits(u,a),u.prototype.processChunk=function(f){var I=n.transformTo(r.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var p=I;(I=new Uint8Array(p.length+this.leftOver.length)).set(this.leftOver,0),I.set(p,this.leftOver.length)}else I=this.leftOver.concat(I);this.leftOver=null}var m=function(_,A){var T;for((A=A||_.length)>_.length&&(A=_.length),T=A-1;0<=T&&(192&_[T])==128;)T--;return T<0||T===0?A:T+l[_[T]]>A?T:A}(I),E=I;m!==I.length&&(r.uint8array?(E=I.subarray(0,m),this.leftOver=I.subarray(m,I.length)):(E=I.slice(0,m),this.leftOver=I.slice(m,I.length))),this.push({data:i.utf8decode(E),meta:f.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=u,n.inherits(d,a),d.prototype.processChunk=function(f){this.push({data:i.utf8encode(f.data),meta:f.meta})},i.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,i){var n=t("./support"),r=t("./base64"),o=t("./nodejsUtils"),a=t("./external");function l(p){return p}function h(p,m){for(var E=0;E<p.length;++E)m[E]=255&p.charCodeAt(E);return m}t("setimmediate"),i.newBlob=function(p,m){i.checkSupport("blob");try{return new Blob([p],{type:m})}catch{try{var E=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return E.append(p),E.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(p,m,E){var _=[],A=0,T=p.length;if(T<=E)return String.fromCharCode.apply(null,p);for(;A<T;)m==="array"||m==="nodebuffer"?_.push(String.fromCharCode.apply(null,p.slice(A,Math.min(A+E,T)))):_.push(String.fromCharCode.apply(null,p.subarray(A,Math.min(A+E,T)))),A+=E;return _.join("")},stringifyByChar:function(p){for(var m="",E=0;E<p.length;E++)m+=String.fromCharCode(p[E]);return m},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(p){var m=65536,E=i.getTypeOf(p),_=!0;if(E==="uint8array"?_=u.applyCanBeUsed.uint8array:E==="nodebuffer"&&(_=u.applyCanBeUsed.nodebuffer),_)for(;1<m;)try{return u.stringifyByChunk(p,E,m)}catch{m=Math.floor(m/2)}return u.stringifyByChar(p)}function f(p,m){for(var E=0;E<p.length;E++)m[E]=p[E];return m}i.applyFromCharCode=d;var I={};I.string={string:l,array:function(p){return h(p,new Array(p.length))},arraybuffer:function(p){return I.string.uint8array(p).buffer},uint8array:function(p){return h(p,new Uint8Array(p.length))},nodebuffer:function(p){return h(p,o.allocBuffer(p.length))}},I.array={string:d,array:l,arraybuffer:function(p){return new Uint8Array(p).buffer},uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(p)}},I.arraybuffer={string:function(p){return d(new Uint8Array(p))},array:function(p){return f(new Uint8Array(p),new Array(p.byteLength))},arraybuffer:l,uint8array:function(p){return new Uint8Array(p)},nodebuffer:function(p){return o.newBufferFrom(new Uint8Array(p))}},I.uint8array={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return p.buffer},uint8array:l,nodebuffer:function(p){return o.newBufferFrom(p)}},I.nodebuffer={string:d,array:function(p){return f(p,new Array(p.length))},arraybuffer:function(p){return I.nodebuffer.uint8array(p).buffer},uint8array:function(p){return f(p,new Uint8Array(p.length))},nodebuffer:l},i.transformTo=function(p,m){if(m=m||"",!p)return m;i.checkSupport(p);var E=i.getTypeOf(m);return I[E][p](m)},i.resolve=function(p){for(var m=p.split("/"),E=[],_=0;_<m.length;_++){var A=m[_];A==="."||A===""&&_!==0&&_!==m.length-1||(A===".."?E.pop():E.push(A))}return E.join("/")},i.getTypeOf=function(p){return typeof p=="string"?"string":Object.prototype.toString.call(p)==="[object Array]"?"array":n.nodebuffer&&o.isBuffer(p)?"nodebuffer":n.uint8array&&p instanceof Uint8Array?"uint8array":n.arraybuffer&&p instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(p){if(!n[p.toLowerCase()])throw new Error(p+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(p){var m,E,_="";for(E=0;E<(p||"").length;E++)_+="\\x"+((m=p.charCodeAt(E))<16?"0":"")+m.toString(16).toUpperCase();return _},i.delay=function(p,m,E){setImmediate(function(){p.apply(E||null,m||[])})},i.inherits=function(p,m){function E(){}E.prototype=m.prototype,p.prototype=new E},i.extend=function(){var p,m,E={};for(p=0;p<arguments.length;p++)for(m in arguments[p])Object.prototype.hasOwnProperty.call(arguments[p],m)&&E[m]===void 0&&(E[m]=arguments[p][m]);return E},i.prepareContent=function(p,m,E,_,A){return a.Promise.resolve(m).then(function(T){return n.blob&&(T instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(T))!==-1)&&typeof FileReader<"u"?new a.Promise(function(R,F){var w=new FileReader;w.onload=function(L){R(L.target.result)},w.onerror=function(L){F(L.target.error)},w.readAsArrayBuffer(T)}):T}).then(function(T){var R=i.getTypeOf(T);return R?(R==="arraybuffer"?T=i.transformTo("uint8array",T):R==="string"&&(A?T=r.decode(T):E&&_!==!0&&(T=function(F){return h(F,n.uint8array?new Uint8Array(F.length):new Array(F.length))}(T))),T):a.Promise.reject(new Error("Can't read the data of '"+p+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./signature"),a=t("./zipEntry"),l=t("./support");function h(u){this.files=[],this.loadOptions=u}h.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(d)+", expected "+r.pretty(u)+")")}},isSignature:function(u,d){var f=this.reader.index;this.reader.setIndex(u);var I=this.reader.readString(4)===d;return this.reader.setIndex(f),I},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),d=l.uint8array?"uint8array":"array",f=r.transformTo(d,u);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,d,f,I=this.zip64EndOfCentralSize-44;0<I;)u=this.reader.readInt(2),d=this.reader.readInt(4),f=this.reader.readData(d),this.zip64ExtensibleData[u]={id:u,length:d,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,d;for(u=0;u<this.files.length;u++)d=this.files[u],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(u=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var d=u;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var I=d-f;if(0<I)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=I);else if(I<0)throw new Error("Corrupted zip: missing "+Math.abs(I)+" bytes.")},prepareReader:function(u){this.reader=n(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,i){var n=t("./reader/readerFor"),r=t("./utils"),o=t("./compressedObject"),a=t("./crc32"),l=t("./utf8"),h=t("./compressions"),u=t("./support");function d(f,I){this.options=f,this.loadOptions=I}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var I,p;if(f.skip(22),this.fileNameLength=f.readInt(2),p=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(p),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((I=function(m){for(var E in h)if(Object.prototype.hasOwnProperty.call(h,E)&&h[E].magic===m)return h[E];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,I,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var I=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(I),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=n(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var I,p,m,E=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<E;)I=f.readInt(2),p=f.readInt(2),m=f.readData(p),this.extraFields[I]={id:I,length:p,value:m};f.setIndex(E)},handleUTF8:function(){var f=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var I=this.findExtraFieldUnicodePath();if(I!==null)this.fileNameStr=I;else{var p=r.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(p)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var E=r.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(E)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var I=n(f.value);return I.readInt(1)!==1||a(this.fileName)!==I.readInt(4)?null:l.utf8decode(I.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var I=n(f.value);return I.readInt(1)!==1||a(this.fileComment)!==I.readInt(4)?null:l.utf8decode(I.readData(f.length-5))}return null}},s.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,i){function n(I,p,m){this.name=I,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=p,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var r=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),a=t("./utf8"),l=t("./compressedObject"),h=t("./stream/GenericWorker");n.prototype={internalStream:function(I){var p=null,m="string";try{if(!I)throw new Error("No output type specified.");var E=(m=I.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),p=this._decompressWorker();var _=!this._dataBinary;_&&!E&&(p=p.pipe(new a.Utf8EncodeWorker)),!_&&E&&(p=p.pipe(new a.Utf8DecodeWorker))}catch(A){(p=new h("error")).error(A)}return new r(p,m,"")},async:function(I,p){return this.internalStream(I).accumulate(p)},nodeStream:function(I,p){return this.internalStream(I||"nodebuffer").toNodejsStream(p)},_compressWorker:function(I,p){if(this._data instanceof l&&this._data.compression.magic===I.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new a.Utf8EncodeWorker)),l.createWorkerFrom(m,I,p)},_decompressWorker:function(){return this._data instanceof l?this._data.getContentWorker():this._data instanceof h?this._data:new o(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<u.length;f++)n.prototype[u[f]]=d;s.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,i){(function(n){var r,o,a=n.MutationObserver||n.WebKitMutationObserver;if(a){var l=0,h=new a(I),u=n.document.createTextNode("");h.observe(u,{characterData:!0}),r=function(){u.data=l=++l%2}}else if(n.setImmediate||n.MessageChannel===void 0)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var p=n.document.createElement("script");p.onreadystatechange=function(){I(),p.onreadystatechange=null,p.parentNode.removeChild(p),p=null},n.document.documentElement.appendChild(p)}:function(){setTimeout(I,0)};else{var d=new n.MessageChannel;d.port1.onmessage=I,r=function(){d.port2.postMessage(0)}}var f=[];function I(){var p,m;o=!0;for(var E=f.length;E;){for(m=f,f=[],p=-1;++p<E;)m[p]();E=f.length}o=!1}s.exports=function(p){f.push(p)!==1||o||r()}}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,i){var n=t("immediate");function r(){}var o={},a=["REJECTED"],l=["FULFILLED"],h=["PENDING"];function u(E){if(typeof E!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,E!==r&&p(this,E)}function d(E,_,A){this.promise=E,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function f(E,_,A){n(function(){var T;try{T=_(A)}catch(R){return o.reject(E,R)}T===E?o.reject(E,new TypeError("Cannot resolve promise with itself")):o.resolve(E,T)})}function I(E){var _=E&&E.then;if(E&&(typeof E=="object"||typeof E=="function")&&typeof _=="function")return function(){_.apply(E,arguments)}}function p(E,_){var A=!1;function T(w){A||(A=!0,o.reject(E,w))}function R(w){A||(A=!0,o.resolve(E,w))}var F=m(function(){_(R,T)});F.status==="error"&&T(F.value)}function m(E,_){var A={};try{A.value=E(_),A.status="success"}catch(T){A.status="error",A.value=T}return A}(s.exports=u).prototype.finally=function(E){if(typeof E!="function")return this;var _=this.constructor;return this.then(function(A){return _.resolve(E()).then(function(){return A})},function(A){return _.resolve(E()).then(function(){throw A})})},u.prototype.catch=function(E){return this.then(null,E)},u.prototype.then=function(E,_){if(typeof E!="function"&&this.state===l||typeof _!="function"&&this.state===a)return this;var A=new this.constructor(r);return this.state!==h?f(A,this.state===l?E:_,this.outcome):this.queue.push(new d(A,E,_)),A},d.prototype.callFulfilled=function(E){o.resolve(this.promise,E)},d.prototype.otherCallFulfilled=function(E){f(this.promise,this.onFulfilled,E)},d.prototype.callRejected=function(E){o.reject(this.promise,E)},d.prototype.otherCallRejected=function(E){f(this.promise,this.onRejected,E)},o.resolve=function(E,_){var A=m(I,_);if(A.status==="error")return o.reject(E,A.value);var T=A.value;if(T)p(E,T);else{E.state=l,E.outcome=_;for(var R=-1,F=E.queue.length;++R<F;)E.queue[R].callFulfilled(_)}return E},o.reject=function(E,_){E.state=a,E.outcome=_;for(var A=-1,T=E.queue.length;++A<T;)E.queue[A].callRejected(_);return E},u.resolve=function(E){return E instanceof this?E:o.resolve(new this(r),E)},u.reject=function(E){var _=new this(r);return o.reject(_,E)},u.all=function(E){var _=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=E.length,T=!1;if(!A)return this.resolve([]);for(var R=new Array(A),F=0,w=-1,L=new this(r);++w<A;)N(E[w],w);return L;function N(M,z){_.resolve(M).then(function(O){R[z]=O,++F!==A||T||(T=!0,o.resolve(L,R))},function(O){T||(T=!0,o.reject(L,O))})}},u.race=function(E){var _=this;if(Object.prototype.toString.call(E)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=E.length,T=!1;if(!A)return this.resolve([]);for(var R=-1,F=new this(r);++R<A;)w=E[R],_.resolve(w).then(function(L){T||(T=!0,o.resolve(F,L))},function(L){T||(T=!0,o.reject(F,L))});var w;return F}},{immediate:36}],38:[function(t,s,i){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,i){var n=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/messages"),l=t("./zlib/zstream"),h=Object.prototype.toString,u=0,d=-1,f=0,I=8;function p(E){if(!(this instanceof p))return new p(E);this.options=r.assign({level:d,method:I,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},E||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var A=n.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(A!==u)throw new Error(a[A]);if(_.header&&n.deflateSetHeader(this.strm,_.header),_.dictionary){var T;if(T=typeof _.dictionary=="string"?o.string2buf(_.dictionary):h.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(A=n.deflateSetDictionary(this.strm,T))!==u)throw new Error(a[A]);this._dict_set=!0}}function m(E,_){var A=new p(_);if(A.push(E,!0),A.err)throw A.msg||a[A.err];return A.result}p.prototype.push=function(E,_){var A,T,R=this.strm,F=this.options.chunkSize;if(this.ended)return!1;T=_===~~_?_:_===!0?4:0,typeof E=="string"?R.input=o.string2buf(E):h.call(E)==="[object ArrayBuffer]"?R.input=new Uint8Array(E):R.input=E,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new r.Buf8(F),R.next_out=0,R.avail_out=F),(A=n.deflate(R,T))!==1&&A!==u)return this.onEnd(A),!(this.ended=!0);R.avail_out!==0&&(R.avail_in!==0||T!==4&&T!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(r.shrinkBuf(R.output,R.next_out))):this.onData(r.shrinkBuf(R.output,R.next_out)))}while((0<R.avail_in||R.avail_out===0)&&A!==1);return T===4?(A=n.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===u):T!==2||(this.onEnd(u),!(R.avail_out=0))},p.prototype.onData=function(E){this.chunks.push(E)},p.prototype.onEnd=function(E){E===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=E,this.msg=this.strm.msg},i.Deflate=p,i.deflate=m,i.deflateRaw=function(E,_){return(_=_||{}).raw=!0,m(E,_)},i.gzip=function(E,_){return(_=_||{}).gzip=!0,m(E,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,i){var n=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),a=t("./zlib/constants"),l=t("./zlib/messages"),h=t("./zlib/zstream"),u=t("./zlib/gzheader"),d=Object.prototype.toString;function f(p){if(!(this instanceof f))return new f(p);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},p||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||p&&p.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&!(15&m.windowBits)&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var E=n.inflateInit2(this.strm,m.windowBits);if(E!==a.Z_OK)throw new Error(l[E]);this.header=new u,n.inflateGetHeader(this.strm,this.header)}function I(p,m){var E=new f(m);if(E.push(p,!0),E.err)throw E.msg||l[E.err];return E.result}f.prototype.push=function(p,m){var E,_,A,T,R,F,w=this.strm,L=this.options.chunkSize,N=this.options.dictionary,M=!1;if(this.ended)return!1;_=m===~~m?m:m===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof p=="string"?w.input=o.binstring2buf(p):d.call(p)==="[object ArrayBuffer]"?w.input=new Uint8Array(p):w.input=p,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new r.Buf8(L),w.next_out=0,w.avail_out=L),(E=n.inflate(w,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&N&&(F=typeof N=="string"?o.string2buf(N):d.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,E=n.inflateSetDictionary(this.strm,F)),E===a.Z_BUF_ERROR&&M===!0&&(E=a.Z_OK,M=!1),E!==a.Z_STREAM_END&&E!==a.Z_OK)return this.onEnd(E),!(this.ended=!0);w.next_out&&(w.avail_out!==0&&E!==a.Z_STREAM_END&&(w.avail_in!==0||_!==a.Z_FINISH&&_!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=o.utf8border(w.output,w.next_out),T=w.next_out-A,R=o.buf2string(w.output,A),w.next_out=T,w.avail_out=L-T,T&&r.arraySet(w.output,w.output,A,T,0),this.onData(R)):this.onData(r.shrinkBuf(w.output,w.next_out)))),w.avail_in===0&&w.avail_out===0&&(M=!0)}while((0<w.avail_in||w.avail_out===0)&&E!==a.Z_STREAM_END);return E===a.Z_STREAM_END&&(_=a.Z_FINISH),_===a.Z_FINISH?(E=n.inflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===a.Z_OK):_!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(w.avail_out=0))},f.prototype.onData=function(p){this.chunks.push(p)},f.prototype.onEnd=function(p){p===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},i.Inflate=f,i.inflate=I,i.inflateRaw=function(p,m){return(m=m||{}).raw=!0,I(p,m)},i.ungzip=I},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,i){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(a){for(var l=Array.prototype.slice.call(arguments,1);l.length;){var h=l.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var u in h)h.hasOwnProperty(u)&&(a[u]=h[u])}}return a},i.shrinkBuf=function(a,l){return a.length===l?a:a.subarray?a.subarray(0,l):(a.length=l,a)};var r={arraySet:function(a,l,h,u,d){if(l.subarray&&a.subarray)a.set(l.subarray(h,h+u),d);else for(var f=0;f<u;f++)a[d+f]=l[h+f]},flattenChunks:function(a){var l,h,u,d,f,I;for(l=u=0,h=a.length;l<h;l++)u+=a[l].length;for(I=new Uint8Array(u),l=d=0,h=a.length;l<h;l++)f=a[l],I.set(f,d),d+=f.length;return I}},o={arraySet:function(a,l,h,u,d){for(var f=0;f<u;f++)a[d+f]=l[h+f]},flattenChunks:function(a){return[].concat.apply([],a)}};i.setTyped=function(a){a?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(n)},{}],42:[function(t,s,i){var n=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var a=new n.Buf8(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;function h(u,d){if(d<65537&&(u.subarray&&o||!u.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(u,d));for(var f="",I=0;I<d;I++)f+=String.fromCharCode(u[I]);return f}a[254]=a[254]=1,i.string2buf=function(u){var d,f,I,p,m,E=u.length,_=0;for(p=0;p<E;p++)(64512&(f=u.charCodeAt(p)))==55296&&p+1<E&&(64512&(I=u.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(I-56320),p++),_+=f<128?1:f<2048?2:f<65536?3:4;for(d=new n.Buf8(_),p=m=0;m<_;p++)(64512&(f=u.charCodeAt(p)))==55296&&p+1<E&&(64512&(I=u.charCodeAt(p+1)))==56320&&(f=65536+(f-55296<<10)+(I-56320),p++),f<128?d[m++]=f:(f<2048?d[m++]=192|f>>>6:(f<65536?d[m++]=224|f>>>12:(d[m++]=240|f>>>18,d[m++]=128|f>>>12&63),d[m++]=128|f>>>6&63),d[m++]=128|63&f);return d},i.buf2binstring=function(u){return h(u,u.length)},i.binstring2buf=function(u){for(var d=new n.Buf8(u.length),f=0,I=d.length;f<I;f++)d[f]=u.charCodeAt(f);return d},i.buf2string=function(u,d){var f,I,p,m,E=d||u.length,_=new Array(2*E);for(f=I=0;f<E;)if((p=u[f++])<128)_[I++]=p;else if(4<(m=a[p]))_[I++]=65533,f+=m-1;else{for(p&=m===2?31:m===3?15:7;1<m&&f<E;)p=p<<6|63&u[f++],m--;1<m?_[I++]=65533:p<65536?_[I++]=p:(p-=65536,_[I++]=55296|p>>10&1023,_[I++]=56320|1023&p)}return h(_,I)},i.utf8border=function(u,d){var f;for((d=d||u.length)>u.length&&(d=u.length),f=d-1;0<=f&&(192&u[f])==128;)f--;return f<0||f===0?d:f+a[u[f]]>d?f:d}},{"./common":41}],43:[function(t,s,i){s.exports=function(n,r,o,a){for(var l=65535&n|0,h=n>>>16&65535|0,u=0;o!==0;){for(o-=u=2e3<o?2e3:o;h=h+(l=l+r[a++]|0)|0,--u;);l%=65521,h%=65521}return l|h<<16|0}},{}],44:[function(t,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,i){var n=function(){for(var r,o=[],a=0;a<256;a++){r=a;for(var l=0;l<8;l++)r=1&r?3988292384^r>>>1:r>>>1;o[a]=r}return o}();s.exports=function(r,o,a,l){var h=n,u=l+a;r^=-1;for(var d=l;d<u;d++)r=r>>>8^h[255&(r^o[d])];return-1^r}},{}],46:[function(t,s,i){var n,r=t("../utils/common"),o=t("./trees"),a=t("./adler32"),l=t("./crc32"),h=t("./messages"),u=0,d=4,f=0,I=-2,p=-1,m=4,E=2,_=8,A=9,T=286,R=30,F=19,w=2*T+1,L=15,N=3,M=258,z=M+N+1,O=42,P=113,C=1,v=2,$=3,Y=4;function K(g,H){return g.msg=h[H],H}function G(g){return(g<<1)-(4<g?9:0)}function it(g){for(var H=g.length;0<=--H;)g[H]=0}function B(g){var H=g.state,k=H.pending;k>g.avail_out&&(k=g.avail_out),k!==0&&(r.arraySet(g.output,H.pending_buf,H.pending_out,k,g.next_out),g.next_out+=k,H.pending_out+=k,g.total_out+=k,g.avail_out-=k,H.pending-=k,H.pending===0&&(H.pending_out=0))}function U(g,H){o._tr_flush_block(g,0<=g.block_start?g.block_start:-1,g.strstart-g.block_start,H),g.block_start=g.strstart,B(g.strm)}function nt(g,H){g.pending_buf[g.pending++]=H}function J(g,H){g.pending_buf[g.pending++]=H>>>8&255,g.pending_buf[g.pending++]=255&H}function q(g,H){var k,b,S=g.max_chain_length,x=g.strstart,X=g.prev_length,Z=g.nice_match,D=g.strstart>g.w_size-z?g.strstart-(g.w_size-z):0,j=g.window,tt=g.w_mask,Q=g.prev,rt=g.strstart+M,Et=j[x+X-1],ht=j[x+X];g.prev_length>=g.good_match&&(S>>=2),Z>g.lookahead&&(Z=g.lookahead);do if(j[(k=H)+X]===ht&&j[k+X-1]===Et&&j[k]===j[x]&&j[++k]===j[x+1]){x+=2,k++;do;while(j[++x]===j[++k]&&j[++x]===j[++k]&&j[++x]===j[++k]&&j[++x]===j[++k]&&j[++x]===j[++k]&&j[++x]===j[++k]&&j[++x]===j[++k]&&j[++x]===j[++k]&&x<rt);if(b=M-(rt-x),x=rt-M,X<b){if(g.match_start=H,Z<=(X=b))break;Et=j[x+X-1],ht=j[x+X]}}while((H=Q[H&tt])>D&&--S!=0);return X<=g.lookahead?X:g.lookahead}function _t(g){var H,k,b,S,x,X,Z,D,j,tt,Q=g.w_size;do{if(S=g.window_size-g.lookahead-g.strstart,g.strstart>=Q+(Q-z)){for(r.arraySet(g.window,g.window,Q,Q,0),g.match_start-=Q,g.strstart-=Q,g.block_start-=Q,H=k=g.hash_size;b=g.head[--H],g.head[H]=Q<=b?b-Q:0,--k;);for(H=k=Q;b=g.prev[--H],g.prev[H]=Q<=b?b-Q:0,--k;);S+=Q}if(g.strm.avail_in===0)break;if(X=g.strm,Z=g.window,D=g.strstart+g.lookahead,j=S,tt=void 0,tt=X.avail_in,j<tt&&(tt=j),k=tt===0?0:(X.avail_in-=tt,r.arraySet(Z,X.input,X.next_in,tt,D),X.state.wrap===1?X.adler=a(X.adler,Z,tt,D):X.state.wrap===2&&(X.adler=l(X.adler,Z,tt,D)),X.next_in+=tt,X.total_in+=tt,tt),g.lookahead+=k,g.lookahead+g.insert>=N)for(x=g.strstart-g.insert,g.ins_h=g.window[x],g.ins_h=(g.ins_h<<g.hash_shift^g.window[x+1])&g.hash_mask;g.insert&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[x+N-1])&g.hash_mask,g.prev[x&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=x,x++,g.insert--,!(g.lookahead+g.insert<N)););}while(g.lookahead<z&&g.strm.avail_in!==0)}function Pt(g,H){for(var k,b;;){if(g.lookahead<z){if(_t(g),g.lookahead<z&&H===u)return C;if(g.lookahead===0)break}if(k=0,g.lookahead>=N&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+N-1])&g.hash_mask,k=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),k!==0&&g.strstart-k<=g.w_size-z&&(g.match_length=q(g,k)),g.match_length>=N)if(b=o._tr_tally(g,g.strstart-g.match_start,g.match_length-N),g.lookahead-=g.match_length,g.match_length<=g.max_lazy_match&&g.lookahead>=N){for(g.match_length--;g.strstart++,g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+N-1])&g.hash_mask,k=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart,--g.match_length!=0;);g.strstart++}else g.strstart+=g.match_length,g.match_length=0,g.ins_h=g.window[g.strstart],g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+1])&g.hash_mask;else b=o._tr_tally(g,0,g.window[g.strstart]),g.lookahead--,g.strstart++;if(b&&(U(g,!1),g.strm.avail_out===0))return C}return g.insert=g.strstart<N-1?g.strstart:N-1,H===d?(U(g,!0),g.strm.avail_out===0?$:Y):g.last_lit&&(U(g,!1),g.strm.avail_out===0)?C:v}function lt(g,H){for(var k,b,S;;){if(g.lookahead<z){if(_t(g),g.lookahead<z&&H===u)return C;if(g.lookahead===0)break}if(k=0,g.lookahead>=N&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+N-1])&g.hash_mask,k=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),g.prev_length=g.match_length,g.prev_match=g.match_start,g.match_length=N-1,k!==0&&g.prev_length<g.max_lazy_match&&g.strstart-k<=g.w_size-z&&(g.match_length=q(g,k),g.match_length<=5&&(g.strategy===1||g.match_length===N&&4096<g.strstart-g.match_start)&&(g.match_length=N-1)),g.prev_length>=N&&g.match_length<=g.prev_length){for(S=g.strstart+g.lookahead-N,b=o._tr_tally(g,g.strstart-1-g.prev_match,g.prev_length-N),g.lookahead-=g.prev_length-1,g.prev_length-=2;++g.strstart<=S&&(g.ins_h=(g.ins_h<<g.hash_shift^g.window[g.strstart+N-1])&g.hash_mask,k=g.prev[g.strstart&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=g.strstart),--g.prev_length!=0;);if(g.match_available=0,g.match_length=N-1,g.strstart++,b&&(U(g,!1),g.strm.avail_out===0))return C}else if(g.match_available){if((b=o._tr_tally(g,0,g.window[g.strstart-1]))&&U(g,!1),g.strstart++,g.lookahead--,g.strm.avail_out===0)return C}else g.match_available=1,g.strstart++,g.lookahead--}return g.match_available&&(b=o._tr_tally(g,0,g.window[g.strstart-1]),g.match_available=0),g.insert=g.strstart<N-1?g.strstart:N-1,H===d?(U(g,!0),g.strm.avail_out===0?$:Y):g.last_lit&&(U(g,!1),g.strm.avail_out===0)?C:v}function dt(g,H,k,b,S){this.good_length=g,this.max_lazy=H,this.nice_length=k,this.max_chain=b,this.func=S}function wt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*w),this.dyn_dtree=new r.Buf16(2*(2*R+1)),this.bl_tree=new r.Buf16(2*(2*F+1)),it(this.dyn_ltree),it(this.dyn_dtree),it(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(L+1),this.heap=new r.Buf16(2*T+1),it(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*T+1),it(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function At(g){var H;return g&&g.state?(g.total_in=g.total_out=0,g.data_type=E,(H=g.state).pending=0,H.pending_out=0,H.wrap<0&&(H.wrap=-H.wrap),H.status=H.wrap?O:P,g.adler=H.wrap===2?0:1,H.last_flush=u,o._tr_init(H),f):K(g,I)}function se(g){var H=At(g);return H===f&&function(k){k.window_size=2*k.w_size,it(k.head),k.max_lazy_match=n[k.level].max_lazy,k.good_match=n[k.level].good_length,k.nice_match=n[k.level].nice_length,k.max_chain_length=n[k.level].max_chain,k.strstart=0,k.block_start=0,k.lookahead=0,k.insert=0,k.match_length=k.prev_length=N-1,k.match_available=0,k.ins_h=0}(g.state),H}function $t(g,H,k,b,S,x){if(!g)return I;var X=1;if(H===p&&(H=6),b<0?(X=0,b=-b):15<b&&(X=2,b-=16),S<1||A<S||k!==_||b<8||15<b||H<0||9<H||x<0||m<x)return K(g,I);b===8&&(b=9);var Z=new wt;return(g.state=Z).strm=g,Z.wrap=X,Z.gzhead=null,Z.w_bits=b,Z.w_size=1<<Z.w_bits,Z.w_mask=Z.w_size-1,Z.hash_bits=S+7,Z.hash_size=1<<Z.hash_bits,Z.hash_mask=Z.hash_size-1,Z.hash_shift=~~((Z.hash_bits+N-1)/N),Z.window=new r.Buf8(2*Z.w_size),Z.head=new r.Buf16(Z.hash_size),Z.prev=new r.Buf16(Z.w_size),Z.lit_bufsize=1<<S+6,Z.pending_buf_size=4*Z.lit_bufsize,Z.pending_buf=new r.Buf8(Z.pending_buf_size),Z.d_buf=1*Z.lit_bufsize,Z.l_buf=3*Z.lit_bufsize,Z.level=H,Z.strategy=x,Z.method=k,se(g)}n=[new dt(0,0,0,0,function(g,H){var k=65535;for(k>g.pending_buf_size-5&&(k=g.pending_buf_size-5);;){if(g.lookahead<=1){if(_t(g),g.lookahead===0&&H===u)return C;if(g.lookahead===0)break}g.strstart+=g.lookahead,g.lookahead=0;var b=g.block_start+k;if((g.strstart===0||g.strstart>=b)&&(g.lookahead=g.strstart-b,g.strstart=b,U(g,!1),g.strm.avail_out===0)||g.strstart-g.block_start>=g.w_size-z&&(U(g,!1),g.strm.avail_out===0))return C}return g.insert=0,H===d?(U(g,!0),g.strm.avail_out===0?$:Y):(g.strstart>g.block_start&&(U(g,!1),g.strm.avail_out),C)}),new dt(4,4,8,4,Pt),new dt(4,5,16,8,Pt),new dt(4,6,32,32,Pt),new dt(4,4,16,16,lt),new dt(8,16,32,32,lt),new dt(8,16,128,128,lt),new dt(8,32,128,256,lt),new dt(32,128,258,1024,lt),new dt(32,258,258,4096,lt)],i.deflateInit=function(g,H){return $t(g,H,_,15,8,0)},i.deflateInit2=$t,i.deflateReset=se,i.deflateResetKeep=At,i.deflateSetHeader=function(g,H){return g&&g.state?g.state.wrap!==2?I:(g.state.gzhead=H,f):I},i.deflate=function(g,H){var k,b,S,x;if(!g||!g.state||5<H||H<0)return g?K(g,I):I;if(b=g.state,!g.output||!g.input&&g.avail_in!==0||b.status===666&&H!==d)return K(g,g.avail_out===0?-5:I);if(b.strm=g,k=b.last_flush,b.last_flush=H,b.status===O)if(b.wrap===2)g.adler=0,nt(b,31),nt(b,139),nt(b,8),b.gzhead?(nt(b,(b.gzhead.text?1:0)+(b.gzhead.hcrc?2:0)+(b.gzhead.extra?4:0)+(b.gzhead.name?8:0)+(b.gzhead.comment?16:0)),nt(b,255&b.gzhead.time),nt(b,b.gzhead.time>>8&255),nt(b,b.gzhead.time>>16&255),nt(b,b.gzhead.time>>24&255),nt(b,b.level===9?2:2<=b.strategy||b.level<2?4:0),nt(b,255&b.gzhead.os),b.gzhead.extra&&b.gzhead.extra.length&&(nt(b,255&b.gzhead.extra.length),nt(b,b.gzhead.extra.length>>8&255)),b.gzhead.hcrc&&(g.adler=l(g.adler,b.pending_buf,b.pending,0)),b.gzindex=0,b.status=69):(nt(b,0),nt(b,0),nt(b,0),nt(b,0),nt(b,0),nt(b,b.level===9?2:2<=b.strategy||b.level<2?4:0),nt(b,3),b.status=P);else{var X=_+(b.w_bits-8<<4)<<8;X|=(2<=b.strategy||b.level<2?0:b.level<6?1:b.level===6?2:3)<<6,b.strstart!==0&&(X|=32),X+=31-X%31,b.status=P,J(b,X),b.strstart!==0&&(J(b,g.adler>>>16),J(b,65535&g.adler)),g.adler=1}if(b.status===69)if(b.gzhead.extra){for(S=b.pending;b.gzindex<(65535&b.gzhead.extra.length)&&(b.pending!==b.pending_buf_size||(b.gzhead.hcrc&&b.pending>S&&(g.adler=l(g.adler,b.pending_buf,b.pending-S,S)),B(g),S=b.pending,b.pending!==b.pending_buf_size));)nt(b,255&b.gzhead.extra[b.gzindex]),b.gzindex++;b.gzhead.hcrc&&b.pending>S&&(g.adler=l(g.adler,b.pending_buf,b.pending-S,S)),b.gzindex===b.gzhead.extra.length&&(b.gzindex=0,b.status=73)}else b.status=73;if(b.status===73)if(b.gzhead.name){S=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>S&&(g.adler=l(g.adler,b.pending_buf,b.pending-S,S)),B(g),S=b.pending,b.pending===b.pending_buf_size)){x=1;break}x=b.gzindex<b.gzhead.name.length?255&b.gzhead.name.charCodeAt(b.gzindex++):0,nt(b,x)}while(x!==0);b.gzhead.hcrc&&b.pending>S&&(g.adler=l(g.adler,b.pending_buf,b.pending-S,S)),x===0&&(b.gzindex=0,b.status=91)}else b.status=91;if(b.status===91)if(b.gzhead.comment){S=b.pending;do{if(b.pending===b.pending_buf_size&&(b.gzhead.hcrc&&b.pending>S&&(g.adler=l(g.adler,b.pending_buf,b.pending-S,S)),B(g),S=b.pending,b.pending===b.pending_buf_size)){x=1;break}x=b.gzindex<b.gzhead.comment.length?255&b.gzhead.comment.charCodeAt(b.gzindex++):0,nt(b,x)}while(x!==0);b.gzhead.hcrc&&b.pending>S&&(g.adler=l(g.adler,b.pending_buf,b.pending-S,S)),x===0&&(b.status=103)}else b.status=103;if(b.status===103&&(b.gzhead.hcrc?(b.pending+2>b.pending_buf_size&&B(g),b.pending+2<=b.pending_buf_size&&(nt(b,255&g.adler),nt(b,g.adler>>8&255),g.adler=0,b.status=P)):b.status=P),b.pending!==0){if(B(g),g.avail_out===0)return b.last_flush=-1,f}else if(g.avail_in===0&&G(H)<=G(k)&&H!==d)return K(g,-5);if(b.status===666&&g.avail_in!==0)return K(g,-5);if(g.avail_in!==0||b.lookahead!==0||H!==u&&b.status!==666){var Z=b.strategy===2?function(D,j){for(var tt;;){if(D.lookahead===0&&(_t(D),D.lookahead===0)){if(j===u)return C;break}if(D.match_length=0,tt=o._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,tt&&(U(D,!1),D.strm.avail_out===0))return C}return D.insert=0,j===d?(U(D,!0),D.strm.avail_out===0?$:Y):D.last_lit&&(U(D,!1),D.strm.avail_out===0)?C:v}(b,H):b.strategy===3?function(D,j){for(var tt,Q,rt,Et,ht=D.window;;){if(D.lookahead<=M){if(_t(D),D.lookahead<=M&&j===u)return C;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=N&&0<D.strstart&&(Q=ht[rt=D.strstart-1])===ht[++rt]&&Q===ht[++rt]&&Q===ht[++rt]){Et=D.strstart+M;do;while(Q===ht[++rt]&&Q===ht[++rt]&&Q===ht[++rt]&&Q===ht[++rt]&&Q===ht[++rt]&&Q===ht[++rt]&&Q===ht[++rt]&&Q===ht[++rt]&&rt<Et);D.match_length=M-(Et-rt),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=N?(tt=o._tr_tally(D,1,D.match_length-N),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(tt=o._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),tt&&(U(D,!1),D.strm.avail_out===0))return C}return D.insert=0,j===d?(U(D,!0),D.strm.avail_out===0?$:Y):D.last_lit&&(U(D,!1),D.strm.avail_out===0)?C:v}(b,H):n[b.level].func(b,H);if(Z!==$&&Z!==Y||(b.status=666),Z===C||Z===$)return g.avail_out===0&&(b.last_flush=-1),f;if(Z===v&&(H===1?o._tr_align(b):H!==5&&(o._tr_stored_block(b,0,0,!1),H===3&&(it(b.head),b.lookahead===0&&(b.strstart=0,b.block_start=0,b.insert=0))),B(g),g.avail_out===0))return b.last_flush=-1,f}return H!==d?f:b.wrap<=0?1:(b.wrap===2?(nt(b,255&g.adler),nt(b,g.adler>>8&255),nt(b,g.adler>>16&255),nt(b,g.adler>>24&255),nt(b,255&g.total_in),nt(b,g.total_in>>8&255),nt(b,g.total_in>>16&255),nt(b,g.total_in>>24&255)):(J(b,g.adler>>>16),J(b,65535&g.adler)),B(g),0<b.wrap&&(b.wrap=-b.wrap),b.pending!==0?f:1)},i.deflateEnd=function(g){var H;return g&&g.state?(H=g.state.status)!==O&&H!==69&&H!==73&&H!==91&&H!==103&&H!==P&&H!==666?K(g,I):(g.state=null,H===P?K(g,-3):f):I},i.deflateSetDictionary=function(g,H){var k,b,S,x,X,Z,D,j,tt=H.length;if(!g||!g.state||(x=(k=g.state).wrap)===2||x===1&&k.status!==O||k.lookahead)return I;for(x===1&&(g.adler=a(g.adler,H,tt,0)),k.wrap=0,tt>=k.w_size&&(x===0&&(it(k.head),k.strstart=0,k.block_start=0,k.insert=0),j=new r.Buf8(k.w_size),r.arraySet(j,H,tt-k.w_size,k.w_size,0),H=j,tt=k.w_size),X=g.avail_in,Z=g.next_in,D=g.input,g.avail_in=tt,g.next_in=0,g.input=H,_t(k);k.lookahead>=N;){for(b=k.strstart,S=k.lookahead-(N-1);k.ins_h=(k.ins_h<<k.hash_shift^k.window[b+N-1])&k.hash_mask,k.prev[b&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=b,b++,--S;);k.strstart=b,k.lookahead=N-1,_t(k)}return k.strstart+=k.lookahead,k.block_start=k.strstart,k.insert=k.lookahead,k.lookahead=0,k.match_length=k.prev_length=N-1,k.match_available=0,g.next_in=Z,g.input=D,g.avail_in=X,k.wrap=x,f},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,i){s.exports=function(n,r){var o,a,l,h,u,d,f,I,p,m,E,_,A,T,R,F,w,L,N,M,z,O,P,C,v;o=n.state,a=n.next_in,C=n.input,l=a+(n.avail_in-5),h=n.next_out,v=n.output,u=h-(r-n.avail_out),d=h+(n.avail_out-257),f=o.dmax,I=o.wsize,p=o.whave,m=o.wnext,E=o.window,_=o.hold,A=o.bits,T=o.lencode,R=o.distcode,F=(1<<o.lenbits)-1,w=(1<<o.distbits)-1;t:do{A<15&&(_+=C[a++]<<A,A+=8,_+=C[a++]<<A,A+=8),L=T[_&F];e:for(;;){if(_>>>=N=L>>>24,A-=N,(N=L>>>16&255)===0)v[h++]=65535&L;else{if(!(16&N)){if(!(64&N)){L=T[(65535&L)+(_&(1<<N)-1)];continue e}if(32&N){o.mode=12;break t}n.msg="invalid literal/length code",o.mode=30;break t}M=65535&L,(N&=15)&&(A<N&&(_+=C[a++]<<A,A+=8),M+=_&(1<<N)-1,_>>>=N,A-=N),A<15&&(_+=C[a++]<<A,A+=8,_+=C[a++]<<A,A+=8),L=R[_&w];s:for(;;){if(_>>>=N=L>>>24,A-=N,!(16&(N=L>>>16&255))){if(!(64&N)){L=R[(65535&L)+(_&(1<<N)-1)];continue s}n.msg="invalid distance code",o.mode=30;break t}if(z=65535&L,A<(N&=15)&&(_+=C[a++]<<A,(A+=8)<N&&(_+=C[a++]<<A,A+=8)),f<(z+=_&(1<<N)-1)){n.msg="invalid distance too far back",o.mode=30;break t}if(_>>>=N,A-=N,(N=h-u)<z){if(p<(N=z-N)&&o.sane){n.msg="invalid distance too far back",o.mode=30;break t}if(P=E,(O=0)===m){if(O+=I-N,N<M){for(M-=N;v[h++]=E[O++],--N;);O=h-z,P=v}}else if(m<N){if(O+=I+m-N,(N-=m)<M){for(M-=N;v[h++]=E[O++],--N;);if(O=0,m<M){for(M-=N=m;v[h++]=E[O++],--N;);O=h-z,P=v}}}else if(O+=m-N,N<M){for(M-=N;v[h++]=E[O++],--N;);O=h-z,P=v}for(;2<M;)v[h++]=P[O++],v[h++]=P[O++],v[h++]=P[O++],M-=3;M&&(v[h++]=P[O++],1<M&&(v[h++]=P[O++]))}else{for(O=h-z;v[h++]=v[O++],v[h++]=v[O++],v[h++]=v[O++],2<(M-=3););M&&(v[h++]=v[O++],1<M&&(v[h++]=v[O++]))}break}}break}}while(a<l&&h<d);a-=M=A>>3,_&=(1<<(A-=M<<3))-1,n.next_in=a,n.next_out=h,n.avail_in=a<l?l-a+5:5-(a-l),n.avail_out=h<d?d-h+257:257-(h-d),o.hold=_,o.bits=A}},{}],49:[function(t,s,i){var n=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),a=t("./inffast"),l=t("./inftrees"),h=1,u=2,d=0,f=-2,I=1,p=852,m=592;function E(O){return(O>>>24&255)+(O>>>8&65280)+((65280&O)<<8)+((255&O)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(O){var P;return O&&O.state?(P=O.state,O.total_in=O.total_out=P.total=0,O.msg="",P.wrap&&(O.adler=1&P.wrap),P.mode=I,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new n.Buf32(p),P.distcode=P.distdyn=new n.Buf32(m),P.sane=1,P.back=-1,d):f}function T(O){var P;return O&&O.state?((P=O.state).wsize=0,P.whave=0,P.wnext=0,A(O)):f}function R(O,P){var C,v;return O&&O.state?(v=O.state,P<0?(C=0,P=-P):(C=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?f:(v.window!==null&&v.wbits!==P&&(v.window=null),v.wrap=C,v.wbits=P,T(O))):f}function F(O,P){var C,v;return O?(v=new _,(O.state=v).window=null,(C=R(O,P))!==d&&(O.state=null),C):f}var w,L,N=!0;function M(O){if(N){var P;for(w=new n.Buf32(512),L=new n.Buf32(32),P=0;P<144;)O.lens[P++]=8;for(;P<256;)O.lens[P++]=9;for(;P<280;)O.lens[P++]=7;for(;P<288;)O.lens[P++]=8;for(l(h,O.lens,0,288,w,0,O.work,{bits:9}),P=0;P<32;)O.lens[P++]=5;l(u,O.lens,0,32,L,0,O.work,{bits:5}),N=!1}O.lencode=w,O.lenbits=9,O.distcode=L,O.distbits=5}function z(O,P,C,v){var $,Y=O.state;return Y.window===null&&(Y.wsize=1<<Y.wbits,Y.wnext=0,Y.whave=0,Y.window=new n.Buf8(Y.wsize)),v>=Y.wsize?(n.arraySet(Y.window,P,C-Y.wsize,Y.wsize,0),Y.wnext=0,Y.whave=Y.wsize):(v<($=Y.wsize-Y.wnext)&&($=v),n.arraySet(Y.window,P,C-v,$,Y.wnext),(v-=$)?(n.arraySet(Y.window,P,C-v,v,0),Y.wnext=v,Y.whave=Y.wsize):(Y.wnext+=$,Y.wnext===Y.wsize&&(Y.wnext=0),Y.whave<Y.wsize&&(Y.whave+=$))),0}i.inflateReset=T,i.inflateReset2=R,i.inflateResetKeep=A,i.inflateInit=function(O){return F(O,15)},i.inflateInit2=F,i.inflate=function(O,P){var C,v,$,Y,K,G,it,B,U,nt,J,q,_t,Pt,lt,dt,wt,At,se,$t,g,H,k,b,S=0,x=new n.Buf8(4),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!O||!O.state||!O.output||!O.input&&O.avail_in!==0)return f;(C=O.state).mode===12&&(C.mode=13),K=O.next_out,$=O.output,it=O.avail_out,Y=O.next_in,v=O.input,G=O.avail_in,B=C.hold,U=C.bits,nt=G,J=it,H=d;t:for(;;)switch(C.mode){case I:if(C.wrap===0){C.mode=13;break}for(;U<16;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(2&C.wrap&&B===35615){x[C.check=0]=255&B,x[1]=B>>>8&255,C.check=o(C.check,x,2,0),U=B=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&B)<<8)+(B>>8))%31){O.msg="incorrect header check",C.mode=30;break}if((15&B)!=8){O.msg="unknown compression method",C.mode=30;break}if(U-=4,g=8+(15&(B>>>=4)),C.wbits===0)C.wbits=g;else if(g>C.wbits){O.msg="invalid window size",C.mode=30;break}C.dmax=1<<g,O.adler=C.check=1,C.mode=512&B?10:12,U=B=0;break;case 2:for(;U<16;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(C.flags=B,(255&C.flags)!=8){O.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){O.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=B>>8&1),512&C.flags&&(x[0]=255&B,x[1]=B>>>8&255,C.check=o(C.check,x,2,0)),U=B=0,C.mode=3;case 3:for(;U<32;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}C.head&&(C.head.time=B),512&C.flags&&(x[0]=255&B,x[1]=B>>>8&255,x[2]=B>>>16&255,x[3]=B>>>24&255,C.check=o(C.check,x,4,0)),U=B=0,C.mode=4;case 4:for(;U<16;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}C.head&&(C.head.xflags=255&B,C.head.os=B>>8),512&C.flags&&(x[0]=255&B,x[1]=B>>>8&255,C.check=o(C.check,x,2,0)),U=B=0,C.mode=5;case 5:if(1024&C.flags){for(;U<16;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}C.length=B,C.head&&(C.head.extra_len=B),512&C.flags&&(x[0]=255&B,x[1]=B>>>8&255,C.check=o(C.check,x,2,0)),U=B=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(G<(q=C.length)&&(q=G),q&&(C.head&&(g=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),n.arraySet(C.head.extra,v,Y,q,g)),512&C.flags&&(C.check=o(C.check,v,q,Y)),G-=q,Y+=q,C.length-=q),C.length))break t;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(G===0)break t;for(q=0;g=v[Y+q++],C.head&&g&&C.length<65536&&(C.head.name+=String.fromCharCode(g)),g&&q<G;);if(512&C.flags&&(C.check=o(C.check,v,q,Y)),G-=q,Y+=q,g)break t}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(G===0)break t;for(q=0;g=v[Y+q++],C.head&&g&&C.length<65536&&(C.head.comment+=String.fromCharCode(g)),g&&q<G;);if(512&C.flags&&(C.check=o(C.check,v,q,Y)),G-=q,Y+=q,g)break t}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;U<16;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(B!==(65535&C.check)){O.msg="header crc mismatch",C.mode=30;break}U=B=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),O.adler=C.check=0,C.mode=12;break;case 10:for(;U<32;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}O.adler=C.check=E(B),U=B=0,C.mode=11;case 11:if(C.havedict===0)return O.next_out=K,O.avail_out=it,O.next_in=Y,O.avail_in=G,C.hold=B,C.bits=U,2;O.adler=C.check=1,C.mode=12;case 12:if(P===5||P===6)break t;case 13:if(C.last){B>>>=7&U,U-=7&U,C.mode=27;break}for(;U<3;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}switch(C.last=1&B,U-=1,3&(B>>>=1)){case 0:C.mode=14;break;case 1:if(M(C),C.mode=20,P!==6)break;B>>>=2,U-=2;break t;case 2:C.mode=17;break;case 3:O.msg="invalid block type",C.mode=30}B>>>=2,U-=2;break;case 14:for(B>>>=7&U,U-=7&U;U<32;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if((65535&B)!=(B>>>16^65535)){O.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&B,U=B=0,C.mode=15,P===6)break t;case 15:C.mode=16;case 16:if(q=C.length){if(G<q&&(q=G),it<q&&(q=it),q===0)break t;n.arraySet($,v,Y,q,K),G-=q,Y+=q,it-=q,K+=q,C.length-=q;break}C.mode=12;break;case 17:for(;U<14;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(C.nlen=257+(31&B),B>>>=5,U-=5,C.ndist=1+(31&B),B>>>=5,U-=5,C.ncode=4+(15&B),B>>>=4,U-=4,286<C.nlen||30<C.ndist){O.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;U<3;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}C.lens[X[C.have++]]=7&B,B>>>=3,U-=3}for(;C.have<19;)C.lens[X[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,k={bits:C.lenbits},H=l(0,C.lens,0,19,C.lencode,0,C.work,k),C.lenbits=k.bits,H){O.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;dt=(S=C.lencode[B&(1<<C.lenbits)-1])>>>16&255,wt=65535&S,!((lt=S>>>24)<=U);){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(wt<16)B>>>=lt,U-=lt,C.lens[C.have++]=wt;else{if(wt===16){for(b=lt+2;U<b;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(B>>>=lt,U-=lt,C.have===0){O.msg="invalid bit length repeat",C.mode=30;break}g=C.lens[C.have-1],q=3+(3&B),B>>>=2,U-=2}else if(wt===17){for(b=lt+3;U<b;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}U-=lt,g=0,q=3+(7&(B>>>=lt)),B>>>=3,U-=3}else{for(b=lt+7;U<b;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}U-=lt,g=0,q=11+(127&(B>>>=lt)),B>>>=7,U-=7}if(C.have+q>C.nlen+C.ndist){O.msg="invalid bit length repeat",C.mode=30;break}for(;q--;)C.lens[C.have++]=g}}if(C.mode===30)break;if(C.lens[256]===0){O.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,k={bits:C.lenbits},H=l(h,C.lens,0,C.nlen,C.lencode,0,C.work,k),C.lenbits=k.bits,H){O.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,k={bits:C.distbits},H=l(u,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,k),C.distbits=k.bits,H){O.msg="invalid distances set",C.mode=30;break}if(C.mode=20,P===6)break t;case 20:C.mode=21;case 21:if(6<=G&&258<=it){O.next_out=K,O.avail_out=it,O.next_in=Y,O.avail_in=G,C.hold=B,C.bits=U,a(O,J),K=O.next_out,$=O.output,it=O.avail_out,Y=O.next_in,v=O.input,G=O.avail_in,B=C.hold,U=C.bits,C.mode===12&&(C.back=-1);break}for(C.back=0;dt=(S=C.lencode[B&(1<<C.lenbits)-1])>>>16&255,wt=65535&S,!((lt=S>>>24)<=U);){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(dt&&!(240&dt)){for(At=lt,se=dt,$t=wt;dt=(S=C.lencode[$t+((B&(1<<At+se)-1)>>At)])>>>16&255,wt=65535&S,!(At+(lt=S>>>24)<=U);){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}B>>>=At,U-=At,C.back+=At}if(B>>>=lt,U-=lt,C.back+=lt,C.length=wt,dt===0){C.mode=26;break}if(32&dt){C.back=-1,C.mode=12;break}if(64&dt){O.msg="invalid literal/length code",C.mode=30;break}C.extra=15&dt,C.mode=22;case 22:if(C.extra){for(b=C.extra;U<b;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}C.length+=B&(1<<C.extra)-1,B>>>=C.extra,U-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;dt=(S=C.distcode[B&(1<<C.distbits)-1])>>>16&255,wt=65535&S,!((lt=S>>>24)<=U);){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(!(240&dt)){for(At=lt,se=dt,$t=wt;dt=(S=C.distcode[$t+((B&(1<<At+se)-1)>>At)])>>>16&255,wt=65535&S,!(At+(lt=S>>>24)<=U);){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}B>>>=At,U-=At,C.back+=At}if(B>>>=lt,U-=lt,C.back+=lt,64&dt){O.msg="invalid distance code",C.mode=30;break}C.offset=wt,C.extra=15&dt,C.mode=24;case 24:if(C.extra){for(b=C.extra;U<b;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}C.offset+=B&(1<<C.extra)-1,B>>>=C.extra,U-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){O.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(it===0)break t;if(q=J-it,C.offset>q){if((q=C.offset-q)>C.whave&&C.sane){O.msg="invalid distance too far back",C.mode=30;break}_t=q>C.wnext?(q-=C.wnext,C.wsize-q):C.wnext-q,q>C.length&&(q=C.length),Pt=C.window}else Pt=$,_t=K-C.offset,q=C.length;for(it<q&&(q=it),it-=q,C.length-=q;$[K++]=Pt[_t++],--q;);C.length===0&&(C.mode=21);break;case 26:if(it===0)break t;$[K++]=C.length,it--,C.mode=21;break;case 27:if(C.wrap){for(;U<32;){if(G===0)break t;G--,B|=v[Y++]<<U,U+=8}if(J-=it,O.total_out+=J,C.total+=J,J&&(O.adler=C.check=C.flags?o(C.check,$,J,K-J):r(C.check,$,J,K-J)),J=it,(C.flags?B:E(B))!==C.check){O.msg="incorrect data check",C.mode=30;break}U=B=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;U<32;){if(G===0)break t;G--,B+=v[Y++]<<U,U+=8}if(B!==(4294967295&C.total)){O.msg="incorrect length check",C.mode=30;break}U=B=0}C.mode=29;case 29:H=1;break t;case 30:H=-3;break t;case 31:return-4;case 32:default:return f}return O.next_out=K,O.avail_out=it,O.next_in=Y,O.avail_in=G,C.hold=B,C.bits=U,(C.wsize||J!==O.avail_out&&C.mode<30&&(C.mode<27||P!==4))&&z(O,O.output,O.next_out,J-O.avail_out)?(C.mode=31,-4):(nt-=O.avail_in,J-=O.avail_out,O.total_in+=nt,O.total_out+=J,C.total+=J,C.wrap&&J&&(O.adler=C.check=C.flags?o(C.check,$,J,O.next_out-J):r(C.check,$,J,O.next_out-J)),O.data_type=C.bits+(C.last?64:0)+(C.mode===12?128:0)+(C.mode===20||C.mode===15?256:0),(nt==0&&J===0||P===4)&&H===d&&(H=-5),H)},i.inflateEnd=function(O){if(!O||!O.state)return f;var P=O.state;return P.window&&(P.window=null),O.state=null,d},i.inflateGetHeader=function(O,P){var C;return O&&O.state&&2&(C=O.state).wrap?((C.head=P).done=!1,d):f},i.inflateSetDictionary=function(O,P){var C,v=P.length;return O&&O.state?(C=O.state).wrap!==0&&C.mode!==11?f:C.mode===11&&r(1,P,v,0)!==C.check?-3:z(O,P,v,v)?(C.mode=31,-4):(C.havedict=1,d):f},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,i){var n=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(h,u,d,f,I,p,m,E){var _,A,T,R,F,w,L,N,M,z=E.bits,O=0,P=0,C=0,v=0,$=0,Y=0,K=0,G=0,it=0,B=0,U=null,nt=0,J=new n.Buf16(16),q=new n.Buf16(16),_t=null,Pt=0;for(O=0;O<=15;O++)J[O]=0;for(P=0;P<f;P++)J[u[d+P]]++;for($=z,v=15;1<=v&&J[v]===0;v--);if(v<$&&($=v),v===0)return I[p++]=20971520,I[p++]=20971520,E.bits=1,0;for(C=1;C<v&&J[C]===0;C++);for($<C&&($=C),O=G=1;O<=15;O++)if(G<<=1,(G-=J[O])<0)return-1;if(0<G&&(h===0||v!==1))return-1;for(q[1]=0,O=1;O<15;O++)q[O+1]=q[O]+J[O];for(P=0;P<f;P++)u[d+P]!==0&&(m[q[u[d+P]]++]=P);if(w=h===0?(U=_t=m,19):h===1?(U=r,nt-=257,_t=o,Pt-=257,256):(U=a,_t=l,-1),O=C,F=p,K=P=B=0,T=-1,R=(it=1<<(Y=$))-1,h===1&&852<it||h===2&&592<it)return 1;for(;;){for(L=O-K,M=m[P]<w?(N=0,m[P]):m[P]>w?(N=_t[Pt+m[P]],U[nt+m[P]]):(N=96,0),_=1<<O-K,C=A=1<<Y;I[F+(B>>K)+(A-=_)]=L<<24|N<<16|M|0,A!==0;);for(_=1<<O-1;B&_;)_>>=1;if(_!==0?(B&=_-1,B+=_):B=0,P++,--J[O]==0){if(O===v)break;O=u[d+m[P]]}if($<O&&(B&R)!==T){for(K===0&&(K=$),F+=C,G=1<<(Y=O-K);Y+K<v&&!((G-=J[Y+K])<=0);)Y++,G<<=1;if(it+=1<<Y,h===1&&852<it||h===2&&592<it)return 1;I[T=B&R]=$<<24|Y<<16|F-p|0}}return B!==0&&(I[F+B]=O-K<<24|64<<16|0),E.bits=$,0}},{"../utils/common":41}],51:[function(t,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,i){var n=t("../utils/common"),r=0,o=1;function a(S){for(var x=S.length;0<=--x;)S[x]=0}var l=0,h=29,u=256,d=u+1+h,f=30,I=19,p=2*d+1,m=15,E=16,_=7,A=256,T=16,R=17,F=18,w=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=new Array(2*(d+2));a(z);var O=new Array(2*f);a(O);var P=new Array(512);a(P);var C=new Array(256);a(C);var v=new Array(h);a(v);var $,Y,K,G=new Array(f);function it(S,x,X,Z,D){this.static_tree=S,this.extra_bits=x,this.extra_base=X,this.elems=Z,this.max_length=D,this.has_stree=S&&S.length}function B(S,x){this.dyn_tree=S,this.max_code=0,this.stat_desc=x}function U(S){return S<256?P[S]:P[256+(S>>>7)]}function nt(S,x){S.pending_buf[S.pending++]=255&x,S.pending_buf[S.pending++]=x>>>8&255}function J(S,x,X){S.bi_valid>E-X?(S.bi_buf|=x<<S.bi_valid&65535,nt(S,S.bi_buf),S.bi_buf=x>>E-S.bi_valid,S.bi_valid+=X-E):(S.bi_buf|=x<<S.bi_valid&65535,S.bi_valid+=X)}function q(S,x,X){J(S,X[2*x],X[2*x+1])}function _t(S,x){for(var X=0;X|=1&S,S>>>=1,X<<=1,0<--x;);return X>>>1}function Pt(S,x,X){var Z,D,j=new Array(m+1),tt=0;for(Z=1;Z<=m;Z++)j[Z]=tt=tt+X[Z-1]<<1;for(D=0;D<=x;D++){var Q=S[2*D+1];Q!==0&&(S[2*D]=_t(j[Q]++,Q))}}function lt(S){var x;for(x=0;x<d;x++)S.dyn_ltree[2*x]=0;for(x=0;x<f;x++)S.dyn_dtree[2*x]=0;for(x=0;x<I;x++)S.bl_tree[2*x]=0;S.dyn_ltree[2*A]=1,S.opt_len=S.static_len=0,S.last_lit=S.matches=0}function dt(S){8<S.bi_valid?nt(S,S.bi_buf):0<S.bi_valid&&(S.pending_buf[S.pending++]=S.bi_buf),S.bi_buf=0,S.bi_valid=0}function wt(S,x,X,Z){var D=2*x,j=2*X;return S[D]<S[j]||S[D]===S[j]&&Z[x]<=Z[X]}function At(S,x,X){for(var Z=S.heap[X],D=X<<1;D<=S.heap_len&&(D<S.heap_len&&wt(x,S.heap[D+1],S.heap[D],S.depth)&&D++,!wt(x,Z,S.heap[D],S.depth));)S.heap[X]=S.heap[D],X=D,D<<=1;S.heap[X]=Z}function se(S,x,X){var Z,D,j,tt,Q=0;if(S.last_lit!==0)for(;Z=S.pending_buf[S.d_buf+2*Q]<<8|S.pending_buf[S.d_buf+2*Q+1],D=S.pending_buf[S.l_buf+Q],Q++,Z===0?q(S,D,x):(q(S,(j=C[D])+u+1,x),(tt=w[j])!==0&&J(S,D-=v[j],tt),q(S,j=U(--Z),X),(tt=L[j])!==0&&J(S,Z-=G[j],tt)),Q<S.last_lit;);q(S,A,x)}function $t(S,x){var X,Z,D,j=x.dyn_tree,tt=x.stat_desc.static_tree,Q=x.stat_desc.has_stree,rt=x.stat_desc.elems,Et=-1;for(S.heap_len=0,S.heap_max=p,X=0;X<rt;X++)j[2*X]!==0?(S.heap[++S.heap_len]=Et=X,S.depth[X]=0):j[2*X+1]=0;for(;S.heap_len<2;)j[2*(D=S.heap[++S.heap_len]=Et<2?++Et:0)]=1,S.depth[D]=0,S.opt_len--,Q&&(S.static_len-=tt[2*D+1]);for(x.max_code=Et,X=S.heap_len>>1;1<=X;X--)At(S,j,X);for(D=rt;X=S.heap[1],S.heap[1]=S.heap[S.heap_len--],At(S,j,1),Z=S.heap[1],S.heap[--S.heap_max]=X,S.heap[--S.heap_max]=Z,j[2*D]=j[2*X]+j[2*Z],S.depth[D]=(S.depth[X]>=S.depth[Z]?S.depth[X]:S.depth[Z])+1,j[2*X+1]=j[2*Z+1]=D,S.heap[1]=D++,At(S,j,1),2<=S.heap_len;);S.heap[--S.heap_max]=S.heap[1],function(ht,Vt){var Ke,ie,Je,Rt,Ps,Si,ce=Vt.dyn_tree,kn=Vt.max_code,to=Vt.stat_desc.static_tree,eo=Vt.stat_desc.has_stree,so=Vt.stat_desc.extra_bits,zn=Vt.stat_desc.extra_base,ts=Vt.stat_desc.max_length,Ls=0;for(Rt=0;Rt<=m;Rt++)ht.bl_count[Rt]=0;for(ce[2*ht.heap[ht.heap_max]+1]=0,Ke=ht.heap_max+1;Ke<p;Ke++)ts<(Rt=ce[2*ce[2*(ie=ht.heap[Ke])+1]+1]+1)&&(Rt=ts,Ls++),ce[2*ie+1]=Rt,kn<ie||(ht.bl_count[Rt]++,Ps=0,zn<=ie&&(Ps=so[ie-zn]),Si=ce[2*ie],ht.opt_len+=Si*(Rt+Ps),eo&&(ht.static_len+=Si*(to[2*ie+1]+Ps)));if(Ls!==0){do{for(Rt=ts-1;ht.bl_count[Rt]===0;)Rt--;ht.bl_count[Rt]--,ht.bl_count[Rt+1]+=2,ht.bl_count[ts]--,Ls-=2}while(0<Ls);for(Rt=ts;Rt!==0;Rt--)for(ie=ht.bl_count[Rt];ie!==0;)kn<(Je=ht.heap[--Ke])||(ce[2*Je+1]!==Rt&&(ht.opt_len+=(Rt-ce[2*Je+1])*ce[2*Je],ce[2*Je+1]=Rt),ie--)}}(S,x),Pt(j,Et,S.bl_count)}function g(S,x,X){var Z,D,j=-1,tt=x[1],Q=0,rt=7,Et=4;for(tt===0&&(rt=138,Et=3),x[2*(X+1)+1]=65535,Z=0;Z<=X;Z++)D=tt,tt=x[2*(Z+1)+1],++Q<rt&&D===tt||(Q<Et?S.bl_tree[2*D]+=Q:D!==0?(D!==j&&S.bl_tree[2*D]++,S.bl_tree[2*T]++):Q<=10?S.bl_tree[2*R]++:S.bl_tree[2*F]++,j=D,Et=(Q=0)===tt?(rt=138,3):D===tt?(rt=6,3):(rt=7,4))}function H(S,x,X){var Z,D,j=-1,tt=x[1],Q=0,rt=7,Et=4;for(tt===0&&(rt=138,Et=3),Z=0;Z<=X;Z++)if(D=tt,tt=x[2*(Z+1)+1],!(++Q<rt&&D===tt)){if(Q<Et)for(;q(S,D,S.bl_tree),--Q!=0;);else D!==0?(D!==j&&(q(S,D,S.bl_tree),Q--),q(S,T,S.bl_tree),J(S,Q-3,2)):Q<=10?(q(S,R,S.bl_tree),J(S,Q-3,3)):(q(S,F,S.bl_tree),J(S,Q-11,7));j=D,Et=(Q=0)===tt?(rt=138,3):D===tt?(rt=6,3):(rt=7,4)}}a(G);var k=!1;function b(S,x,X,Z){J(S,(l<<1)+(Z?1:0),3),function(D,j,tt,Q){dt(D),nt(D,tt),nt(D,~tt),n.arraySet(D.pending_buf,D.window,j,tt,D.pending),D.pending+=tt}(S,x,X)}i._tr_init=function(S){k||(function(){var x,X,Z,D,j,tt=new Array(m+1);for(D=Z=0;D<h-1;D++)for(v[D]=Z,x=0;x<1<<w[D];x++)C[Z++]=D;for(C[Z-1]=D,D=j=0;D<16;D++)for(G[D]=j,x=0;x<1<<L[D];x++)P[j++]=D;for(j>>=7;D<f;D++)for(G[D]=j<<7,x=0;x<1<<L[D]-7;x++)P[256+j++]=D;for(X=0;X<=m;X++)tt[X]=0;for(x=0;x<=143;)z[2*x+1]=8,x++,tt[8]++;for(;x<=255;)z[2*x+1]=9,x++,tt[9]++;for(;x<=279;)z[2*x+1]=7,x++,tt[7]++;for(;x<=287;)z[2*x+1]=8,x++,tt[8]++;for(Pt(z,d+1,tt),x=0;x<f;x++)O[2*x+1]=5,O[2*x]=_t(x,5);$=new it(z,w,u+1,d,m),Y=new it(O,L,0,f,m),K=new it(new Array(0),N,0,I,_)}(),k=!0),S.l_desc=new B(S.dyn_ltree,$),S.d_desc=new B(S.dyn_dtree,Y),S.bl_desc=new B(S.bl_tree,K),S.bi_buf=0,S.bi_valid=0,lt(S)},i._tr_stored_block=b,i._tr_flush_block=function(S,x,X,Z){var D,j,tt=0;0<S.level?(S.strm.data_type===2&&(S.strm.data_type=function(Q){var rt,Et=4093624447;for(rt=0;rt<=31;rt++,Et>>>=1)if(1&Et&&Q.dyn_ltree[2*rt]!==0)return r;if(Q.dyn_ltree[18]!==0||Q.dyn_ltree[20]!==0||Q.dyn_ltree[26]!==0)return o;for(rt=32;rt<u;rt++)if(Q.dyn_ltree[2*rt]!==0)return o;return r}(S)),$t(S,S.l_desc),$t(S,S.d_desc),tt=function(Q){var rt;for(g(Q,Q.dyn_ltree,Q.l_desc.max_code),g(Q,Q.dyn_dtree,Q.d_desc.max_code),$t(Q,Q.bl_desc),rt=I-1;3<=rt&&Q.bl_tree[2*M[rt]+1]===0;rt--);return Q.opt_len+=3*(rt+1)+5+5+4,rt}(S),D=S.opt_len+3+7>>>3,(j=S.static_len+3+7>>>3)<=D&&(D=j)):D=j=X+5,X+4<=D&&x!==-1?b(S,x,X,Z):S.strategy===4||j===D?(J(S,2+(Z?1:0),3),se(S,z,O)):(J(S,4+(Z?1:0),3),function(Q,rt,Et,ht){var Vt;for(J(Q,rt-257,5),J(Q,Et-1,5),J(Q,ht-4,4),Vt=0;Vt<ht;Vt++)J(Q,Q.bl_tree[2*M[Vt]+1],3);H(Q,Q.dyn_ltree,rt-1),H(Q,Q.dyn_dtree,Et-1)}(S,S.l_desc.max_code+1,S.d_desc.max_code+1,tt+1),se(S,S.dyn_ltree,S.dyn_dtree)),lt(S),Z&&dt(S)},i._tr_tally=function(S,x,X){return S.pending_buf[S.d_buf+2*S.last_lit]=x>>>8&255,S.pending_buf[S.d_buf+2*S.last_lit+1]=255&x,S.pending_buf[S.l_buf+S.last_lit]=255&X,S.last_lit++,x===0?S.dyn_ltree[2*X]++:(S.matches++,x--,S.dyn_ltree[2*(C[X]+u+1)]++,S.dyn_dtree[2*U(x)]++),S.last_lit===S.lit_bufsize-1},i._tr_align=function(S){J(S,2,3),q(S,A,z),function(x){x.bi_valid===16?(nt(x,x.bi_buf),x.bi_buf=0,x.bi_valid=0):8<=x.bi_valid&&(x.pending_buf[x.pending++]=255&x.bi_buf,x.bi_buf>>=8,x.bi_valid-=8)}(S)}},{"../utils/common":41}],53:[function(t,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,i){(function(n){(function(r,o){if(!r.setImmediate){var a,l,h,u,d=1,f={},I=!1,p=r.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(r);m=m&&m.setTimeout?m:r,a={}.toString.call(r.process)==="[object process]"?function(T){process.nextTick(function(){_(T)})}:function(){if(r.postMessage&&!r.importScripts){var T=!0,R=r.onmessage;return r.onmessage=function(){T=!1},r.postMessage("","*"),r.onmessage=R,T}}()?(u="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",A,!1):r.attachEvent("onmessage",A),function(T){r.postMessage(u+T,"*")}):r.MessageChannel?((h=new MessageChannel).port1.onmessage=function(T){_(T.data)},function(T){h.port2.postMessage(T)}):p&&"onreadystatechange"in p.createElement("script")?(l=p.documentElement,function(T){var R=p.createElement("script");R.onreadystatechange=function(){_(T),R.onreadystatechange=null,l.removeChild(R),R=null},l.appendChild(R)}):function(T){setTimeout(_,0,T)},m.setImmediate=function(T){typeof T!="function"&&(T=new Function(""+T));for(var R=new Array(arguments.length-1),F=0;F<R.length;F++)R[F]=arguments[F+1];var w={callback:T,args:R};return f[d]=w,a(d),d++},m.clearImmediate=E}function E(T){delete f[T]}function _(T){if(I)setTimeout(_,0,T);else{var R=f[T];if(R){I=!0;try{(function(F){var w=F.callback,L=F.args;switch(L.length){case 0:w();break;case 1:w(L[0]);break;case 2:w(L[0],L[1]);break;case 3:w(L[0],L[1],L[2]);break;default:w.apply(o,L)}})(R)}finally{E(T),I=!1}}}}function A(T){T.source===r&&typeof T.data=="string"&&T.data.indexOf(u)===0&&_(+T.data.slice(u.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof vs<"u"?vs:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Xr);var Fc=Xr.exports;const Fr=Uo(Fc);var Dn={},Fi={};(function(c){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s="["+e+"]["+t+"]*",i=new RegExp("^"+s+"$"),n=function(o,a){const l=[];let h=a.exec(o);for(;h;){const u=[];u.startIndex=a.lastIndex-h[0].length;const d=h.length;for(let f=0;f<d;f++)u.push(h[f]);l.push(u),h=a.exec(o)}return l},r=function(o){const a=i.exec(o);return!(a===null||typeof a>"u")};c.isExist=function(o){return typeof o<"u"},c.isEmptyObject=function(o){return Object.keys(o).length===0},c.merge=function(o,a,l){if(a){const h=Object.keys(a),u=h.length;for(let d=0;d<u;d++)l==="strict"?o[h[d]]=[a[h[d]]]:o[h[d]]=a[h[d]]}},c.getValue=function(o){return c.isExist(o)?o:""},c.isName=r,c.getAllMatches=n,c.nameRegexp=s})(Fi);const Un=Fi,Sc={allowBooleanAttributes:!1,unpairedTags:[]};Dn.validate=function(c,e){e=Object.assign({},Sc,e);const t=[];let s=!1,i=!1;c[0]==="\uFEFF"&&(c=c.substr(1));for(let n=0;n<c.length;n++)if(c[n]==="<"&&c[n+1]==="?"){if(n+=2,n=wr(c,n),n.err)return n}else if(c[n]==="<"){let r=n;if(n++,c[n]==="!"){n=Nr(c,n);continue}else{let o=!1;c[n]==="/"&&(o=!0,n++);let a="";for(;n<c.length&&c[n]!==">"&&c[n]!==" "&&c[n]!=="	"&&c[n]!==`
`&&c[n]!=="\r";n++)a+=c[n];if(a=a.trim(),a[a.length-1]==="/"&&(a=a.substring(0,a.length-1),n--),!xc(a)){let u;return a.trim().length===0?u="Invalid space after '<'.":u="Tag '"+a+"' is an invalid name.",Ot("InvalidTag",u,Dt(c,n))}const l=bc(c,n);if(l===!1)return Ot("InvalidAttr","Attributes for '"+a+"' have open quote.",Dt(c,n));let h=l.value;if(n=l.index,h[h.length-1]==="/"){const u=n-h.length;h=h.substring(0,h.length-1);const d=br(h,e);if(d===!0)s=!0;else return Ot(d.err.code,d.err.msg,Dt(c,u+d.err.line))}else if(o)if(l.tagClosed){if(h.trim().length>0)return Ot("InvalidTag","Closing tag '"+a+"' can't have attributes or invalid starting.",Dt(c,r));if(t.length===0)return Ot("InvalidTag","Closing tag '"+a+"' has not been opened.",Dt(c,r));{const u=t.pop();if(a!==u.tagName){let d=Dt(c,u.tagStartPos);return Ot("InvalidTag","Expected closing tag '"+u.tagName+"' (opened in line "+d.line+", col "+d.col+") instead of closing tag '"+a+"'.",Dt(c,r))}t.length==0&&(i=!0)}}else return Ot("InvalidTag","Closing tag '"+a+"' doesn't have proper closing.",Dt(c,n));else{const u=br(h,e);if(u!==!0)return Ot(u.err.code,u.err.msg,Dt(c,n-h.length+u.err.line));if(i===!0)return Ot("InvalidXml","Multiple possible root nodes found.",Dt(c,n));e.unpairedTags.indexOf(a)!==-1||t.push({tagName:a,tagStartPos:r}),s=!0}for(n++;n<c.length;n++)if(c[n]==="<")if(c[n+1]==="!"){n++,n=Nr(c,n);continue}else if(c[n+1]==="?"){if(n=wr(c,++n),n.err)return n}else break;else if(c[n]==="&"){const u=Mc(c,n);if(u==-1)return Ot("InvalidChar","char '&' is not expected.",Dt(c,n));n=u}else if(i===!0&&!Sr(c[n]))return Ot("InvalidXml","Extra text at the end",Dt(c,n));c[n]==="<"&&n--}}else{if(Sr(c[n]))continue;return Ot("InvalidChar","char '"+c[n]+"' is not expected.",Dt(c,n))}if(s){if(t.length==1)return Ot("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",Dt(c,t[0].tagStartPos));if(t.length>0)return Ot("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Ot("InvalidXml","Start tag expected.",1);return!0};function Sr(c){return c===" "||c==="	"||c===`
`||c==="\r"}function wr(c,e){const t=e;for(;e<c.length;e++)if(c[e]=="?"||c[e]==" "){const s=c.substr(t,e-t);if(e>5&&s==="xml")return Ot("InvalidXml","XML declaration allowed only at the start of the document.",Dt(c,e));if(c[e]=="?"&&c[e+1]==">"){e++;break}else continue}return e}function Nr(c,e){if(c.length>e+5&&c[e+1]==="-"&&c[e+2]==="-"){for(e+=3;e<c.length;e++)if(c[e]==="-"&&c[e+1]==="-"&&c[e+2]===">"){e+=2;break}}else if(c.length>e+8&&c[e+1]==="D"&&c[e+2]==="O"&&c[e+3]==="C"&&c[e+4]==="T"&&c[e+5]==="Y"&&c[e+6]==="P"&&c[e+7]==="E"){let t=1;for(e+=8;e<c.length;e++)if(c[e]==="<")t++;else if(c[e]===">"&&(t--,t===0))break}else if(c.length>e+9&&c[e+1]==="["&&c[e+2]==="C"&&c[e+3]==="D"&&c[e+4]==="A"&&c[e+5]==="T"&&c[e+6]==="A"&&c[e+7]==="["){for(e+=8;e<c.length;e++)if(c[e]==="]"&&c[e+1]==="]"&&c[e+2]===">"){e+=2;break}}return e}const wc='"',Nc="'";function bc(c,e){let t="",s="",i=!1;for(;e<c.length;e++){if(c[e]===wc||c[e]===Nc)s===""?s=c[e]:s!==c[e]||(s="");else if(c[e]===">"&&s===""){i=!0;break}t+=c[e]}return s!==""?!1:{value:t,index:e,tagClosed:i}}const Pc=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function br(c,e){const t=Un.getAllMatches(c,Pc),s={};for(let i=0;i<t.length;i++){if(t[i][1].length===0)return Ot("InvalidAttr","Attribute '"+t[i][2]+"' has no space in starting.",Es(t[i]));if(t[i][3]!==void 0&&t[i][4]===void 0)return Ot("InvalidAttr","Attribute '"+t[i][2]+"' is without value.",Es(t[i]));if(t[i][3]===void 0&&!e.allowBooleanAttributes)return Ot("InvalidAttr","boolean attribute '"+t[i][2]+"' is not allowed.",Es(t[i]));const n=t[i][2];if(!vc(n))return Ot("InvalidAttr","Attribute '"+n+"' is an invalid name.",Es(t[i]));if(!s.hasOwnProperty(n))s[n]=1;else return Ot("InvalidAttr","Attribute '"+n+"' is repeated.",Es(t[i]))}return!0}function Lc(c,e){let t=/\d/;for(c[e]==="x"&&(e++,t=/[\da-fA-F]/);e<c.length;e++){if(c[e]===";")return e;if(!c[e].match(t))break}return-1}function Mc(c,e){if(e++,c[e]===";")return-1;if(c[e]==="#")return e++,Lc(c,e);let t=0;for(;e<c.length;e++,t++)if(!(c[e].match(/\w/)&&t<20)){if(c[e]===";")break;return-1}return e}function Ot(c,e,t){return{err:{code:c,msg:e,line:t.line||t,col:t.col}}}function vc(c){return Un.isName(c)}function xc(c){return Un.isName(c)}function Dt(c,e){const t=c.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function Es(c){return c.startIndex+c[1].length}var Bn={};const Zr={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(c,e){return e},attributeValueProcessor:function(c,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(c,e,t){return c}},Dc=function(c){return Object.assign({},Zr,c)};Bn.buildOptions=Dc;Bn.defaultOptions=Zr;class Uc{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var Bc=Uc;const kc=Fi;function zc(c,e){const t={};if(c[e+3]==="O"&&c[e+4]==="C"&&c[e+5]==="T"&&c[e+6]==="Y"&&c[e+7]==="P"&&c[e+8]==="E"){e=e+9;let s=1,i=!1,n=!1,r="";for(;e<c.length;e++)if(c[e]==="<"&&!n){if(i&&Gc(c,e))e+=7,[entityName,val,e]=Yc(c,e+1),val.indexOf("&")===-1&&(t[Zc(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(i&&Hc(c,e))e+=8;else if(i&&Wc(c,e))e+=8;else if(i&&Xc(c,e))e+=9;else if(Vc)n=!0;else throw new Error("Invalid DOCTYPE");s++,r=""}else if(c[e]===">"){if(n?c[e-1]==="-"&&c[e-2]==="-"&&(n=!1,s--):s--,s===0)break}else c[e]==="["?i=!0:r+=c[e];if(s!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function Yc(c,e){let t="";for(;e<c.length&&c[e]!=="'"&&c[e]!=='"';e++)t+=c[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const s=c[e++];let i="";for(;e<c.length&&c[e]!==s;e++)i+=c[e];return[t,i,e]}function Vc(c,e){return c[e+1]==="!"&&c[e+2]==="-"&&c[e+3]==="-"}function Gc(c,e){return c[e+1]==="!"&&c[e+2]==="E"&&c[e+3]==="N"&&c[e+4]==="T"&&c[e+5]==="I"&&c[e+6]==="T"&&c[e+7]==="Y"}function Hc(c,e){return c[e+1]==="!"&&c[e+2]==="E"&&c[e+3]==="L"&&c[e+4]==="E"&&c[e+5]==="M"&&c[e+6]==="E"&&c[e+7]==="N"&&c[e+8]==="T"}function Wc(c,e){return c[e+1]==="!"&&c[e+2]==="A"&&c[e+3]==="T"&&c[e+4]==="T"&&c[e+5]==="L"&&c[e+6]==="I"&&c[e+7]==="S"&&c[e+8]==="T"}function Xc(c,e){return c[e+1]==="!"&&c[e+2]==="N"&&c[e+3]==="O"&&c[e+4]==="T"&&c[e+5]==="A"&&c[e+6]==="T"&&c[e+7]==="I"&&c[e+8]==="O"&&c[e+9]==="N"}function Zc(c){if(kc.isName(c))return c;throw new Error(`Invalid entity name ${c}`)}var $c=zc;const jc=/^[-+]?0x[a-fA-F0-9]+$/,Qc=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const qc={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function Kc(c,e={}){if(e=Object.assign({},qc,e),!c||typeof c!="string")return c;let t=c.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return c;if(e.hex&&jc.test(t))return Number.parseInt(t,16);{const s=Qc.exec(t);if(s){const i=s[1],n=s[2];let r=Jc(s[3]);const o=s[4]||s[6];if(!e.leadingZeros&&n.length>0&&i&&t[2]!==".")return c;if(!e.leadingZeros&&n.length>0&&!i&&t[1]!==".")return c;{const a=Number(t),l=""+a;return l.search(/[eE]/)!==-1||o?e.eNotation?a:c:t.indexOf(".")!==-1?l==="0"&&r===""||l===r||i&&l==="-"+r?a:c:n?r===l||i+r===l?a:c:t===l||t===i+l?a:c}}else return c}}function Jc(c){return c&&c.indexOf(".")!==-1&&(c=c.replace(/0+$/,""),c==="."?c="0":c[0]==="."?c="0"+c:c[c.length-1]==="."&&(c=c.substr(0,c.length-1))),c}var tl=Kc;const $r=Fi,Is=Bc,el=$c,sl=tl;let il=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t,s)=>String.fromCharCode(Number.parseInt(s,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t,s)=>String.fromCharCode(Number.parseInt(s,16))}},this.addExternalEntities=nl,this.parseXml=ll,this.parseTextData=rl,this.resolveNameSpace=ol,this.buildAttributesMap=cl,this.isItStopNode=fl,this.replaceEntitiesValue=ul,this.readStopNodeData=El,this.saveTextToParentTag=dl,this.addChild=hl}};function nl(c){const e=Object.keys(c);for(let t=0;t<e.length;t++){const s=e[t];this.lastEntities[s]={regex:new RegExp("&"+s+";","g"),val:c[s]}}}function rl(c,e,t,s,i,n,r){if(c!==void 0&&(this.options.trimValues&&!s&&(c=c.trim()),c.length>0)){r||(c=this.replaceEntitiesValue(c));const o=this.options.tagValueProcessor(e,c,t,i,n);return o==null?c:typeof o!=typeof c||o!==c?o:this.options.trimValues?hn(c,this.options.parseTagValue,this.options.numberParseOptions):c.trim()===c?hn(c,this.options.parseTagValue,this.options.numberParseOptions):c}}function ol(c){if(this.options.removeNSPrefix){const e=c.split(":"),t=c.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(c=t+e[1])}return c}const al=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function cl(c,e,t){if(!this.options.ignoreAttributes&&typeof c=="string"){const s=$r.getAllMatches(c,al),i=s.length,n={};for(let r=0;r<i;r++){const o=this.resolveNameSpace(s[r][1]);let a=s[r][4],l=this.options.attributeNamePrefix+o;if(o.length)if(this.options.transformAttributeName&&(l=this.options.transformAttributeName(l)),l==="__proto__"&&(l="#__proto__"),a!==void 0){this.options.trimValues&&(a=a.trim()),a=this.replaceEntitiesValue(a);const h=this.options.attributeValueProcessor(o,a,e);h==null?n[l]=a:typeof h!=typeof a||h!==a?n[l]=h:n[l]=hn(a,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[l]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=n,r}return n}}const ll=function(c){c=c.replace(/\r\n?/g,`
`);const e=new Is("!xml");let t=e,s="",i="";for(let n=0;n<c.length;n++)if(c[n]==="<")if(c[n+1]==="/"){const o=be(c,">",n,"Closing Tag is not closed.");let a=c.substring(n+2,o).trim();if(this.options.removeNSPrefix){const u=a.indexOf(":");u!==-1&&(a=a.substr(u+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),t&&(s=this.saveTextToParentTag(s,t,i));const l=i.substring(i.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let h=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(h=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):h=i.lastIndexOf("."),i=i.substring(0,h),t=this.tagsNodeStack.pop(),s="",n=o}else if(c[n+1]==="?"){let o=ln(c,n,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(s=this.saveTextToParentTag(s,t,i),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const a=new Is(o.tagName);a.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(a[":@"]=this.buildAttributesMap(o.tagExp,i,o.tagName)),this.addChild(t,a,i)}n=o.closeIndex+1}else if(c.substr(n+1,3)==="!--"){const o=be(c,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const a=c.substring(n+4,o-2);s=this.saveTextToParentTag(s,t,i),t.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}n=o}else if(c.substr(n+1,2)==="!D"){const o=el(c,n);this.docTypeEntities=o.entities,n=o.i}else if(c.substr(n+1,2)==="!["){const o=be(c,"]]>",n,"CDATA is not closed.")-2,a=c.substring(n+9,o);s=this.saveTextToParentTag(s,t,i);let l=this.parseTextData(a,t.tagname,i,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):t.add(this.options.textNodeName,l),n=o+2}else{let o=ln(c,n,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let h=o.tagExp,u=o.attrExpPresent,d=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),t&&s&&t.tagname!=="!xml"&&(s=this.saveTextToParentTag(s,t,i,!1));const f=t;if(f&&this.options.unpairedTags.indexOf(f.tagname)!==-1&&(t=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),a!==e.tagname&&(i+=i?"."+a:a),this.isItStopNode(this.options.stopNodes,i,a)){let I="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),i=i.substr(0,i.length-1),h=a):h=h.substr(0,h.length-1),n=o.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)n=o.closeIndex;else{const m=this.readStopNodeData(c,l,d+1);if(!m)throw new Error(`Unexpected end of ${l}`);n=m.i,I=m.tagContent}const p=new Is(a);a!==h&&u&&(p[":@"]=this.buildAttributesMap(h,i,a)),I&&(I=this.parseTextData(I,a,i,!0,u,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),p.add(this.options.textNodeName,I),this.addChild(t,p,i)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),i=i.substr(0,i.length-1),h=a):h=h.substr(0,h.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const I=new Is(a);a!==h&&u&&(I[":@"]=this.buildAttributesMap(h,i,a)),this.addChild(t,I,i),i=i.substr(0,i.lastIndexOf("."))}else{const I=new Is(a);this.tagsNodeStack.push(t),a!==h&&u&&(I[":@"]=this.buildAttributesMap(h,i,a)),this.addChild(t,I,i),t=I}s="",n=d}}else s+=c[n];return e.child};function hl(c,e,t){const s=this.options.updateTag(e.tagname,t,e[":@"]);s===!1||(typeof s=="string"&&(e.tagname=s),c.addChild(e))}const ul=function(c){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];c=c.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];c=c.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];c=c.replace(t.regex,t.val)}c=c.replace(this.ampEntity.regex,this.ampEntity.val)}return c};function dl(c,e,t,s){return c&&(s===void 0&&(s=Object.keys(e.child).length===0),c=this.parseTextData(c,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,s),c!==void 0&&c!==""&&e.add(this.options.textNodeName,c),c=""),c}function fl(c,e,t){const s="*."+t;for(const i in c){const n=c[i];if(s===n||e===n)return!0}return!1}function pl(c,e,t=">"){let s,i="";for(let n=e;n<c.length;n++){let r=c[n];if(s)r===s&&(s="");else if(r==='"'||r==="'")s=r;else if(r===t[0])if(t[1]){if(c[n+1]===t[1])return{data:i,index:n}}else return{data:i,index:n};else r==="	"&&(r=" ");i+=r}}function be(c,e,t,s){const i=c.indexOf(e,t);if(i===-1)throw new Error(s);return i+e.length-1}function ln(c,e,t,s=">"){const i=pl(c,e+1,s);if(!i)return;let n=i.data;const r=i.index,o=n.search(/\s/);let a=n,l=!0;o!==-1&&(a=n.substring(0,o),n=n.substring(o+1).trimStart());const h=a;if(t){const u=a.indexOf(":");u!==-1&&(a=a.substr(u+1),l=a!==i.data.substr(u+1))}return{tagName:a,tagExp:n,closeIndex:r,attrExpPresent:l,rawTagName:h}}function El(c,e,t){const s=t;let i=1;for(;t<c.length;t++)if(c[t]==="<")if(c[t+1]==="/"){const n=be(c,">",t,`${e} is not closed`);if(c.substring(t+2,n).trim()===e&&(i--,i===0))return{tagContent:c.substring(s,t),i:n};t=n}else if(c[t+1]==="?")t=be(c,"?>",t+1,"StopNode is not closed.");else if(c.substr(t+1,3)==="!--")t=be(c,"-->",t+3,"StopNode is not closed.");else if(c.substr(t+1,2)==="![")t=be(c,"]]>",t,"StopNode is not closed.")-2;else{const n=ln(c,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&i++,t=n.closeIndex)}}function hn(c,e,t){if(e&&typeof c=="string"){const s=c.trim();return s==="true"?!0:s==="false"?!1:sl(c,t)}else return $r.isExist(c)?c:""}var Il=il,jr={};function ml(c,e){return Qr(c,e)}function Qr(c,e,t){let s;const i={};for(let n=0;n<c.length;n++){const r=c[n],o=Cl(r);let a="";if(t===void 0?a=o:a=t+"."+o,o===e.textNodeName)s===void 0?s=r[o]:s+=""+r[o];else{if(o===void 0)continue;if(r[o]){let l=Qr(r[o],e,a);const h=Tl(l,e);r[":@"]?gl(l,r[":@"],a,e):Object.keys(l).length===1&&l[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?l=l[e.textNodeName]:Object.keys(l).length===0&&(e.alwaysCreateTextNode?l[e.textNodeName]="":l=""),i[o]!==void 0&&i.hasOwnProperty(o)?(Array.isArray(i[o])||(i[o]=[i[o]]),i[o].push(l)):e.isArray(o,a,h)?i[o]=[l]:i[o]=l}}}return typeof s=="string"?s.length>0&&(i[e.textNodeName]=s):s!==void 0&&(i[e.textNodeName]=s),i}function Cl(c){const e=Object.keys(c);for(let t=0;t<e.length;t++){const s=e[t];if(s!==":@")return s}}function gl(c,e,t,s){if(e){const i=Object.keys(e),n=i.length;for(let r=0;r<n;r++){const o=i[r];s.isArray(o,t+"."+o,!0,!0)?c[o]=[e[o]]:c[o]=e[o]}}}function Tl(c,e){const{textNodeName:t}=e,s=Object.keys(c).length;return!!(s===0||s===1&&(c[t]||typeof c[t]=="boolean"||c[t]===0))}jr.prettify=ml;const{buildOptions:_l}=Bn,Al=Il,{prettify:Rl}=jr,yl=Dn;let Ol=class{constructor(e){this.externalEntities={},this.options=_l(e)}parse(e,t){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(t){t===!0&&(t={});const n=yl.validate(e,t);if(n!==!0)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const s=new Al(this.options);s.addExternalEntities(this.externalEntities);const i=s.parseXml(e);return this.options.preserveOrder||i===void 0?i:Rl(i,this.options)}addEntity(e,t){if(t.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(t==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}};var Fl=Ol;const Sl=`
`;function wl(c,e){let t="";return e.format&&e.indentBy.length>0&&(t=Sl),qr(c,e,"",t)}function qr(c,e,t,s){let i="",n=!1;for(let r=0;r<c.length;r++){const o=c[r],a=Nl(o);if(a===void 0)continue;let l="";if(t.length===0?l=a:l=`${t}.${a}`,a===e.textNodeName){let I=o[a];bl(l,e)||(I=e.tagValueProcessor(a,I),I=Kr(I,e)),n&&(i+=s),i+=I,n=!1;continue}else if(a===e.cdataPropName){n&&(i+=s),i+=`<![CDATA[${o[a][0][e.textNodeName]}]]>`,n=!1;continue}else if(a===e.commentPropName){i+=s+`<!--${o[a][0][e.textNodeName]}-->`,n=!0;continue}else if(a[0]==="?"){const I=Pr(o[":@"],e),p=a==="?xml"?"":s;let m=o[a][0][e.textNodeName];m=m.length!==0?" "+m:"",i+=p+`<${a}${m}${I}?>`,n=!0;continue}let h=s;h!==""&&(h+=e.indentBy);const u=Pr(o[":@"],e),d=s+`<${a}${u}`,f=qr(o[a],e,l,h);e.unpairedTags.indexOf(a)!==-1?e.suppressUnpairedNode?i+=d+">":i+=d+"/>":(!f||f.length===0)&&e.suppressEmptyNode?i+=d+"/>":f&&f.endsWith(">")?i+=d+`>${f}${s}</${a}>`:(i+=d+">",f&&s!==""&&(f.includes("/>")||f.includes("</"))?i+=s+e.indentBy+f+s:i+=f,i+=`</${a}>`),n=!0}return i}function Nl(c){const e=Object.keys(c);for(let t=0;t<e.length;t++){const s=e[t];if(c.hasOwnProperty(s)&&s!==":@")return s}}function Pr(c,e){let t="";if(c&&!e.ignoreAttributes)for(let s in c){if(!c.hasOwnProperty(s))continue;let i=e.attributeValueProcessor(s,c[s]);i=Kr(i,e),i===!0&&e.suppressBooleanAttributes?t+=` ${s.substr(e.attributeNamePrefix.length)}`:t+=` ${s.substr(e.attributeNamePrefix.length)}="${i}"`}return t}function bl(c,e){c=c.substr(0,c.length-e.textNodeName.length-1);let t=c.substr(c.lastIndexOf(".")+1);for(let s in e.stopNodes)if(e.stopNodes[s]===c||e.stopNodes[s]==="*."+t)return!0;return!1}function Kr(c,e){if(c&&c.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const s=e.entities[t];c=c.replace(s.regex,s.val)}return c}var Pl=wl;const Ll=Pl,Ml={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(c,e){return e},attributeValueProcessor:function(c,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ye(c){this.options=Object.assign({},Ml,c),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Dl),this.processTextOrObjNode=vl,this.options.format?(this.indentate=xl,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ye.prototype.build=function(c){return this.options.preserveOrder?Ll(c,this.options):(Array.isArray(c)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(c={[this.options.arrayNodeName]:c}),this.j2x(c,0).val)};ye.prototype.j2x=function(c,e){let t="",s="";for(let i in c)if(Object.prototype.hasOwnProperty.call(c,i))if(typeof c[i]>"u")this.isAttribute(i)&&(s+="");else if(c[i]===null)this.isAttribute(i)?s+="":i[0]==="?"?s+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(c[i]instanceof Date)s+=this.buildTextValNode(c[i],i,"",e);else if(typeof c[i]!="object"){const n=this.isAttribute(i);if(n)t+=this.buildAttrPairStr(n,""+c[i]);else if(i===this.options.textNodeName){let r=this.options.tagValueProcessor(i,""+c[i]);s+=this.replaceEntitiesValue(r)}else s+=this.buildTextValNode(c[i],i,"",e)}else if(Array.isArray(c[i])){const n=c[i].length;let r="",o="";for(let a=0;a<n;a++){const l=c[i][a];if(!(typeof l>"u"))if(l===null)i[0]==="?"?s+=this.indentate(e)+"<"+i+"?"+this.tagEndChar:s+=this.indentate(e)+"<"+i+"/"+this.tagEndChar;else if(typeof l=="object")if(this.options.oneListGroup){const h=this.j2x(l,e+1);r+=h.val,this.options.attributesGroupName&&l.hasOwnProperty(this.options.attributesGroupName)&&(o+=h.attrStr)}else r+=this.processTextOrObjNode(l,i,e);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(i,l);h=this.replaceEntitiesValue(h),r+=h}else r+=this.buildTextValNode(l,i,"",e)}this.options.oneListGroup&&(r=this.buildObjectNode(r,i,o,e)),s+=r}else if(this.options.attributesGroupName&&i===this.options.attributesGroupName){const n=Object.keys(c[i]),r=n.length;for(let o=0;o<r;o++)t+=this.buildAttrPairStr(n[o],""+c[i][n[o]])}else s+=this.processTextOrObjNode(c[i],i,e);return{attrStr:t,val:s}};ye.prototype.buildAttrPairStr=function(c,e){return e=this.options.attributeValueProcessor(c,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+c:" "+c+'="'+e+'"'};function vl(c,e,t){const s=this.j2x(c,t+1);return c[this.options.textNodeName]!==void 0&&Object.keys(c).length===1?this.buildTextValNode(c[this.options.textNodeName],e,s.attrStr,t):this.buildObjectNode(s.val,e,s.attrStr,t)}ye.prototype.buildObjectNode=function(c,e,t,s){if(c==="")return e[0]==="?"?this.indentate(s)+"<"+e+t+"?"+this.tagEndChar:this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let i="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",i=""),(t||t==="")&&c.indexOf("<")===-1?this.indentate(s)+"<"+e+t+n+">"+c+i:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(s)+`<!--${c}-->`+this.newLine:this.indentate(s)+"<"+e+t+n+this.tagEndChar+c+this.indentate(s)+i}};ye.prototype.closeTag=function(c){let e="";return this.options.unpairedTags.indexOf(c)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${c}`,e};ye.prototype.buildTextValNode=function(c,e,t,s){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(s)+`<![CDATA[${c}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(s)+`<!--${c}-->`+this.newLine;if(e[0]==="?")return this.indentate(s)+"<"+e+t+"?"+this.tagEndChar;{let i=this.options.tagValueProcessor(e,c);return i=this.replaceEntitiesValue(i),i===""?this.indentate(s)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(s)+"<"+e+t+">"+i+"</"+e+this.tagEndChar}};ye.prototype.replaceEntitiesValue=function(c){if(c&&c.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];c=c.replace(t.regex,t.val)}return c};function xl(c){return this.options.indentBy.repeat(c)}function Dl(c){return c.startsWith(this.options.attributeNamePrefix)&&c!==this.options.textNodeName?c.substr(this.attrPrefixLen):!1}var Ul=ye;const Bl=Dn,kl=Fl,zl=Ul;var Yl={XMLParser:kl,XMLValidator:Bl,XMLBuilder:zl};class un{constructor(e,t){y(this,"date",new Date);y(this,"author");y(this,"guid",pe.create());y(this,"viewpoint");y(this,"modifiedAuthor");y(this,"modifiedDate");y(this,"topic");y(this,"_components");y(this,"_comment","");this._components=e,this._comment=t;const s=this._components.get(bt);this.author=s.config.author}set comment(e){var s;const t=this._components.get(bt);this._comment=e,this.modifiedDate=new Date,this.modifiedAuthor=t.config.author,(s=this.topic)==null||s.comments.set(this.guid,this)}get comment(){return this._comment}serialize(){let e=null;this.viewpoint&&(e=`<Viewpoint Guid="${this.viewpoint.guid}"/>`);let t=null;this.modifiedDate&&(t=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let s=null;return this.modifiedAuthor&&(s=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`),`
      <Comment Guid="${this.guid}">
        <Date>${this.date.toISOString()}</Date>
        <Author>${this.author}</Author>
        <Comment>${this.comment}</Comment>
        ${e??""}
        ${s??""}
        ${t??""}
      </Comment>
    `}}const ae=class ae{constructor(e){y(this,"guid",pe.create());y(this,"title",ae.default.title);y(this,"creationDate",new Date);y(this,"creationAuthor","");y(this,"viewpoints",new Xe);y(this,"relatedTopics",new Xe);y(this,"comments",new fe);y(this,"customData",{});y(this,"description");y(this,"serverAssignedId");y(this,"dueDate");y(this,"modifiedAuthor");y(this,"modifiedDate");y(this,"index");y(this,"_type",ae.default.type);y(this,"_status",ae.default.status);y(this,"_priority",ae.default.priority);y(this,"_stage",ae.default.priority);y(this,"_assignedTo",ae.default.assignedTo);y(this,"_labels",ae.default.labels);y(this,"_components");this._components=e;const t=e.get(bt);this.creationAuthor=t.config.author,this.relatedTopics.guard=s=>s!==this.guid}set type(e){const t=this._components.get(bt),{strict:s,types:i}=t.config;(!s||i.has(e))&&(this._type=e)}get type(){return this._type}set status(e){const t=this._components.get(bt),{strict:s,statuses:i}=t.config;(!s||i.has(e))&&(this._status=e)}get status(){return this._status}set priority(e){const t=this._components.get(bt);if(e){const{strict:s,priorities:i}=t.config;if(!(s?i.has(e):!0))return;this._priority=e}else this._priority=e}get priority(){return this._priority}set stage(e){const t=this._components.get(bt);if(e){const{strict:s,stages:i}=t.config;if(!(s?i.has(e):!0))return;this._stage=e}else this._stage=e}get stage(){return this._stage}set assignedTo(e){const t=this._components.get(bt);if(e){const{strict:s,users:i}=t.config;if(!(s?i.has(e):!0))return;this._assignedTo=e}else this._assignedTo=e}get assignedTo(){return this._assignedTo}set labels(e){const t=this._components.get(bt),{strict:s,labels:i}=t.config;if(s){const n=new Set;for(const r of e)(!s||i.has(r))&&n.add(r);this._labels=n}else this._labels=e}get labels(){return this._labels}get _managerVersion(){return this._components.get(bt).config.version}set(e){const t=e,s=this;for(const n in e){if(n==="guid")continue;const r=t[n];n in this&&(s[n]=r)}return this._components.get(bt).list.set(this.guid,this),this}createComment(e,t){const s=new un(this._components,e);return s.viewpoint=t,s.topic=this,this.comments.set(s.guid,s),s}createLabelTags(e=this._managerVersion){let t="Labels";e==="2.1"&&(t="Labels"),e==="3"&&(t="Label");let s=[...this.labels].map(i=>`<${t}>${i}</${t}>`).join(`
`);for(const i in this.customData){const n=this.customData[i];typeof n=="string"&&(s+=`
<${t}>${n}</${t}>`)}return e==="2.1"?s:e==="3"?s.length!==0?`<Labels>
${s}
</Labels>`:"<Labels/>":s}createCommentTags(e=this._managerVersion){const t=[...this.comments.values()].map(s=>s.serialize()).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<Comments>
${t}
</Comments>`:"<Comments/>":t}createViewpointTags(e=this._managerVersion){let t="Viewpoints";e==="2.1"&&(t="Viewpoints"),e==="3"&&(t="ViewPoint");const s=this._components.get(te),n=[...this.viewpoints].map(r=>s.list.get(r)).filter(r=>r).map(r=>`<${t} Guid="${r.guid}">
          <Viewpoint>${r.guid}.bcfv</Viewpoint>
          <Snapshot>${r.guid}.jpeg</Snapshot>
        </${t}>
      `).join(`
`);return e==="2.1"?n:e==="3"?n.length!==0?`<Viewpoints>
${n}
</Viewpoints>`:"<Viewpoints />":n}createRelatedTopicTags(e=this._managerVersion){const t=[...this.relatedTopics].map(s=>`<RelatedTopic Guid="${s}"></RelatedTopic>
      `).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<RelatedTopics>
${t}
</RelatedTopics>`:"<RelatedTopics />":t}serialize(){const e=this._managerVersion;let t=null;this.serverAssignedId&&(t=`ServerAssignedId="${this.serverAssignedId}"`);let s=null;this.priority&&(s=`<Priority>${this.priority}</Priority>`);let i=null;this.index&&e==="2.1"&&(i=`<Index>${this.index}</Index>`);let n=null;this.modifiedDate&&(n=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let r=null;this.modifiedAuthor&&(r=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`);let o=null;this.dueDate&&(o=`<DueDate>${this.dueDate.toISOString()}</DueDate>`);let a=null;this.assignedTo&&(a=`<AssignedTo>${this.assignedTo}</AssignedTo>`);let l=null;this.description&&(l=`<Description>${this.description}</Description>`);let h=null;this.stage&&(h=`<Stage>${this.stage}</Stage>`);const u=this.createCommentTags(e),d=this.createViewpointTags(e),f=this.createLabelTags(e),I=this.createRelatedTopicTags(e);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Markup>
        <Topic Guid="${this.guid}" TopicType="${this.type}" TopicStatus="${this.status}" ${t??""}>
          <Title>${this.title}</Title>
          <CreationDate>${this.creationDate.toISOString()}</CreationDate>
          <CreationAuthor>${this.creationAuthor}</CreationAuthor>
          ${s??""}
          ${i??""}
          ${n??""}
          ${r??""}
          ${o??""}
          ${a??""}
          ${l??""}
          ${h??""}
          ${f}
          ${I}
          ${e==="3"?u:""}
          ${e==="3"?d:""}
        </Topic>
        ${e==="2.1"?u:""}
        ${e==="2.1"?d:""}
      </Markup>
    `}};y(ae,"default",{title:"BCF Topic",type:"Issue",status:"Active",labels:new Set});let hi=ae;const Vl=(c,e)=>{if(e.trim()==="")return;const t=bt.xmlParser.parse(e).Extensions;if(!t)return;const{Priorities:s,TopicStatuses:i,TopicTypes:n,Users:r}=t;if(s&&s.Priority){const o=Array.isArray(s.Priority)?s.Priority:[s.Priority];for(const a of o)c.config.priorities.add(a)}if(i&&i.TopicStatus){const o=Array.isArray(i.TopicStatus)?i.TopicStatus:[i.TopicStatus];for(const a of o)c.config.statuses.add(a)}if(n&&n.TopicType){const o=Array.isArray(n.TopicType)?n.TopicType:[n.TopicType];for(const a of o)c.config.types.add(a)}if(r&&r.User){const o=Array.isArray(r.User)?r.User:[r.User];for(const a of o)c.config.users.add(a)}},Ne=class Ne extends Bt{constructor(){super(...arguments);y(this,"enabled",!1);y(this,"config",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1});y(this,"list",new fe);y(this,"onSetup",new st);y(this,"isSetup",!1);y(this,"onBCFImported",new st);y(this,"onDisposed",new st)}setup(t){this.isSetup||(this.config={...this.config,...t},this.isSetup=!0,this.enabled=!0,this.onSetup.trigger())}create(t){const s=new hi(this.components);return t&&(s.guid=t.guid??s.guid,s.set(t)),this.list.set(s.guid,s),s}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){const t=[...this.list].map(([s,i])=>i.type);return new Set(t)}get usedStatuses(){const t=[...this.list].map(([s,i])=>i.status);return new Set(t)}get usedPriorities(){const t=[...this.list].map(([s,i])=>i.priority).filter(s=>s);return new Set(t)}get usedStages(){const t=[...this.list].map(([s,i])=>i.stage).filter(s=>s);return new Set(t)}get usedUsers(){const t=[];for(const[s,i]of this.list){t.push(i.creationAuthor),i.assignedTo&&t.push(i.assignedTo),i.modifiedAuthor&&t.push(i.modifiedAuthor);for(const[n,r]of i.comments)t.push(r.author),r.modifiedAuthor&&t.push(r.modifiedAuthor)}return new Set(t)}get usedLabels(){const t=[];for(const[s,i]of this.list)t.push(...i.labels);return new Set(t)}updateExtensions(){for(const[t,s]of this.list){for(const i of s.labels)this.config.labels.add(i);this.config.types.add(s.type),s.priority&&this.config.priorities.add(s.priority),s.stage&&this.config.stages.add(s.stage),this.config.statuses.add(s.status),this.config.users.add(s.creationAuthor),s.assignedTo&&this.config.users.add(s.assignedTo),s.modifiedAuthor&&this.config.users.add(s.modifiedAuthor);for(const[i,n]of s.comments)this.config.users.add(n.author),n.modifiedAuthor&&this.config.users.add(n.modifiedAuthor)}}updateViewpointReferences(){const t=this.components.get(te);for(const[s,i]of this.list)for(const n of i.viewpoints)t.list.has(n)||i.viewpoints.delete(n)}async export(t=this.list.values()){const s=new Fr;s.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`),s.file("bcf.extensions",this.serializeExtensions());const n=await(await fetch("https://thatopen.github.io/engine_components/resources/favicon.ico")).blob(),r=this.components.get(te);for(const a of t){const l=s.folder(a.guid);l.file("markup.bcf",a.serialize());for(const h of a.viewpoints){const u=r.list.get(h);u&&(l.file(`${h}.jpeg`,n,{binary:!0}),l.file(`${h}.bcfv`,await u.serialize()))}}return await s.generateAsync({type:"blob"})}serializeExtensions(){const t=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),s=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),i=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),n=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${t.length!==0?`<TopicTypes>
${t}
</TopicTypes>`:""}
        ${s.length!==0?`<TopicStatuses>
${s}
</TopicStatuses>`:""}
        ${i.length!==0?`<Priorities>
${i}
</Priorities>`:""}
        ${n.length!==0?`<TopicLabels>
${n}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(t){const{Guid:s,Date:i,Author:n,Comment:r,Viewpoint:o}=t;if(!(s&&i&&n&&(un||o)))return null;const a=this.components.get(te),l=new un(this.components,r??"");return l.guid=s,l.date=new Date(i),l.author=n,l.viewpoint=o!=null&&o.Guid?a.list.get(o.Guid):void 0,l.modifiedAuthor=t.ModifiedAuthor,l.modifiedDate=t.ModifiedDate?new Date(t.ModifiedDate):void 0,l}getMarkupComments(t,s){var o;let i;if(s==="2.1"&&(i=t.Comment),s==="3"&&(i=(o=t.Topic.Comments)==null?void 0:o.Comment),!i)return[];i=Array.isArray(i)?i:[i];const n=i.map(a=>this.processMarkupComment(a)).filter(a=>a);return Array.isArray(n)?n:[n]}getMarkupLabels(t,s){var r;let i;return s==="2.1"&&(i=t.Topic.Labels),s==="3"&&(i=(r=t.Topic.Labels)==null?void 0:r.Label),i?Array.isArray(i)?i:[i]:[]}getMarkupViewpoints(t,s){var n;let i;return s==="2.1"&&(i=t.Viewpoints),s==="3"&&(i=(n=t.Topic.Viewpoints)==null?void 0:n.ViewPoint),i?(i=Array.isArray(i)?i:[i],i):[]}getMarkupRelatedTopics(t,s){var r;let i;return s==="2.1"&&(i=t.Topic.RelatedTopic),s==="3"&&(i=(r=t.Topic.RelatedTopics)==null?void 0:r.RelatedTopic),i?(Array.isArray(i)?i:[i]).map(o=>o.Guid):[]}async load(t,s){var _;const{fallbackVersionOnImport:i,ignoreIncompleteTopicsOnImport:n,updateExtensionsOnImport:r}=this.config,o=new Fr;await o.loadAsync(t);const a=Object.values(o.files);let l=i;const h=a.find(A=>A.name.endsWith(".version"));if(h){const A=await h.async("string"),T=Ne.xmlParser.parse(A).Version.VersionId;l=String(T)}if(!(l&&(l==="2.1"||l==="3")))throw new Error(`BCFTopics: ${l} is not supported.`);const u=a.find(A=>A.name.endsWith(".extensions"));if(r&&u){const A=await u.async("string");Vl(this,A)}const d=[],f=this.components.get(te),I=a.filter(A=>A.name.endsWith(".bcfv"));for(const A of I){const T=await A.async("string"),R=Ne.xmlParser.parse(T).VisualizationInfo;if(!R){console.warn("Missing VisualizationInfo in Viewpoint");continue}const F={},{Guid:w,ClippingPlanes:L,Components:N,OrthogonalCamera:M,PerspectiveCamera:z}=R;if(w&&(F.guid=w),N){const{Selection:P,Visibility:C}=N;if(P&&P.Component){const $=Array.isArray(P.Component)?P.Component:[P.Component];F.selectionComponents=$.map(Y=>Y.IfcGuid).filter(Y=>Y)}if(C&&"DefaultVisibility"in C&&(F.defaultVisibility=C.DefaultVisibility),C&&C.Exceptions&&"Component"in C.Exceptions){const{Component:$}=C.Exceptions,Y=Array.isArray($)?$:[$];F.exceptionComponents=Y.map(K=>K.IfcGuid).filter(K=>K)}let v;l==="2.1"&&(v=N.ViewSetupHints),l==="3"&&(v=(_=N.Visibility)==null?void 0:_.ViewSetupHints),v&&("OpeningsVisible"in v&&(F.openingsVisible=v.OpeningsVisible),"SpacesVisible"in v&&(F.spacesVisible=v.SpacesVisible),"SpaceBoundariesVisible"in v&&(F.spaceBoundariesVisible=v.SpaceBoundariesVisible))}if(M||z){const P=R.PerspectiveCamera??R.OrthogonalCamera,{CameraViewPoint:C,CameraDirection:v}=P,$=new W(Number(C.X),Number(C.Z),Number(-C.Y)),Y=new W(Number(v.X),Number(v.Z),Number(-v.Y)),K={position:{x:$.x,y:$.y,z:$.z},direction:{x:Y.x,y:Y.y,z:Y.z},aspectRatio:"AspectRatio"in P?P.AspectRatio:1};"ViewToWorldScale"in P&&(F.camera={...K,viewToWorldScale:P.ViewToWorldScale}),"FieldOfView"in P&&(F.camera={...K,fov:P.FieldOfView})}const O=new Jr(this.components,s,{data:F,setCamera:!1});if(N){const{Coloring:P}=N;if(P&&P.Color){const C=Array.isArray(P.Color)?P.Color:[P.Color];for(const v of C){const{Color:$,Component:Y}=v,G=(Array.isArray(Y)?Y:[Y]).map(it=>it.IfcGuid);O.componentColors.set($,G)}}}if(d.push(O),L){const P=this.components.get(rn),C=Array.isArray(L.ClippingPlane)?L.ClippingPlane:[L.ClippingPlane];for(const v of C){const{Location:$,Direction:Y}=v;if(!($&&Y))continue;const K=new W($.X,$.Z,-$.Y),G=new W(Y.X,-Y.Z,Y.Y),it=P.createFromNormalAndCoplanarPoint(s,G,K);it.visible=!1,it.enabled=!1,O.clippingPlanes.add(it)}}}const p={},m=[],E=a.filter(A=>A.name.endsWith(".bcf"));for(const A of E){const T=await A.async("string"),R=Ne.xmlParser.parse(T).Markup,F=R.Topic,{Guid:w,TopicType:L,TopicStatus:N,Title:M,CreationDate:z,CreationAuthor:O}=F;if(n&&!(w&&L&&N&&M&&z&&O))continue;const P=new hi(this.components);P.guid=w??P.guid;const C=this.getMarkupRelatedTopics(R,l);p[P.guid]=new Set(C),P.type=L??P.type,P.status=N??P.status,P.title=M??P.title,P.creationDate=z?new Date(z):P.creationDate,P.creationAuthor=O??P.creationAuthor,P.serverAssignedId=F.ServerAssignedId,P.priority=F.Priority,P.index=F.Index,P.modifiedDate=F.ModifiedDate?new Date(F.ModifiedDate):void 0,P.modifiedAuthor=F.ModifiedAuthor,P.dueDate=F.DueDate?new Date(F.DueDate):void 0,P.assignedTo=F.AssignedTo,P.description=F.Description,P.stage=F.Stage;const v=this.getMarkupLabels(R,l);for(const K of v)P.labels.add(K);const $=this.getMarkupComments(R,l);for(const K of $)P.comments.set(K.guid,K);const Y=this.getMarkupViewpoints(R,l);for(const K of Y){if(!(K&&K.Guid))continue;const G=f.list.get(K.Guid);G&&P.viewpoints.add(G.guid)}this.list.set(P.guid,P),m.push(P)}for(const A in p){const T=this.list.get(A);if(!T)continue;const R=p[A];for(const F of R)T.relatedTopics.add(F)}return this.onBCFImported.trigger(m),{viewpoints:d,topics:m}}};y(Ne,"uuid","de977976-e4f6-4e4f-a01a-204727839802"),y(Ne,"xmlParser",new Yl.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));let bt=Ne;const Kt=class Kt extends Bt{constructor(t){super(t);y(this,"enabled",!0);y(this,"onDisposed",new st);y(this,"_absoluteMin");y(this,"_absoluteMax");y(this,"_meshes",[]);this.components.add(Kt.uuid,this),this._absoluteMin=Kt.newBound(!0),this._absoluteMax=Kt.newBound(!1)}static getDimensions(t){const{min:s,max:i}=t,n=Math.abs(i.x-s.x),r=Math.abs(i.y-s.y),o=Math.abs(i.z-s.z),a=new W;return a.subVectors(i,s).divideScalar(2).add(s),{width:n,height:r,depth:o,center:a}}static newBound(t){const s=t?1:-1;return new W(s*Number.MAX_VALUE,s*Number.MAX_VALUE,s*Number.MAX_VALUE)}static getBounds(t,s,i){const n=i||this.newBound(!1),r=s||this.newBound(!0);for(const o of t)o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),o.z<r.z&&(r.z=o.z),o.x>n.x&&(n.x=o.x),o.y>n.y&&(n.y=o.y),o.z>n.z&&(n.z=o.z);return new Nt(s,i)}dispose(){const t=this.components.get(je);for(const s of this._meshes)t.destroy(s);this._meshes=[],this.onDisposed.trigger(Kt.uuid),this.onDisposed.reset()}get(){const t=this._absoluteMin.clone(),s=this._absoluteMax.clone();return new Nt(t,s)}getSphere(){const t=this._absoluteMin.clone(),s=this._absoluteMax.clone(),i=Math.abs((s.x-t.x)/2),n=Math.abs((s.y-t.y)/2),r=Math.abs((s.z-t.z)/2),o=new W(t.x+i,t.y+n,t.z+r),a=o.distanceTo(t);return new Ti(o,a)}getMesh(){const t=new Nt(this._absoluteMin,this._absoluteMax),s=Kt.getDimensions(t),{width:i,height:n,depth:r,center:o}=s,a=new Lt(i,n,r),l=new et(a);return this._meshes.push(l),l.position.copy(o),l}reset(){this._absoluteMin=Kt.newBound(!0),this._absoluteMax=Kt.newBound(!1)}add(t){for(const s of t.items)this.addMesh(s.mesh)}addMesh(t,s){if(!t.geometry.index)return;const i=Kt.getFragmentBounds(t);t.updateMatrixWorld();const n=t.matrixWorld,r=new Ft,o=t instanceof oi,a=new Set;if(t instanceof Do){s||(s=t.fragment.ids);for(const l of s){const h=t.fragment.getInstancesIDs(l);if(h)for(const u of h)a.add(u)}}else a.add(0);for(const l of a){const h=i.min.clone(),u=i.max.clone();o&&(t.getMatrixAt(l,r),h.applyMatrix4(r),u.applyMatrix4(r)),h.applyMatrix4(n),u.applyMatrix4(n),h.x<this._absoluteMin.x&&(this._absoluteMin.x=h.x),h.y<this._absoluteMin.y&&(this._absoluteMin.y=h.y),h.z<this._absoluteMin.z&&(this._absoluteMin.z=h.z),h.x>this._absoluteMax.x&&(this._absoluteMax.x=h.x),h.y>this._absoluteMax.y&&(this._absoluteMax.y=h.y),h.z>this._absoluteMax.z&&(this._absoluteMax.z=h.z),u.x>this._absoluteMax.x&&(this._absoluteMax.x=u.x),u.y>this._absoluteMax.y&&(this._absoluteMax.y=u.y),u.z>this._absoluteMax.z&&(this._absoluteMax.z=u.z),u.x<this._absoluteMin.x&&(this._absoluteMin.x=u.x),u.y<this._absoluteMin.y&&(this._absoluteMin.y=u.y),u.z<this._absoluteMin.z&&(this._absoluteMin.z=u.z)}}addFragmentIdMap(t){const s=this.components.get(gt);for(const i in t){const n=s.list.get(i);if(!n)continue;const r=t[i];this.addMesh(n.mesh,r)}}static getFragmentBounds(t){const s=t.geometry.attributes.position,i=Number.MAX_VALUE,n=-i,r=new W(i,i,i),o=new W(n,n,n);if(!t.geometry.index)throw new Error("Geometry must be indexed!");const a=Array.from(t.geometry.index.array);for(let l=0;l<a.length;l++){if(l%3===0&&a[l]===0&&a[l+1]===0&&a[l+2]===0){l+=2;continue}const h=a[l],u=s.getX(h),d=s.getY(h),f=s.getZ(h);u<r.x&&(r.x=u),d<r.y&&(r.y=d),f<r.z&&(r.z=f),u>o.x&&(o.x=u),d>o.y&&(o.y=d),f>o.z&&(o.z=f)}return new Nt(r,o)}};y(Kt,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");let dn=Kt;const mi=class mi extends Bt{constructor(t){super(t);y(this,"enabled",!0);y(this,"list",{});y(this,"onDisposed",new st);y(this,"onFragmentsDisposed",t=>{const{groupID:s,fragmentIDs:i}=t;for(const n in this.list){const r=this.list[n],o=Object.keys(r);if(o.includes(s))delete r[s],Object.values(r).length===0&&delete this.list[n];else for(const a of o){const l=r[a];for(const h of i)delete l.map[h];Object.values(l).length===0&&delete r[a]}}});t.add(mi.uuid,this),t.get(gt).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(gt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(t){for(const s in this.list){const i=this.list[s];for(const n in i){const r=i[n];delete r.map[t]}}}find(t){const s=this.components.get(gt);if(!t){const o={};for(const[a,l]of s.list)o[a]=new Set(l.ids);return o}const i=Object.keys(t).length,n={};for(const o in t){const a=t[o];if(!this.list[o]){console.warn(`Classification ${o} does not exist.`);continue}for(const l of a){const h=this.list[o][l];if(h)for(const u in h.map){n[u]||(n[u]=new Map);for(const d of h.map[u]){const f=n[u].get(d);f===void 0?n[u].set(d,1):n[u].set(d,f+1)}}}}const r={};for(const o in n){const a=n[o];for(const[l,h]of a){if(h===void 0)throw new Error("Malformed fragments map!");h===i&&(r[o]||(r[o]=new Set),r[o].add(l))}}return r}byModel(t,s){this.list.models||(this.list.models={});const i=this.list.models;i[t]||(i[t]={map:{},id:null,name:t});const n=i[t];for(const[r,o]of s.data){const a=o[0];for(const l of a){const h=s.keyFragments.get(l);h&&(n.map[h]||(n.map[h]=new Set),n.map[h].add(r))}}}async byPredefinedType(t){var n;this.list.predefinedTypes||(this.list.predefinedTypes={});const s=this.list.predefinedTypes,i=t.getAllPropertiesIDs();for(const r of i){const o=await t.getProperties(r);if(!o)continue;const a=String((n=o.PredefinedType)==null?void 0:n.value).toUpperCase();s[a]||(s[a]={map:{},id:null,name:a});const l=s[a];for(const[h,u]of t.data){const d=u[0];for(const f of d){const I=t.keyFragments.get(f);if(!I)throw new Error("Fragment ID not found!");l.map[I]||(l.map[I]=new Set),l.map[I].add(o.expressID)}}}}byEntity(t){this.list.entities||(this.list.entities={});for(const[s,i]of t.data){const r=i[1][1],o=Wr[r];this.saveItem(t,"entities",o,s)}}async byIfcRel(t,s,i){Ze.isRel(s)&&await Ze.getRelationMap(t,s,async(n,r)=>{const{name:o}=await Ze.getEntityName(t,n);for(const a of r)this.saveItem(t,i,o??"NO REL NAME",a)})}async bySpatialStructure(t,s={}){var l,h;const i=this.components.get(Qe),n=i.relationMaps[t.uuid];if(!n)throw new Error(`Classifier: model relations of ${t.name||t.uuid} have to exists to group by spatial structure.`);const r="spatialStructures",a=s.useProperties===void 0||s.useProperties;for(const[u]of n){if(s.isolate){const p=t.data.get(u);if(!p)continue;const m=p[1][1];if(m===void 0||!s.isolate.has(m))continue}const d=i.getEntityRelations(t,u,"Decomposes");if(d)for(const p of d){let m=p.toString();if(a){const E=await t.getProperties(p);if(!E)continue;m=(l=E.Name)==null?void 0:l.value}this.saveItem(t,r,m,u,p)}const f=i.getEntityRelations(t,u,"ContainsElements");if(!f)continue;let I=u.toString();if(a){const p=await t.getProperties(u);if(!p)continue;I=(h=p.Name)==null?void 0:h.value}for(const p of f){this.saveItem(t,r,I,p,u);const m=i.getEntityRelations(t,Number(p),"IsDecomposedBy");if(m)for(const E of m)this.saveItem(t,r,I,E,u)}}}setColor(t,s,i=!1){const n=this.components.get(gt);for(const r in t){const o=n.list.get(r);if(!o)continue;const a=t[r];o.setColor(s,a,i)}}resetColor(t){const s=this.components.get(gt);for(const i in t){const n=s.list.get(i);if(!n)continue;const r=t[i];n.resetColor(r)}}saveItem(t,s,i,n,r=null){this.list[s]||(this.list[s]={});const o=t.data.get(n);if(o)for(const a of o[0]){const l=t.keyFragments.get(a);if(l){const h=this.list[s];h[i]||(h[i]={map:{},id:r,name:i}),h[i].map[l]||(h[i].map[l]=new Set),h[i].map[l].add(n)}}}};y(mi,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");let ui=mi;const Ci=class Ci extends Bt{constructor(t){super(t);y(this,"enabled",!0);this.components.add(Ci.uuid,this)}set(t,s){const i=this.components.get(gt);if(!s){for(const[n,r]of i.list)r&&(r.setVisibility(t),this.updateCulledVisibility(r));return}for(const n in s){const r=s[n],o=i.list.get(n);o&&(o.setVisibility(t,r),this.updateCulledVisibility(o))}}isolate(t){this.set(!1),this.set(!0,t)}updateCulledVisibility(t){const s=this.components.get(nn);for(const[i,n]of s.list){const r=n.colorMeshes.get(t.id);r&&(r.count=t.mesh.count)}}};y(Ci,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");let fn=Ci;class Jr{constructor(e,t,s){y(this,"title");y(this,"guid",pe.create());y(this,"clippingPlanes",new Xe);y(this,"camera",{aspectRatio:0,fov:0,direction:{x:0,y:0,z:80},position:{x:0,y:0,z:0}});y(this,"exceptionComponents",new Xe);y(this,"selectionComponents",new Xe);y(this,"componentColors",new fe);y(this,"spacesVisible",!1);y(this,"spaceBoundariesVisible",!1);y(this,"openingsVisible",!1);y(this,"defaultVisibility",!0);y(this,"_components");y(this,"world");const i={setCamera:!0,...s},{data:n,setCamera:r}=i;this._components=e,this.world=t,n&&(this.guid=n.guid??this.guid,this.set(n)),r&&this.updateCamera()}get _selectionModelIdMap(){const e=this._components.get(gt),t={};for(const[s,i]of e.groups){s in t||(t[s]=new Set);for(const n of this.selectionComponents){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return t}get _exceptionModelIdMap(){const e=this._components.get(gt),t={};for(const[s,i]of e.groups){s in t||(t[s]=new Set);for(const n of this.exceptionComponents){const r=i.globalToExpressIDs.get(n);r&&t[s].add(r)}}return t}get selection(){return this._components.get(gt).modelIdToFragmentIdMap(this._selectionModelIdMap)}get exception(){return this._components.get(gt).modelIdToFragmentIdMap(this._exceptionModelIdMap)}get projection(){return"fov"in this.camera?"Perspective":"Orthographic"}get position(){const e=this._components.get(gt),{position:t}=this.camera,{x:s,y:i,z:n}=t,r=new W(s,i,n);return e.applyBaseCoordinateSystem(r,new Ft),r}get direction(){const{direction:e}=this.camera,{x:t,y:s,z:i}=e;return new W(t,s,i)}get _managerVersion(){return this._components.get(bt).config.version}get topics(){return[...this._components.get(bt).list.values()].filter(i=>i.viewpoints.has(this.guid))}addComponentsFromMap(e){const s=this._components.get(gt).fragmentIdMapToGuids(e);this.selectionComponents.add(...s),this._components.get(te).list.set(this.guid,this)}set(e){const t=e,s=this;for(const n in e){if(n==="guid")continue;const r=t[n];if(n==="selectionComponents"){this.selectionComponents.clear(),this.selectionComponents.add(...r);continue}if(n==="exceptionComponents"){this.exceptionComponents.clear(),this.exceptionComponents.add(...r);continue}n in this&&(s[n]=r)}return this._components.get(te).list.set(this.guid,this),this}async go(e=!0){const{camera:t}=this.world;if(!t.hasCameraControls())throw new Error("Viewpoint: the world's camera need controls to set the viewpoint.");t instanceof Ic&&t.projection.set(this.projection);const s=this.position,i=this.direction;let n={x:s.x+i.x*80,y:s.y+i.y*80,z:s.z+i.z*80};const r=this.selection;if(Object.keys(r).length===0){const h=this._components.get(ws).get(this.world).castRayFromVector(s,this.direction);h&&(n=h.point)}else{const a=this._components.get(dn);a.reset(),a.addFragmentIdMap(r),n=a.getSphere().center,a.reset()}const o=this._components.get(fn);o.set(this.defaultVisibility),o.set(!this.defaultVisibility,this.exception),o.set(!0,r),await t.controls.setLookAt(s.x,s.y,s.z,n.x,n.y,n.z,e)}updateCamera(){const{camera:e,renderer:t}=this.world;if(!t)throw new Error("Viewpoint: the world needs to have a renderer!");if(!e.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");const s=new W;e.controls.getPosition(s);const i=e.three,n=new W(0,0,-1).applyEuler(i.rotation),{width:r,height:o}=t.getSize();let a=r/o;Number.isNaN(a)&&(a=1);const l=this._components.get(gt);s.applyMatrix4(l.baseCoordinationMatrix.clone().invert());const h={aspectRatio:a,position:{x:s.x,y:s.y,z:s.z},direction:{x:n.x,y:n.y,z:n.z}};i instanceof Lr?this.camera={...h,fov:i.fov}:i instanceof En&&(this.camera={...h,viewToWorldScale:i.top-i.bottom}),this._components.get(te).list.set(this.guid,this)}colorize(){const e=this._components.get(te),t=this._components.get(gt),s=this._components.get(ui);for(const[i,n]of this.componentColors){const r=t.guidToFragmentIdMap(n),o=new mn(`#${i}`);s.setColor(r,o,e.config.overwriteColors)}}resetColors(){const e=this._components.get(gt),t=this._components.get(ui);for(const[s,i]of this.componentColors){const n=e.guidToFragmentIdMap(i);t.resetColor(n)}}async createComponentTags(e){var n,r;const t=this._components.get(gt),s=this._components.get(bt);let i="";if(s.config.includeSelectionTag){const o=e==="selection"?this._selectionModelIdMap:this._exceptionModelIdMap;for(const a in o){const l=t.groups.get(a);if(!l)continue;const h=o[a];for(const u of h){const d=await l.getProperties(u);if(!d)continue;const f=(n=d.GlobalId)==null?void 0:n.value;if(!f)continue;const I=(r=d.Tag)==null?void 0:r.value;let p=null;I&&(p=`AuthoringToolId="${I}"`),i+=`
<Component IfcGuid="${f}" ${p??""} />`}}}else i=[...this.selectionComponents].map(o=>`<Component IfcGuid="${o}" />`).join(`
`);return i}async serialize(e=this._managerVersion){const t=this._components.get(gt),s=this.position;s.applyMatrix4(t.baseCoordinationMatrix.clone().invert());const i=this.direction;i.normalize();const n=new Ft().makeRotationX(Math.PI/2),r=i.clone().applyMatrix4(n);r.normalize();const o=`<CameraViewPoint>
      <X>${s.x}</X>
      <Y>${-s.z}</Y>
      <Z>${s.y}</Z>
    </CameraViewPoint>`,a=`<CameraDirection>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraDirection>`,l=`<CameraUpVector>
      <X>${r.x}</X>
      <Y>${-r.z}</Y>
      <Z>${r.y}</Z>
    </CameraUpVector>`,h=`<AspectRatio>${this.camera.aspectRatio}</AspectRatio>`;let u="";"viewToWorld"in this.camera?u=`<OrthogonalCamera>
        ${o}
        ${a}
        ${l}
        ${h}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(u=`<PerspectiveCamera>
        ${o}
        ${a}
        ${l}
        ${h}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);const d=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,f=(await this.createComponentTags("selection")).trim(),I=(await this.createComponentTags("exception")).trim();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${e==="2.1"?d:""}
        ${f.length!==0?`<Selection>${f}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${e==="3"?d:""}
          ${I.length!==0?`<Exceptions>${I}</Exceptions>`:""}
        </Visibility>
      </Components>
      ${u}
    </VisualizationInfo>`}}const gi=class gi extends Bt{constructor(t){super(t);y(this,"enabled",!0);y(this,"list",new fe);y(this,"isSetup",!1);y(this,"onSetup",new st);y(this,"config",{overwriteColors:!1});y(this,"onDisposed",new st);t.add(gi.uuid,this)}create(t,s){const i=new Jr(this.components,t,{data:s});return s||this.list.set(i.guid,i),i}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};y(gi,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");let te=gi;export{bt as B,sn as C,je as D,st as E,gt as F,an as I,vn as S,pe as U,te as V,li as W,Qe as a,Ze as b,cn as c,Ha as d,Bt as e};
